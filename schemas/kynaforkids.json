[{
  "table_name": "report_studio_role",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.report_studio_role`\n(\n  studio_id INT64,\n  role STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n)\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "package_category",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.package_category`\n(\n  id INT64,\n  name STRING,\n  slug STRING,\n  icon_url STRING,\n  image_url STRING,\n  visible INT64,\n  is_feature INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  `order` INT64,\n  image_alt STRING,\n  seo_name STRING,\n  show_footer INT64,\n  type INT64,\n  level INT64,\n  package_slug STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_teacher_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_log`\n(\n  id INT64,\n  booking_id INT64,\n  begin_at INT64,\n  end_at INT64,\n  teacher_id INT64,\n  action INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ai_tutor_rating_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.ai_tutor_rating_view`\nAS SELECT * except(created_at,updated_at),\r\n      timestamp_seconds(created_at) as created_at,\r\n      timestamp_seconds(updated_at) as updated_at,\r\nFROM `kynaforkids-server-production.kynaforkids.ai_tutor_rating`;"
}, {
  "table_name": "booking_student_session",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_session`\n(\n  student_id INT64,\n  schedule_id INT64,\n  date INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n);"
}, {
  "table_name": "b2b_student",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.b2b_student`\n(\n  student_id INT64,\n  company_id INT64,\n  department_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (student_id) NOT ENFORCED\n)\nCLUSTER BY student_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_pronunciation_lesson",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_pronunciation_lesson`\n(\n  id INT64,\n  name STRING,\n  ai_pronunciation_topic_id INT64,\n  banner STRING,\n  description_1 STRING,\n  description_2 STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "group_talk_scheduler",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.group_talk_scheduler`\n(\n  id INT64,\n  group_talk_id INT64,\n  type INT64,\n  time INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_statistical_automapping",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_statistical_automapping`\n(\n  id INT64,\n  booking_id INT64,\n  teacher_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_fixed_schedule_bonus",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_fixed_schedule_bonus`\n(\n  id INT64,\n  booking_session_id INT64,\n  teacher_id INT64,\n  student_id INT64,\n  student_code STRING,\n  begin_at INT64,\n  status INT64,\n  status_after_complain INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_class_lesson_student",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_class_lesson_student`\n(\n  booking_class_lesson_id INT64,\n  student_program_lesson_id INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n)\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "summer_camp_student_homework_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.summer_camp_student_homework_log`\n(\n  id INT64,\n  camp_id INT64,\n  student_id INT64,\n  summer_camp_stage_id INT64,\n  lesson_camp_config_id INT64,\n  point INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "missions",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.missions`\n(\n  id INT64,\n  object_type INT64,\n  point STRING,\n  description STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_teacher_caresoft_balancer",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_caresoft_balancer`\n(\n  id INT64,\n  ip_phone STRING,\n  in_use INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ai_idiom_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_idiom_config`\n(\n  id INT64,\n  ai_topic_id INT64,\n  structure STRING,\n  grammar STRING,\n  `using` STRING,\n  translate STRING,\n  example STRING,\n  example_translate STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "summer_camp_student",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.summer_camp_student`\n(\n  id INT64,\n  camp_id INT64,\n  student_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  group_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "interview_bbb_report",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.interview_bbb_report`\n(\n  interview_id INT64,\n  internal_id STRING,\n  bbb_server_point INT64,\n  start_time INT64,\n  end_time INT64,\n  duration INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (internal_id, interview_id) NOT ENFORCED\n)\nCLUSTER BY internal_id, interview_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_study_mode_activity_type",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_study_mode_activity_type`\n(\n  id INT64,\n  name STRING,\n  command STRING,\n  description STRING,\n  scenario_start STRING,\n  scenario_check STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  stage_id INT64,\n  visible INT64,\n  data_type_id INT64,\n  number_of_times INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "user_access_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.user_access_log`\n(\n  id INT64,\n  user_id INT64,\n  uuid STRING,\n  mobile_name STRING,\n  mobile_type STRING,\n  mobile_os STRING,\n  user_agent STRING,\n  is_deleted INT64,\n  created_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "admin_user_menu_access",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.admin_user_menu_access`\n(\n  id INT64,\n  user_id INT64,\n  menu_id INT64,\n  total_access INT64,\n  link STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_center",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_center`\n(\n  id INT64,\n  name STRING,\n  number_of_student INT64,\n  number_registered INT64,\n  ops_manager_id INT64,\n  visible INT64,\n  subject INT64,\n  center_type INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_lead_status",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_lead_status`\n(\n  id INT64,\n  name STRING,\n  upsell INT64,\n  step INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "quiz_session",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.quiz_session`\n(\n  id INT64,\n  status INT64,\n  start_time INT64,\n  end_time INT64,\n  total_score FLOAT64,\n  user_id INT64,\n  quiz_id INT64,\n  is_passed INT64,\n  is_booking_practice INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ops_manager",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ops_manager`\n(\n  ops_manager_id INT64,\n  ops_id INT64,\n  is_available INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (ops_id, ops_manager_id) NOT ENFORCED\n)\nCLUSTER BY ops_id, ops_manager_id;"
}, {
  "table_name": "wh_reason",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.wh_reason`\n(\n  id INT64,\n  name STRING,\n  type INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "teacher_income",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.teacher_income`\n(\n  course_id INT64,\n  period_time INT64,\n  total_minutes_view INT64,\n  guaranteed_income NUMERIC(12),\n  performance_income NUMERIC(12),\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n);"
}, {
  "table_name": "booking_student_extra_lesson",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_extra_lesson`\n(\n  student_id INT64,\n  level_id INT64,\n  num_of_extra_lesson INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n);"
}, {
  "table_name": "booking_teacher_scheduler",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_scheduler`\n(\n  id INT64,\n  teacher_id INT64,\n  params STRING,\n  type INT64,\n  time INT64,\n  is_executed INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ai_study_mode_lesson",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_study_mode_lesson`\n(\n  id INT64,\n  name STRING,\n  banner STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  ai_study_mode_level_id INT64,\n  intro_video STRING,\n  flow_type_id INT64,\n  what_you_will_learn STRING,\n  document_link STRING,\n  end_video STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "skill",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.skill`\n(\n  id INT64,\n  name STRING,\n  slug STRING,\n  visible INT64,\n  `order` INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "affiliate_post_sample_tag",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.affiliate_post_sample_tag`\n(\n  affiliate_post_sample_id INT64,\n  affiliate_slug_tag STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (affiliate_post_sample_id, affiliate_slug_tag) NOT ENFORCED\n)\nCLUSTER BY affiliate_post_sample_id, affiliate_slug_tag;"
}, {
  "table_name": "package_combo_item",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.package_combo_item`\n(\n  id INT64,\n  package_combo_id INT64,\n  package_id INT64,\n  `order` INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_lesson_extend_data",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_lesson_extend_data`\n(\n  id INT64,\n  booking_lesson_id INT64,\n  vocabulary STRING,\n  grammar_and_structure STRING,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  mapping_lesson_id STRING,\n  class_exercise_link STRING,\n  student_duo_room_note STRING,\n  teacher_duo_room_note STRING,\n  duo_video_ids STRING,\n  mapping_lesson_foreign_id STRING,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "international_country",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.international_country`\n(\n  id INT64,\n  name STRING,\n  code STRING,\n  currency_code STRING,\n  currency_decimals INT64,\n  visible INT64,\n  language_code STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  phone_code STRING,\n  is_active INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "writing_toeic_session",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.writing_toeic_session`\n(\n  id INT64,\n  status INT64,\n  start_time INT64,\n  end_time INT64,\n  total_score FLOAT64,\n  is_graded INT64,\n  user_id INT64,\n  quiz_id INT64,\n  is_passed INT64,\n  is_booking_practice INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_national_shift_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_national_shift_config`\n(\n  id INT64,\n  national_id INT64,\n  program_id INT64,\n  number_of_shift INT64,\n  max_salary NUMERIC(15, 2),\n  max_bonus NUMERIC(15, 2),\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_difficulty_level",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_difficulty_level`\n(\n  id INT64,\n  name STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "big_query_scheduler",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.big_query_scheduler`\n(\n  id INT64,\n  table_name STRING,\n  type INT64,\n  record_id STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_lead_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.booking_lead_view`\nAS SELECT        \r\n    * EXCEPT(created_at, updated_at, create_order_at, approved_at),       \r\n    TIMESTAMP_SECONDS(created_at) as created_at,       \r\n    TIMESTAMP_SECONDS(updated_at) as updated_at,       \r\n    TIMESTAMP_SECONDS(create_order_at) as create_order_at,       \r\n    TIMESTAMP_SECONDS(approved_at) as approved_at,FROM `kynaforkids-server-production.kynaforkids.booking_lead`;"
}, {
  "table_name": "ai_picture_mode_skill",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_picture_mode_skill`\n(\n  id INT64,\n  name STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "task_management_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.task_management_view`\nAS SELECT * except(approved_at,created_at,updated_at),\r\n      timestamp_seconds(approved_at) as approved_at,\r\n      timestamp_seconds(created_at) as created_at,\r\n      timestamp_seconds(updated_at) as updated_at,\r\n\r\nFROM `kynaforkids-server-production.kynaforkids.task_management`;"
}, {
  "table_name": "ltv_report_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.ltv_report_view`\nAS WITH main_table AS (\r\n\r\n      SELECT \r\n      t1.student_name AS student_name\r\n      , if(t1.student_code is null, t1.phone_number, t1.student_code) as student_code\r\n      , t1.order_code\r\n      , (t1.tong_thu) AS tong_thu\r\n      , DATETIME_TRUNC(timestamp_seconds(t1.don_ghi_danh_lan_dau),MONTH) AS don_ghi_danh_lan_dau\r\n      , DATETIME_TRUNC(timestamp_seconds(t1.accounting_date), MONTH) as accounting_date\r\n      , datetime_diff(DATETIME_TRUNC(PARSE_DATE(\u0027%Y%m%d\u0027,@DS_END_DATE),MONTH),DATETIME_TRUNC(DATE(timestamp_seconds(t1.don_ghi_danh_lan_dau)),MONTH),MONTH) as max_no_month_ranges\r\n      , datetime_diff(DATETIME_TRUNC(DATE(timestamp_seconds(t1.accounting_date)),MONTH),DATETIME_TRUNC(DATE(timestamp_seconds(t1.don_ghi_danh_lan_dau)),MONTH),MONTH) as retention_months\r\n      , datetime_diff(DATETIME_TRUNC(PARSE_DATE(\u0027%Y%m%d\u0027,@DS_END_DATE),MONTH),DATETIME_TRUNC(PARSE_DATE(\u0027%Y%m%d\u0027,@DS_START_DATE),MONTH),MONTH) as max_cohort_ranges\r\n      , t1.country\r\n      , t1.user_type\r\n\r\n      FROM\r\n      (\r\n        SELECT\r\n        bo.student_code_1 AS student_code\r\n        , (SELECT MAX(p.`name`) FROM `kynaforkids-server-production.kynaforkids.profile` p ,\r\n          `kynaforkids-server-production.kynaforkids.booking_student` bst WHERE bst.student_code \u003d bo.student_code_1 AND p.user_id \u003d bst.user_id\r\n        ) AS student_name\r\n        , (bo.phone_number) AS phone_number\r\n        , (bo.Order_Code) as order_code\r\n        , (bo.Original_Price * bo.Ex)  AS tong_thu\r\n        --, (SELECT MIN(bos.Date) FROM `kynaforkids-server-production.kynaforkids.Acc_Order_Tutoring_No_Students`  bos\r\n        --WHERE bos.student_code_1 \u003d bo.student_code_1 AND bos.Payment_Content not in (\u0027Đơn hoàn tiền\u0027,\u0027Hoàn tiền\u0027,\u0027Học thử\u0027) and bos.student_code_1 is not null -- and bos.total_lesson \u003e\u003d 10\r\n        --group by bos.student_code_1\r\n        -- ) AS don_ghi_danh_lan_dau\r\n        -- Diep adding start 15-03-2025\r\n        , (SELECT MIN(bos.accounting_date) FROM `kynaforkids-server-production.kynaforkids.Acc_Order_Tutoring_No_Students`  bos\r\n          WHERE bos.student_code_1 \u003d bo.student_code_1 AND bos.Payment_Content not in (\u0027Đơn hoàn tiền\u0027,\u0027Hoàn tiền\u0027,\u0027Học thử\u0027) and bos.student_code_1 is not null -- and bos.total_lesson \u003e\u003d 10\r\n          group by bos.student_code_1\r\n        ) AS don_ghi_danh_lan_dau\r\n        ,bo.accounting_date as accounting_date\r\n        -- Diep adding end 15-03-2025\r\n        --, bo.Date as accounting_date\r\n        , (bo.Market)  AS country\r\n        , (CASE (bo.user_type_id)\r\n          WHEN 1 THEN \u0027Kid\u0027\r\n          WHEN 2 THEN \u0027Adult\u0027\r\n          END ) AS user_type\r\n        FROM `kynaforkids-server-production.kynaforkids.Acc_Order_Tutoring_No_Students`  bo\r\n        WHERE bo.Payment_Content not in (\u0027Đơn hoàn tiền\u0027,\u0027Hoàn tiền\u0027,\u0027Học thử\u0027) -- and bo.total_lesson \u003e\u003d 10\r\n        AND bo.student_code_1 is not null and (DATE(bo.Date)  \u003e\u003d PARSE_DATE(\u0027%Y%m%d\u0027, @DS_START_DATE)\r\n          AND DATE(bo.Date) \u003c\u003d PARSE_DATE(\u0027%Y%m%d\u0027, @DS_END_DATE))\r\n\r\n        UNION ALL\r\n\r\n        SELECT \r\n        NULL AS student_code\r\n        , (bo.name) as student_name\r\n        , (bo.phone_number) as phone_number\r\n        , (bo.Order_Code) as order_code\r\n        , (bo.Original_Price * bo.Ex)  AS tong_thu\r\n        --, (SELECT MIN(bos.Date) FROM `kynaforkids-server-production.kynaforkids.Acc_Order_Tutoring_No_Students`  bos\r\n         -- WHERE bos.phone_number \u003d bo.phone_number AND bos.Payment_Content not in (\u0027Đơn hoàn tiền\u0027,\u0027Hoàn tiền\u0027,\u0027Học thử\u0027) and bos.student_code_1 is null -- and bos.total_lesson \u003e\u003d 10\r\n         -- group by bos.phone_number\r\n        --) AS don_ghi_danh_lan_dau\r\n        \r\n        -- diep start 15-03-2025\r\n        , (SELECT MIN(bos.accounting_date) FROM `kynaforkids-server-production.kynaforkids.Acc_Order_Tutoring_No_Students`  bos\r\n          WHERE bos.phone_number \u003d bo.phone_number AND bos.Payment_Content not in (\u0027Đơn hoàn tiền\u0027,\u0027Hoàn tiền\u0027,\u0027Học thử\u0027) and bos.student_code_1 is null -- and bos.total_lesson \u003e\u003d 10\r\n          group by bos.phone_number\r\n        ) AS don_ghi_danh_lan_dau\r\n        , bo.accounting_date\r\n        -- diep end 15-03-2025\r\n        \r\n        --, bo.Date\r\n        , (bo.Market)  AS country\r\n        , ( CASE (bo.user_type_id)\r\n          WHEN 1 THEN \u0027Kid\u0027\r\n          WHEN 2 THEN \u0027Adult\u0027\r\n          END ) AS user_type\r\n\r\n        FROM `kynaforkids-server-production.kynaforkids.Acc_Order_Tutoring_No_Students` bo\r\n        WHERE bo.Payment_Content not in (\u0027Đơn hoàn tiền\u0027,\u0027Hoàn tiền\u0027,\u0027Học thử\u0027) -- and bo.total_lesson \u003e\u003d 10\r\n        AND bo.student_code_1 is null and (DATE(bo.Date) \u003e\u003d PARSE_DATE(\u0027%Y%m%d\u0027, @DS_START_DATE)\r\n          AND DATE(bo.Date) \u003c\u003d PARSE_DATE(\u0027%Y%m%d\u0027,@DS_END_DATE))\r\n      ) t1\r\n   \r\n   WHERE \r\n    (\r\n      DATE(timestamp_seconds(t1.don_ghi_danh_lan_dau)) \u003e\u003d PARSE_DATE(\u0027%Y%m%d\u0027, @DS_START_DATE) \r\n      AND (DATE(timestamp_seconds(t1.don_ghi_danh_lan_dau)) \u003c\u003d PARSE_DATE(\u0027%Y%m%d\u0027,@DS_END_DATE))\r\n    )\r\n )\r\n\r\nSELECT  ma.student_code\r\n       ,ma.student_name\r\n       ,ma.order_code\r\n       ,sum(ma.tong_thu) as tong_thu\r\n       ,ma.don_ghi_danh_lan_dau\r\n       ,ma.accounting_date\r\n       ,ma.max_no_month_ranges\r\n       ,ma.retention_months\r\n       ,ma.max_cohort_ranges\r\n       ,max(ma.country) as country\r\n       ,max(ma.user_type) as user_type\r\n FROM main_table ma\r\n GROUP BY ma.don_ghi_danh_lan_dau, ma.accounting_date, ma.student_code, ma.student_name, ma.order_code ,ma.max_no_month_ranges ,ma.retention_months ,ma.max_cohort_ranges\r\n;"
}, {
  "table_name": "booking_order_exception_policy",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_order_exception_policy`\n(\n  id INT64,\n  booking_order_id INT64,\n  data STRING,\n  status INT64,\n  manager_note STRING,\n  approval_note STRING,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "order_1_1_min_tao_don",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.order_1_1_min_tao_don`\nAS select \r\n    date(min(bo.created_at)) as ngay_tao_don,\r\n    bo.email,\r\n    bo.program_id\r\n  from `kynaforkids-server-production.kynaforkids.booking_order_view` bo\r\n  where bo.payment_status \u003d 1\r\n  group by bo.email, bo.program_id;"
}, {
  "table_name": "affiliate_tag",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.affiliate_tag`\n(\n  slug STRING,\n  name STRING,\n  is_tag_landing_page INT64,\n  is_tag_post_sample INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (slug) NOT ENFORCED\n)\nCLUSTER BY slug;"
}, {
  "table_name": "package_level",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.package_level`\n(\n  id INT64,\n  name STRING,\n  `order` INT64,\n  knowledge STRING,\n  num_of_vocabulary INT64,\n  num_of_sentence INT64,\n  num_of_grammar INT64,\n  package_id INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ceo_cac_tester_cost_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.ceo_cac_tester_cost_view`\nAS with tester_booking_cost_data as\r\n(\r\nselect \r\n\r\n  -- t1.booking_id,\r\n  t1.booking_time,\r\n  -- t1.booking_type,\r\n  -- t1.num_shift,\r\n  -- t1.teacher_name,\r\n  t1.teacher_country,\r\n  -- t1.booking_status,\r\n  t1.program,\r\n  -- t1.teacher_id,\r\n  -- t1.payment_content,\r\n  -- t1.teacher_source,\r\n  t1.student_country,\r\n  -- if(sum(t1.revenue) is null,0,sum(t1.revenue)) as revenue_oc,\r\n  -- if(sum(t1.revenue) is null,0,(sum(t1.revenue) * if(avg(t1.currency_exchange_rate) is null, 1, avg(t1.currency_exchange_rate)))) as revenue_vnd,\r\n  max(s2.sellingEx) as sellingEx,\r\n  if(max(t1.income) is null, 0,max(t1.income))  + if(max(t1.bonus_income) is null, 0, max(t1.bonus_income))\r\n  + if(max(bsi.bonus_test_online_early_review) is null, 0, max(bsi.bonus_test_online_early_review))\r\n  + if(max(bsi.bonus_test_online_golden_hour) is null, 0, max(bsi.bonus_test_online_golden_hour))\r\n  - if(max(bsi.open_webcam_below_standard_penalty) is null, 0, max(bsi.open_webcam_below_standard_penalty))\r\n  - if(max(bsi.full_face_below_standard_penalty) is null, 0, max(bsi.full_face_below_standard_penalty))\r\n  - if(max(bsi.etiquette_violation_penalty) is null, 0, max(bsi.etiquette_violation_penalty))\r\n  - if(max(t1.rating_below_standard_penalty) is null, 0,max(t1.rating_below_standard_penalty)) \r\n  - if(max(t1.cancel_penalty_income) is null, 0, max(t1.cancel_penalty_income))  as total_income,\r\n\r\n  countif(t1.booking_status \u003d \u0027Completed\u0027) as booking_completed\r\n  \r\n  \r\nfrom (\r\nSELECT \r\n  bs.id as booking_id,\r\n  bs.begin_at as booking_time,\r\n  \r\n  -- case\r\n  --     when bs.is_compensatory_course \u003d 1 then \u0027buoi_bu\u0027\r\n  --     else \u0027buoi_chinh_thuc\u0027\r\n  -- end as booking_type,\r\n\r\n  -- (select max(p.`name`) from `kynaforkids-server-production.kynaforkids.profile` p where p.user_id \u003d bs.teacher_id) as teacher_name,\r\n  case\r\n    when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 1 then \u0027Philippines\u0027\r\n    when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 2 then \u0027Native\u0027\r\n    when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 3 then \u0027Vietnamese\u0027\r\n    when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 4 then \u0027Thailand\u0027\r\n    when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 5 then \u0027Indonesia\u0027\r\n  when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 8 then \u0027Laos\u0027\r\n  when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 9 then \u0027Malaysia\u0027\r\n  end as teacher_country,\r\n  `kynaforkids-server-production.kynaforkids.func_get_booking_status`(bs.status_id, bs.cancel_config_id) as booking_status,\r\n  -- (select bp.number_of_shift from `kynaforkids-server-production.kynaforkids.booking_program` bp where bp.id \u003d bs.program_id ) as num_shift,\r\n  \r\n  (`kynaforkids-server-production.kynaforkids.func_get_program_name_from_id`(bs.program_id)) as program,\r\n  -- bs.teacher_id,\r\n\r\n  -- case\r\n  --   when (select min(cast(bo.payment_content as INT64)) from `kynaforkids-server-production.kynaforkids.booking_order` bo\r\n  --   where  bo.student_payment_id \u003d bss.student_payment_id) \u003d 1 then \u0027Buổi Học thử\u0027\r\n  --   when (select bph.payment_fee from `kynaforkids-server-production.kynaforkids.booking_payment_history` bph \r\n  --   where bph.id \u003d bss.student_payment_id) \u003d 0  then \u0027Buổi tặng\u0027\r\n  --   else \u0027Buổi Ghi danh\u0027\r\n  -- end as payment_content,\r\n  \r\n  -- (select bt.teacher_source from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bs.teacher_id \u003d bt.user_id) as teacher_source,\r\n  `kynaforkids-server-production.kynaforkids.func_get_booking_student_country`((select bst.country_id from  `kynaforkids-server-production.kynaforkids.booking_student` bst \r\n  where bs.id \u003d bss.booking_session_id and bss.student_id \u003d bst.user_id)) as student_country,\r\n  bss.revenue,\r\n  bss.currency_exchange_rate,\r\n  bs.income,\r\n (bs.bonus_income + (select max(bse.bonus_excess) from `kynaforkids-server-production.kynaforkids.booking_session_extend_bonus` bse \r\n  where bse.booking_id \u003d bs.id)) as bonus_income,\r\n  bs.rating_below_standard_penalty,\r\n  bs.cancel_penalty_income,\r\n  \r\nFROM `kynaforkids-server-production.kynaforkids.booking_session_view` bs\r\ninner join `kynaforkids-server-production.kynaforkids.booking_session_student` bss on bs.id \u003d bss.booking_session_id \r\n--where bs.program_id not in (5,14,15,21,22,46,52,61,62,63,64,65,66,67,88,102)\r\nwhere bs.program_id not in (select id from `kynaforkids-server-production.kynaforkids.booking_program` where type in (2,3,4) or program_type \u003d 1)\r\n      and bs.status_id \u003d 5\r\n) t1\r\ninner join `kynaforkids-server-production.kynaforkids.booking_session_student` bss on t1.booking_id \u003d bss.booking_session_id\r\n\r\nleft join `kynaforkids-server-production.kynaforkids.booking_session_income` bsi on t1.booking_id \u003d bsi.booking_session_id\r\n\r\njoin\r\n\r\n(select t3.date, t3.sellingEx, t3.teacherCountry,\r\n  lead (t3.date) over (partition by t3.teacherCountry order by t3.date) as next_applied_date\r\n  from kynaforkids-server-production.kynaforkids.Acc_teacher_income_ex t3) s2\r\n\r\non date(t1.booking_time) \u003e\u003d s2.date and (date(t1.booking_time) \u003c s2.next_applied_date or s2.next_applied_date is null) and t1.teacher_country \u003d s2.teacherCountry\r\n\r\n--group by booking_id, booking_time, booking_type, teacher_name, teacher_country, booking_status, program, num_shift, teacher_id, payment_content, teacher_source, student_country\r\n\r\nwhere t1.program like \u0027%Test%\u0027\r\ngroup by booking_id, booking_time, teacher_country, booking_status, program, student_country\r\n),\r\n\r\ntemp_table_1 as \r\n(\r\nselect \r\n      FORMAT_DATE(\u0027%Y-%m\u0027, tbc.booking_time) AS year_month,\r\n    --  tbc.student_country,\r\n      ROUND(SUM(tbc.total_income * tbc.sellingEx)) as tester_booking_cost,\r\n      SUM(coalesce(tbc.booking_completed,0)) as num_booking_completed,\r\n      case when SUM(coalesce(tbc.booking_completed,0)) \u003d 0 then null \r\n           else \r\n                ROUND(SUM(tbc.total_income * tbc.sellingEx)/SUM(coalesce(tbc.booking_completed,0))) \r\n        end as cost_per_booking,\r\n\r\n      -- SUM(case\r\n      --         when tbc.total_income \u003d 0 or tbc.total_income is null then 0\r\n      --         else 1\r\n      --     end\r\n      -- ) as num_teacher_cost_booking,\r\n      -- SUM(tbc.total_income * tbc.sellingEx) /   SUM(case\r\n      --         when tbc.total_income \u003d 0 or tbc.total_income is null then 0\r\n      --         else 1\r\n      --     end\r\n      -- ) as cost_per_teacher_cost_booking\r\n\r\nfrom tester_booking_cost_data tbc \r\nwhere date(tbc.booking_time) \u003e\u003d \u00272024-01-01\u0027\r\ngroup by year_month--, tbc.student_country\r\norder by year_month desc\r\n),\r\n\r\ntemp_table_2 as\r\n(\r\nselect \r\n      tt.*,\r\n      -- ctv_cost.ctv_cost as ctv_month_cost,\r\n      toa.test_other_adjustment\r\nfrom temp_table_1 tt\r\n-- left join `kynaforkids-server-production.nhan_kynaforkids.ceo_cac_ctv_PT_cost` ctv_cost on tt.year_month \u003d ctv_cost.year_month\r\nleft join `kynaforkids-server-production.kynaforkids.ceo_cac_tester_other_adjustment` toa on tt.year_month \u003d toa.year_month\r\n),\r\n\r\ntemp_table_3 as\r\n(\r\nselect \r\n      *,\r\n      --28920833 as avg_month_ctv_pt_2024,\r\n      --4365 as avg_booking_adjustment_2024,\r\n      -- IF(year_month \u003e\u003d \u00272025-01\u0027,ROUND(28920833 * CAST(EXTRACT(DAY FROM CURRENT_DATE()) AS BIGNUMERIC) / EXTRACT(DAY FROM LAST_DAY(CURRENT_DATE()))),null) AS projected_ctv_month_cost,\r\n      IF(year_month \u003e\u003d \u00272025-01\u0027,ROUND(4365 * tt.num_booking_completed),null) as projected_month_adjustment,\r\n\r\nfrom temp_table_2 tt \r\norder by year_month desc\r\n)\r\n\r\nselect \r\n        *,\r\n        -- if(ctv_month_cost is null, projected_ctv_month_cost, ctv_month_cost) as calc_ctv_month_cost,\r\n        if(test_other_adjustment is null, projected_month_adjustment, test_other_adjustment) as calc_month_adjustment, \r\n        -- if(ctv_month_cost is null, projected_ctv_month_cost, ctv_month_cost) +\r\n        if(test_other_adjustment is null, projected_month_adjustment, test_other_adjustment) + tester_booking_cost as total_test_cost  \r\n        -- bao gồm booking theo ca đã hoàn thành, dự báo chi phí ctv theo ngày hiện  tại và dự báo chi phí adjust theo số booking đã hoàn thành\r\nfrom temp_table_3 tt\r\nwhere year_month \u003c\u003d FORMAT_DATE(\u0027%Y-%m\u0027, current_date())\r\n;"
}, {
  "table_name": "commission_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.commission_config`\n(\n  id INT64,\n  name STRING,\n  affiliate_group_id INT64,\n  affiliate_is_teacher INT64,\n  teacher_commission_percent FLOAT64,\n  affiliate_commission_percent FLOAT64,\n  start_date INT64,\n  end_date INT64,\n  country_id INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_order_video_course",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_order_video_course`\n(\n  id INT64,\n  booking_order_id INT64,\n  booking_package_subscription_config_id INT64,\n  price NUMERIC(15, 2),\n  currency STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  promotion_code STRING,\n  price_after_discount NUMERIC(10, 2),\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "summer_camp_ticket_info",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.summer_camp_ticket_info`\n(\n  id INT64,\n  phone_number STRING,\n  student_code STRING,\n  student_id INT64,\n  number_of_weeks INT64,\n  status INT64,\n  begin_at INT64,\n  end_at INT64,\n  source_type INT64,\n  source_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  access_code STRING,\n  noti_status_id INT64,\n  send_noti_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "game",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.game`\n(\n  id INT64,\n  game_type_id INT64,\n  lesson_id INT64,\n  `order` INT64,\n  visible INT64,\n  json_data STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  layout_type INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_schedule",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_schedule`\n(\n  id INT64,\n  name STRING,\n  begin_at INT64,\n  end_at INT64,\n  visible INT64,\n  `order` INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  student_country_applied STRING,\n  teacher_country_applied STRING,\n  except_program STRING,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "writing_main_criteria",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.writing_main_criteria`\n(\n  id INT64,\n  name STRING,\n  css_class STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "quiz_score_toeic_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.quiz_score_toeic_config`\n(\n  id INT64,\n  score INT64,\n  listening_point INT64,\n  reading_point INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  point INT64,\n  type INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "menu_role",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.menu_role`\n(\n  menu_id INT64,\n  role STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n)\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "sms_template",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.sms_template`\n(\n  id INT64,\n  type INT64,\n  template STRING,\n  region_code INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "bot_parameter",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.bot_parameter`\n(\n  key STRING,\n  description STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (key) NOT ENFORCED\n)\nCLUSTER BY key\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "outline_detail",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.outline_detail`\n(\n  id INT64,\n  outline_id INT64,\n  level_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "potential_booking_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.potential_booking_log`\n(\n  id INT64,\n  booking_id INT64,\n  is_accepted_from_potential INT64,\n  teacher_session_status_before INT64,\n  is_fixed_teacher INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "Test_student_teacher_math",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.Test_student_teacher_math`\nAS -- Data cũ: https://docs.google.com/spreadsheets/d/1k1SzjiDqt0JNSiDiO6PnPNDQHs4AyM9PdaV6isxUZk4/edit?gid\u003d0#gid\u003d0\r\n-- ngaltt cập nhập ngày 16/08/2024\r\nselect \r\nt1.student_code as MaHV,\r\nsum(t1.nhom_50) as total_hv,\r\nsum(t1.nhom_40) as total_hv_40,\r\nmax(t1.email) as Email, \r\nmax(t1.phone_number) as Phone, \r\nmax(t1.name) as GiaoVien,\r\nCASE\r\n    WHEN max (t1.international_country_id) \u003d 1 THEN \u0027Thailand\u0027\r\n    WHEN max (t1.international_country_id) \u003d 2 THEN \u0027Indo\u0027\r\n    WHEN max (t1.international_country_id) \u003d 3 THEN \u0027VietNam\u0027\r\n    WHEN max (t1.international_country_id) \u003d 4 THEN \u0027Khac\u0027\r\n    WHEN max (t1.international_country_id) \u003d 5 THEN \u0027Lao\u0027\r\n    WHEN max (t1.international_country_id) \u003d 6 THEN \u0027Malaysia\u0027\r\nEND as QuocGia,\r\nmax(t1.international_country_id) as international_country_id,\r\nmax (t1.teacher_id) as TeacherID,\r\n-- nhom 50\r\nsum(t1.total_dat) as total_dat,\r\nsum(t1.total_khongdat)  as total_khongdat,\r\nsum(t1.total_duoichuan) as total_duoichuan,\r\nsum(t1.total_nopay) as total_nopay,\r\n-- nhom 40\r\nsum(t1.total_dat_40) as total_dat_40,\r\nsum(t1.total_khongdat_40)  as total_khongdat_40,\r\nsum(t1.total_duoichuan_40) as total_duoichuan_40,\r\nsum(t1.total_nopay_40) as total_nopay_40,\r\n\r\nmax(t1.begin_at) as begin_at\r\n from\r\n(\r\nSELECT \r\nbo.student_code,\r\nbo.email,\r\nbo.phone_number,\r\nbo.international_country_id,\r\nsessionStudent.teacher_id,\r\nsessionStudent.begin_at,\r\nif(sessionStudent.program_id in (47,48,53,54,55,56) and sessionStudent.rating \u003d 2,1,0) as total_dat,\r\nif(sessionStudent.program_id in (47,48,53,54,55,56) and sessionStudent.rating \u003d 1,1,0)  as total_khongdat,\r\nif(sessionStudent.program_id in (47,48,53,54,55,56) and sessionStudent.rating \u003d 3,1,0) as total_duoichuan,\r\nif(sessionStudent.program_id in (47,48,53,54,55,56) and sessionStudent.rating \u003d 4,1,0) as total_nopay,\r\nif(sessionStudent.program_id in (47,48,53,54,55,56), 1, 0) as nhom_50,\r\n\r\nif(sessionStudent.program_id in (89,90) and sessionStudent.rating \u003d 2,1,0) as total_dat_40,\r\nif(sessionStudent.program_id in (89,90) and sessionStudent.rating \u003d 1,1,0)  as total_khongdat_40,\r\nif(sessionStudent.program_id in (89,90) and sessionStudent.rating \u003d 3,1,0) as total_duoichuan_40,\r\nif(sessionStudent.program_id in (89,90) and sessionStudent.rating \u003d 4,1,0) as total_nopay_40,\r\nif(sessionStudent.program_id in (89,90), 1, 0) as nhom_40,\r\np.name\r\nFROM `kynaforkids-server-production.kynaforkids.booking_order` bo\r\nINNER JOIN `kynaforkids-server-production.kynaforkids.booking_student` bst ON bst.student_code \u003d bo.student_code\r\nINNER JOIN (\r\nSELECT bss.student_id, bs.name, bs.teacher_id, bs.rating, date(bs.begin_at) as begin_at, bs.program_id\r\nFROM `kynaforkids-server-production.kynaforkids.booking_session_student` bss\r\nINNER JOIN `kynaforkids-server-production.kynaforkids.booking_session_view` bs ON bs.id \u003d bss.booking_session_id\r\nWHERE bs.status_id IN (5)\r\nAND bs.program_id IN (47,48,53,54,55,56,89, 90)\r\n) sessionStudent ON sessionStudent.student_id \u003d bst.user_id\r\nINNER JOIN `kynaforkids-server-production.kynaforkids.profile` p ON p.user_id \u003d sessionStudent.teacher_id\r\nWHERE  bo.status \u003d 4\r\nAND bo.payment_status \u003d 1\r\nAND cast(bo.payment_content as INT64) in (2, 1)\r\n) t1\r\n-- where t1.teacher_id \u003d 1460188\r\n-- and ( t1.begin_at \u003e\u003d \u00272024-06-01\u0027 and t1.begin_at \u003c\u003d \u00272024-06-30\u0027)\r\nGROUP BY t1.student_code\r\n;"
}, {
  "table_name": "ai_study_mode_sample_sentence",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_study_mode_sample_sentence`\n(\n  id INT64,\n  content STRING,\n  translate STRING,\n  banner STRING,\n  ai_study_mode_lesson_id INT64,\n  ai_study_mode_activity_type_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "international_province",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.international_province`\n(\n  id INT64,\n  country_id INT64,\n  name STRING,\n  local_name STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "redmine_task_assign_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.redmine_task_assign_config`\n(\n  category_id INT64,\n  subcategory_id STRING,\n  assignee_config STRING,\n  watcher_config STRING,\n  hour_handle INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n)\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_student_program",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_program`\n(\n  user_id INT64,\n  program_id INT64,\n  total_lesson INT64,\n  refundable_lesson INT64,\n  refundable_gift_lesson INT64,\n  total_gift_lesson INT64,\n  remain_lesson INT64,\n  remain_class INT64,\n  teacher_priority_id STRING,\n  student_priority_id STRING,\n  student_exclude_id STRING,\n  learning_type INT64,\n  start_level_id INT64,\n  current_level_id INT64,\n  quality_training INT64,\n  quality_refund INT64,\n  quality_private_session INT64,\n  start_at INT64,\n  expired_at INT64,\n  student_status INT64,\n  curriculum_type INT64,\n  country_id INT64,\n  user_type_id INT64,\n  is_complete INT64,\n  apply_priority_date_at INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  reserve_at INT64,\n  date_of_reservation INT64,\n  teacher_exclude_id STRING,\n  teacher_gender_priority INT64,\n  lms_type INT64,\n  record_number INT64,\n  status INT64,\n  bk_remain_lesson INT64,\n  priority_country_group_region_ids STRING,\n  max_students INT64,\n  is_lock INT64,\n  is_divided_lesson INT64,\n  is_lesson_separate INT64,\n  is_learning_weekly INT64,\n  dev_note INT64,\n  only_map_fixed_teacher INT64,\n  is_odd_number_priority_date INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  is_accepted_economy INT64,\n  accepted_economy_at INT64,\n  PRIMARY KEY (user_id, program_id) NOT ENFORCED\n)\nCLUSTER BY user_id, program_id;"
}, {
  "table_name": "summer_camp_stage",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.summer_camp_stage`\n(\n  id INT64,\n  camp_id INT64,\n  name STRING,\n  begin_at INT64,\n  end_at INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "mkt_table_temp_data_nhap_lieu",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.kynaforkids.mkt_table_temp_data_nhap_lieu`\n(\n  phone_number STRING\n)\nOPTIONS(\n  sheet_range\u003d\"A:A\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/1S0LUuHu1WPWcgs1UgZ32OfzGg9B4HAAAGyCTmhPW834/edit?gid\u003d1799636986#gid\u003d1799636986\"]\n);"
}, {
  "table_name": "timesheet",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.timesheet`\n(\n  id INT64,\n  start_time INT64,\n  end_time INT64,\n  monday STRING,\n  tuesday STRING,\n  wednesday STRING,\n  thursday STRING,\n  friday STRING,\n  saturday STRING,\n  sunday STRING,\n  type STRING,\n  role STRING,\n  country_code STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "report_category",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.report_category`\n(\n  id INT64,\n  name STRING,\n  payment_gateway_id INT64,\n  template_upload STRING,\n  big_query_table STRING,\n  template_columns STRING,\n  is_update INT64,\n  visible INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "wheel_camp_product",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.wheel_camp_product`\n(\n  id INT64,\n  name STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  type INT64,\n  params JSON,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "b2b_student_program_report",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.b2b_student_program_report`\n(\n  student_id INT64,\n  program_id INT64,\n  total_booking_completed INT64,\n  total_booking_compensatory INT64,\n  total_booking_cancel_not_compensatory INT64,\n  total_lesson INT64,\n  total_homework INT64,\n  total_homework_completed INT64,\n  percent_homework_completed INT64,\n  total_score_homework_with_checkpoint INT64,\n  total_homework_with_checkpoint INT64,\n  percent_homework_with_checkpoint INT64,\n  total_score_homework_without_checkpoint INT64,\n  total_homework_without_checkpoint INT64,\n  percent_homework_without_checkpoint INT64,\n  video_booking_completed STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (program_id, student_id) NOT ENFORCED\n)\nCLUSTER BY program_id, student_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "wh_inventory_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.wh_inventory_view`\nAS SELECT * except(created_at,updated_at),\r\n      timestamp_seconds(created_at) as created_at,\r\n      timestamp_seconds(updated_at) as updated_at,\r\nFROM `kynaforkids-server-production.kynaforkids.wh_inventory`;"
}, {
  "table_name": "mkt_line_performance_by_new_students_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.mkt_line_performance_by_new_students_view`\nAS WITH aff_campaign_inf AS\r\n(\r\n  SELECT\r\n    aci.`campaign_id`,\r\n    ac.name as campaign_name,\r\n    date(TIMESTAMP_SECONDS(aci.`date`)+ INTERVAL 7 HOUR) as date_spend,\r\n    aci.`spend`,\r\n    ac.account_id,\r\n    ac.channel_id,\r\n    ac.effective_status,\r\n    ac.product_id,\r\n    ac.user_id,\r\n    ac.country_id,\r\n    ac.line_id,\r\n  \r\n    CASE\r\n          WHEN ac.channel_id \u003d 1 AND  date(TIMESTAMP_SECONDS(aci.`date`)+ INTERVAL 7 HOUR) \u003e\u003d \u00272025-03-01\u0027 THEN ROUND(1.05 * aci.spend)\r\n          WHEN ac.channel_id \u003d 1 AND  date(TIMESTAMP_SECONDS(aci.`date`)+ INTERVAL 7 HOUR) \u003c \u00272025-03-01\u0027 THEN ROUND(1.07 * aci.spend)\r\n          WHEN ac.channel_id \u003d 2 THEN ROUND(1.05 * aci.spend)\r\n          WHEN ac.channel_id \u003d 3 THEN ROUND(1.05 * aci.spend)\r\n    END AS spend_with_tax,\r\n  FROM\r\n    `kynaforkids-server-production.kynaforkids.adwords_meta_campaign_insight` aci\r\n\r\n  LEFT JOIN `kynaforkids-server-production.kynaforkids.adwords_meta_campaign` ac\r\n        ON  ac.id \u003d aci.campaign_id\r\n  WHERE date(TIMESTAMP_SECONDS(aci.`date`)) \u003e\u003d \u00272022-01-01\u0027\r\n\r\n),\r\n\r\nline_name_spend as(\r\n  SELECT  ci.date_spend, ci.channel_id, ci.product_id, ci.country_id, \r\n        SUM(ci.spend) as spend, SUM(ci.spend_with_tax) as spend_with_tax,\r\n        CASE WHEN ci.line_id is not null then line.name\r\n             ELSE \u0027Line_without_ID\u0027\r\n        END as line_mkt\r\n  FROM aff_campaign_inf ci\r\n  LEFT JOIN `kynaforkids-server-production.kynaforkids.adwords_meta_line` line ON(line.id \u003d ci.line_id)\r\n  GROUP BY ci.date_spend, line_mkt, ci.country_id, ci.channel_id, ci.product_id\r\n  ORDER BY date_spend \r\n),\r\n\r\n\r\n\r\nline_lead_date AS \r\n(\r\nSELECT \r\n        lead_date, line_id,\r\n        SUM(num_leads) as num_leads,\r\n        SUM(num_leads_test_approved) as num_leads_test_approved,\r\n        SUM(num_leads_test) as num_leads_test,\r\n        SUM(leads_wait_for_order) as leads_wait_for_order,\r\n        max(country_id) as country_id,\r\n\r\nFROM\r\n(\r\nSELECT\r\n       date(blv.created_at) as lead_date, \r\n        blv.affiliate_campaign as utm_campaign,\r\n        -- MAX(blv.country_id) as country_id,\r\n        COUNTIF(blv.id is not null and blv.Bloked_Open \u003d \u0027Open\u0027) as num_leads,\r\n        COUNT(blv.test_approved_lead_id) as num_leads_test_approved,\r\n        COUNTIF(blv.nhan_xet_gv \u003d \u0027Đã có nhận xét\u0027) as num_leads_test,\r\n        COUNTIF(blv.lead_status \u003d \u0027Ghi danh - Chờ lên đơn\u0027 and blv.Bloked_Open \u003d \u0027Open\u0027) as leads_wait_for_order,\r\n\r\n        if((select max(auc.country_id) from `kynaforkids-server-production.kynaforkids.adwords_utm_campaign` auc where lower(name) \u003d lower(blv.affiliate_campaign)) is null,\r\n            max(blv.country_id), \r\n            (select max(auc.country_id) from `kynaforkids-server-production.kynaforkids.adwords_utm_campaign` auc where lower(name) \u003d lower(blv.affiliate_campaign))) as country_id,\r\n        \r\n        (SELECT max(line_id) FROM `kynaforkids-server-production.kynaforkids.adwords_utm_campaign` \r\n         WHERE lower(name) \u003d lower(blv.affiliate_campaign)) as line_id,\r\n  FROM `kynaforkids-server-production.kynaforkids.mkt_booking_lead_view` blv\r\n  WHERE -- blv.sourse \u003d \u0027Marketing\u0027  \r\n       date(blv.created_at) \u003e\u003d \u00272022-01-01\u0027\r\n    -- AND blv.Bloked_Open \u003d \u0027Open\u0027\r\n    -- AND blv.sale_email !\u003d \u0027lp.marketing@kynaforkids.vn\u0027\r\n    AND blv.id NOT IN\r\n        (\r\n          SELECT blv.id \r\n          FROM  `kynaforkids-server-production.kynaforkids.mkt_booking_lead_view` blv\r\n          WHERE   \r\n                   date(blv.created_at) \u003e\u003d \u00272022-01-01\u0027\r\n               AND blv.reason_cancel_id IN (\u002720\u0027,\u002718\u0027,\u002717\u0027,\u00279\u0027,\u00278\u0027)\r\n        )\r\n  GROUP BY lead_date, blv.affiliate_campaign, line_id\r\n  ORDER By lead_date\r\n)\r\nGROUP BY lead_date, line_id\r\n)\r\n,\r\n\r\nline_order_date AS (\r\nSELECT\r\n        date(oc.ngay_tao_don) as order_date,\r\n        -- date(oc.accounting_date) as order_date, \r\n        (SELECT MAX(line_id) FROM `kynaforkids-server-production.kynaforkids.adwords_utm_campaign` \r\n         WHERE lower(name) \u003d lower(oc.affiliate_campaign)) as line_id,\r\n        -- oc.affiliate_campaign as utm_campaign,\r\n        MAX(oc.country_id) as country_id,\r\n        SUM(oc.total_VND) as order_value,\r\n        COUNT(oc.order_id) as num_orders,\r\nFROM `kynaforkids-server-production.kynaforkids.mkt_booking_order_old_new_students_view` oc\r\nWHERE \r\n      date(oc.ngay_tao_don) \u003e\u003d \u00272022-01-01\u0027 \r\nGROUP BY order_date, line_id\r\nORDER BY order_date \r\n),\r\n\r\nline_lead_order AS\r\n(\r\nSELECT \r\n        IF(lld.lead_date is null, lod.order_date, lld.lead_date) as calc_date, \r\n        lld.lead_date,\r\n        lod.order_date,\r\n        IF(lld.line_id is null, lod.line_id, lld.line_id) as line_id,\r\n        lld.line_id as line_id_lead, \r\n        lod.line_id as line_id_od, \r\n        lld.num_leads, \r\n        lld.num_leads_test, \r\n        lld.num_leads_test_approved, \r\n        lld.leads_wait_for_order, \r\n        lod.num_orders, \r\n        lod.order_value,\r\n        IF(lld.country_id is null, lod.country_id, lld.country_id) as country_id, \r\nFROM line_lead_date lld\r\nFULL JOIN line_order_date lod\r\nON (lld.lead_date \u003d lod.order_date AND lld.line_id \u003d lod.line_id)\r\n),\r\n\r\nline_name_lead_order AS (\r\nSELECT\r\n    llo.calc_date,\r\n    SUM(num_leads) as num_leads, SUM(num_leads_test) as num_leads_test, SUM(num_leads_test_approved) as num_leads_test_approved, SUM(num_orders) as num_orders, SUM(leads_wait_for_order) as leads_wait_for_order, SUM(order_value) as order_value,\r\n    CASE WHEN llo.line_id is not null then line.name\r\n        ELSE \u0027Line_without_ID\u0027\r\n    END AS line_mkt,\r\n    IF(llo.country_id is null, (SELECT max(auc.country_id) FROM `kynaforkids-server-production.kynaforkids.adwords_utm_campaign` auc \r\n         WHERE llo.line_id \u003d auc.line_id), llo.country_id) as country_id,\r\n    \r\n    (SELECT max(auc.product_id) FROM `kynaforkids-server-production.kynaforkids.adwords_utm_campaign` auc \r\n         WHERE llo.line_id \u003d auc.line_id) as product_id,\r\n\r\n    (SELECT max(auc.channel_id) FROM `kynaforkids-server-production.kynaforkids.adwords_utm_campaign` auc \r\n         WHERE llo.line_id \u003d auc.line_id) as channel_id,         \r\nFROM line_lead_order llo\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.adwords_meta_line` line ON(line.id \u003d llo.line_id)\r\nGROUP BY llo.calc_date, line_mkt, country_id, channel_id, product_id\r\nORDER BY calc_date\r\n),\r\n\r\nperformance_table as \r\n(SELECT \r\n  IF(lot.calc_date is null, sp.date_spend, lot.calc_date) as calc_date,\r\n  IF(lot.line_mkt is null, sp.line_mkt, lot.line_mkt) as line_mkt,\r\n--   IF(lot.country_id is null, sp.country_id, lot.country_id) as country_id,\r\n  IF(sp.country_id is null, lot.country_id, sp.country_id) as country_id,\r\n  -- lot.country_id as country_id,\r\n  IF(lot.channel_id is null, sp.channel_id, lot.channel_id) as channel_id,\r\n  IF(lot.product_id is null, sp.product_id, lot.product_id) as product_id,\r\n  SUM(sp.spend) as spend, \r\n  SUM(sp.spend_with_tax) as spend_with_tax,\r\n  SUM(lot.num_leads) as num_leads,\r\n  SUM(lot.num_leads_test) as num_leads_test,\r\n  SUM(lot.num_leads_test_approved) as num_leads_test_approved,\r\n  SUM(lot.leads_wait_for_order) as leads_wait_for_order,\r\n  SUM(lot.num_orders) as num_orders,\r\n  SUM(lot.order_value) as order_value,\r\n  \r\nFROM line_name_lead_order lot\r\nFULL JOIN line_name_spend sp\r\n-- ON (lot.calc_date \u003d sp.date_spend AND lot.line_mkt \u003d sp.line_mkt)\r\nON (lot.calc_date \u003d sp.date_spend AND lot.line_mkt \u003d sp.line_mkt AND lot.country_id \u003d sp.country_id AND lot.channel_id \u003d sp.channel_id AND lot.product_id\u003dsp.product_id) \r\n\r\nGROUP BY calc_date, line_mkt, country_id, channel_id, product_id\r\nORDER BY calc_date \r\n),\r\n\r\norganic_detail as(\r\nselect calc_date,\r\n      sum(case when line_mkt  \u003d \u0027Organic FB KID\u0027 then num_leads*0.1\r\n      end) as num_leads_fb_kid,\r\n      sum(case when line_mkt  \u003d \u0027Organic FB KEA\u0027 then num_leads*0.1\r\n      end) as num_leads_kea,\r\n      sum(case when line_mkt  \u003d \u0027Organic FB KID\u0027 then num_leads_test*0.1\r\n      end) as num_leads_test_fb_kid,\r\n      sum(case when line_mkt  \u003d \u0027Organic FB KEA\u0027 then num_leads_test*0.1\r\n      end) as num_leads_test_kea,\r\n      sum(case when line_mkt  \u003d \u0027Organic FB KID\u0027 then num_leads_test_approved*0.1\r\n      end) as num_leads_test_approved_fb_kid,\r\n      sum(case when line_mkt  \u003d \u0027Organic FB KEA\u0027 then num_leads_test_approved*0.1\r\n      end) as num_leads_test_approved_kea,\r\n      sum(case when line_mkt  \u003d \u0027Organic FB KID\u0027 then leads_wait_for_order*0.1\r\n      end) as leads_wait_for_order_fb_kid,\r\n      sum(case when line_mkt  \u003d \u0027Organic FB KEA\u0027 then leads_wait_for_order*0.1\r\n      end) as leads_wait_for_order_kea,\r\n      sum(case when line_mkt  \u003d \u0027Organic FB KID\u0027 then num_orders*0.1\r\n      end) as num_orders_fb_kid,\r\n      sum(case when line_mkt  \u003d \u0027Organic FB KEA\u0027 then num_orders*0.1\r\n      end) as num_orders_kea,\r\n      sum(case when line_mkt  \u003d \u0027Organic FB KID\u0027 then order_value*0.1\r\n      end) as order_value_fb_kid,\r\n      sum(case when line_mkt  \u003d \u0027Organic FB KEA\u0027 then order_value*0.1\r\n      end) as order_value_kea,\r\nfrom performance_table \r\nwhere line_mkt  \u003d \u0027Organic FB KID\u0027 or line_mkt  \u003d \u0027Organic FB KEA\u0027\r\ngroup by calc_date\r\n),\r\n\r\nresult as(\r\nselect * except(num_leads,num_leads_fb_kid,num_leads_kea,num_leads_test,num_leads_test_fb_kid,num_leads_test_kea,num_leads_test_approved,num_leads_test_approved_fb_kid,num_leads_test_approved_kea,leads_wait_for_order,leads_wait_for_order_fb_kid,leads_wait_for_order_kea,num_orders,num_orders_fb_kid,num_orders_kea,order_value,order_value_fb_kid,order_value_kea),\r\n       case when line_mkt  \u003d \u0027Organic FB KID\u0027 then o.num_leads_fb_kid\r\n            when line_mkt  \u003d \u0027Đan KE11\u0027 then coalesce(num_leads,0) + coalesce(o.num_leads_fb_kid*4,0) --if(num_leads_fb_kid is null, num_leads,o.num_leads_fb_kid*4)\r\n            when line_mkt  \u003d \u0027Đan KEVN\u0027 and pt.product_id \u003d 1 then coalesce(num_leads,0) + coalesce(o.num_leads_fb_kid*2.5,0) -- if(num_leads_fb_kid is null, num_leads,o.num_leads_fb_kid*2.5)\r\n            when line_mkt  \u003d \u0027Nhung KID CVS \u0027 then coalesce(num_leads,0) + coalesce(o.num_leads_fb_kid*2.5,0) --if(o.num_leads_fb_kid is null, num_leads,o.num_leads_fb_kid*2.5)\r\n            when line_mkt  \u003d \u0027Organic FB KEA\u0027 then o.num_leads_kea\r\n            when line_mkt  \u003d \u0027Đan KEA\u0027 then coalesce(num_leads,0) + coalesce(o.num_leads_kea*6.5,0) -- if(num_leads_kea is null, num_leads,o.num_leads_kea*6.5)\r\n            when line_mkt  \u003d \u0027Nhung KEA CVS\u0027 then coalesce(num_leads,0) + coalesce(o.num_leads_kea*2.5,0) --if(num_leads_kea is null, num_leads,o.num_leads_kea*2.5)\r\n            else num_leads\r\n       end as num_leads,\r\n\r\n       case when line_mkt  \u003d \u0027Organic FB KID\u0027 then o.num_leads_test_fb_kid\r\n            when line_mkt  \u003d \u0027Đan KE11\u0027 then coalesce(num_leads_test,0) + coalesce(o.num_leads_test_fb_kid*4,0) \r\n            when line_mkt  \u003d \u0027Đan KEVN\u0027 and pt.product_id \u003d 1 then coalesce(num_leads_test,0) + coalesce(o.num_leads_test_fb_kid*2.5,0)\r\n            when line_mkt  \u003d \u0027Nhung KID CVS \u0027 then coalesce(num_leads_test,0) + coalesce(o.num_leads_test_fb_kid*2.5,0)     when line_mkt  \u003d \u0027Organic FB KEA\u0027 then o.num_leads_test_kea\r\n            when line_mkt  \u003d \u0027Đan KEA\u0027 then coalesce(num_leads_test,0) + coalesce(o.num_leads_test_kea*6.5,0)\r\n            when line_mkt  \u003d \u0027Nhung KEA CVS\u0027 then coalesce(num_leads_test,0) + coalesce(o.num_leads_test_kea*2.5,0)\r\n            else num_leads_test\r\n       end as num_leads_test,\r\n\r\n       case when line_mkt  \u003d \u0027Organic FB KID\u0027 then o.num_leads_test_approved_fb_kid\r\n            when line_mkt  \u003d \u0027Đan KE11\u0027 then coalesce(num_leads_test_approved,0) + coalesce(o.num_leads_test_approved_fb_kid*4,0) \r\n            when line_mkt  \u003d \u0027Đan KEVN\u0027 and pt.product_id \u003d 1 then coalesce(num_leads_test_approved,0) + coalesce(o.num_leads_test_approved_fb_kid*2.5,0)\r\n            when line_mkt  \u003d \u0027Nhung KID CVS \u0027 then coalesce(num_leads_test_approved,0) + coalesce(o.num_leads_test_approved_fb_kid*2.5,0)     when line_mkt  \u003d \u0027Organic FB KEA\u0027 then o.num_leads_test_approved_kea\r\n            when line_mkt  \u003d \u0027Đan KEA\u0027 then coalesce(num_leads_test_approved,0) + coalesce(o.num_leads_test_approved_kea*6.5,0)\r\n            when line_mkt  \u003d \u0027Nhung KEA CVS\u0027 then coalesce(num_leads_test_approved,0) + coalesce(o.num_leads_test_approved_kea*2.5,0)\r\n            else num_leads_test_approved\r\n       end as num_leads_test_approved,\r\n\r\n       case when line_mkt  \u003d \u0027Organic FB KID\u0027 then o.leads_wait_for_order_fb_kid\r\n            when line_mkt  \u003d \u0027Đan KE11\u0027 then coalesce(leads_wait_for_order,0) + coalesce(o.leads_wait_for_order_fb_kid*4,0) \r\n            when line_mkt  \u003d \u0027Đan KEVN\u0027 and pt.product_id \u003d 1 then coalesce(leads_wait_for_order,0) + coalesce(o.leads_wait_for_order_fb_kid*2.5,0)\r\n            when line_mkt  \u003d \u0027Nhung KID CVS \u0027 then coalesce(leads_wait_for_order,0) + coalesce(o.leads_wait_for_order_fb_kid*2.5,0)     when line_mkt  \u003d \u0027Organic FB KEA\u0027 then o.leads_wait_for_order_kea\r\n            when line_mkt  \u003d \u0027Đan KEA\u0027 then coalesce(leads_wait_for_order,0) + coalesce(o.leads_wait_for_order_kea*6.5,0)\r\n            when line_mkt  \u003d \u0027Nhung KEA CVS\u0027 then coalesce(leads_wait_for_order,0) + coalesce(o.leads_wait_for_order_kea*2.5,0)\r\n            else leads_wait_for_order\r\n       end as leads_wait_for_order,\r\n\r\n       case when line_mkt  \u003d \u0027Organic FB KID\u0027 then o.num_orders_fb_kid\r\n            when line_mkt  \u003d \u0027Đan KE11\u0027 then coalesce(num_orders,0) + coalesce(o.num_orders_fb_kid*4,0) \r\n            when line_mkt  \u003d \u0027Đan KEVN\u0027 and pt.product_id \u003d 1 then coalesce(num_orders,0) + coalesce(o.num_orders_fb_kid*2.5,0)\r\n            when line_mkt  \u003d \u0027Nhung KID CVS \u0027 then coalesce(num_orders,0) + coalesce(o.num_orders_fb_kid*2.5,0)     when line_mkt  \u003d \u0027Organic FB KEA\u0027 then o.num_orders_kea\r\n            when line_mkt  \u003d \u0027Đan KEA\u0027 then coalesce(num_orders,0) + coalesce(o.num_orders_kea*6.5,0)\r\n            when line_mkt  \u003d \u0027Nhung KEA CVS\u0027 then coalesce(num_orders,0) + coalesce(o.num_orders_kea*2.5,0)\r\n            else num_orders\r\n       end as num_orders,\r\n\r\n       case when line_mkt  \u003d \u0027Organic FB KID\u0027 then o.order_value_fb_kid\r\n            when line_mkt  \u003d \u0027Đan KE11\u0027 then coalesce(leads_wait_for_order,0) + coalesce(o.order_value_fb_kid*4,0) \r\n            when line_mkt  \u003d \u0027Đan KEVN\u0027 and pt.product_id \u003d 1 then coalesce(order_value,0) + coalesce(o.order_value_fb_kid*2.5,0)\r\n            when line_mkt  \u003d \u0027Nhung KID CVS \u0027 then coalesce(order_value,0) + coalesce(o.order_value_fb_kid*2.5,0)     when line_mkt  \u003d \u0027Organic FB KEA\u0027 then o.order_value_kea\r\n            when line_mkt  \u003d \u0027Đan KEA\u0027 then coalesce(order_value,0) + coalesce(o.order_value_kea*6.5,0)\r\n            when line_mkt  \u003d \u0027Nhung KEA CVS\u0027 then coalesce(order_value,0) + coalesce(o.order_value_kea*2.5,0)\r\n            else order_value\r\n       end as order_value,\r\n\r\nfrom performance_table pt\r\nleft join organic_detail o using(calc_date)\r\n)\r\n\r\nSELECT pt.*,\r\n      case \r\n          WHEN country_id \u003d 1 THEN \u0027Thailand\u0027\r\n          WHEN country_id \u003d 2 THEN \u0027Indo\u0027\r\n          WHEN country_id \u003d 3 THEN \u0027Việt Nam\u0027\r\n          WHEN country_id \u003d 4 THEN \u0027Khác\u0027\r\n          WHEN country_id \u003d 5 THEN \u0027Lào\u0027\r\n          WHEN country_id \u003d 6 THEN \u0027Malaysia\u0027\r\n          else \"Chưa biết\"\r\n      end as country,\r\n\r\n      case \r\n            when product_id \u003d 1 then \u0027Kids - 1 kèm 1\u0027\r\n            when product_id \u003d 2 then \u0027KEA - 1 kèm 1\u0027\r\n            when product_id \u003d 3 then \u0027Toán - 1 kèm 1\u0027\r\n            when product_id \u003d 4 then \u0027Kids - Class\u0027\r\n            when product_id \u003d 5 then \u0027Tuyển dụng GV\u0027\r\n            when product_id \u003d 6 then \u0027Khác\u0027\r\n            when product_id \u003d 7 then \u0027AI Tutor\u0027\r\n            else \"Chưa biết\"\r\n      end as product_name,\r\n\r\n      case \r\n          when channel_id \u003d 1 then \u0027Facebook\u0027\r\n          when channel_id \u003d 2 then \u0027Tiktok\u0027\r\n          when channel_id \u003d 3 then \u0027Google\u0027\r\n          else \"Chưa biết\"\r\n      end as channel_name\r\n\r\n\r\nFROM result pt\r\n;"
}, {
  "table_name": "booking_student_scheduler",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_scheduler`\n(\n  id INT64,\n  student_id INT64,\n  user_type_id INT64,\n  type INT64,\n  time INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  data STRING,\n  is_executed INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  program_id INT64,\n  schedule_status_id INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "wheel_camp_user_code",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.wheel_camp_user_code`\n(\n  id INT64,\n  type_code INT64,\n  source_id INT64,\n  phone_number STRING,\n  code STRING,\n  status INT64,\n  expired_at INT64,\n  used_at INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  wheel_camp_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "quiz_question",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.quiz_question`\n(\n  id INT64,\n  quiz_part_id INT64,\n  question_image_url STRING,\n  question_image_height INT64,\n  answer_image_url STRING,\n  answer_image_height INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  stage_question STRING,\n  stage_answer STRING,\n  question_image_width NUMERIC(13, 2),\n  answer_image_width NUMERIC(13, 2),\n  `order` INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  object_id INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_student_priority_teacher_request",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_priority_teacher_request`\n(\n  id INT64,\n  request_id INT64,\n  teacher_id INT64,\n  booking_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_monitor_issue",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_monitor_issue`\n(\n  id INT64,\n  name STRING,\n  type INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  is_show INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_student_economy_request",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_economy_request`\n(\n  id INT64,\n  request_id INT64,\n  student_id INT64,\n  program_id INT64,\n  is_economy INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ticket_comment",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ticket_comment`\n(\n  id INT64,\n  ticket_id INT64,\n  comment STRING,\n  role_comment INT64,\n  media_url STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  is_kyna_read INT64,\n  is_teacher_read INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  visible INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "offline_event_student_test",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.offline_event_student_test`\n(\n  id INT64,\n  offline_event_student_id INT64,\n  quiz_id INT64,\n  quiz_session_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  quiz_type INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "adwords_meta_campaign_insight",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.adwords_meta_campaign_insight`\n(\n  campaign_id STRING,\n  date INT64,\n  spend_oc INT64,\n  spend INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  spend_after_tax INT64,\n  PRIMARY KEY (date, campaign_id) NOT ENFORCED\n)\nCLUSTER BY date, campaign_id;"
}, {
  "table_name": "adwords_meta_campaign",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.adwords_meta_campaign`\n(\n  id STRING,\n  account_id STRING,\n  name STRING,\n  channel_id INT64,\n  effective_status STRING,\n  visible INT64,\n  product_id INT64,\n  user_id INT64,\n  country_id INT64,\n  line_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_teacher_location",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_location`\n(\n  booking_teacher_id INT64,\n  country_id INT64,\n  province_id INT64,\n  district_id INT64,\n  ward_id INT64,\n  address STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (booking_teacher_id) NOT ENFORCED\n)\nCLUSTER BY booking_teacher_id;"
}, {
  "table_name": "ai_practice_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_practice_config`\n(\n  id INT64,\n  ai_topic_id INT64,\n  name STRING,\n  type INT64,\n  speech_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "qa_ticket_status",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.qa_ticket_status`\n(\n  id INT64,\n  name STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_teacher_lead_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.booking_teacher_lead_view`\nAS SELECT * except(created_at,updated_at,`order`),\r\n      timestamp_seconds(created_at) as created_at,\r\n      timestamp_seconds(updated_at) as updated_at,\r\n      timestamp_seconds(`order`) as `order`\r\nFROM `kynaforkids-server-production.kynaforkids.booking_teacher_lead`;"
}, {
  "table_name": "aca_tc_interview_list_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.aca_tc_interview_list_view`\nAS SELECT \r\n      id, name, email, phone_number,       \r\n      date(TIMESTAMP_SECONDS(birthday)) as birthday,      \r\n      case when gender \u003d 1 then \u0027Nam\u0027\r\n           when gender \u003d 2 then \u0027Nữ\u0027\r\n      end as sex,\r\n      `kynaforkids-server-production.kynaforkids.func_get_country_teacher`(country_id) as country,\r\n      if(is_tester \u003d 1, \u0027Tester\u0027,\u0027Giáo viên\u0027) as position,\r\n      CONCAT(\"https://files.kynaenglish.com\",link_cv) as link_cv,\r\n      video_link as interview_record,\r\n      `kynaforkids-server-production.kynaforkids.func_get_email_from_kynaforkids_user`(interview_by) as interview_by,\r\n      date(begin_at) as interview_date, \r\n      `kynaforkids-server-production.kynaforkids.func_get_email_from_kynaforkids_user`(created_by) as created_by,\r\n     \r\n      CASE \r\n        WHEN training_status \u003d 1 THEN \u0027Not yet\u0027\r\n        WHEN training_status \u003d 2 THEN \u0027Done All\u0027\r\n        WHEN training_status \u003d 3 THEN \u0027Done Test\u0027\r\n        WHEN training_status \u003d 4 THEN \u0027Done Teaching\u0027\r\n        ELSE \u0027Unknown\u0027\r\n     END AS training_status_description,\r\n\r\n     (select date(bsn.begin_at)\r\n     from `kynaforkids.booking_session_view` bsn\r\n     where bsn.id \u003d booking_training_id) as booked_training_date,\r\n\r\n\r\n      CASE \r\n        WHEN candidate_status \u003d 1 THEN \u0027Not Set\u0027\r\n        WHEN candidate_status \u003d 2 THEN \u0027Confirm Interview\u0027\r\n        WHEN candidate_status \u003d 3 THEN \u0027Reject Interview\u0027\r\n        WHEN candidate_status \u003d 4 THEN \u0027No Show Up\u0027\r\n        WHEN candidate_status \u003d 5 THEN \u0027Deal\u0027\r\n        WHEN candidate_status \u003d 6 THEN \u0027Fail\u0027\r\n        WHEN candidate_status \u003d 7 THEN \u0027Accepted\u0027\r\n        WHEN candidate_status \u003d 8 THEN \u0027Discarded\u0027\r\n        WHEN candidate_status \u003d 9 THEN \u0027Offer rejected\u0027\r\n        WHEN candidate_status \u003d 10 THEN \u0027Pending offer approval\u0027\r\n        WHEN candidate_status \u003d 11 THEN \u0027Offer not approved\u0027\r\n        WHEN candidate_status \u003d 12 THEN \u0027Offer sent\u0027\r\n        WHEN candidate_status \u003d 13 THEN \u0027Pending interview result approval\u0027\r\n        WHEN candidate_status \u003d 14 THEN \u0027Interview result not approved\u0027\r\n        WHEN candidate_status \u003d 15 THEN \u0027Interview result approved\u0027\r\n     END AS candidate_status_description,\r\n\r\n     point,\r\n     comment,\r\n\r\n \r\n\r\n\r\n\r\nFROM `kynaforkids-server-production.kynaforkids.interview_view` \r\nwhere subject \u003d 1\r\n      -- and email \u003d \"minhle31231024656@gmail.com\";"
}, {
  "table_name": "offline_event",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.offline_event`\n(\n  id INT64,\n  event_name STRING,\n  event_start INT64,\n  event_end INT64,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  prefix STRING,\n  address STRING,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.log`\n(\n  id INT64,\n  level INT64,\n  category STRING,\n  log_time FLOAT64,\n  prefix STRING,\n  message STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "affiliate_user_post_tracking_status",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.affiliate_user_post_tracking_status`\n(\n  id INT64,\n  name STRING,\n  step INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "contest_student_session",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.contest_student_session`\n(\n  id INT64,\n  student_id INT64,\n  contest_quiz_learning_id INT64,\n  score INT64,\n  is_passed INT64,\n  number_of_learning INT64,\n  comment STRING,\n  detail_ids JSON,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "sales_nguoi_lon_temp",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.sales_nguoi_lon_temp`\n(\n  User_ID INT64,\n  Student_code STRING,\n  Email STRING,\n  Program STRING,\n  Sale_in_charge STRING,\n  Supervisor STRING,\n  Student_status INT64,\n  Total_lesson INT64,\n  Used_lesson INT64,\n  Remain_lesson INT64,\n  Affliate_email STRING,\n  Affiliate_category STRING,\n  Qu___c_t___ch_GV STRING,\n  Phone INT64\n);"
}, {
  "table_name": "topic_user",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.topic_user`\n(\n  id INT64,\n  user_id INT64,\n  topic_id INT64,\n  status INT64,\n  is_send STRING,\n  last_send_at INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_teacher_log_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.booking_teacher_log_view`\nAS SELECT * except(begin_at,end_at,created_at,updated_at),\r\n      timestamp_seconds(begin_at) as begin_at,\r\n      timestamp_seconds(end_at) as end_at,\r\n      timestamp_seconds(created_at) as created_at,\r\n      timestamp_seconds(updated_at) as updated_at,\r\nFROM `kynaforkids-server-production.kynaforkids.booking_teacher_log`;"
}, {
  "table_name": "booking_teacher_offer_template",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_offer_template`\n(\n  id INT64,\n  template_name STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "speech_question",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.speech_question`\n(\n  id INT64,\n  speech_id INT64,\n  text STRING,\n  instruction STRING,\n  audio_url STRING,\n  image_url STRING,\n  type INT64,\n  visible INT64,\n  is_deleted INT64,\n  `order` INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  speech_question_type_id INT64,\n  ipa STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_teacher_program",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_program`\n(\n  user_id INT64,\n  program_id INT64,\n  salary FLOAT64,\n  bonus NUMERIC(15, 2),\n  apply_date INT64,\n  visible INT64,\n  is_salary_over_threshold INT64,\n  only_automap_priority_student INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (user_id, program_id) NOT ENFORCED\n)\nCLUSTER BY user_id, program_id;"
}, {
  "table_name": "ai_study_mode_level",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_study_mode_level`\n(\n  id INT64,\n  name STRING,\n  user_type_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  level_prompt STRING,\n  student_age STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_order_voucher_config_detail",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_order_voucher_config_detail`\n(\n  id INT64,\n  voucher_config_id INT64,\n  discount INT64,\n  min NUMERIC(15, 2),\n  max NUMERIC(15, 2),\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "migration",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.migration`\n(\n  version STRING,\n  apply_time INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (version) NOT ENFORCED\n)\nCLUSTER BY version\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "gso_province",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.gso_province`\n(\n  id INT64,\n  gso_id STRING,\n  name STRING,\n  en_name STRING,\n  level STRING,\n  updated INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "queue_center_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.queue_center_log`\n(\n  id INT64,\n  channel INT64,\n  type INT64,\n  data STRING,\n  result STRING,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "course_favourite",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.course_favourite`\n(\n  user_id INT64,\n  course_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n)\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "quiz_session_info",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.quiz_session_info`\n(\n  id INT64,\n  quiz_session_id INT64,\n  children_name STRING,\n  parent_name STRING,\n  phone_number STRING,\n  email STRING,\n  source_id INT64,\n  lang_code STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "b2b_company_contract",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.b2b_company_contract`\n(\n  id INT64,\n  company_id INT64,\n  contract_code STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_complain_note",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_complain_note`\n(\n  id INT64,\n  complain_id INT64,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_class",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_class`\n(\n  id INT64,\n  booking_program_id INT64,\n  booking_level_id INT64,\n  name STRING,\n  booking_class_priority_date_id INT64,\n  schedule_id STRING,\n  teacher_country_id INT64,\n  begin_at INT64,\n  end_at INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  record_number INT64,\n  max_students INT64,\n  is_sync INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ceo_cac_general_num_students_part_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.ceo_cac_general_num_students_part_view`\nAS select \r\n     *\r\n-- from `kynaforkids-server-production.kynaforkids.ceo_cac_num_new_students_view` nst\r\nfrom `kynaforkids-server-production.datateam_kynaforkids.report_cac_kyna_new_students_91ba7bf9-c30e-4ed3-98d9-a0dea42a833e` nst\r\nwhere nst.year_month \u003c\u003d FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE()) \r\n      and nst.year_month \u003e\u003d \u00272024-01\u0027;"
}, {
  "table_name": "booking_order_gift_detail",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_order_gift_detail`\n(\n  booking_order_gift_id INT64,\n  wh_product_id INT64,\n  wh_location_id INT64,\n  quantity INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  _dev_id STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (_dev_id) NOT ENFORCED\n)\nCLUSTER BY _dev_id;"
}, {
  "table_name": "booking_hot_bonus_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_hot_bonus_config`\n(\n  id INT64,\n  program_id INT64,\n  level_id INT64,\n  amount FLOAT64,\n  applied_from INT64,\n  applied_to INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_teacher_leave_request_detail",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_leave_request_detail`\n(\n  leave_request_id INT64,\n  begin_at INT64,\n  end_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n);"
}, {
  "table_name": "conversation_type",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.conversation_type`\n(\n  id INT64,\n  main_id INT64,\n  name STRING,\n  type INT64,\n  assign_type INT64,\n  `order` INT64,\n  order_when_have_class INT64,\n  need_supporter INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ai_tutor_error_report_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.ai_tutor_error_report_view`\nAS SELECT * except(created_at,updated_at),\r\n      timestamp_seconds(created_at) as created_at,\r\n      timestamp_seconds(updated_at) as updated_at,\r\nFROM `kynaforkids-server-production.kynaforkids.ai_tutor_error_report`;"
}, {
  "table_name": "booking_commission_income",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_commission_income`\n(\n  id INT64,\n  affiliate_id INT64,\n  date INT64,\n  total_amount NUMERIC(15, 2),\n  total_commission_amount NUMERIC(15, 2),\n  total_order INT64,\n  total_enrollment_order INT64,\n  total_re_register_order INT64,\n  re_register_commisson_amount NUMERIC(15, 2),\n  enrollment_commission_percent NUMERIC(15, 2),\n  enrollment_commisson_amount NUMERIC(15, 2),\n  enrollment_commission_percent_bonus NUMERIC(15, 2),\n  enrollment_commisson_amount_bonus NUMERIC(15, 2),\n  final_total_commission_amount NUMERIC(15, 2),\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  debt_income NUMERIC(15, 2),\n  adjustment_other NUMERIC(15, 2),\n  bonus NUMERIC(15, 2),\n  payment_adjustment NUMERIC(15, 2),\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "event_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.event_log`\n(\n  id INT64,\n  message_id STRING,\n  type INT64,\n  record_id INT64,\n  event_name STRING,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "web_notification",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.web_notification`\n(\n  id INT64,\n  name STRING,\n  title STRING,\n  body STRING,\n  icon STRING,\n  image STRING,\n  redirect_url STRING,\n  screen_name STRING,\n  params STRING,\n  start_time INT64,\n  status INT64,\n  app STRING,\n  topics STRING,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  is_repeat INT64,\n  type INT64,\n  excel_file STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "card_subscriptions",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.card_subscriptions`\n(\n  card_id INT64,\n  package_subscription_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (package_subscription_id, card_id) NOT ENFORCED\n)\nCLUSTER BY package_subscription_id, card_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "schedule_command_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.schedule_command_log`\n(\n  id INT64,\n  name STRING,\n  command STRING,\n  allow_parallel INT64,\n  cron_expression STRING,\n  timezone STRING,\n  timeout INT64,\n  executed_at INT64,\n  done_at INT64,\n  stdout STRING,\n  stderr STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "placement_test_level_exchange",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.placement_test_level_exchange`\n(\n  id INT64,\n  program_type INT64,\n  number_of_course INT64,\n  start_level_id INT64,\n  end_level_id INT64,\n  content STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_country_group_region",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_country_group_region`\n(\n  id INT64,\n  country_id INT64,\n  country_group_id INT64,\n  region_id STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_commission_db_tutoring_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.booking_commission_db_tutoring_view`\nAS SELECT \r\n  bo.accounting_date AS ngay_hach_toan\r\n, bo.invoice_code\r\n, bo.currency_exchange_rate\r\n, bo.total\r\n, bc.total_amount\r\n, bc.total_amount * bo.currency_exchange_rate as total_amount_vnd\r\n, ((bo.total - IF(bo.discount_money IS NULL, 0, bo.discount_money)) * bo.currency_exchange_rate)  AS price_vnd\r\n,(\r\nCASE\r\n  WHEN bo.program_type \u003d 1 THEN \"Đơn 1 kèm 1\"\r\n  WHEN bo.program_type \u003d 2 THEN \"Đơn AI kèm Group Talk\"\r\nEND\r\n) AS loai_don\r\n, (\r\nCASE \r\n  WHEN bo.user_type_id \u003d 1 THEN \u0027Trẻ em\u0027\r\n  WHEN bo.user_type_id \u003d 2 THEN \u0027Người lớn\u0027\r\nEND\r\n) AS loai_hoc_vien\r\n, (\r\nCASE\r\n  WHEN bo.student_type \u003d 1 THEN \u0027Học viên mới\u0027\r\n  WHEN bo.student_type \u003d 2 THEN \u0027Học viên cũ\u0027\r\nEND\r\n) AS student_type\r\n, `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(bo.payment_content) AS payment_content\r\n, bo.payment_content as payment_content_id\r\n, bc.affiliate_id as affiliate_id \r\n, ( SELECT au.country_id FROM `kynaforkids-server-production.kynaforkids.affiliate_user` au \r\n  WHERE au.affiliate_id \u003d CAST(bc.affiliate_id AS INT64) ) AS country_id\r\n,(SELECT MAX(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u, `kynaforkids-server-production.kynaforkids.affiliate_user` au WHERE au.user_id \u003d u.id AND au.affiliate_id \u003d CAST(bc.affiliate_id AS INT64)) as affiliate_email\r\n\r\n, (SELECT ac.name FROM `kynaforkids-server-production.kynaforkids.affiliate_category` ac, `kynaforkids-server-production.kynaforkids.affiliate_user` au WHERE CAST(bc.affiliate_id AS INT64) \u003d au.affiliate_id AND au.affiliate_category_id \u003d ac.id) as loai_affiliate\r\n\r\n, (SELECT au.affiliate_category_id FROM `kynaforkids-server-production.kynaforkids.affiliate_user` au  WHERE CAST(bc.affiliate_id AS INT64) \u003d au.affiliate_id ) AS affiliate_category_id\r\n\r\n, `kynaforkids-server-production.kynaforkids.func_get_source_affiliate`((SELECT au.source_id FROM `kynaforkids-server-production.kynaforkids.affiliate_user` au \r\nWHERE CAST(bc.affiliate_id AS INT64) \u003d au.affiliate_id)) as nguon_affiliate\r\n\r\n, (SELECT au.source_id FROM `kynaforkids-server-production.kynaforkids.affiliate_user` au \r\nWHERE CAST(bc.affiliate_id AS INT64) \u003d au.affiliate_id) AS source_id\r\n\r\n,(SELECT MAX(u.email) from `kynaforkids-server-production.kynaforkids.user` u, `kynaforkids-server-production.kynaforkids.affiliate_user` au where au.bd_incharge_id \u003d u.id and au.affiliate_id \u003d cast(bc.affiliate_id as INT64)) as bd_incharge\r\n, (\r\nSELECT \r\n  ( CASE\r\n    WHEN bacc.payment_count \u003d 1 THEN \u0027Lần đầu\u0027\r\n    WHEN bacc.payment_count \u003d 2 THEN \u0027Lần sau\u0027\r\n    ELSE NULL\r\n  END ) as lan_thanh_toan,\r\n\r\nFROM `kynaforkids-server-production.kynaforkids.booking_affiliate_commission_config` bacc\r\nWHERE bacc.id \u003d bc.affiliate_commission_config_id\r\n) as lan_thanh_toan,\r\n\r\ncase\r\n    when bc.status \u003d 1 then \u0027Mới tạo\u0027\r\n    when bc.status \u003d 2 then \u0027Xác nhận\u0027\r\n    when bc.status \u003d 3 then \u0027Hoàn thành\u0027\r\n    when bc.status \u003d 4 then \u0027Hủy\u0027\r\n    when bc.status \u003d 10 then \u0027Quy đổi hoa hồng\u0027\r\n    else \u0027Khác\u0027\r\nend as aff_commission_status\r\n\r\n, bc.affiliate_commission_percent_bonus\r\n, bc.affiliate_commission_amount_bonus * bc.currency_exchange_rate AS hoa_hong_vnd\r\nFROM `kynaforkids-server-production.kynaforkids.booking_commission` bc \r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_order_view` bo ON bo.id \u003d bc.order_id\r\nWHERE\r\nCAST(bc.affiliate_id AS INT64) \u003e 0 and bc.status in (3,10)\r\n-- AND (DATE(bo.accounting_date) \u003e\u003d \u00272024-11-01\u0027 AND DATE(bo.accounting_date) \u003c\u003d \u00272024-11-30\u0027)\r\n--  AND bc.order_id \u003d 115826\r\n-- AND (DATE(bo.accounting_date) \u003e\u003d PARSE_DATE(\u0027%Y%m%d\u0027, @DS_START_DATE) AND DATE(bo.accounting_date) \u003c\u003d PARSE_DATE(\u0027%Y%m%d\u0027, @DS_END_DATE))\r\n  -- and bc.order_id is not null\r\nORDER BY bc.affiliate_id;"
}, {
  "table_name": "booking_price_config_flash_sale",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_price_config_flash_sale`\n(\n  id INT64,\n  begin_at INT64,\n  end_at INT64,\n  country_id INT64,\n  currency_code STRING,\n  teacher_nationality INT64,\n  program_id INT64,\n  payment_content INT64,\n  min_price NUMERIC(15, 2),\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  record_number INT64,\n  max_students INT64,\n  user_type_id INT64,\n  fs_code STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "queue",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.queue`\n(\n  id INT64,\n  channel STRING,\n  job STRING,\n  pushed_at INT64,\n  ttr INT64,\n  delay INT64,\n  priority INT64,\n  reserved_at INT64,\n  attempt INT64,\n  done_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_lesson_homework",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_lesson_homework`\n(\n  booking_lesson_id INT64,\n  lesson_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n);"
}, {
  "table_name": "b2b_company_user",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.b2b_company_user`\n(\n  id INT64,\n  user_id INT64,\n  company_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_teacher_metadata",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_metadata`\n(\n  id INT64,\n  user_id INT64,\n  program_id INT64,\n  type STRING,\n  value STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "document_type",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.document_type`\n(\n  id INT64,\n  name STRING,\n  slug STRING,\n  icon_url STRING,\n  visible INT64,\n  `order` INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "autocall_booking_session_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.autocall_booking_session_log`\n(\n  id INT64,\n  booking_id INT64,\n  user_id INT64,\n  phone_number STRING,\n  call_result STRING,\n  call_result_status STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "career_category",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.career_category`\n(\n  id INT64,\n  name STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "aca_caresoft_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.aca_caresoft_log`\n(\n  id INT64,\n  ip_phone STRING,\n  phone_number STRING,\n  caresoft_data STRING,\n  ended_at INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_student_3rd_party_code",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_3rd_party_code`\n(\n  id INT64,\n  student_id INT64,\n  booking_order_id INT64,\n  package_id INT64,\n  subscription_id INT64,\n  code STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  has_sent_student INT64,\n  date_send_student INT64,\n  student_sent_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "b2b_elsa_learning_progress",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.b2b_elsa_learning_progress`\n(\n  id INT64,\n  student_id INT64,\n  total_hours_practice INT64,\n  complete_rate INT64,\n  join_rate INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "sales_tre_em_temp",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.sales_tre_em_temp`\n(\n  User_ID INT64,\n  Student_code STRING,\n  Email STRING,\n  Program STRING,\n  Sale_in_charge STRING,\n  Supervisor STRING,\n  Student_status INT64,\n  Total_lesson INT64,\n  Used_lesson INT64,\n  Remain_lesson INT64,\n  Affliate_email STRING,\n  Affiliate_category STRING,\n  Qu___c_t___ch_GV STRING,\n  Phone INT64\n);"
}, {
  "table_name": "ceo_cac_sale_fixed_cost_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.ceo_cac_sale_fixed_cost_view`\nAS WITH sale_fixed_cost_temp AS (\r\n  SELECT      \r\n    ym.year_month,\r\n    sfc.fixedSaleSalary,\r\n    IF(sfc.fixedSaleSalary IS NOT NULL, 1, 0) AS is_salary_finalized\r\n  FROM `kynaforkids-server-production.kynaforkids.cac_year_month_table` ym\r\n  LEFT JOIN `kynaforkids.CEO_CAC_fixedSaleSalary_month` sfc USING(year_month)\r\n  WHERE year_month BETWEEN \u00272024-01\u0027 AND FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE())\r\n  ORDER BY year_month DESC\r\n),\r\n\r\nmost_recent_salary AS (\r\n  SELECT fixedSaleSalary\r\n  FROM sale_fixed_cost_temp\r\n  WHERE is_salary_finalized \u003d 1\r\n  ORDER BY year_month DESC\r\n  LIMIT 1\r\n)\r\n\r\nSELECT \r\n  t.year_month,\r\n  CASE\r\n    WHEN t.is_salary_finalized \u003d 1 THEN t.fixedSaleSalary\r\n    ELSE ROUND((SELECT fixedSaleSalary FROM most_recent_salary) * \r\n         IF(t.year_month \u003c FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE()),\r\n            1,\r\n            (EXTRACT(DAY FROM CURRENT_DATE()) / EXTRACT(DAY FROM LAST_DAY(CURRENT_DATE())))))\r\n  END AS fixedSaleSalary\r\nFROM sale_fixed_cost_temp t\r\nWHERE t.year_month \u003e\u003d \u00272024-01\u0027\r\nORDER BY t.year_month DESC;"
}, {
  "table_name": "booking_timeline_scheduler",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_timeline_scheduler`\n(\n  id INT64,\n  user_id INT64,\n  timeline_action_id INT64,\n  time INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "sales_hcm_temp",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.kynaforkids.sales_hcm_temp`\nOPTIONS(\n  sheet_range\u003d\"HCM!A:N\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/10HXF63d790w2VxxYBtmfBPXy_6b6q6uM5WDeINb7JCg/edit?gid\u003d759681707#gid\u003d759681707\"]\n);"
}, {
  "table_name": "writing_sub_criteria",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.writing_sub_criteria`\n(\n  id INT64,\n  main_criteria_id INT64,\n  name STRING,\n  description STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_session_criteria",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_session_criteria`\n(\n  id INT64,\n  booking_session_id INT64,\n  criteria_name STRING,\n  type INT64,\n  status INT64,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ai_study_mode_media",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_study_mode_media`\n(\n  id INT64,\n  name STRING,\n  file_name STRING,\n  link STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  ai_study_mode_lesson_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "po_package",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.po_package`\n(\n  id INT64,\n  name STRING,\n  description STRING,\n  price INT64,\n  has_one_to_one INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "elsa_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.elsa_log`\n(\n  id INT64,\n  api_url STRING,\n  method STRING,\n  request STRING,\n  response STRING,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "mkt_booking_order_old_new_students_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.mkt_booking_order_old_new_students_view`\nAS WITH order_info AS (\r\n  (SELECT date(bo.created_at) AS ngay_tao_don,\r\n          date(bo.payment_at) AS ngay_duyet_don,\r\n          if(bo.accounting_date IS NULL, date(bo.created_at), date(bo.accounting_date)) AS accounting_date,\r\n\r\n     (SELECT created_at\r\n      FROM `kynaforkids-server-production.kynaforkids.booking_lead`\r\n      WHERE id \u003d bo.lead_id) AS ngay_tao_lead,\r\n          bo.invoice_code,\r\n\r\n     -- (SELECT name\r\n     --  FROM `kynaforkids-server-production.kynaforkids.booking_lead`\r\n     --  WHERE id \u003d bo.lead_id) AS ten_phu_huynh,\r\n          -- bo.email,\r\n          -- bo.name,\r\n          bo.student_code,\r\n          bo.student_id,\r\n          bo.phone_number,\r\n          bo.id as order_id,\r\n          bo.international_country_id,\r\n          if(bo.total_video_course IS NULL, 0, bo.total_video_course) AS total_video_course,\r\n          bo.total,\r\n          `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(cast(bo.payment_content AS INT64)) AS noi_dung_thanh_toan,\r\n          `kynaforkids-server-production.kynaforkids.func_get_source`(bo.source) AS source,\r\n          `kynaforkids-server-production.kynaforkids.func_get_program_name_from_id`(bo.program_id) AS program,\r\n          `kynaforkids-server-production.kynaforkids.func_get_booking_order_status`(bo.status) AS order_status,\r\n          CASE WHEN bo.payment_status \u003d 0 THEN \u0027Chưa duyệt\u0027 \r\n               WHEN bo.payment_status \u003d 1 THEN \u0027Đã duyệt\u0027 \r\n               WHEN bo.payment_status \u003d 2 THEN \u0027Không duyệt\u0027 \r\n               WHEN bo.payment_status \u003d 3 THEN \u0027Cần điều chỉnh\u0027 \r\n               WHEN bo.payment_status \u003d 4 THEN \u0027Đã điều chỉnh\u0027 \r\n               ELSE \u0027Khác\u0027 END AS payment_status,\r\n          bo.total - if(bo.discount_money IS NULL, 0, bo.discount_money) AS price,\r\n          -- bo.duration,\r\n          -- bo.note AS note,\r\n          bo.lead_id AS lead_id,\r\n          -- bll.gclid,\r\n\r\n     -- (SELECT sale_id\r\n     --  FROM `kynaforkids-server-production.kynaforkids.booking_lead`\r\n     --  WHERE id \u003d bo.lead_id) AS sale_id,\r\n     \r\n     IF (bll.actual_utm_campaign IS NULL,\r\n                                   bll.utm_campaign,\r\n                                   bll.actual_utm_campaign) AS affiliate_campaign,\r\n    --  bll.actual_utm_campaign as affiliate_campaign, \r\n    --  (SELECT actual_lead_id\r\n    --   FROM `kynaforkids-server-production.kynaforkids.booking_lead`\r\n    --   WHERE id \u003d bo.lead_id) AS actual_lead_id,\r\n    --       if(bll.actual_lead_id IS NULL, bll.utm_campaign,\r\n    --            (SELECT bl.utm_campaign\r\n    --             FROM `kynaforkids-server-production.kynaforkids.booking_lead` bl\r\n    --             WHERE bl.id \u003d bll.actual_lead_id)) AS affiliate_campaign,\r\n\r\n     -- (SELECT fanpage_name\r\n     --  FROM `kynaforkids-server-production.kynaforkids.booking_lead`\r\n     --  WHERE id \u003d bo.lead_id) AS fanpage_name,\r\n          -- if(bll.actual_lead_id IS NULL, bll.landing_page_name,\r\n          --      (SELECT bl.landing_page_name\r\n          --       FROM `kynaforkids-server-production.kynaforkids.booking_lead` bl\r\n          --       WHERE bl.id \u003d bll.actual_lead_id)) AS landingpage_name,\r\n          -- if(bll.actual_lead_id IS NULL, bll.affiliate_id,\r\n          --      (SELECT bl.affiliate_id\r\n          --       FROM `kynaforkids-server-production.kynaforkids.booking_lead` bl\r\n          --       WHERE bl.id \u003d bll.actual_lead_id)) AS affiliate_id,\r\n          bo.currency_exchange_rate,\r\n          ((bo.total - if(bo.discount_money IS NULL, 0, bo.discount_money)) * bo.currency_exchange_rate) AS price_vnd,\r\n          `kynaforkids-server-production.kynaforkids.func_get_country`(bo.international_country_id) AS country,\r\n          -- bo.total_lesson,\r\n\r\n     -- (SELECT string_agg(t1.video_course_name)\r\n     --  FROM `kynaforkids-server-production.kynaforkids.view_tutoring_video_course_name` t1\r\n     --  WHERE t1.id \u003d bo.id) AS video_course_name,\r\n          -- if(bll.actual_lead_id IS NULL,\r\n          --      (SELECT max(u.email)\r\n          --       FROM `kynaforkids-server-production.kynaforkids.kynaforkids_user` u\r\n          --       WHERE bll.affiliate_id \u003d u.id),\r\n          --      (SELECT max(u.email)\r\n          --       FROM `kynaforkids-server-production.kynaforkids.booking_lead` bl, `kynaforkids-server-production.kynaforkids.kynaforkids_user` u\r\n          --       WHERE bll.actual_lead_id \u003d bl.id\r\n          --         AND bl.affiliate_id \u003d u.id)) AS affiliate_email,\r\n\r\n     -- (SELECT max(u.email)\r\n     --  FROM `kynaforkids-server-production.kynaforkids.kynaforkids_user` u,\r\n     --       `kynaforkids-server-production.kynaforkids.affiliate_user` au\r\n     --  WHERE au.affiliate_id \u003d bo.affiliate_id\r\n     --    AND au.user_id \u003d u.id) AS affiliate_emaill,\r\n\r\n     -- (SELECT ac.name\r\n     --  FROM `kynaforkids-server-production.kynaforkids.affiliate_category` ac,\r\n     --       `kynaforkids-server-production.kynaforkids.affiliate_user` au\r\n     --  WHERE bo.affiliate_id \u003d au.affiliate_id\r\n     --    AND au.affiliate_category_id \u003d ac.id) AS loai_affiliate,\r\n          -- IF (bll.actual_lead_id IS NULL,\r\n          --       (SELECT ac.name\r\n          --        FROM `kynaforkids-server-production.kynaforkids.affiliate_user` au,\r\n          --             `kynaforkids-server-production.kynaforkids.affiliate_category` ac\r\n          --        WHERE bll.affiliate_id \u003d au.user_id\r\n          --          AND au.affiliate_category_id \u003d ac.id),\r\n          --       (SELECT ac.name\r\n          --        FROM `kynaforkids-server-production.kynaforkids.booking_lead` bl,\r\n          --             `kynaforkids-server-production.kynaforkids.affiliate_user` au,\r\n          --             `kynaforkids-server-production.kynaforkids.affiliate_category` ac\r\n          --        WHERE bl.id \u003d bll.actual_lead_id\r\n          --          AND bl.affiliate_id \u003d au.user_id\r\n          --          AND au.affiliate_category_id \u003d ac.id)) AS affiliate_type\r\n   FROM `kynaforkids-server-production.kynaforkids.booking_order_view` bo\r\n   LEFT JOIN `kynaforkids-server-production.kynaforkids.booking_lead` bll ON bll.id \u003d bo.lead_id\r\n   WHERE\r\n      `kynaforkids-server-production.kynaforkids.func_get_source`(bo.source) in (\u0027Marketing\u0027)\r\n      and bo.program_type in (1)\r\n      and bo.status in (4,6)\r\n      and bo.payment_status in (1,0,3)\r\n      and not (bo.order_type in (2) and bo.order_type_sub in (9))\r\n      and bo.total \u003e 0\r\n   )\r\n),\r\n\r\ntemp_table as\r\n(\r\nSELECT \r\n       t1.order_id,\r\n       t1.ngay_tao_don,\r\n       t1.ngay_duyet_don,\r\n       t1.accounting_date,\r\n       t1.ngay_tao_lead,\r\n       t1.invoice_code,\r\n     --   t1.ten_phu_huynh,\r\n     --   t1.email,\r\n     --   t1.name,\r\n     --   t1.student_code,\r\n       t1.phone_number,\r\n       t1.international_country_id as country_id,\r\n       t1.total_video_course,\r\n       t1.total,\r\n       t1.noi_dung_thanh_toan,\r\n       t1.source,\r\n       t1.program,\r\n       t1.order_status,\r\n       t1.payment_status,\r\n     --   t1.price,\r\n       ((t1.price + t1.total_video_course) * t1.currency_exchange_rate) AS total_VND,\r\n     --   (t1.price + t1.total_video_course) AS total_nguyen_te,\r\n     --   t1.duration,\r\n     --   t1.note,\r\n       t1.lead_id,\r\n     --   `kynaforkids-server-production.kynaforkids.func_get_email_from_kynaforkids_user`(t1.sale_id) AS sale_email,\r\n       t1.affiliate_campaign,\r\n     --   t1.landingpage_name,\r\n     --   t1.fanpage_name,\r\n     --   t1.gclid,\r\n     --   t1.affiliate_id,\r\n     --   t1.affiliate_email,\r\n     --   t1.affiliate_type,\r\n     --   t1.currency_exchange_rate,\r\n     --   t1.price_vnd,\r\n       t1.country,\r\n     --   t1.total_lesson,\r\n     --   t1.video_course_name,\r\n     --   t1.affiliate_emaill,\r\n     --   t1.loai_affiliate\r\n      t1.student_id,\r\n      t1.student_code,\r\n      (\r\n         SELECT COUNT(distinct bo.id) \r\n         FROM `kynaforkids.booking_order_view` bo \r\n         WHERE (bo.student_id \u003d t1.student_id OR bo.student_code \u003d t1.student_code) AND bo.payment_status in (1)  AND bo.status in (4) and not(bo.order_type in (2) and bo.order_type_sub in (9)) AND `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(cast(bo.payment_content AS INT64)) in (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) AND date(bo.created_at) \u003c date(t1.ngay_tao_don)\r\n      ) as num_completed_orders_same_student, \r\n\r\n         (\r\n         SELECT COUNT(distinct bo.id) \r\n         FROM `kynaforkids.booking_order_view` bo \r\n         WHERE (RIGHT(bo.phone_number,9) \u003d RIGHT(t1.phone_number,9)) AND bo.payment_status in (1) AND bo.status in (4) and not(bo.order_type in (2) and bo.order_type_sub in (9)) AND `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(cast(bo.payment_content AS INT64)) in (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) AND date(bo.created_at) \u003c date(t1.ngay_tao_don)\r\n      ) as num_completed_orders_same_phone,\r\n\r\nFROM order_info t1\r\nWHERE --t1.source \u003d \u0027Marketing\u0027  \r\n      --AND t1.ngay_tao_don \u003e\u003d \u00272024-01-01\u0027 \r\n      --AND t1.payment_status in (\u0027Đã duyệt\u0027,\u0027Chưa duyệt\u0027,\u0027Cần điều chỉnh\u0027) \r\n      --AND t1.order_status in (\u0027Hoàn thành\u0027, \u0027Chờ xác nhận thanh toán\u0027)\r\n      t1.noi_dung_thanh_toan in (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n      --AND (t1.price + t1.total_video_course) \u003e 0\r\n      -- AND t1.ngay_tao_lead \u003e\u003d \u00272024-01-01\u0027\r\n)\r\n\r\nSELECT * \r\nFROM\r\n(\r\n    SELECT \r\n          t2.*,\r\n          if(not(student_code is null or student_code\u003d\u0027\u0027),if(t2.num_completed_orders_same_student \u003e 0, \u0027Học viên cũ\u0027, \u0027Học viên mới\u0027),if(t2.num_completed_orders_same_phone \u003e 0, \u0027có order cùng phone chưa rõ HV cũ/mới\u0027, \u0027Học viên mới\u0027)) as old_new_student,\r\n          \r\n\r\n    FROM temp_table t2\r\n    WHERE DATE(t2.ngay_tao_don) \u003e\u003d \u00272022-01-01\u0027\r\n)\r\nWHERE old_new_student \u003d \u0027Học viên mới\u0027;"
}, {
  "table_name": "placement_test_program",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.placement_test_program`\n(\n  id INT64,\n  name STRING,\n  is_support_speaking INT64,\n  subject INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "arena",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.arena`\n(\n  id INT64,\n  quiz_id INT64,\n  name STRING,\n  start_time INT64,\n  end_time INT64,\n  rule_description STRING,\n  present_description STRING,\n  background_countdown STRING,\n  background_finish STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  status INT64,\n  web_push_id STRING,\n  publish_content INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_teacher_type_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_type_config`\n(\n  id INT64,\n  name STRING,\n  teacher_country_id STRING,\n  type INT64,\n  note STRING,\n  `order` INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "view_manage_booking_teacher",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.view_manage_booking_teacher`\nAS \r\n  SELECT\r\n    -- FORMAT_TIMESTAMP(\"%d-%m-%Y\", ((bs.begin_at))) AS teacher_day,\r\n    date(bs.begin_at) as teacher_day,\r\n    teacher_id,\r\n    (SELECT max(p.name) FROM `kynaforkids-server-production.kynaforkids.profile` p WHERE p.user_id\u003d bs.teacher_id) AS teacher_name,\r\n    (select max(u.email) from `kynaforkids-server-production.kynaforkids.user` u where u.id \u003d bs.teacher_id) as teacher_email,\r\n    case\r\n      when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id ) \u003d 1 then \u0027Philippines\u0027\r\n      when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id ) \u003d 2 then \u0027Native\u0027\r\n      when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id ) \u003d 3 then \u0027Vietnamese\u0027\r\n      when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id ) \u003d 4 then \u0027Thailand\u0027\r\n      when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id ) \u003d 5 then \u0027Indonesia\u0027\r\n    end as teacher_country,\r\n    case\r\n      when (select bt.status  from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id ) \u003d 0 then \u0027Deactive\u0027\r\n      when (select bt.status from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id ) \u003d 1 then \u0027Active\u0027\r\n    end as teacher_status,\r\n    COUNT(*) AS total_bookings,\r\n    COUNTIF(bs.status_id in (1,2,3,4,5)) as booking_booked,\r\n    -- ngaltt start\r\n    -- COUNTIF(bs.status_id\u003d5 and bs.program_id \u003d 8) AS taught_test_1ca,\r\n    -- COUNTIF(bs.status_id\u003d5 and bs.program_id \u003d 13) AS taught_test_2ca,\r\n    -- COUNTIF(bs.status_id\u003d5 and bs.program_id in (20,1,2,3,4,7)) AS taught_25p,\r\n    -- COUNTIF(bs.status_id\u003d5 and bs.program_id not in (20,1,2,3,4,7,13,8)) AS taught_45p,\r\n    COUNTIF(bs.status_id\u003d5 and bs.program_id in (select bp.id from `kynaforkids-server-production.kynaforkids.booking_program` bp\r\nwhere bp.number_of_shift \u003d 1 and bp.program_type \u003d 2 and  bp.subject \u003d 1 and bp.id !\u003d 3)) AS taught_test_1ca,\r\n\r\n    COUNTIF(bs.status_id\u003d5 and bs.program_id in (select id from `kynaforkids-server-production.kynaforkids.booking_program` bp\r\nwhere bp.number_of_shift \u003d 2 and bp.program_type \u003d 2 and  bp.subject \u003d 1 and bp.id !\u003d 3) ) AS taught_test_2ca,\r\n\r\n    COUNTIF(bs.status_id\u003d5 and bs.program_id in (select id from `kynaforkids-server-production.kynaforkids.booking_program` bp\r\nwhere bp.number_of_shift \u003d 1 and bp.program_type \u003d 1 and  bp.subject \u003d 1 and bp.id !\u003d 3) ) AS taught_25p,\r\n\r\n    COUNTIF(bs.status_id\u003d5 and bs.program_id in (select id from `kynaforkids-server-production.kynaforkids.booking_program` bp\r\nwhere bp.number_of_shift \u003d 2 and bp.program_type \u003d 1 and  bp.subject \u003d 1 and bp.id not in (3,118,119,120,127,128,129,130,131))) AS taught_45p,\r\n    \r\n    COUNTIF(bs.status_id\u003d5 and bs.program_id in (118,119,120,127,128,129)) AS taught_60p,  -- chương trình 60 phút cũng 2 ca\r\n    COUNTIF(bs.status_id\u003d5 and bs.program_id in (130,131)) AS taught_extra, -- chương trình ngoại khóa cũng 2 ca\r\n    -- ngaltt end\r\n    COUNTIF(bs.status_id\u003d6) AS reject_bookings,\r\n    COUNTIF(bs.status_id \u003d 5\r\n      AND bs.rating\u003d3) AS bellow_standard_bookings,\r\n    COUNTIF(bs.status_id \u003d 5\r\n      AND bs.rating\u003d4) AS no_pay_bookings,\r\n    COUNTIF(bs.status_id \u003d 7\r\n      AND bs.cancel_status_id \u003d 4 ) AS approved_cancel_bookings,\r\n    -- ngaltt start 15/08/2024\r\n    -- COUNTIF(bs.status_id \u003d 7\r\n    --   AND bs.cancel_status_id in (11,16,5,17,12,18,19,13,20,14,15,21,22,23,24,25,26,27,28,29,30,6,7,8,9,10) ) AS penalty_cancel_bookings,\r\n    COUNTIF(bs.status_id \u003d 7\r\n      AND bs.cancel_status_id in  (select id from `kynaforkids-server-production.kynaforkids.booking_income_config`\r\nwhere cancel_by \u003d 2 and value_compensation \u003e 0)) AS penalty_cancel_bookings,\r\n    -- ngaltt end 15/08/2024\r\n    -- ngaltt start 03/04/2024\r\n    COUNTIF(bs.status_id \u003d 7\r\n      AND bs.cancel_status_id in  (select id from `kynaforkids-server-production.kynaforkids.booking_income_config`\r\nwhere cancel_by \u003d 2 and value_compensation \u003e 0)\r\n      AND bs.program_id in (select bp.id from `kynaforkids-server-production.kynaforkids.booking_program` bp\r\n      where bp.number_of_shift \u003d 1 and  bp.subject \u003d 1 and bp.id !\u003d 3)\r\n       ) AS penalty_cancel_bookings_25m,\r\n    COUNTIF(bs.status_id \u003d 7\r\n      AND bs.cancel_status_id in  (select id from `kynaforkids-server-production.kynaforkids.booking_income_config`\r\nwhere cancel_by \u003d 2 and value_compensation \u003e 0)\r\n      AND bs.program_id in (select bp.id from `kynaforkids-server-production.kynaforkids.booking_program` bp\r\n      where bp.number_of_shift \u003d 2 and  bp.subject \u003d 1 and bp.id !\u003d 3)\r\n       ) AS penalty_cancel_bookings_45m,\r\n    -- ngaltt start 03/04/2024\r\n   -- if((select bt.teacher_source  from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id ) \u003d 1,\r\n   -- COUNTIF(bs.status_id \u003d 7 AND bs.cancel_config_id not IN (1,6, 8) and bs.income \u003e 0),\r\n   -- COUNTIF(bs.status_id \u003d 7 AND bs.cancel_config_id not IN (1,6, 8)and bs.cancel_status_id in (2,3))) AS cancel_by_Kyna,\r\n    COUNTIF(bs.status_id \u003d 7 AND bs.cancel_config_id not IN (1,6, 8)and bs.cancel_status_id in (2,32)) AS Cancellations_with_50_compensation,\r\n    COUNTIF(bs.status_id \u003d 7 AND bs.cancel_config_id not IN (1,6, 8)and bs.cancel_status_id in (3,33)) AS Cancellations_with_100_compensation,\r\n    --COUNTIF(bs.status_id \u003d 7 AND bs.cancel_config_id not IN (1,6, 8)and bs.cancel_status_id in (2,3)) AS cancel_by_Kyna_RJ,\r\n   --quynh start--\r\n    COUNTIF(bs.status_id\u003d7 and bs.program_id in (select id from `kynaforkids-server-production.kynaforkids.booking_program` bp\r\n    where bp.number_of_shift \u003d 1 and bp.program_type \u003d 1 and  bp.subject \u003d 1 and bp.id !\u003d 3 AND bs.cancel_config_id not IN (1,6, 8)and bs.cancel_status_id in \r\n    (2, 32))) AS lop_50_compensation_25p,\r\n\r\n    COUNTIF(bs.status_id\u003d7 and bs.program_id in (select id from `kynaforkids-server-production.kynaforkids.booking_program` bp\r\n    where bp.number_of_shift \u003d 2 and bp.program_type \u003d 1 and  bp.subject \u003d 1 and bp.id !\u003d 3 AND bs.cancel_config_id not IN (1,6, 8)and bs.cancel_status_id in (2, 32))) \r\n    AS lop_50_compensation_45_50p,\r\n\r\n    COUNTIF(bs.status_id\u003d7 and bs.program_id in (select id from `kynaforkids-server-production.kynaforkids.booking_program` bp\r\n    where bp.number_of_shift \u003d 1 and bp.program_type \u003d 1 and  bp.subject \u003d 1 and bp.id !\u003d 3 AND bs.cancel_config_id not IN (1,6, 8)and bs.cancel_status_id in (3,33) )) \r\n    AS lop_100_compensation_25p,\r\n\r\n    COUNTIF(bs.status_id\u003d7 and bs.program_id in (select id from `kynaforkids-server-production.kynaforkids.booking_program` bp\r\n    where bp.number_of_shift \u003d 2 and bp.program_type \u003d 1 and  bp.subject \u003d 1 and bp.id !\u003d 3 AND bs.cancel_config_id not IN (1,6, 8)and bs.cancel_status_id in (3,33) )) \r\n    AS lop_100_compensation_45_50p,\r\n\r\n    COUNTIF(bs.status_id \u003d 5 and bs.rating \u003d 4 and bs.program_id in (select id from `kynaforkids-server-production.kynaforkids.booking_program` bp\r\n    where bp.number_of_shift \u003d 1 and bp.program_type \u003d 1 and  bp.subject \u003d 1 and bp.id !\u003d 3)) AS Nopay_25p,\r\n\r\n    COUNTIF(bs.status_id \u003d 5 and bs.rating \u003d 4 and bs.program_id in (select id from `kynaforkids-server-production.kynaforkids.booking_program` bp\r\n    where bp.number_of_shift \u003d 2 and bp.program_type \u003d 1 and  bp.subject \u003d 1 and bp.id not in (3,118,119,120,127,128,129,130,131))) AS Nopay_45_50p,\r\n\r\n    COUNTIF(bs.status_id \u003d 5 and bs.rating \u003d 4 and bs.program_id in (118,119,120,127,128,129)) AS Nopay_60p,  -- Nopay chương trình 60 phút (cũng 2 ca)\r\n\r\n    COUNTIF(bs.status_id \u003d 5 and bs.rating \u003d 4 and bs.program_id in (130,131)) AS Nopay_extra,  -- No pay chương trình ngoại khóa (cũng 2 ca)\r\n\r\n    --quynh end--\r\n    -- ngaltt 14/05/2024 start\r\n    COUNTIF(bs.status_id \u003d 5 and bs.rating \u003d 4 and bs.program_id in (select id from `kynaforkids-server-production.kynaforkids.booking_program` bp\r\n    where bp.number_of_shift \u003d 1 and bp.program_type \u003d 2 and  bp.subject \u003d 1 and bp.id !\u003d 3)) AS Nopay_Test_25p,\r\n\r\n    COUNTIF(bs.status_id \u003d 5 and bs.rating \u003d 4 and bs.program_id in (select id from `kynaforkids-server-production.kynaforkids.booking_program` bp\r\n    where bp.number_of_shift \u003d 2 and bp.program_type \u003d 2 and  bp.subject \u003d 1 and bp.id !\u003d 3)) AS Nopay_Test_45_50p,\r\n\r\n    SUM(IF(bs.status_id\u003d5 and bs.program_id in (select id from `kynaforkids-server-production.kynaforkids.booking_program` bp\r\n    where bp.number_of_shift \u003d 1 and bp.program_type \u003d 1 and  bp.subject \u003d 1 and bp.id !\u003d 3), \r\n     bs.total_income\r\n    , 0)) AS income_taught_25p,\r\n\r\n    SUM(IF(bs.status_id\u003d5 and bs.program_id in (select bp.id from `kynaforkids-server-production.kynaforkids.booking_program` bp\r\n    where bp.number_of_shift \u003d 1 and bp.program_type \u003d 2 and  bp.subject \u003d 1 and bp.id !\u003d 3),\r\n      bs.total_income\r\n     , 0)) AS income_taught_test_1ca,\r\n\r\n    SUM(IF(bs.status_id\u003d5 and bs.program_id in (select id from `kynaforkids-server-production.kynaforkids.booking_program` bp\r\n    where bp.number_of_shift \u003d 2 and bp.program_type \u003d 1 and  bp.subject \u003d 1 and bp.id not in (3,118,119,120,127,128,129,130,131)),\r\n     bs.total_income\r\n    , 0)) AS income_taught_45p,\r\n\r\n   SUM(IF(bs.status_id\u003d5 and bs.program_id in (118,119,120,127,128,129),\r\n     bs.total_income\r\n    , 0)) AS income_taught_60p,\r\n\r\n    SUM(IF(bs.status_id\u003d5 and bs.program_id in (130,131),\r\n     bs.total_income\r\n    , 0)) AS income_taught_extra,\r\n\r\n    SUM(IF(bs.status_id\u003d5 and bs.program_id in (select id from `kynaforkids-server-production.kynaforkids.booking_program` bp\r\n    where bp.number_of_shift \u003d 2 and bp.program_type \u003d 2 and  bp.subject \u003d 1 and bp.id !\u003d 3),\r\n      bs.total_income\r\n     , 0)) AS income_taught_test_2ca,\r\n\r\n    SUM(IF(bs.status_id \u003d 5 and bs.rating \u003d 4 and bs.program_id in (select id from `kynaforkids-server-production.kynaforkids.booking_program` bp where bp.number_of_shift \u003d 1 and bp.program_type \u003d 1 and  bp.subject \u003d 1 and bp.id !\u003d 3)\r\n    , -bs.total_income\r\n    , 0)) AS income_Nopay_25p,\r\n\r\n    SUM(IF(bs.status_id \u003d 5 and bs.rating \u003d 4 and bs.program_id in (select id from `kynaforkids-server-production.kynaforkids.booking_program` bp where bp.number_of_shift \u003d 1 and bp.program_type \u003d 2 and  bp.subject \u003d 1 and bp.id !\u003d 3)\r\n    , -bs.total_income\r\n    , 0)) AS income_Nopay_test_25p,\r\n\r\n    SUM(IF(bs.status_id \u003d 5 and bs.rating \u003d 4 and bs.program_id in (select id from `kynaforkids-server-production.kynaforkids.booking_program` bp where bp.number_of_shift \u003d 2 and bp.program_type \u003d 1 and  bp.subject \u003d 1 and bp.id not in (3,118,119,120,127,128,129,130,131)), \r\n    -bs.total_income\r\n    , 0)) AS income_Nopay_45_50p,\r\n\r\n     SUM(IF(bs.status_id \u003d 5 and bs.rating \u003d 4 and bs.program_id in (118,119,120,127,128,129), \r\n    -bs.total_income\r\n    , 0)) AS income_Nopay_60p,\r\n\r\n     SUM(IF(bs.status_id \u003d 5 and bs.rating \u003d 4 and bs.program_id in (130,131), \r\n    -bs.total_income\r\n    , 0)) AS income_Nopay_extra,\r\n\r\n    SUM(IF(bs.status_id \u003d 5 and bs.rating \u003d 4 and bs.program_id in (select id from `kynaforkids-server-production.kynaforkids.booking_program` bp where bp.number_of_shift \u003d 2 and bp.program_type \u003d 2 and  bp.subject \u003d 1 and bp.id !\u003d 3), \r\n    -bs.total_income\r\n    , 0)) AS income_Nopay_test_45_50p\r\n      -- ngaltt 14/05/2024 end\r\n  FROM `kynaforkids-server-production.kynaforkids.booking_session_view` bs\r\n  WHERE bs.teacher_id IS NOT NULL\r\n  GROUP BY\r\n    bs.teacher_id,\r\n    teacher_day;"
}, {
  "table_name": "Acc_Order_Tutoring_No_Students",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.Acc_Order_Tutoring_No_Students`\nAS SELECT bo.Date, bo.Order_Code,\r\n       if(bo.student_code_1 is null or bo.student_code_1 \u003d \u0027\u0027,bo.phone_number,bo.student_code_1) as student_code,\r\n       bo.Payment_Content,\r\n       bo.Source,\r\n       bo.Original_Price,\r\n       bo.Ex,\r\n       bo.Market,\r\n       bo.affiliate_id,\r\n       bo.lead_id,\r\n      (select ac.name from `kynaforkids-server-production.kynaforkids.affiliate_category` ac, `kynaforkids-server-production.kynaforkids.affiliate_user` au  where bo.affiliate_id \u003d au.affiliate_id and au.affiliate_category_id \u003d ac.id) as loai_affiliate,\r\n      bo.user_type_id,\r\n       bo.student_code_1,\r\n       bo.phone_number,\r\n       -- start adding 11/02/2025\r\n       bo.email,\r\n       bo.accounting_date,\r\n       -- end adding 11/02/2025\r\n       bo.name,\r\n       bo.total_lesson,\r\n       bo.total_gift_lesson,\r\n       bo.program_id,\r\n      (bo.total_video_course * bo.Ex) as total_video_vnd\r\nFROM\r\n      (select order_kt.Date,\r\n              order_kt.Order_Code,\r\n              if(order_ds.student_code is null or order_ds.student_code \u003d \u0027\u0027 ,order_ds.phone_number,order_ds.student_code) as student_code,\r\n              order_kt.Payment_Content,\r\n              order_kt.Source,\r\n              order_kt.Original_Price,\r\n              order_kt.Ex, order_kt.Market,\r\n              order_ds.affiliate_id,\r\n              order_ds.lead_id,\r\n              order_ds.user_type_id,\r\n              order_ds.student_code as student_code_1,\r\n              order_ds.phone_number,\r\n              -- start adding 11/02/2025\r\n              order_ds.email,\r\n              if(order_ds.accounting_date is null, order_ds.payment_at,order_ds.accounting_date) as accounting_date,\r\n              -- end adding 11/02/2025\r\n              order_ds.name,\r\n              order_ds.total_lesson,\r\n              order_ds.total_gift_lesson, order_ds.program_id,\r\n              if(order_ds.total_video_course is null, 0, order_ds.total_video_course) as total_video_course,\r\n      from kynaforkids-server-production.kynaforkids.Order_Tutoring as order_kt\r\n      join kynaforkids-server-production.kynaforkids.booking_order as order_ds\r\n      on order_kt.Order_Code \u003d order_ds.invoice_code) bo;"
}, {
  "table_name": "booking_level_mapping",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_level_mapping`\n(\n  id INT64,\n  source_level_id INT64,\n  target_level_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  target_level_id_v2 INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "aca_training_sample_record",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.aca_training_sample_record`\n(\n  booking_id INT64,\n  record_url STRING,\n  is_hide_face INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "partner_product",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.partner_product`\n(\n  id INT64,\n  partner_id INT64,\n  package_id INT64,\n  subscription_id INT64,\n  name STRING,\n  code STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_session_action",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_session_action`\n(\n  id INT64,\n  session_id INT64,\n  from_status INT64,\n  to_status INT64,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  action_id STRING,\n  detail_change STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_ai_level",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_ai_level`\n(\n  id INT64,\n  name STRING,\n  program_id INT64,\n  next_level_id INT64,\n  visible INT64,\n  `order` INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  corresponding_options INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "temp_mkt_line_performance_by_new_students_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.temp_mkt_line_performance_by_new_students_view`\nAS WITH aff_campaign_inf AS\r\n(\r\n  SELECT\r\n    aci.`campaign_id`,\r\n    ac.name as campaign_name,\r\n    date(TIMESTAMP_SECONDS(aci.`date`)+ INTERVAL 7 HOUR) as date_spend,\r\n    aci.`spend`,\r\n    ac.account_id,\r\n    ac.channel_id,\r\n    ac.effective_status,\r\n    ac.product_id,\r\n    ac.user_id,\r\n    ac.country_id,\r\n    ac.line_id,\r\n  \r\n    CASE\r\n          WHEN ac.channel_id \u003d 1 AND  date(TIMESTAMP_SECONDS(aci.`date`)+ INTERVAL 7 HOUR) \u003e\u003d \u00272025-03-01\u0027 THEN ROUND(1.05 * aci.spend)\r\n          WHEN ac.channel_id \u003d 1 AND  date(TIMESTAMP_SECONDS(aci.`date`)+ INTERVAL 7 HOUR) \u003c \u00272025-03-01\u0027 THEN ROUND(1.07 * aci.spend)\r\n          WHEN ac.channel_id \u003d 2 THEN ROUND(1.05 * aci.spend)\r\n          WHEN ac.channel_id \u003d 3 THEN ROUND(1.05 * aci.spend)\r\n    END AS spend_with_tax,\r\n  FROM\r\n    `kynaforkids-server-production.kynaforkids.adwords_meta_campaign_insight` aci\r\n\r\n  LEFT JOIN `kynaforkids-server-production.kynaforkids.adwords_meta_campaign` ac\r\n        ON  ac.id \u003d aci.campaign_id\r\n  WHERE date(TIMESTAMP_SECONDS(aci.`date`)) \u003e\u003d \u00272022-01-01\u0027\r\n\r\n),\r\n\r\nline_name_spend as(\r\n  SELECT  ci.date_spend, ci.channel_id, ci.product_id, ci.country_id, \r\n        SUM(ci.spend) as spend, SUM(ci.spend_with_tax) as spend_with_tax,\r\n        CASE WHEN ci.line_id is not null then line.name\r\n             ELSE \u0027Line_without_ID\u0027\r\n        END as line_mkt\r\n  FROM aff_campaign_inf ci\r\n  LEFT JOIN `kynaforkids-server-production.kynaforkids.adwords_meta_line` line ON(line.id \u003d ci.line_id)\r\n  GROUP BY ci.date_spend, line_mkt, ci.country_id, ci.channel_id, ci.product_id\r\n  ORDER BY date_spend \r\n),\r\n\r\n\r\n\r\nline_lead_date AS \r\n(\r\nSELECT \r\n        lead_date, line_id,\r\n        SUM(num_leads) as num_leads,\r\n        SUM(num_leads_test_approved) as num_leads_test_approved,\r\n        SUM(num_leads_test) as num_leads_test,\r\n        SUM(leads_wait_for_order) as leads_wait_for_order,\r\n        max(country_id) as country_id,\r\n\r\nFROM\r\n(\r\nSELECT\r\n       date(blv.created_at) as lead_date, \r\n        blv.affiliate_campaign as utm_campaign,\r\n        -- MAX(blv.country_id) as country_id,\r\n        COUNTIF(blv.id is not null and blv.Bloked_Open \u003d \u0027Open\u0027) as num_leads,\r\n        COUNT(blv.test_approved_lead_id) as num_leads_test_approved,\r\n        COUNTIF(blv.nhan_xet_gv \u003d \u0027Đã có nhận xét\u0027) as num_leads_test,\r\n        COUNTIF(blv.lead_status \u003d \u0027Ghi danh - Chờ lên đơn\u0027 and blv.Bloked_Open \u003d \u0027Open\u0027) as leads_wait_for_order,\r\n\r\n        if((select max(auc.country_id) from `kynaforkids-server-production.kynaforkids.adwords_utm_campaign` auc where lower(name) \u003d lower(blv.affiliate_campaign)) is null,\r\n            max(blv.country_id), \r\n            (select max(auc.country_id) from `kynaforkids-server-production.kynaforkids.adwords_utm_campaign` auc where lower(name) \u003d lower(blv.affiliate_campaign))) as country_id,\r\n        \r\n        (SELECT max(line_id) FROM `kynaforkids-server-production.kynaforkids.adwords_utm_campaign` \r\n         WHERE lower(name) \u003d lower(blv.affiliate_campaign)) as line_id,\r\n  FROM `kynaforkids-server-production.kynaforkids.mkt_booking_lead_view` blv\r\n  WHERE -- blv.sourse \u003d \u0027Marketing\u0027  \r\n       date(blv.created_at) \u003e\u003d \u00272022-01-01\u0027\r\n    -- AND blv.Bloked_Open \u003d \u0027Open\u0027\r\n    -- AND blv.sale_email !\u003d \u0027lp.marketing@kynaforkids.vn\u0027\r\n    AND blv.id NOT IN\r\n        (\r\n          SELECT blv.id \r\n          FROM  `kynaforkids-server-production.kynaforkids.mkt_booking_lead_view` blv\r\n          WHERE   \r\n                   date(blv.created_at) \u003e\u003d \u00272022-01-01\u0027\r\n               AND blv.reason_cancel_id IN (\u002720\u0027,\u002718\u0027,\u002717\u0027,\u00279\u0027,\u00278\u0027)\r\n        )\r\n  GROUP BY lead_date, blv.affiliate_campaign, line_id\r\n  ORDER By lead_date\r\n)\r\nGROUP BY lead_date, line_id\r\n)\r\n,\r\n\r\nline_order_date AS (\r\nSELECT\r\n        date(oc.ngay_tao_don) as order_date,\r\n        -- date(oc.accounting_date) as order_date, \r\n        (SELECT MAX(line_id) FROM `kynaforkids-server-production.kynaforkids.adwords_utm_campaign` \r\n         WHERE lower(name) \u003d lower(oc.affiliate_campaign)) as line_id,\r\n        -- oc.affiliate_campaign as utm_campaign,\r\n        MAX(oc.country_id) as country_id,\r\n        SUM(oc.total_VND) as order_value,\r\n        COUNT(oc.order_id) as num_orders,\r\nFROM `kynaforkids-server-production.kynaforkids.mkt_booking_order_old_new_students_view` oc\r\nWHERE \r\n      date(oc.ngay_tao_don) \u003e\u003d \u00272022-01-01\u0027 \r\nGROUP BY order_date, line_id\r\nORDER BY order_date \r\n),\r\n\r\nline_lead_order AS\r\n(\r\nSELECT \r\n        IF(lld.lead_date is null, lod.order_date, lld.lead_date) as calc_date, \r\n        lld.lead_date,\r\n        lod.order_date,\r\n        IF(lld.line_id is null, lod.line_id, lld.line_id) as line_id,\r\n        lld.line_id as line_id_lead, \r\n        lod.line_id as line_id_od, \r\n        lld.num_leads, \r\n        lld.num_leads_test, \r\n        lld.num_leads_test_approved, \r\n        lld.leads_wait_for_order, \r\n        lod.num_orders, \r\n        lod.order_value,\r\n        IF(lld.country_id is null, lod.country_id, lld.country_id) as country_id, \r\nFROM line_lead_date lld\r\nFULL JOIN line_order_date lod\r\nON (lld.lead_date \u003d lod.order_date AND lld.line_id \u003d lod.line_id)\r\n),\r\n\r\nline_name_lead_order AS (\r\nSELECT\r\n    llo.calc_date,\r\n    SUM(num_leads) as num_leads, SUM(num_leads_test) as num_leads_test, SUM(num_leads_test_approved) as num_leads_test_approved, SUM(num_orders) as num_orders, SUM(leads_wait_for_order) as leads_wait_for_order, SUM(order_value) as order_value,\r\n    CASE WHEN llo.line_id is not null then line.name\r\n        ELSE \u0027Line_without_ID\u0027\r\n    END AS line_mkt,\r\n    IF(llo.country_id is null, (SELECT max(auc.country_id) FROM `kynaforkids-server-production.kynaforkids.adwords_utm_campaign` auc \r\n         WHERE llo.line_id \u003d auc.line_id), llo.country_id) as country_id,\r\n    \r\n    (SELECT max(auc.product_id) FROM `kynaforkids-server-production.kynaforkids.adwords_utm_campaign` auc \r\n         WHERE llo.line_id \u003d auc.line_id) as product_id,\r\n\r\n    (SELECT max(auc.channel_id) FROM `kynaforkids-server-production.kynaforkids.adwords_utm_campaign` auc \r\n         WHERE llo.line_id \u003d auc.line_id) as channel_id,         \r\nFROM line_lead_order llo\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.adwords_meta_line` line ON(line.id \u003d llo.line_id)\r\nGROUP BY llo.calc_date, line_mkt, country_id, channel_id, product_id\r\nORDER BY calc_date\r\n),\r\n\r\nperformance_table as \r\n(SELECT \r\n  IF(lot.calc_date is null, sp.date_spend, lot.calc_date) as calc_date,\r\n  IF(lot.line_mkt is null, sp.line_mkt, lot.line_mkt) as line_mkt,\r\n--   IF(lot.country_id is null, sp.country_id, lot.country_id) as country_id,\r\n  IF(sp.country_id is null, lot.country_id, sp.country_id) as country_id,\r\n  -- lot.country_id as country_id,\r\n  IF(lot.channel_id is null, sp.channel_id, lot.channel_id) as channel_id,\r\n  IF(lot.product_id is null, sp.product_id, lot.product_id) as product_id,\r\n  SUM(sp.spend) as spend, \r\n  SUM(sp.spend_with_tax) as spend_with_tax,\r\n  SUM(lot.num_leads) as num_leads,\r\n  SUM(lot.num_leads_test) as num_leads_test,\r\n  SUM(lot.num_leads_test_approved) as num_leads_test_approved,\r\n  SUM(lot.leads_wait_for_order) as leads_wait_for_order,\r\n  SUM(lot.num_orders) as num_orders,\r\n  SUM(lot.order_value) as order_value,\r\n  \r\nFROM line_name_lead_order lot\r\nFULL JOIN line_name_spend sp\r\n-- ON (lot.calc_date \u003d sp.date_spend AND lot.line_mkt \u003d sp.line_mkt)\r\nON (lot.calc_date \u003d sp.date_spend AND lot.line_mkt \u003d sp.line_mkt AND lot.country_id \u003d sp.country_id AND lot.channel_id \u003d sp.channel_id AND lot.product_id\u003dsp.product_id) \r\n\r\nGROUP BY calc_date, line_mkt, country_id, channel_id, product_id\r\nORDER BY calc_date \r\n)\r\n\r\nSELECT pt.*,\r\n      case \r\n          WHEN country_id \u003d 1 THEN \u0027Thailand\u0027\r\n          WHEN country_id \u003d 2 THEN \u0027Indo\u0027\r\n          WHEN country_id \u003d 3 THEN \u0027Việt Nam\u0027\r\n          WHEN country_id \u003d 4 THEN \u0027Khác\u0027\r\n          WHEN country_id \u003d 5 THEN \u0027Lào\u0027\r\n          WHEN country_id \u003d 6 THEN \u0027Malaysia\u0027\r\n          else \"Chưa biết\"\r\n      end as country,\r\n\r\n      case \r\n            when product_id \u003d 1 then \u0027Kids - 1 kèm 1\u0027\r\n            when product_id \u003d 2 then \u0027KEA - 1 kèm 1\u0027\r\n            when product_id \u003d 3 then \u0027Toán - 1 kèm 1\u0027\r\n            when product_id \u003d 4 then \u0027Kids - Class\u0027\r\n            when product_id \u003d 5 then \u0027Tuyển dụng GV\u0027\r\n            when product_id \u003d 6 then \u0027Khác\u0027\r\n            when product_id \u003d 7 then \u0027AI Tutor\u0027\r\n            else \"Chưa biết\"\r\n      end as product_name,\r\n\r\n      case \r\n          when channel_id \u003d 1 then \u0027Facebook\u0027\r\n          when channel_id \u003d 2 then \u0027Tiktok\u0027\r\n          when channel_id \u003d 3 then \u0027Google\u0027\r\n          else \"Chưa biết\"\r\n      end as channel_name\r\n\r\n\r\nFROM performance_table pt\r\n\r\n\r\n;"
}, {
  "table_name": "booking_student_program_certificate_commitment",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_program_certificate_commitment`\n(\n  id INT64,\n  student_id INT64,\n  program_id INT64,\n  order_id INT64,\n  approved_at INT64,\n  certificate_commitment_id INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "bot_fulfillment",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.bot_fulfillment`\n(\n  id INT64,\n  name STRING,\n  parameter STRING,\n  type INT64,\n  content STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_tutor_error_report",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_tutor_error_report`\n(\n  id INT64,\n  mode INT64,\n  error_type INT64,\n  description STRING,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  json_data STRING,\n  reference_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "arena_race",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.arena_race`\n(\n  arena_id INT64,\n  candidate_id INT64,\n  session_id INT64,\n  start_time INT64,\n  end_time INT64,\n  total_score NUMERIC(15, 2),\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  visible INT64,\n  status INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (candidate_id, arena_id) NOT ENFORCED\n)\nCLUSTER BY candidate_id, arena_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_sale_commission",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_sale_commission`\n(\n  id INT64,\n  country_id INT64,\n  currency_code STRING,\n  order_id INT64,\n  source_id INT64,\n  sale_id INT64,\n  total NUMERIC(15, 2),\n  rate FLOAT64,\n  commission_config_id INT64,\n  commission NUMERIC(15, 2),\n  amount NUMERIC(15, 2),\n  note STRING,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  program_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_lead_conversion",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_lead_conversion`\n(\n  id INT64,\n  phone_number STRING,\n  intl_phone_number STRING,\n  email STRING,\n  currency_code STRING,\n  event_name STRING,\n  event_id STRING,\n  event_time INT64,\n  event_source STRING,\n  action_source STRING,\n  landing_page_slug STRING,\n  user_data STRING,\n  custom_data STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  lead_id INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "sms_subscription_template",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.sms_subscription_template`\n(\n  id INT64,\n  type INT64,\n  template STRING,\n  region_code INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "adwords_meta_ad_utm_campaign",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.adwords_meta_ad_utm_campaign`\n(\n  id INT64,\n  ad_id STRING,\n  utm_campaign STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_student_action",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_action`\n(\n  id INT64,\n  student_id INT64,\n  action INT64,\n  notes STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "Acc_teacher_income_ex",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.Acc_teacher_income_ex`\n(\n  date DATE,\n  sellingEx FLOAT64,\n  teacherCountry STRING,\n  currency STRING\n);"
}, {
  "table_name": "booking_student_center",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_center`\n(\n  user_id INT64,\n  is_user_test INT64,\n  subject INT64,\n  center_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n);"
}, {
  "table_name": "cac_year_month_table",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.cac_year_month_table`\n(\n  year_month STRING\n);"
}, {
  "table_name": "wh_department",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.wh_department`\n(\n  id INT64,\n  name STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_teacher_income_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.booking_teacher_income_view`\nAS SELECT bti.* except(`date`,created_at,updated_at),\r\n      timestamp_seconds(bti.`date`) as `date`,\r\n      timestamp_seconds(bti.created_at) as created_at,\r\n      timestamp_seconds(bti.updated_at) as updated_at,\r\n      FORMAT_DATETIME(\u0027%Y-%m\u0027, timestamp_seconds(bti.`date`)) AS year_month,\r\n      `kynaforkids-server-production.kynaforkids.func_get_country_teacher`(bt.country_id) as teacherCountry \r\n\r\n\r\nFROM `kynaforkids-server-production.kynaforkids.booking_teacher_income` bti\r\nleft join `kynaforkids.booking_teacher` bt on bti.teacher_id \u003d bt.user_id\r\n;"
}, {
  "table_name": "aca_ai_tutor_lessons_with_low_rating_feedback_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.aca_ai_tutor_lessons_with_low_rating_feedback_view`\nAS WITH ai_topic_add_mode AS \r\n(\r\nSELECT atp.*, \r\n       1 as mode,\r\n       (SELECT al.name\r\n        FROM `kynaforkids.ai_level` al WHERE al.id \u003d atp.ai_level_id) as level_name\r\n\r\nFROM `kynaforkids-server-production.kynaforkids.ai_topic` atp \r\n\r\n),\r\n\r\nai_pronunciation_lesson_add_mode AS \r\n(\r\nSELECT t1.*,\r\n       (SELECT apl.name\r\n        FROM `kynaforkids-server-production.kynaforkids.ai_pronunciation_level` apl WHERE apl.id \u003d t1.ai_pronunciation_level_id) as level_name\r\n       \r\nFROM\r\n(\r\nSELECT apl.*, \r\n       2 as mode,\r\n       (SELECT apt.name\r\n        FROM `kynaforkids-server-production.kynaforkids.ai_pronunciation_topic` apt WHERE apt.id \u003d apl.ai_pronunciation_topic_id) as topic_name,\r\n        (SELECT apt.ai_pronunciation_level_id\r\n        FROM `kynaforkids-server-production.kynaforkids.ai_pronunciation_topic` apt WHERE apt.id \u003d apl.ai_pronunciation_topic_id) as ai_pronunciation_level_id\r\nFROM `kynaforkids-server-production.kynaforkids.ai_pronunciation_lesson` apl\r\n\r\n) t1\r\n),\r\n\r\nai_picture_topic_add_mode AS \r\n(\r\nSELECT \r\n        apm.*, \r\n        3 as mode,\r\n        (SELECT apl.name\r\n        FROM `kynaforkids-server-production.kynaforkids.ai_picture_mode_level` apl WHERE apl.id \u003d apm.ai_picture_mode_level_id) as level_name\r\n\r\nFROM `kynaforkids-server-production.kynaforkids.ai_picture_mode_topic` apm\r\n\r\n),\r\n\r\nai_feedback_get_name AS\r\n(\r\nSELECT ae.*, \r\n       ap.level_name as pp_level, ap.topic_name as pp_topic, ap.name as pronunc_name, \r\n       arp.level_name as rp_level, arp.name as roleplay_name, \r\n       api.level_name as pic_level, api.name as pic_name \r\n\r\nFROM `kynaforkids-server-production.kynaforkids.ai_tutor_error_report` ae\r\nLEFT JOIN ai_pronunciation_lesson_add_mode ap ON (ae.mode \u003d ap.mode AND ae.reference_id \u003d ap.id)\r\nLEFT JOIN ai_topic_add_mode arp ON (ae.mode \u003d arp.mode AND ae.reference_id \u003d arp.id)\r\nLEFT JOIN ai_picture_topic_add_mode api ON (ae.mode \u003d api.mode AND ae.reference_id \u003d api.id)\r\n),\r\n\r\nfeedback_table as\r\n(\r\nSELECT *,\r\n       IF(pic_name is null,IF(pronunc_name is null, roleplay_name,pronunc_name),pic_name) as lesson_topic_name,\r\n       IF(pp_level is null,IF(pic_level is null, rp_level,pic_level),pp_level) as level,\r\n       case   when error_type \u003d 2 then \"Nội dung hoặc hình ảnh không chính xác\"\r\n\t       when error_type \u003d 3 then \"Chủ đề chưa đáp ứng yêu cầu\"\r\n\t       when error_type \u003d 4 then \"Chấm điểm sai\"\r\n              when error_type \u003d 1 then \"Vấn đề khác\"\r\n       end as `error`\r\nFROM ai_feedback_get_name\r\nWHERE mode is not null\r\n),\r\n\r\n\r\nai_rating_get_name AS\r\n(\r\nSELECT ar.*, \r\n       ap.level_name as pp_level, ap.topic_name as pp_topic, ap.name as pronunc_name, \r\n       arp.level_name as rp_level, arp.name as roleplay_name, \r\n       api.level_name as pic_level, api.name as pic_name \r\n\r\nFROM `kynaforkids-server-production.kynaforkids.ai_tutor_rating` ar\r\nLEFT JOIN ai_pronunciation_lesson_add_mode ap ON (ar.mode \u003d ap.mode AND ar.topic_id \u003d ap.id)\r\nLEFT JOIN ai_topic_add_mode arp ON (ar.mode \u003d arp.mode AND ar.topic_id \u003d arp.id)\r\nLEFT JOIN ai_picture_topic_add_mode api ON (ar.mode \u003d api.mode AND ar.topic_id \u003d api.id)\r\n),\r\n\r\n\r\nrating_table AS\r\n(\r\nSELECT *,\r\n       IF(pic_name is null,IF(pronunc_name is null, roleplay_name,pronunc_name),pic_name) as lesson_topic_name,\r\n       IF(pp_level is null,IF(pic_level is null, rp_level,pic_level),pp_level) as level,\r\n\t \r\nFROM ai_rating_get_name\r\n),\r\n\r\nrating_feedback_table AS\r\n(SELECT \r\n       IF(rt.mode is null,ft.mode, rt.mode) as mode,\r\n       -- rt.mode, ft.mode,\r\n       IF(rt.level is null,ft.level, rt.level) as level,\r\n       IF(rt.lesson_topic_name is null,ft.lesson_topic_name, rt.lesson_topic_name) as lesson_topic_name,\r\n       -- rt.lesson_topic_name,ft.lesson_topic_name,\r\n       IF(rt.created_by is null,ft.created_by, rt.created_by) as created_by,\r\n       -- rt.created_by, ft.created_by,\r\n       \r\n       \r\n       -- IF(rt.lesson_topic_name is null,ft.lesson_topic_name, rt.lesson_topic_name) as lesson_topic_name,\r\n       AVG(rt.rating) as rating,\r\n       string_agg(rt.comment, \", \") as comment,\r\n       max(if(rt.created_at is not null and ft.created_at is not null, greatest(rt.created_at, ft.created_at), if(rt.created_at is not null,rt.created_at,ft.created_at))) as latest_submitted_at,\r\n       string_agg(ft.error) as `error`,\r\n       string_agg(ft.description) as description,\r\n\r\n    \r\n\r\nFROM rating_table rt\r\nFULL JOIN feedback_table ft ON (rt.created_by \u003d ft.created_by AND rt.mode \u003d ft.mode AND rt.level \u003d ft.level AND rt.lesson_topic_name \u003d ft.lesson_topic_name)\r\nGROUP BY mode, level, lesson_topic_name, created_by\r\n       --   rt.mode, ft.mode, rt.lesson_topic_name,ft.lesson_topic_name, rt.created_by, ft.created_by\r\n-- ORDER BY length(comment)\r\n),\r\n\r\nrating_feedback_table_add_mode_name AS\r\n(\r\nSELECT *,\r\n       case   when mode \u003d 1 then \u0027Role Play\u0027\r\n\t       when mode \u003d 2 then \u0027Pronunciation\u0027\r\n              when mode \u003d 3 then \u0027Picture\u0027\r\n              else \u0027Unknown\u0027 \r\n       end as ai_mode\r\nFROM rating_feedback_table \r\n)\r\n\r\n\r\nSELECT ai_mode, level, lesson_topic_name,\r\n       COUNT(rating) as num_rating_1_2,\r\n       string_agg(`comment`) as comments,\r\n       string_agg(`error`) as errors,\r\n       string_agg(`description`) as descriptions,\r\n       max(timestamp_seconds(latest_submitted_at)) as latest_submitted_at,\r\n       \r\nFROM rating_feedback_table_add_mode_name rft\r\nWHERE rating \u003d 1 or rating \u003d 2  \r\nGROUP BY ai_mode, level, lesson_topic_name\r\nHAVING num_rating_1_2 \u003e\u003d 3 OR errors LIKE \"%Nội dung hoặc hình ảnh không chính xác\"\r\nORDER BY ai_mode;"
}, {
  "table_name": "sms_subscription_transaction",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.sms_subscription_transaction`\n(\n  id INT64,\n  api_gateway_data STRING,\n  user_id INT64,\n  sms_type INT64,\n  phone_number STRING,\n  command_code STRING,\n  package_code STRING,\n  amount NUMERIC(15, 2),\n  status INT64,\n  channel STRING,\n  is_assign_user INT64,\n  created_at INT64,\n  updated_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "Test_student_booking",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.Test_student_booking`\nAS SELECT \r\n  bs.teacher_id as TeacherID,\r\n  if(bs.rating \u003d 2,1,0) as total_dat,\r\n  if(bs.rating \u003d 1,1,0)  as total_khongdat,\r\n  if(bs.rating \u003d 3,1,0) as total_duoichuan,\r\n  if(bs.rating \u003d 4,1,0) as total_nopay,\r\n  if(bs.rating \u003d 4 and bs.program_id \u003d 8,1,0) as total_nopay_1_ca,\r\n  if(bs.rating \u003d 4 and bs.program_id \u003d 13,1,0) as total_nopay_2_ca,\r\n  date(bs.begin_at) as begin_at\r\nFROM `kynaforkids-server-production.kynaforkids.booking_session_student` bss\r\nINNER JOIN `kynaforkids-server-production.kynaforkids.booking_session_view` bs ON bs.id \u003d bss.booking_session_id\r\nWHERE bs.status_id IN (5)\r\nAND bs.program_id IN (8,13,47,48,53,54,55,56,89,90)\r\n;"
}, {
  "table_name": "quiz_part_result",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.quiz_part_result`\n(\n  id INT64,\n  quiz_session_id INT64,\n  section_id INT64,\n  part_id INT64,\n  total_score FLOAT64,\n  is_passed INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "rating_template",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.rating_template`\n(\n  id INT64,\n  name STRING,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "kynavn_email_contact_name",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.kynavn_email_contact_name`\n(\n  email STRING,\n  id INT64,\n  name STRING,\n  part_number INT64\n);"
}, {
  "table_name": "sale_bonus_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.sale_bonus_config`\n(\n  id INT64,\n  affiliate_source_id INT64,\n  country_id INT64,\n  user_type INT64,\n  percent FLOAT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_session_upgrade",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_session_upgrade`\n(\n  id INT64,\n  booking_session_id INT64,\n  program_id INT64,\n  student_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "user_activity",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.user_activity`\n(\n  id INT64,\n  user_id INT64,\n  action_type INT64,\n  object_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "contest_school",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.contest_school`\n(\n  id INT64,\n  name STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  contest_campaign_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  province_id INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "data_export",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.data_export`\n(\n  id INT64,\n  name STRING,\n  description STRING,\n  sql_command STRING,\n  update_field_name STRING,\n  insert_field_name STRING,\n  unique_columns STRING,\n  db_name STRING,\n  biq_query_table STRING,\n  query_all INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  visible INT64,\n  output_result STRING,\n  begin_run_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "package_subscriptions",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.package_subscriptions`\n(\n  id INT64,\n  package_id INT64,\n  subscription_month INT64,\n  price INT64,\n  price_discount INT64,\n  percent_discount FLOAT64,\n  prize STRING,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  name STRING,\n  is_deleted INT64,\n  offer_month INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  subscription_weeks INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "task_management",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.task_management`\n(\n  id INT64,\n  action_id INT64,\n  source INT64,\n  content STRING,\n  teacher_id INT64,\n  interview_id INT64,\n  program_id INT64,\n  ops_teacher_id INT64,\n  status INT64,\n  sub_status INT64,\n  approved_by INT64,\n  approved_at INT64,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "contest_quiz_learning",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.contest_quiz_learning`\n(\n  id INT64,\n  contest_round_info_id INT64,\n  contest_round_phase_info_id INT64,\n  group_id INT64,\n  lesson_id INT64,\n  lesson_type INT64,\n  learning_mode INT64,\n  is_main_exam INT64,\n  max_doing_number INT64,\n  score INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "education_department_class",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.education_department_class`\n(\n  id INT64,\n  education_department_school_id INT64,\n  name STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "writing_session_grading_note",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.writing_session_grading_note`\n(\n  id INT64,\n  writing_session_id INT64,\n  key INT64,\n  type INT64,\n  main_criteria_id INT64,\n  sub_criteria_id INT64,\n  criteria_type_id INT64,\n  text_selected STRING,\n  correct_text STRING,\n  css_class STRING,\n  offset INT64,\n  selected_length INT64,\n  teacher_note STRING,\n  description STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_payment_history_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.booking_payment_history_view`\nAS SELECT * except(payment_at,created_at),\r\n      timestamp_seconds(payment_at) as payment_at,\r\n      timestamp_seconds(created_at) as created_at\r\nFROM `kynaforkids-server-production.kynaforkids.booking_payment_history`;"
}, {
  "table_name": "interview_action_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.interview_action_log`\n(\n  id INT64,\n  interview_id INT64,\n  action INT64,\n  data STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "sales_ctv_marketing_hour_timesheet",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.kynaforkids.sales_ctv_marketing_hour_timesheet`\nOPTIONS(\n  sheet_range\u003d\"Sheet1!A:D\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/1r_wiqJqtIQc6rNjhyrAB52dG5UkYbzNfvHutdLwJD5k\"]\n);"
}, {
  "table_name": "booking_lead_shipping",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_lead_shipping`\n(\n  booking_lead_id INT64,\n  address STRING,\n  location_id INT64,\n  note STRING,\n  sort_mode STRING,\n  shipping_code STRING,\n  shipping_status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (booking_lead_id) NOT ENFORCED\n)\nCLUSTER BY booking_lead_id;"
}, {
  "table_name": "mission_package",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.mission_package`\n(\n  id INT64,\n  mission_id INT64,\n  package_id INT64,\n  point INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "adwords_meta_page",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.adwords_meta_page`\n(\n  id STRING,\n  name STRING,\n  category STRING,\n  access_token STRING,\n  created_at INT64,\n  updated_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_role_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_role_config`\n(\n  id INT64,\n  ai_topic_id INT64,\n  name STRING,\n  banner STRING,\n  situation STRING,\n  goal STRING,\n  scenario_create STRING,\n  scenario_suggest STRING,\n  scenario_grammar_check STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  waiting_text STRING,\n  visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "deactivate_telesales_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.deactivate_telesales_log`\n(\n  id INT64,\n  user_id INT64,\n  is_removed_from_timesheet INT64,\n  total_country INT64,\n  total_country_lead_updated INT64,\n  total_country_student_updated INT64,\n  output STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_student_priority_date",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_priority_date`\n(\n  id INT64,\n  student_id INT64,\n  program_id INT64,\n  day INT64,\n  schedule_id INT64,\n  fixed_teacher_id INT64,\n  only_map_current_teacher INT64,\n  fixed_teacher_country_id INT64,\n  class_priority_date_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_student_priority_date_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_priority_date_log`\n(\n  id INT64,\n  student_id INT64,\n  program_id INT64,\n  day INT64,\n  schedule_id INT64,\n  fixed_teacher_id INT64,\n  fixed_teacher_country_id INT64,\n  action STRING,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "user_premium_package",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.user_premium_package`\n(\n  id INT64,\n  user_id INT64,\n  user_children_id INT64,\n  app_type INT64,\n  combo_subscription_id INT64,\n  `from` INT64,\n  `to` INT64,\n  object_id INT64,\n  object_type INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  is_deleted INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_action_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_action_log`\n(\n  id INT64,\n  action STRING,\n  user_id INT64,\n  params STRING,\n  result STRING,\n  number_of_total INT64,\n  number_of_completed INT64,\n  number_of_failed INT64,\n  number_of_retry INT64,\n  last_record_id INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "placement_test_age_tag",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.placement_test_age_tag`\n(\n  id INT64,\n  name STRING,\n  description STRING,\n  country_apply STRING,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_teacher_payment_method",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_payment_method`\n(\n  id INT64,\n  teacher_id INT64,\n  payment_method INT64,\n  owner STRING,\n  bank_no STRING,\n  bank_name STRING,\n  bank_branch STRING,\n  bank_address STRING,\n  swift_code STRING,\n  iban_number STRING,\n  aba_routing_number STRING,\n  currency STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ai_tutor_pupular_topic",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_tutor_pupular_topic`\n(\n  id INT64,\n  mode INT64,\n  topic_id INT64,\n  count INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "wh_location_product",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.wh_location_product`\n(\n  location_id INT64,\n  product_id INT64,\n  amount NUMERIC(15, 2),\n  delay_shipping_day INT64,\n  estimate_next_import_date STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (product_id, location_id) NOT ENFORCED\n)\nCLUSTER BY product_id, location_id;"
}, {
  "table_name": "booking_teacher_contract_updating",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_contract_updating`\n(\n  id INT64,\n  teacher_id INT64,\n  type INT64,\n  terminal_date INT64,\n  terminal_reason INT64,\n  info_update STRING,\n  note STRING,\n  status INT64,\n  approved_by INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_teacher_lead_action",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_lead_action`\n(\n  id INT64,\n  teacher_lead_id INT64,\n  action INT64,\n  note STRING,\n  status_from INT64,\n  status_to INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "wh_log_product",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.wh_log_product`\n(\n  id INT64,\n  log_id INT64,\n  product_id INT64,\n  remain_quantity INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  quantity INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_session_map_experiment",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_session_map_experiment`\n(\n  id INT64,\n  action_id INT64,\n  booking_id INT64,\n  program_id INT64,\n  teacher_id INT64,\n  country_id INT64,\n  day INT64,\n  schedule_id INT64,\n  schedule_list STRING,\n  begin_at INT64,\n  end_at INT64,\n  teacher_type INT64,\n  teacher_country_id INT64,\n  teacher_map_type INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "partner_box_card",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.partner_box_card`\n(\n  id INT64,\n  code_po STRING,\n  payment_method INT64,\n  payment_method_note STRING,\n  partner_id INT64,\n  po_type INT64,\n  note STRING,\n  approved_status INT64,\n  payment_status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  process_type INT64,\n  total_price NUMERIC(13, 2),\n  partner_box_card_id INT64,\n  discount_amount NUMERIC(13, 2),\n  is_deleted INT64,\n  contract_url STRING,\n  approve_date INT64,\n  accounting_note STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "contest_student",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.contest_student`\n(\n  id INT64,\n  phone_number STRING,\n  student_name STRING,\n  access_code STRING,\n  contest_class_id INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  parent_name STRING,\n  avatar STRING,\n  student_id INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "offline_event_student",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.offline_event_student`\n(\n  id INT64,\n  event_id INT64,\n  active_code STRING,\n  student_name STRING,\n  phone_number STRING,\n  schedule_id INT64,\n  event_join_time INT64,\n  check_in_time INT64,\n  total_listening_speaking_score FLOAT64,\n  sale_in_charge_id INT64,\n  aca_in_charge_id INT64,\n  affiliate_id INT64,\n  utm_campaign STRING,\n  lead_id INT64,\n  tele_marketing_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  noti_status_id INT64,\n  send_noti_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  age_option INT64,\n  last_sic INT64,\n  is_done_review INT64,\n  status INT64,\n  scholarship_id INT64,\n  labels STRING,\n  due_date INT64,\n  age INT64,\n  speaking_test_at INT64,\n  request_speak_result INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_session_student",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_session_student`\n(\n  booking_session_id INT64,\n  student_id INT64,\n  country_id INT64,\n  currency_code STRING,\n  currency_exchange_rate FLOAT64,\n  student_payment_id INT64,\n  revenue NUMERIC(15, 2),\n  attendee_url STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  record_number INT64,\n  teacher_type INT64,\n  booking_order_teacher_type_id INT64,\n  is_compensatory INT64,\n  list_homework_label STRING,\n  list_homework_level STRING,\n  is_homework_completed INT64,\n  is_student_join_meeting INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (booking_session_id, student_id) NOT ENFORCED\n)\nCLUSTER BY booking_session_id, student_id;"
}, {
  "table_name": "course_question",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.course_question`\n(\n  id INT64,\n  course_id INT64,\n  user_id INT64,\n  content STRING,\n  question_id INT64,\n  is_approved INT64,\n  visible INT64,\n  is_on_behalf_of_teacher INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "promotion",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.promotion`\n(\n  id INT64,\n  name STRING,\n  start_time INT64,\n  end_time INT64,\n  is_apply_all_package INT64,\n  is_apply_discount_package INT64,\n  is_create_voucher_soon INT64,\n  number_of_voucher INT64,\n  prefix STRING,\n  discount_type INT64,\n  discount_value INT64,\n  fix_code STRING,\n  max_usage_number_per_user INT64,\n  max_usage_number INT64,\n  min_order_total_amount NUMERIC(13, 2),\n  max_discount_amount NUMERIC(13, 2),\n  is_on_campaign INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  affiliate_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_teacher_session",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_session`\n(\n  teacher_id INT64,\n  schedule_id INT64,\n  date INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  record_number INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n);"
}, {
  "table_name": "mission_user",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.mission_user`\n(\n  id INT64,\n  user_id INT64,\n  mission_package_id INT64,\n  is_calculated INT64,\n  time_calculated INT64,\n  object_id INT64,\n  point INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_teacher_available",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_available`\n(\n  id INT64,\n  program_id INT64,\n  date INT64,\n  number_booked INT64,\n  total INT64,\n  record_number INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "user_zalo",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.user_zalo`\n(\n  user_id INT64,\n  phone_number STRING,\n  oa_id STRING,\n  follower_id STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (user_id) NOT ENFORCED\n)\nCLUSTER BY user_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "affiliate_user_post_tracking_remind",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.affiliate_user_post_tracking_remind`\n(\n  id INT64,\n  affiliate_user_post_tracking_id INT64,\n  action INT64,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ai_avatar_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_avatar_config`\n(\n  id INT64,\n  avatar STRING,\n  display_name STRING,\n  sound STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  sound_name STRING,\n  model_3d STRING,\n  user_type_id INT64,\n  visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_teacher_session_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.booking_teacher_session_view`\nAS SELECT * except(date, created_at,updated_at),\r\n      timestamp_seconds(date) as `date`,\r\n      timestamp_seconds(created_at) as created_at,\r\n      timestamp_seconds(updated_at) as updated_at\r\nFROM `kynaforkids-server-production.kynaforkids.booking_teacher_session`;"
}, {
  "table_name": "user_level_start",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.user_level_start`\n(\n  id INT64,\n  user_id INT64,\n  package_id INT64,\n  level_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ceo_cfo_tasks_ops_students_relationship_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.ceo_cfo_tasks_ops_students_relationship_view`\nAS with task_control_data AS \r\n(\r\nselect \r\n  t1.id as task_id, \r\n  t1.subject,\r\n  t1.start_date,\r\n  case \r\n    when t1.status_id \u003d 1 then \u0027Mới tạo\u0027\r\n    when t1.status_id \u003d 2 then \u0027Đang xử lý\u0027\r\n    when t1.status_id \u003d 3 then \u0027Đã xử lý\u0027\r\n    when t1.status_id \u003d 4 then \u0027Trùng\u0027\r\n    else \u0027Từ chối\u0027\r\n  end as status,\r\n  t1.assigned_to_id,\r\n (select max(rr.name) from `kynaforkids-server-production.redmine_kyna_task_live.members` rm, `kynaforkids-server-production.redmine_kyna_task_live.member_roles` rmr,\r\n  `kynaforkids-server-production.redmine_kyna_task_live.roles` rr\r\n  where rm.user_id \u003d t1.assigned_to_id and rmr.member_id \u003d rm.id and rmr.role_id \u003d rr.id) as role_name, \r\n  (select lower(t2.value) from `kynaforkids-server-production.redmine_kyna_task_live.custom_values` t2 where custom_field_id \u003d 1 and t2.customized_id \u003d t1.id) as student_code_from_db,\r\nfrom `kynaforkids-server-production.redmine_kyna_task_live.issues` t1\r\n),\r\n\r\ntask_control_month AS \r\n(\r\nselect \r\n      format_datetime(\u0027%Y-%m\u0027, start_date) as month,\r\n      -- EXTRACT(MONTH FROM start_date) as month,\r\n      -- CASE\r\n      --       WHEN EXTRACT(MONTH FROM start_date) \u003d 4 THEN \u0027Apr 2024\u0027\r\n      --       WHEN EXTRACT(MONTH FROM start_date) \u003d 5 THEN \u0027May 2024\u0027\r\n      --       WHEN EXTRACT(MONTH FROM start_date) \u003d 6 THEN \u0027June 2024\u0027\r\n      --       WHEN EXTRACT(MONTH FROM start_date) \u003d 7 THEN \u0027July 2024\u0027\r\n      --       WHEN EXTRACT(MONTH FROM start_date) \u003d 8 THEN \u0027August 2024\u0027\r\n      --       WHEN EXTRACT(MONTH FROM start_date) \u003d 9 THEN \u0027Sep 2024\u0027\r\n      --       WHEN EXTRACT(MONTH FROM start_date) \u003d 10 THEN \u0027Oct 2024\u0027\r\n      --       WHEN EXTRACT(MONTH FROM start_date) \u003d 11 THEN \u0027Nov 2024\u0027\r\n      --       WHEN EXTRACT(MONTH FROM start_date) \u003d 12 THEN \u0027Dec 2024\u0027\r\n      --       WHEN EXTRACT(MONTH FROM start_date) \u003d 1 THEN \u0027Jan 2025\u0027\r\n      --       WHEN EXTRACT(MONTH FROM start_date) \u003d 2 THEN \u0027Feb 2025\u0027\r\n      --       WHEN EXTRACT(MONTH FROM start_date) \u003d 3 THEN \u0027Mar 2025\u0027\r\n      -- END AS month_name,\r\n      COUNT(distinct task_id) as num_tasks,\r\n      COUNT(distinct assigned_to_id) as num_ops_staffs,\r\n      COUNT(distinct student_code_from_db) as num_students_with_tasks,\r\nfrom task_control_data\r\nwhere role_name like \"%Ops%\" \r\ngroup by month\r\n-- having month \u003e 3\r\norder by month\r\n),\r\n\r\nstudent_info AS \r\n(select \r\n  t1.booking_id,\r\n  t1.booking_time,\r\n  t1.student_code,\r\n  t1.booking_status,\r\nfrom (\r\nSELECT \r\n  bs.id as booking_id,\r\n  bs.begin_at as booking_time,\r\n  (select booking_student.student_code from `kynaforkids-server-production.kynaforkids.booking_student` booking_student\r\n   where bs.id \u003d bss.booking_session_id and booking_student.user_id \u003d bss.student_id) as student_code,\r\n  `kynaforkids-server-production.kynaforkids.func_get_booking_status`(bs.status_id, bs.cancel_config_id) as booking_status,\r\nFROM `kynaforkids-server-production.kynaforkids.booking_session_view` bs\r\ninner join `kynaforkids-server-production.kynaforkids.booking_session_student` bss on bs.id \u003d bss.booking_session_id \r\nwhere bs.program_id in (select bp.id from `kynaforkids-server-production.kynaforkids.booking_program` bp where bp.id !\u003d 3 and type !\u003d 4)  \r\n) t1\r\nwhere date(t1.booking_time) \u003e\u003d \u00272024-10-01\u0027 and (t1.booking_time) \u003c\u003d \u00272025-12-31\u0027\r\nand t1.booking_status \u003d \u0027Completed\u0027 and t1.student_code like \"K%\"\r\n),\r\n\r\nactive_students_month AS (\r\nselect  \r\n        format_datetime(\u0027%Y-%m\u0027, booking_time) as month,\r\n      \r\n        -- EXTRACT(MONTH FROM booking_time) as month,\r\n        -- CASE\r\n        --     WHEN EXTRACT(MONTH FROM booking_time) \u003d 4 THEN \u0027Apr 2024\u0027\r\n        --     WHEN EXTRACT(MONTH FROM booking_time) \u003d 5 THEN \u0027May 2024\u0027\r\n        --     WHEN EXTRACT(MONTH FROM booking_time) \u003d 6 THEN \u0027Jun 2024\u0027\r\n        --     WHEN EXTRACT(MONTH FROM booking_time) \u003d 7 THEN \u0027Jul 2024\u0027\r\n        --     WHEN EXTRACT(MONTH FROM booking_time) \u003d 8 THEN \u0027Aug 2024\u0027\r\n        --     WHEN EXTRACT(MONTH FROM booking_time) \u003d 9 THEN \u0027Sep 2024\u0027\r\n        --     WHEN EXTRACT(MONTH FROM booking_time) \u003d 10 THEN \u0027Oct 2024\u0027\r\n        --     WHEN EXTRACT(MONTH FROM booking_time) \u003d 11 THEN \u0027Nov 2024\u0027\r\n        --     WHEN EXTRACT(MONTH FROM booking_time) \u003d 12 THEN \u0027Dec 2024\u0027\r\n        --     WHEN EXTRACT(MONTH FROM booking_time) \u003d 1 THEN \u0027Jan 2025\u0027\r\n        --     WHEN EXTRACT(MONTH FROM booking_time) \u003d 2 THEN \u0027Feb 2025\u0027\r\n        --     WHEN EXTRACT(MONTH FROM booking_time) \u003d 3 THEN \u0027Mar 2025\u0027\r\n\r\n        -- END AS month_name,\r\n        count(distinct student_code) as num_active_students,\r\nfrom student_info \r\ngroup by month\r\norder by month\r\n)\r\n\r\nselect tc.*, ast.num_active_students,\r\nfrom task_control_month tc\r\ninner join active_students_month ast using(month)\r\norder by month\r\n;"
}, {
  "table_name": "autocall_avoid_booking_session",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.autocall_avoid_booking_session`\n(\n  booking_session_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (booking_session_id) NOT ENFORCED\n)\nCLUSTER BY booking_session_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "affiliate_user",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.affiliate_user`\n(\n  user_id INT64,\n  affiliate_id INT64,\n  affiliate_category_id INT64,\n  commission_percent INT64,\n  status INT64,\n  affiliate_manager_id INT64,\n  is_affiliate_manager INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  total_commission_amount FLOAT64,\n  total_commission_estimate_amount FLOAT64,\n  country_id INT64,\n  bd_incharge_id INT64,\n  source_id INT64,\n  note STRING,\n  action_status INT64,\n  priority INT64,\n  affiliate_lead_id INT64,\n  email_contact STRING,\n  action_status_updated_at INT64,\n  contract_status INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  sale_in_charge_id INT64,\n  PRIMARY KEY (user_id) NOT ENFORCED\n)\nCLUSTER BY user_id;"
}, {
  "table_name": "aca_tuyendung_kho_cv_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.aca_tuyendung_kho_cv_view`\nAS SELECT \r\n        btl.id,\r\n        btl.name,\r\n        btl.email,\r\n        btl.phone_number,\r\n        `kynaforkids-server-production.kynaforkids.func_get_country_teacher`(btl.country_id) as country,\r\n        case when btl.subject \u003d 1 then \u0027Tiếng Anh\u0027\r\n             when btl.subject \u003d 2 then \u0027Toán\u0027\r\n        end as subject_name,\r\n\r\n        CASE \r\n                WHEN btl.recruit_source_id \u003d 1 THEN \u0027TopCV\u0027\r\n                WHEN btl.recruit_source_id \u003d 2 THEN \u0027Ybox\u0027\r\n                WHEN btl.recruit_source_id \u003d 3 THEN \u0027Glints\u0027\r\n                WHEN btl.recruit_source_id \u003d 4 THEN \u0027LinkedIn\u0027\r\n                WHEN btl.recruit_source_id \u003d 5 THEN \u0027Indeed\u0027\r\n                WHEN btl.recruit_source_id \u003d 6 THEN \u0027Website Kyna\u0027\r\n                WHEN btl.recruit_source_id \u003d 7 THEN \u0027Referral (Bạn giới thiệu)\u0027\r\n                WHEN btl.recruit_source_id \u003d 8 THEN \u0027Facebook\u0027\r\n                WHEN btl.recruit_source_id \u003d 9 THEN \u0027Việc làm giáo dục\u0027\r\n                WHEN btl.recruit_source_id \u003d 10 THEN \u0027Khác\u0027\r\n        END AS recruit_source,\r\n\r\n        case when btl.source \u003d 1 then \u0027Giáo viên\u0027\r\n             when btl.source \u003d 2 then \u0027Nội bộ\u0027\r\n        end as source_name,\r\n                \r\n        \r\n        case when btl.type \u003d 1 then \u0027Giáo viên\u0027\r\n             when btl.type \u003d 2 then \u0027Tester\u0027\r\n        end as type,\r\n\r\n        \r\n        CASE \r\n                WHEN btl.status \u003d 9 THEN \u0027Đã là giáo viên\u0027\r\n                WHEN btl.status \u003d 10 THEN \u0027Trùng\u0027\r\n                WHEN btl.status \u003d 1 THEN \u0027Tạo mới\u0027\r\n                WHEN btl.status \u003d 2 THEN \u0027Chưa liên hệ được\u0027\r\n                WHEN btl.status \u003d 3 THEN \u0027Đang liên hệ\u0027\r\n                WHEN btl.status \u003d 4 THEN \u0027Từ chối\u0027\r\n                WHEN btl.status \u003d 12 THEN \u0027Đã tạo Candidate\u0027\r\n                WHEN btl.status \u003d 5 THEN \u0027Đã book lịch phỏng vấn\u0027\r\n                WHEN btl.status \u003d 6 THEN \u0027Đang chờ duyệt\u0027\r\n                WHEN btl.status \u003d 11 THEN \u0027Offer sent\u0027\r\n                WHEN btl.status \u003d 7 THEN \u0027Accepted\u0027\r\n                WHEN btl.status \u003d 8 THEN \u0027Failed\u0027\r\n                ELSE \u0027Unknown\u0027\r\n        END AS candidate_status,\r\n\r\n        if(btl.status in (1,2,3,4,10) or btl.status \u003d 0 or btl.status is null or btl.status \u003e 12,0,1) as candidate_pass_status,\r\n\r\n        concat(\"https://dashboard.kynaforkids.vn/interview/booking-teacher-lead-action/history?id\u003d\",btl.id) as history,\r\n\r\n        `kynaforkids-server-production.kynaforkids.func_get_email_from_kynaforkids_user`(btl.created_by) as created_by,\r\n        date(btl.created_at) as created_date,\r\n        date(TIMESTAMP_SECONDS(btl.recall_date)) as recall_date, \r\n        `kynaforkids-server-production.kynaforkids.func_get_email_from_kynaforkids_user`(btl.created_by) as tc_in_charge,\r\n\r\n\r\n       \r\n\r\nFROM `kynaforkids-server-production.kynaforkids.booking_teacher_lead_view` btl;"
}, {
  "table_name": "affiliate_user_post_tracking_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.affiliate_user_post_tracking_view`\nAS SELECT\r\n  * EXCEPT(created_at, updated_at, register_at, remind_date),\r\n  TIMESTAMP_SECONDS(created_at) AS created_at,\r\n  TIMESTAMP_SECONDS(updated_at) AS updated_at,\r\n  TIMESTAMP_SECONDS(register_at) AS register_at,\r\n  TIMESTAMP_SECONDS(remind_date) AS remind_date\r\nFROM `kynaforkids-server-production.kynaforkids.affiliate_user_post_tracking`;"
}, {
  "table_name": "booking_teacher_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.booking_teacher_view`\nAS SELECT * except(contract_begin_at,contract_end_at,created_at,updated_at,expiration_date,issue_date,birthday),\r\n      timestamp_seconds(contract_begin_at) as contract_begin_at,\r\n      timestamp_seconds(contract_end_at) as contract_end_at,\r\n      timestamp_seconds(created_at) as created_at,\r\n      timestamp_seconds(updated_at) as updated_at,\r\n      timestamp_seconds(expiration_date) as expiration_date,\r\n      timestamp_seconds(issue_date) as issue_date,\r\n      timestamp_seconds(birthday) as birthday,\r\nFROM `kynaforkids-server-production.kynaforkids.booking_teacher`;"
}, {
  "table_name": "booking_class_student",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_class_student`\n(\n  booking_class_id INT64,\n  student_id INT64,\n  join_at INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  record_number INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (booking_class_id, student_id) NOT ENFORCED\n)\nCLUSTER BY booking_class_id, student_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "wh_location",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.wh_location`\n(\n  id INT64,\n  name STRING,\n  description STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "wh_unit",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.wh_unit`\n(\n  id INT64,\n  name STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "speech_session_answer",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.speech_session_answer`\n(\n  id INT64,\n  speech_session_id INT64,\n  speech_question_id INT64,\n  speech_question_answer_id INT64,\n  audio_url STRING,\n  score FLOAT64,\n  is_correct INT64,\n  ielts_score FLOAT64,\n  is_pass INT64,\n  summary STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "contest_campaign",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.contest_campaign`\n(\n  id INT64,\n  name STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  level_type INT64,\n  registration_end INT64,\n  registration_start INT64,\n  link_file_rule STRING,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "offline_event_student_status",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.offline_event_student_status`\n(\n  id INT64,\n  name STRING,\n  step INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_rival",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_rival`\n(\n  id INT64,\n  booking_id INT64,\n  schedule_id INT64,\n  begin_at INT64,\n  end_at INT64,\n  status INT64,\n  expired_at INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  first_action_at INT64,\n  accepted_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_send_out_of_lesson_program_history",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_send_out_of_lesson_program_history`\n(\n  id INT64,\n  user_id INT64,\n  program_id INT64,\n  booking_id INT64,\n  time_send INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "contest_student_quiz_info",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.contest_student_quiz_info`\n(\n  id INT64,\n  contest_student_id INT64,\n  contest_quiz_id INT64,\n  contest_round_id INT64,\n  quiz_session_id INT64,\n  is_winner INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  noti_status_id INT64,\n  send_noti_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "history",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.history`\n(\n  id INT64,\n  user_id INT64,\n  table STRING,\n  action STRING,\n  record_id STRING,\n  log STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "writing_session_info",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.writing_session_info`\n(\n  session_id INT64,\n  children_name STRING,\n  parent_name STRING,\n  phone_number STRING,\n  email STRING,\n  lang_code STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n);"
}, {
  "table_name": "gift_user_convert",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.gift_user_convert`\n(\n  id INT64,\n  user_id INT64,\n  gift_id INT64,\n  created_at INT64,\n  created_by INT64,\n  voucher_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_student_clone",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_clone`\n(\n  student_id INT64,\n  clone_from_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (student_id) NOT ENFORCED\n)\nCLUSTER BY student_id;"
}, {
  "table_name": "booking_order_certificate_commitment",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_order_certificate_commitment`\n(\n  id INT64,\n  order_id INT64,\n  certificate_commitment_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "remind",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.remind`\n(\n  id INT64,\n  order_id INT64,\n  from_order_id INT64,\n  student_code STRING,\n  parent_email STRING,\n  phone STRING,\n  name STRING,\n  amount INT64,\n  total_lesson INT64,\n  program_id INT64,\n  affiliate_id INT64,\n  source_id INT64,\n  user_type_id INT64,\n  payment_date INT64,\n  status INT64,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_replacement_bonus",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_replacement_bonus`\n(\n  booking_id INT64,\n  bonus NUMERIC(15, 2),\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (booking_id) NOT ENFORCED\n)\nCLUSTER BY booking_id;"
}, {
  "table_name": "course_country",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.course_country`\n(\n  course_id INT64,\n  country_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (course_id, country_id) NOT ENFORCED\n)\nCLUSTER BY course_id, country_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_picture_mode_question",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_picture_mode_question`\n(\n  id INT64,\n  ai_picture_mode_media_id INT64,\n  question STRING,\n  answer STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  translate_question STRING,\n  translate_answer STRING,\n  sugguest_answer STRING,\n  visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "sms_transaction",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.sms_transaction`\n(\n  id INT64,\n  type INT64,\n  ref_id INT64,\n  provider STRING,\n  phone_number STRING,\n  sms_content STRING,\n  response STRING,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "writing_session_ielts_score_note",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.writing_session_ielts_score_note`\n(\n  id INT64,\n  writing_session_ielts_score_id INT64,\n  sub_criteria_id INT64,\n  description STRING,\n  teacher_note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "level",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.level`\n(\n  id INT64,\n  name STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "bot_page_route",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.bot_page_route`\n(\n  id INT64,\n  page_id INT64,\n  name STRING,\n  type INT64,\n  intent_id INT64,\n  condition STRING,\n  fulfillment_type INT64,\n  transition STRING,\n  is_default INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "promotion_schedule",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.promotion_schedule`\n(\n  id INT64,\n  package_id INT64,\n  subscription_month INT64,\n  price FLOAT64,\n  discount_price FLOAT64,\n  discount_percent FLOAT64,\n  begin_at INT64,\n  end_at INT64,\n  note STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_student_summary",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_summary`\n(\n  id INT64,\n  student_id INT64,\n  program_id INT64,\n  revenue_total NUMERIC(15, 2),\n  revenue_used NUMERIC(15, 2),\n  revenue_remain NUMERIC(15, 2),\n  lesson_total INT64,\n  lesson_used INT64,\n  lesson_remain INT64,\n  due_date INT64,\n  type INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  has_order_unmap INT64,\n  order_revenue NUMERIC(15, 2),\n  order_lesson INT64,\n  program_revenue NUMERIC(15, 2),\n  program_lesson INT64,\n  order_revenue_unmap NUMERIC(15, 2),\n  revenue_per_lesson NUMERIC(15, 2),\n  revenue_remain_per_lesson NUMERIC(15, 2),\n  revenue_diff NUMERIC(15, 2),\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "interview_bbb_access_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.interview_bbb_access_log`\n(\n  id INT64,\n  interview_id INT64,\n  internal_id STRING,\n  user_id INT64,\n  user_name STRING,\n  user_type STRING,\n  access_time INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "speech_session",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.speech_session`\n(\n  id INT64,\n  user_id INT64,\n  speech_id INT64,\n  percent_can_pass FLOAT64,\n  score FLOAT64,\n  ielts_score FLOAT64,\n  status INT64,\n  is_pass INT64,\n  start_time INT64,\n  end_time INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  is_booking_practice INT64,\n  retry_date INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ticket_issue_position",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ticket_issue_position`\n(\n  id INT64,\n  issue_id INT64,\n  position_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_study_mode_grammar",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_study_mode_grammar`\n(\n  id INT64,\n  content STRING,\n  translate STRING,\n  banner STRING,\n  ai_study_mode_lesson_id INT64,\n  ai_study_mode_activity_type_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  grammar STRING,\n  `using` STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ticket_issue",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ticket_issue`\n(\n  id INT64,\n  name STRING,\n  description STRING,\n  category_id INT64,\n  team_in_charge INT64,\n  type INT64,\n  deadline INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  `order` INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_country",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_country`\n(\n  id INT64,\n  name STRING,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  `order` INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ceo_cac_affiliate_referral_cost_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.ceo_cac_affiliate_referral_cost_view`\nAS with \r\naffiliate_vn_finalized_cost as\r\n(\r\nSELECT \r\nthang as year_month\r\n-- , SUM(total_order) as total_order\r\n-- , SUM(tong_don_ghi_danh_lan_dau) as tong_don_ghi_danh_lan_dau\r\n-- , SUM(hoa_hong_lan_dau) as hoa_hong_lan_dau\r\n-- , SUM(hoa_hong_lan_dau_bonus) as affiliate_cost --hoa_hong_lan_dau_bonus\r\n-- , SUM(tong_tien_lan_dau_grai) as tong_tien_lan_dau_grai\r\n-- , round(SUM(tong_tien_lan_dau)) as tong_tien_lan_dau\r\n, SUM(tong_hoa_hong_cuoi) + SUM(hoa_hong_video) as tong_hoa_hong_cuoi\r\n, SUM(thuong_thang) as thuong_thang\r\n, SUM(dieu_chinh_khac) as dieu_chinh_khac\r\n\r\n-- phần điều chỉnh cho giống số của Kế toán\r\n, round(SUM(tong_hoa_hong_cuoi) + SUM(hoa_hong_video) + SUM(thuong_thang) +  SUM(dieu_chinh_khac)) as affiliate_cost\r\n\r\nFROM\r\n(\r\nSELECT * FROM\r\n(\r\nSELECT \r\nba.*\r\n-- tutoring\r\n, bt.tong_tien_lan_dau_tutoring\r\n, (bt.tong_tien_ghi_danh_lai_tutoring + bt.tra_gop_lan_sau_tutoring + bt.tong_tien_hoc_thu_tutoring) as tong_tien_ghi_danh_lai_tutoring\r\n, bt.tong_thu_nhap_tutoring\r\n, bt.tong_don_tutoring\r\n-- ai group talk\r\n, bg.tong_tien_lan_dau_grai\r\n, (bg.tong_tien_ghi_danh_lai_grai + bg.tra_gop_lan_sau_grai + bg.tong_tien_hoc_thu_grai) as tong_tien_ghi_danh_lai_grai\r\n, bg.tong_thu_nhap_grai\r\n, bg.tong_don_grai\r\n-- Tổng tutoring và group talk\r\n, ( if(bt.tong_tien_lan_dau_tutoring is not null,bt.tong_tien_lan_dau_tutoring, 0) + if(bg.tong_tien_lan_dau_grai is not null,bg.tong_tien_lan_dau_grai, 0 )) as tong_tien_lan_dau\r\n, (if(bt.tong_tien_ghi_danh_lai_tutoring is not null,bt.tong_tien_ghi_danh_lai_tutoring, 0)  + if( bt.tra_gop_lan_sau_tutoring is not null, bt.tra_gop_lan_sau_tutoring, 0) + if(bt.tong_tien_hoc_thu_tutoring is not null, bt.tong_tien_hoc_thu_tutoring, 0)) \r\n+ (if(bg.tong_tien_ghi_danh_lai_grai is not null, bg.tong_tien_ghi_danh_lai_grai, 0) + if(bg.tra_gop_lan_sau_grai is not null, bg.tra_gop_lan_sau_grai, 0) + if(bg.tong_tien_hoc_thu_grai is not null, bg.tong_tien_hoc_thu_grai, 0)) as tong_tien_ghi_danh_lai\r\n, (if(bt.tong_thu_nhap_tutoring is not null, bt.tong_thu_nhap_tutoring, 0) + if(bg.tong_thu_nhap_grai is not null, bg.tong_thu_nhap_grai, 0)) as tong_thu_nhap\r\n, 0 as doanh_thu_video\r\n, 0 as hoa_hong_video\r\nFROM `kynaforkids-server-production.kynaforkids.booking_commission_income_affiliate` ba\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_commission_affiliate_tutoring` bt on ba.thang \u003d bt.ngay_thu_nhap_tutoring and ba.affiliate_id \u003d bt.affiliate_id\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_commission_affiliate_grai` bg on ba.thang \u003d bg.ngay_thu_nhap_grai and ba.affiliate_id \u003d bg.affiliate_id\r\n) t1 \r\nUNION ALL \r\nSELECT * FROM `kynaforkids-server-production.kynaforkids.commission_income_affiliate_video`\r\n) t2\r\n-- WHERE t2.affiliate_id \u003d 542135\r\n-- and t2.thang \u003d \u00272024-10\u0027 \r\nGROUP BY t2.thang\r\norder by year_month desc\r\n),\r\n\r\naff_lao_cost_detail as \r\n(\r\nSELECT \r\n  \r\n\t--   (select max(u.email) from `kynaforkids-server-production.kynaforkids.user` u, `kynaforkids-server-production.kynaforkids.affiliate_user` au where au.user_id \u003d u.id and au.affiliate_id \u003d cast(bc.affiliate_id as INT64)) as affiliate_email,\r\n\tcoalesce(bo.accounting_date, bo.created_at) as ngay_hach_toan,\r\n   \r\n(select u.email from `kynaforkids-server-production.kynaforkids.user` u where u.id \u003d bo.created_by) as sale_incharge,\r\n((bo.total - if(bo.discount_money IS NULL, 0, bo.discount_money) + if(bo.total_video_course IS NULL, 0, bo.total_video_course)) * bo.currency_exchange_rate) AS total_vnd,\r\n  FROM `kynaforkids-server-production.kynaforkids.booking_commission` bc \r\n  left join `kynaforkids-server-production.kynaforkids.booking_order_view` bo on bo.id \u003d bc.order_id\r\n  WHERE cast(bc.affiliate_id as INT64) in (1235265, 1233043) and bc.order_id is not null\r\n        and bo.payment_content in (2)\r\n        and bc.status in (3)\r\n        and bo.status in (4)\r\n),\r\n\r\naff_lao_cost as\r\n(\r\nselect \r\n      format_datetime(\"%Y-%m\", afl.ngay_hach_toan) as year_month,\r\n      coalesce(sum(\r\n          case when afl.sale_incharge \u003d \u0027luan.nt@kynaforkids.vn\u0027 then round(0.45*(afl.total_vnd))\r\n               else round(0.33*(afl.total_vnd))\r\n          end\r\n      ),0) as aff_lao_commission\r\n\r\n\r\nfrom aff_lao_cost_detail afl\r\nwhere format_datetime(\"%Y-%m\", afl.ngay_hach_toan) \u003e\u003d \u00272024-01\u0027\r\ngroup by year_month\r\n),\r\n\r\naff_viet_current_month_detail as\r\n(\r\nSELECT bc.id,\r\n\r\n    -- bc.affiliate_id as affiliate_id, \r\n    -- bo.accounting_date as ngay_hach_toan,\r\n    -- bc.affiliate_commission_percent as phan_tram_hoa_hong, \r\n    bc.affiliate_commission_amount as affiliate_commission_amount,\r\n--     bo.total_video_course as total_video,\r\n--     bc.test_online_bonus,\r\n--   \tbc.country_id,\r\n--     bc.affiliate_commission_percent_bonus,\r\n--     bc.affiliate_commission_amount_bonus,\r\n-- bc.total_amount* bc.currency_exchange_rate as total_new\r\n-- , if(bo.program_type \u003d 2, \u0027AI kèm Group talk\u0027, \u0027Đơn 1-1\u0027) as program_type\r\n  FROM `kynaforkids-server-production.kynaforkids.booking_commission` bc \r\n  left join `kynaforkids-server-production.kynaforkids.booking_order_view` bo on bo.id \u003d bc.order_id\r\n  WHERE cast(bc.affiliate_id as INT64) \u003e 0 and bc.status \u003d 3 and bo.order_type !\u003d 5 \r\n  and FORMAT_DATE(\u0027%Y-%m\u0027,bo.accounting_date) \u003d FORMAT_DATE(\u0027%Y-%m\u0027, current_date())\r\n  and bc.country_id \u003d 3\r\n  and (select ac.name from `kynaforkids-server-production.kynaforkids.affiliate_category` ac, `kynaforkids-server-production.kynaforkids.affiliate_user` au  where cast(bc.affiliate_id as INT64) \u003d au.affiliate_id and au.affiliate_category_id \u003d ac.id) in (\u0027Customer referral\u0027, \u0027Distribution Partner\u0027)\r\n),\r\n\r\naff_viet_previous_month_detail as\r\n(\r\n  SELECT \r\n    bc.id,\r\n    bc.affiliate_commission_amount as affiliate_commission_amount_previous\r\n  FROM `kynaforkids-server-production.kynaforkids.booking_commission` bc \r\n  LEFT JOIN `kynaforkids-server-production.kynaforkids.booking_order_view` bo ON bo.id \u003d bc.order_id\r\n  WHERE CAST(bc.affiliate_id AS INT64) \u003e 0 \r\n    AND bc.status \u003d 3 \r\n    AND bo.order_type !\u003d 5 \r\n    -- PHẦN SỬA ĐỔI CHÍNH Ở ĐÂY:\r\n    AND FORMAT_DATE(\u0027%Y-%m\u0027, bo.accounting_date) \u003d FORMAT_DATE(\u0027%Y-%m\u0027, DATE_SUB(CURRENT_DATE(), INTERVAL 1 MONTH))\r\n    -- HẾT PHẦN SỬA ĐỔI\r\n    AND bc.country_id \u003d 3\r\n    AND (\r\n      SELECT ac.name \r\n      FROM `kynaforkids-server-production.kynaforkids.affiliate_category` ac, \r\n           `kynaforkids-server-production.kynaforkids.affiliate_user` au  \r\n      WHERE CAST(bc.affiliate_id AS INT64) \u003d au.affiliate_id \r\n        AND au.affiliate_category_id \u003d ac.id\r\n    ) IN (\u0027Customer referral\u0027, \u0027Distribution Partner\u0027)\r\n),\r\n\r\naff_vn_current_month as\r\n(\r\nselect \r\n      SUM(affiliate_commission_amount) as aff_vn_cost_current_month\r\nfrom aff_viet_current_month_detail\r\n),\r\n\r\naff_vn_previous_month as\r\n(\r\nselect \r\n      SUM(affiliate_commission_amount_previous) as aff_vn_cost_previous_month\r\nfrom aff_viet_previous_month_detail\r\n),\r\n\r\naffiliate_cost as \r\n(\r\nselect \r\n      ym.year_month,\r\n      afc.* except(year_month, affiliate_cost),\r\n      case when ym.year_month \u003c FORMAT_DATE(\u0027%Y-%m\u0027, date_sub(current_date(),interval 8 day)) then coalesce(afc.affiliate_cost,0) + coalesce(alc.aff_lao_commission,0) \r\n           when ym.year_month \u003c FORMAT_DATE(\u0027%Y-%m\u0027, current_date()) and ym.year_month \u003d FORMAT_DATE(\u0027%Y-%m\u0027, date_sub(current_date(),interval 8 day)) then (select coalesce(aff_vn_cost_previous_month,0) from aff_vn_previous_month) + coalesce(alc.aff_lao_commission,0)\r\n           when ym.year_month \u003d FORMAT_DATE(\u0027%Y-%m\u0027, current_date()) then (select coalesce(aff_vn_cost_current_month,0) from aff_vn_current_month) + coalesce(alc.aff_lao_commission,0)\r\n      end as affiliate_cost,\r\nfrom affiliate_vn_finalized_cost afc\r\nleft join aff_lao_cost alc using(year_month)\r\nfull join `kynaforkids.cac_year_month_table` ym using(year_month)\r\nwhere ym.year_month \u003c\u003d FORMAT_DATE(\u0027%Y-%m\u0027, current_date())\r\norder by year_month desc\r\n)\r\n\r\nselect \r\n       ac.year_month,\r\n       ac.affiliate_cost\r\nfrom affiliate_cost ac\r\norder by year_month desc\r\n\r\n-- affiliate_cost_temp as \r\n-- (\r\n-- select \r\n--       ym.year_month,\r\n--       afc.* except(year_month, affiliate_cost),\r\n--       afc.affiliate_cost + alc.aff_lao_commission as affiliate_cost,\r\n--       if(afc.affiliate_cost is not null and ym.year_month \u003c FORMAT_DATE(\u0027%Y-%m\u0027, current_date()), 1, 0) as is_cost_finalized,      \r\n\r\n-- from affiliate_vn_all_cost afc\r\n-- left join aff_lao_cost alc using(year_month)\r\n-- full join `kynaforkids.cac_year_month_table` ym using(year_month)\r\n-- where ym.year_month \u003c\u003d FORMAT_DATE(\u0027%Y-%m\u0027, current_date())\r\n-- ),\r\n\r\n-- AffCostData AS (\r\n--     SELECT\r\n--         *,\r\n--         ROW_NUMBER() OVER (ORDER BY year_month DESC) AS RowNum\r\n--     FROM\r\n--         affiliate_cost_temp\r\n--     WHERE affiliate_cost_temp.is_cost_finalized \u003d 1\r\n-- ),\r\n\r\n-- MostRecentKnownCost AS (\r\n--     SELECT\r\n--         affiliate_cost\r\n--     FROM\r\n--         AffCostData\r\n--     WHERE\r\n--         RowNum \u003d 1 AND is_cost_finalized \u003d 1\r\n-- ),\r\n\r\n-- ProjectedCost AS (\r\n--     SELECT\r\n--         *,\r\n--         CASE\r\n--             WHEN is_cost_finalized \u003d 1 THEN affiliate_cost\r\n--             WHEN is_cost_finalized \u003d 0 THEN ROUND((SELECT max(affiliate_cost) FROM MostRecentKnownCost) * \r\n--                  IF(year_month \u003c  FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE()),1,(EXTRACT(DAY FROM CURRENT_DATE()) / EXTRACT(DAY FROM LAST_DAY(CURRENT_DATE())))))\r\n--         END AS affiliate_cost_projected\r\n--     FROM\r\n--         affiliate_cost_temp\r\n-- )\r\n\r\n-- select pc.year_month,\r\n--        pc.affiliate_cost_projected as affiliate_cost\r\n-- from ProjectedCost pc\r\n-- order by year_month desc\r\n\r\n-- select * from ProjectedCost;"
}, {
  "table_name": "booking_lead_action",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_lead_action`\n(\n  id INT64,\n  lead_id INT64,\n  action INT64,\n  status_from INT64,\n  status_to INT64,\n  quiz_score FLOAT64,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  status_thai_lead INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "app_notification",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.app_notification`\n(\n  id INT64,\n  app_id STRING,\n  title STRING,\n  description STRING,\n  description_detail STRING,\n  topics STRING,\n  visible INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "order_today",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.order_today`\n(\n  id INT64,\n  order_id INT64,\n  user_id INT64,\n  status INT64,\n  recall_date INT64,\n  invoice_code STRING,\n  promotion_code STRING,\n  gift_id INT64,\n  is_activated INT64,\n  items STRING,\n  student_name STRING,\n  student_email STRING,\n  student_phone STRING,\n  register_name STRING,\n  register_email STRING,\n  register_phone STRING,\n  register_child_name STRING,\n  shipping_name STRING,\n  shipping_code STRING,\n  shipping_email STRING,\n  shipping_phone STRING,\n  shipping_address STRING,\n  shipping_location STRING,\n  payment_name STRING,\n  landing_page_slug STRING,\n  landing_page_name STRING,\n  utm_campaign STRING,\n  payment_method_id INT64,\n  send_to_shipping_status INT64,\n  regulate_shipping INT64,\n  regulate_shipping_status INT64,\n  payment_method_status INT64,\n  payment_active INT64,\n  telesale_id INT64,\n  register_ref STRING,\n  affiliate_id INT64,\n  register_source STRING,\n  contact_status INT64,\n  reason_cancel_shipping_id INT64,\n  reason_cancel_id INT64,\n  total STRING,\n  sale_created_at INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  country_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_student_test_info",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_test_info`\n(\n  id INT64,\n  lead_id INT64,\n  student_id INT64,\n  start_level_id INT64,\n  program_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "support_import",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.support_import`\n(\n  id INT64,\n  name STRING,\n  link STRING,\n  log STRING,\n  type INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "dictionary_language",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.dictionary_language`\n(\n  id INT64,\n  name STRING,\n  prefix_language STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "summer_camp_student_share_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.summer_camp_student_share_log`\n(\n  id INT64,\n  camp_id INT64,\n  student_id INT64,\n  summer_camp_stage_id INT64,\n  template_id INT64,\n  shared_link STRING,\n  shared_image STRING,\n  status INT64,\n  point INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  gift_type INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "kynavn_user",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.kynaforkids.kynavn_user`\nOPTIONS(\n  format\u003d\"CSV\",\n  uris\u003d[\"https://drive.google.com/open?id\u003d1cFMaVadDMRSo9L2ALcvH-w1jMpbku-GY\"]\n);"
}, {
  "table_name": "voucher",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.voucher`\n(\n  id INT64,\n  code STRING,\n  usage_time INT64,\n  promotion_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  user_id INT64,\n  visible INT64,\n  partner_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_country_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_country_config`\n(\n  id INT64,\n  country_id INT64,\n  min_class_number_loyalty INT64,\n  loyalty_bonus NUMERIC(15, 2),\n  max_class_number_cancel INT64,\n  percent_class_number_cancel INT64,\n  fee_cancel_penalty NUMERIC(15, 2),\n  tax INT64,\n  min_income_tax INT64,\n  currency STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_order_company",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_order_company`\n(\n  order_id INT64,\n  company_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  is_use_b2b_system INT64,\n  PRIMARY KEY (order_id) NOT ENFORCED\n)\nCLUSTER BY order_id;"
}, {
  "table_name": "ai_tutor_access_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_tutor_access_log`\n(\n  user_id INT64,\n  last_access INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  amount_access INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (user_id) NOT ENFORCED\n)\nCLUSTER BY user_id;"
}, {
  "table_name": "booking_commission_affiliate_tutoring",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.booking_commission_affiliate_tutoring`\nAS -- Doanh thu với đơn tutoring\r\nSELECT \r\n\tt1.ngay_thu_nhap_tutoring\r\n\t,t1. affiliate_id\r\n\t,SUM(CASE WHEN t1.payment_content \u003d 2 THEN (t1.thuc_nhan_hoc_phi + t1.total_video) ELSE 0 END) as tong_tien_lan_dau_tutoring\r\n\t,SUM(CASE WHEN t1.payment_content \u003d 3 THEN ((t1.thuc_nhan_hoc_phi + t1.total_video)) ELSE 0 END) as tra_gop_lan_sau_tutoring\r\n\t,SUM(CASE WHEN t1.payment_content \u003d 4 THEN ((t1.thuc_nhan_hoc_phi + t1.total_video)) ELSE 0 END) as tong_tien_ghi_danh_lai_tutoring\r\n\t,SUM(CASE WHEN t1.payment_content \u003d 1 THEN ((t1.thuc_nhan_hoc_phi + t1.total_video)) ELSE 0 END) as tong_tien_hoc_thu_tutoring\r\n\t,SUM(t1.thuc_nhan_hoc_phi + t1.total_video) as tong_thu_nhap_tutoring\r\n  , COUNT(t1.order_id) as tong_don_tutoring\r\nFROM\r\n(\r\n\tSELECT \r\n\t\tFORMAT_DATETIME(\u0027%Y-%m\u0027, bo.accounting_date) AS ngay_thu_nhap_tutoring\r\n\t\t, bc.affiliate_id\r\n\t\t, ( \r\n\t\tCASE\r\n\t\tWHEN bo.order_type \u003d 2 THEN bo.revenue_calculate_commission * bo.currency_exchange_rate\r\n\t\tELSE bo.total * bo.currency_exchange_rate\r\n\t\tEND\r\n\t\t) AS thuc_nhan_hoc_phi\r\n\t\t, bo.total_video_course * bo.currency_exchange_rate as total_video\r\n\t\t, bo.payment_content\r\n    , bo.id as order_id\r\n\tFROM `kynaforkids-server-production.kynaforkids.booking_commission` bc \r\n\tLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_order_view` bo ON bc.order_id \u003d bo.id\r\n\tWHERE bc.status \u003d 3\r\n\tAND bo.program_type \u003d 1\r\n  -- AND bc.affiliate_id\u003d 541190 \r\n  -- AND (date(bo.accounting_date) \u003e\u003d \u00272024-11-01\u0027 and date(bo.accounting_date) \u003c\u003d \u00272024-11-30\u0027)\r\n\t) t1\r\n\tGROUP BY t1.ngay_thu_nhap_tutoring, t1.affiliate_id;"
}, {
  "table_name": "booking_teacher_session_info",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_session_info`\n(\n  teacher_id INT64,\n  date INT64,\n  none_booking INT64,\n  has_booking_and_student INT64,\n  has_booking_and_student_priority INT64,\n  student_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n);"
}, {
  "table_name": "order_detail",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.order_detail`\n(\n  order_id INT64,\n  package_id INT64,\n  unit_price NUMERIC(13, 2),\n  discount_amount NUMERIC(13, 2),\n  voucher_discount_amount NUMERIC(13, 2),\n  quantity INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  package_subscription_id INT64,\n  expired_time INT64,\n  payment_fee NUMERIC(13, 2),\n  total NUMERIC(13, 2),\n  package_combo_id INT64,\n  partner_code STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  _dev_id STRING,\n  PRIMARY KEY (package_id, order_id) NOT ENFORCED\n)\nCLUSTER BY package_id, order_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "voucher_usage",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.voucher_usage`\n(\n  id INT64,\n  voucher_id INT64,\n  order_id INT64,\n  user_id INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_lesson",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_lesson`\n(\n  id INT64,\n  code STRING,\n  section_id INT64,\n  name STRING,\n  type INT64,\n  `order` INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  youtube_link STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  total_booking_completed INT64,\n  can_swap INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_timeline_action",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_timeline_action`\n(\n  id INT64,\n  name STRING,\n  content STRING,\n  type INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "writing_criteria_type",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.writing_criteria_type`\n(\n  id INT64,\n  type INT64,\n  grading_type INT64,\n  main_criteria_id INT64,\n  sub_criteria_id INT64,\n  name STRING,\n  description STRING,\n  point INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_action",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_action`\n(\n  name STRING,\n  description STRING,\n  action STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (name) NOT ENFORCED\n)\nCLUSTER BY name\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_teacher",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher`\n(\n  user_id INT64,\n  slug STRING,\n  country_id INT64,\n  ops_teacher_id INT64,\n  country_group_id INT64,\n  region_id INT64,\n  salary FLOAT64,\n  time_zone STRING,\n  bonus NUMERIC(15, 2),\n  contract_begin_at INT64,\n  contract_end_at INT64,\n  bio STRING,\n  status INT64,\n  interview_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  is_auto_repeat_calendar INT64,\n  ranking INT64,\n  birthday INT64,\n  education_background STRING,\n  teaching_experience STRING,\n  other_working_experience STRING,\n  title STRING,\n  contract_no STRING,\n  contract_status INT64,\n  contract_no_bk STRING,\n  id_card STRING,\n  card_holder_name STRING,\n  payment_method INT64,\n  card_type INT64,\n  expiration_date INT64,\n  place_of_issue_en STRING,\n  place_of_issue_vi STRING,\n  address STRING,\n  phone_number STRING,\n  email_offer_picture STRING,\n  teacher_confirmation_pic STRING,\n  pp_picture_front STRING,\n  pp_picture_back STRING,\n  bank_no STRING,\n  bank_name STRING,\n  bank_branch STRING,\n  bank_address STRING,\n  bank_picture STRING,\n  additional_contact STRING,\n  teacher_source INT64,\n  tags STRING,\n  is_tester INT64,\n  is_not_map_new_student INT64,\n  only_test_weekend INT64,\n  enable_mapping INT64,\n  swift_code STRING,\n  apply_appendix_date INT64,\n  promise_month INT64,\n  view_contract_url STRING,\n  is_submitted_form INT64,\n  is_sent_sign INT64,\n  is_show_profile INT64,\n  qualification_photos STRING,\n  contract_note STRING,\n  iban_number STRING,\n  major INT64,\n  certification INT64,\n  certification_other STRING,\n  ielts_score FLOAT64,\n  level_of_education INT64,\n  undergraduate_year INT64,\n  total_completed_booking INT64,\n  only_automap_priority_student INT64,\n  contract_send_status INT64,\n  contract_sign_status INT64,\n  training_status INT64,\n  deactivate_date INT64,\n  is_accept_base_rate INT64,\n  accept_base_rate_at INT64,\n  ignore_full_face_camera INT64,\n  tax_code STRING,\n  issue_date INT64,\n  reactivate_date INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  difficulty_level STRING,\n  is_teacher_summer_camp INT64,\n  is_accepted_economy INT64,\n  PRIMARY KEY (user_id) NOT ENFORCED\n)\nCLUSTER BY user_id;"
}, {
  "table_name": "contest_student_round",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.contest_student_round`\n(\n  id INT64,\n  contest_student_id INT64,\n  contest_round_id INT64,\n  contest_campaign_id INT64,\n  is_winner INT64,\n  noti_status_id INT64,\n  send_noti_at INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "adwords_meta_line",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.adwords_meta_line`\n(\n  id INT64,\n  name STRING,\n  user_id INT64,\n  visible INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "interview_sample_record",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.interview_sample_record`\n(\n  id INT64,\n  interview_id INT64,\n  record_url STRING,\n  is_hide_face INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "quiz",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.quiz`\n(\n  id INT64,\n  name STRING,\n  slug STRING,\n  type INT64,\n  description STRING,\n  image_url STRING,\n  max_retry_count INT64,\n  package_id INT64,\n  course_id INT64,\n  package_level_id INT64,\n  pre_course STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  pre_quiz STRING,\n  percent_can_pass FLOAT64,\n  category_id INT64,\n  access_code STRING,\n  is_send_mail_only INT64,\n  info_form_position INT64,\n  info_field_config STRING,\n  level_config STRING,\n  `order` INT64,\n  dictionary_keyword_tag STRING,\n  quiz_type INT64,\n  writing_id INT64,\n  quiz_stage INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  quiz_content_type INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "user_package",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.user_package`\n(\n  id INT64,\n  user_id INT64,\n  package_id INT64,\n  is_active INT64,\n  user_children_id INT64,\n  started_date INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  order_id STRING,\n  `from` INT64,\n  `to` INT64,\n  booking_from INT64,\n  booking_to INT64,\n  current_course_id INT64,\n  transaction_id STRING,\n  ios_receipt_data STRING,\n  android_purchase_token STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_teacher_offer_template_item",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_offer_template_item`\n(\n  id INT64,\n  template_id INT64,\n  subject_id INT64,\n  teacher_nationality_id INT64,\n  program_id INT64,\n  salary FLOAT64,\n  currency STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_program_user_type",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_program_user_type`\n(\n  id INT64,\n  program_id INT64,\n  user_type_id STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_lead_education_department",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_lead_education_department`\n(\n  booking_lead_id INT64,\n  education_department_id INT64,\n  education_department_school_id INT64,\n  education_department_class_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (booking_lead_id) NOT ENFORCED\n)\nCLUSTER BY booking_lead_id;"
}, {
  "table_name": "qc_tester",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.qc_tester`\n(\n  id INT64,\n  teacher_id INT64,\n  amount_qualified_booking INT64,\n  rating_tmp INT64,\n  final_rating INT64,\n  note STRING,\n  apply_at INT64,\n  apply_log STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "scheduler",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.scheduler`\n(\n  id INT64,\n  type INT64,\n  record_id INT64,\n  time INT64,\n  status INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "affiliate_source",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.affiliate_source`\n(\n  old_affiliate_id INT64,\n  new_affiliate_id INT64,\n  utm_campaign STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n);"
}, {
  "table_name": "track_lead_doanh_thu",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.track_lead_doanh_thu`\nAS select t1.lead_id, sum(price_vnd) as price_vnd from \r\n((\r\nselect \r\n    bo.lead_id,\r\n  sum((bo.total * bo.currency_exchange_rate) - (if(bo.discount_money is null, 0, bo.discount_money) * currency_exchange_rate) + \r\n      (if(bo.total_video_course is null, 0, bo.total_video_course) * bo.currency_exchange_rate))  as price_vnd\r\nfrom `kynaforkids-server-production.kynaforkids.booking_order` bo \r\nwhere bo.payment_status \u003d 1 \r\ngroup by bo.lead_id\r\n)\r\nunion all\r\n(\r\nselect ori.lead_id, sum(o.total * o.currency_exchange_rate) as price_vnd from `kynaforkids-server-production.kynaforkids.order` o\r\nleft join `kynaforkids-server-production.kynaforkids.order_register_info` ori on o.id \u003d ori.order_id\r\nwhere o.status \u003d 3\r\ngroup by ori.lead_id\r\n) ) t1\r\n-- where t1.lead_id \u003d 1963902\r\ngroup by t1.lead_id;"
}, {
  "table_name": "adwords_utm_campaign",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.adwords_utm_campaign`\n(\n  id INT64,\n  name STRING,\n  channel_id INT64,\n  country_id INT64,\n  product_id INT64,\n  user_id INT64,\n  line_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "gso_district",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.gso_district`\n(\n  id INT64,\n  gso_id STRING,\n  name STRING,\n  en_name STRING,\n  level STRING,\n  province_id STRING,\n  province_name STRING,\n  updated INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "dtp_student",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.dtp_student`\n(\n  user_id INT64,\n  phone STRING,\n  name STRING,\n  email STRING,\n  school_name STRING,\n  class_name STRING,\n  dtp_package_id INT64,\n  dtp_grade_id INT64,\n  learning_type INT64,\n  start_at INT64,\n  expired_at INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  series_id STRING,\n  school_id INT64,\n  branch_id INT64,\n  class_id INT64,\n  role_code STRING,\n  PRIMARY KEY (user_id) NOT ENFORCED\n)\nCLUSTER BY user_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "group_talk_notification",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.group_talk_notification`\n(\n  id INT64,\n  type STRING,\n  name STRING,\n  content STRING,\n  chat_database_path STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_teacher_warning_action_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_warning_action_log`\n(\n  id INT64,\n  warning_id INT64,\n  log STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_order_credit_gts",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_order_credit_gts`\n(\n  id INT64,\n  order_id INT64,\n  type INT64,\n  program_id INT64,\n  total_lesson INT64,\n  duration INT64,\n  teacher_type INT64,\n  student_payment_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "rating_template_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.rating_template_config`\n(\n  id INT64,\n  program_id INT64,\n  level_id INT64,\n  rating_template_id INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_pronunciation_level",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_pronunciation_level`\n(\n  id INT64,\n  name STRING,\n  user_type_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_teacher_policy",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_policy`\n(\n  id INT64,\n  name STRING,\n  content STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "rating_template_detail",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.rating_template_detail`\n(\n  id INT64,\n  rating_template_id INT64,\n  rating_criteria_id INT64,\n  one_star STRING,\n  two_star STRING,\n  three_star STRING,\n  four_star STRING,\n  five_star STRING,\n  visible INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_rival_teacher",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_rival_teacher`\n(\n  id INT64,\n  booking_rival_id INT64,\n  teacher_id INT64,\n  status INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  action_at INT64,\n  booking_id INT64,\n  begin_at INT64,\n  end_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "course_tag",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.course_tag`\n(\n  course_id INT64,\n  tag_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n)\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "offline_event_student_action",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.offline_event_student_action`\n(\n  id INT64,\n  offline_event_student_id INT64,\n  action INT64,\n  note STRING,\n  status_from INT64,\n  status_to INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_class_lesson",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_class_lesson`\n(\n  id INT64,\n  class_id INT64,\n  lesson_id INT64,\n  booking_session_id INT64,\n  name STRING,\n  day INT64,\n  schedule_id INT64,\n  teacher_type INT64,\n  teacher_country_id INT64,\n  begin_at INT64,\n  end_at INT64,\n  status INT64,\n  `order` INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "affiliate_notification",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.affiliate_notification`\n(\n  id INT64,\n  student_id INT64,\n  message_type STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_session_income_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.booking_session_income_view`\nAS SELECT  \r\n      bs.id as booking_session_id,\r\n      bsi.* EXCEPT(booking_session_id, created_at, updated_at),   \r\n           \r\n      brb.bonus as replacement_bonus,     \r\n      -- bsi.hot_bonus_income,   \r\n      (bs.bonus_income + \r\n      (select max(bse.bonus_excess) \r\n        from `kynaforkids-server-production.kynaforkids.booking_session_extend_bonus` bse \r\n        where bse.booking_id \u003d bs.id)) as performance_bonus,        \r\n      bs.rating_below_standard_penalty,        \r\n      bs.cancel_penalty_income,        \r\n      bs.income,        \r\n      timestamp_seconds(bsi.created_at) as created_at,                \r\n      timestamp_seconds(bsi.updated_at) as updated_at,\r\n-- FROM `kynaforkids-server-production.kynaforkids.booking_session_income` bsi\r\nFROM `kynaforkids-server-production.kynaforkids.booking_session` bs\r\nleft join `kynaforkids.booking_session_income` bsi on bs.id \u003d bsi.booking_session_id\r\nleft join `kynaforkids.booking_replacement_bonus` brb on brb.booking_id \u003d bs.id\r\n;"
}, {
  "table_name": "booking_ai_homework",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_ai_homework`\n(\n  id INT64,\n  booking_ai_lesson_id INT64,\n  lesson_id INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "partner_transaction",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.partner_transaction`\n(\n  id INT64,\n  code STRING,\n  status INT64,\n  active_count INT64,\n  request_data STRING,\n  response_data STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_payment_history",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_payment_history`\n(\n  id INT64,\n  parent_id INT64,\n  student_id INT64,\n  program_id INT64,\n  booking_order_adjustment_id INT64,\n  payment_at INT64,\n  payment_fee FLOAT64,\n  total_lesson INT64,\n  refundable_lesson INT64,\n  extra_lesson INT64,\n  gift_lesson INT64,\n  duration INT64,\n  status INT64,\n  remain_lesson INT64,\n  revenue_per_booking NUMERIC(15, 2),\n  currency_code STRING,\n  extra_revenue FLOAT64,\n  is_used_extra_revenue INT64,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  approved_by INT64,\n  teacher_type INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "user",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.user`\n(\n  id INT64,\n  username STRING,\n  email STRING,\n  confirmed_at INT64,\n  unconfirmed_email STRING,\n  blocked_at INT64,\n  registration_ip STRING,\n  created_at INT64,\n  updated_at INT64,\n  flags INT64,\n  last_login_at INT64,\n  status INT64,\n  phone_number STRING,\n  parent_id INT64,\n  on_boarding INT64,\n  stripe_customer STRING,\n  confirm_count INT64,\n  source_id INT64,\n  affiliate_source_id INT64,\n  start_level STRING,\n  user_type_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "partner",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.partner`\n(\n  id INT64,\n  name STRING,\n  class STRING,\n  type INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  affiliate_id INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "lesson_session",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.lesson_session`\n(\n  id INT64,\n  lesson_id INT64,\n  user_id INT64,\n  duration INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "b2b_department",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.b2b_department`\n(\n  id INT64,\n  name STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_duo_speak_room",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_duo_speak_room`\n(\n  id INT64,\n  booking_id INT64,\n  level_id INT64,\n  teacher_country_id INT64,\n  is_fixed INT64,\n  begin_at INT64,\n  status INT64,\n  amount_student INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_golden_hour",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_golden_hour`\n(\n  id INT64,\n  teacher_id INT64,\n  booking_session_id INT64,\n  date INT64,\n  schedule_id INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  complain_status INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_status",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_status`\n(\n  id INT64,\n  name STRING,\n  class_name STRING,\n  text_class STRING,\n  is_close INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "adwords_meta_account",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.adwords_meta_account`\n(\n  id STRING,\n  business_id STRING,\n  name STRING,\n  channel_id INT64,\n  account_status INT64,\n  balance INT64,\n  currency STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "mkt_table_temp_alita",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.kynaforkids.mkt_table_temp_alita`\nOPTIONS(\n  sheet_range\u003d\"\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/1c2uexb4-N9BVSev0YV-ZIOqjYERJcSiUoTWsJWU5Y_Y/edit?gid\u003d1454129571#gid\u003d1454129571\"]\n);"
}, {
  "table_name": "ai_tutor_session_prompt_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_tutor_session_prompt_config`\n(\n  id INT64,\n  level_id INT64,\n  overview_comment_prompt STRING,\n  vocabulary_point_prompt STRING,\n  vocabulary_comment_prompt STRING,\n  listening_point_prompt STRING,\n  listening_comment_prompt STRING,\n  use_of_english_point_prompt STRING,\n  use_of_english_comment_prompt STRING,\n  speaking_point_prompt STRING,\n  speaking_comment_prompt STRING,\n  pronunciation_point_prompt STRING,\n  pronunciation_comment_prompt STRING,\n  reading_and_writing_point_prompt STRING,\n  reading_and_writing_comment_prompt STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "bbb_report",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.bbb_report`\n(\n  booking_session_id INT64,\n  internal_id STRING,\n  start_time INT64,\n  end_time INT64,\n  duration INT64,\n  status_record INT64,\n  is_recorded INT64,\n  number_rebuild INT64,\n  primary_session_meeting INT64,\n  bbb_server_point INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (booking_session_id, internal_id) NOT ENFORCED\n)\nCLUSTER BY booking_session_id, internal_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "contest_block_group",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.contest_block_group`\n(\n  id INT64,\n  block_id INT64,\n  group_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  level_type INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_favorite_topic",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_favorite_topic`\n(\n  id INT64,\n  user_id INT64,\n  ai_topic_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  type INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "quiz_section",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.quiz_section`\n(\n  id INT64,\n  name STRING,\n  quiz_id INT64,\n  time INT64,\n  factor INT64,\n  `order` INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  total_point FLOAT64,\n  percent_point FLOAT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  type INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_session_violation",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_session_violation`\n(\n  id INT64,\n  booking_session_id INT64,\n  violation_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_teacher_warning_type",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_warning_type`\n(\n  id INT64,\n  name STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ai_study_mode_vocabulary",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_study_mode_vocabulary`\n(\n  id INT64,\n  content STRING,\n  translate STRING,\n  banner STRING,\n  ai_study_mode_lesson_id INT64,\n  ai_study_mode_activity_type_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  type STRING,\n  ipa STRING,\n  definition STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_lesson_start",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_lesson_start`\n(\n  level_id INT64,\n  lesson_order INT64,\n  first_lesson_at INT64,\n  type_num_days_per_week INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (lesson_order, level_id, type_num_days_per_week) NOT ENFORCED\n)\nCLUSTER BY lesson_order, level_id, type_num_days_per_week;"
}, {
  "table_name": "wheel_camp",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.wheel_camp`\n(\n  id INT64,\n  type_code INT64,\n  name STRING,\n  begin_at INT64,\n  end_at INT64,\n  expired_at INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "dynamic_links",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.dynamic_links`\n(\n  id INT64,\n  name STRING,\n  deep_link STRING,\n  screen_name STRING,\n  params STRING,\n  short_link STRING,\n  long_link STRING,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "conversation",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.conversation`\n(\n  id INT64,\n  user_id INT64,\n  first_time_action INT64,\n  duration INT64,\n  conversation_type_id INT64,\n  supporter_id INT64,\n  current_assign_type INT64,\n  status INT64,\n  ended_at INT64,\n  country_code STRING,\n  forward_id INT64,\n  leave_message STRING,\n  firebase_key STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "adwords_meta_form",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.adwords_meta_form`\n(\n  id STRING,\n  name STRING,\n  page_id STRING,\n  user_id INT64,\n  user_type_id INT64,\n  country_id INT64,\n  subject_code STRING,\n  affiliate_category INT64,\n  affiliate_id INT64,\n  utm_campaign STRING,\n  created_at INT64,\n  updated_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_tutor_import",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_tutor_import`\n(\n  id INT64,\n  name STRING,\n  link STRING,\n  log STRING,\n  type INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "trial_user",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.trial_user`\n(\n  id INT64,\n  device_id STRING,\n  user_id INT64,\n  total_usage INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  user_type_id INT64,\n  device_token STRING,\n  all_usage INT64,\n  country_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "topic",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.topic`\n(\n  id INT64,\n  name STRING,\n  description STRING,\n  type INT64,\n  app STRING,\n  visible INT64,\n  is_send_to_chat INT64,\n  chat_database_path STRING,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "kynavn_orders",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.kynavn_orders`\n(\n  id INT64,\n  order_number STRING,\n  order_date INT64,\n  user_id INT64\n);"
}, {
  "table_name": "timesheet_team",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.timesheet_team`\n(\n  id INT64,\n  name STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_order_teacher_type",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_order_teacher_type`\n(\n  id INT64,\n  student_payment_id INT64,\n  student_id INT64,\n  program_id INT64,\n  order_id INT64,\n  teacher_type INT64,\n  teacher_country_id INT64,\n  total_lesson INT64,\n  remain_lesson INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  total NUMERIC(15, 2),\n  total_per_lesson NUMERIC(15, 2),\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "wiziq_class_report",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.wiziq_class_report`\n(\n  id INT64,\n  class_id INT64,\n  session_id INT64,\n  class_duration INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "wiziq_attendee_report",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.wiziq_attendee_report`\n(\n  class_id INT64,\n  session_id INT64,\n  is_teacher INT64,\n  presenter_email STRING,\n  screen_name STRING,\n  entry_time INT64,\n  exit_time INT64,\n  attended_minutes INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n)\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_transaction",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_transaction`\n(\n  id INT64,\n  order_id INT64,\n  payment_method_id INT64,\n  payment_gateway_id INT64,\n  payment_gateway_status STRING,\n  transaction_code STRING,\n  amount STRING,\n  request_data STRING,\n  response_data STRING,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "order",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.order`\n(\n  id INT64,\n  invoice_code STRING,\n  user_id INT64,\n  promotion_code STRING,\n  payment_method_id INT64,\n  send_to_shipping_status INT64,\n  regulate_shipping INT64,\n  regulate_shipping_status INT64,\n  payment_method_status INT64,\n  contact_status INT64,\n  reason_cancel_shipping_id INT64,\n  reason_cancel_id INT64,\n  affiliate_id INT64,\n  status INT64,\n  sub_total NUMERIC(13, 2),\n  discount_amount NUMERIC(13, 2),\n  voucher_discount_amount NUMERIC(13, 2),\n  shipping_fee NUMERIC(13, 2),\n  payment_fee NUMERIC(13, 2),\n  is_free_ship INT64,\n  total NUMERIC(13, 2),\n  active_code STRING,\n  gift_id INT64,\n  is_activated INT64,\n  telesale_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  is_upgrade INT64,\n  register_source STRING,\n  register_source_key STRING,\n  recall_date INT64,\n  shipping_method_id INT64,\n  pickup_location_id INT64,\n  affiliate_email STRING,\n  affiliate_category_name STRING,\n  sale_bonus_config_id INT64,\n  landing_page_slug STRING,\n  landing_page_name STRING,\n  ref_key STRING,\n  utm_campaign STRING,\n  completed_at INT64,\n  is_assign_user INT64,\n  telesale_follow_at INT64,\n  country_id INT64,\n  currency_code STRING,\n  shipping_service_code STRING,\n  currency_exchange_rate FLOAT64,\n  tracking_id STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (created_at, id) NOT ENFORCED\n)\nCLUSTER BY created_at, id;"
}, {
  "table_name": "booking_student_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.booking_student_view`\nAS SELECT         \r\n    * EXCEPT(start_at, expired_at,created_at,updated_at),       \r\n    TIMESTAMP_SECONDS(start_at) as start_at,       \r\n    TIMESTAMP_SECONDS(expired_at) as expired_at,       \r\n    TIMESTAMP_SECONDS(created_at) as created_at,       \r\n    TIMESTAMP_SECONDS(updated_at) as updated_at\r\nFROM `kynaforkids-server-production.kynaforkids.booking_student`;"
}, {
  "table_name": "booking_session_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.booking_session_view`\nAS SELECT * except(begin_at,end_at,created_at,updated_at,last_action_at,teacher_note_at),\r\n      timestamp_seconds(begin_at) as begin_at,\r\n      timestamp_seconds(end_at) as end_at,\r\n      timestamp_seconds(created_at) as created_at,\r\n      timestamp_seconds(updated_at) as updated_at,\r\n      timestamp_seconds(last_action_at) as last_action_at,\r\n      timestamp_seconds(teacher_note_at) as teacher_note_at,\r\n\r\n      case when bs.status_id \u003d 5 then \u0027Completed\u0027\r\n           when bs.status_id \u003d 7 and bs.cancel_config_id in (2,5,6,9,12) then \u0027Cancel không bù\u0027\r\n      end as completed_or_ko_bu,\r\n\r\n      case when (bs.total_income is null or bs.total_income \u003d 0) then \u0027income_null_0\u0027\r\n           else \u0027income_occured\u0027\r\n      end as income_type\r\n      \r\nFROM `kynaforkids-server-production.kynaforkids.booking_session` bs;"
}, {
  "table_name": "wh_export_product",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.wh_export_product`\n(\n  export_id INT64,\n  product_id INT64,\n  quantity INT64,\n  amount_per_unit NUMERIC(15, 2),\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (product_id, export_id) NOT ENFORCED\n)\nCLUSTER BY product_id, export_id;"
}, {
  "table_name": "social_account",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.social_account`\n(\n  id INT64,\n  user_id INT64,\n  provider STRING,\n  client_id STRING,\n  data STRING,\n  code STRING,\n  created_at INT64,\n  email STRING,\n  username STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_teacher_warning_type_ids",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_warning_type_ids`\n(\n  warning_id INT64,\n  type_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (type_id, warning_id) NOT ENFORCED\n)\nCLUSTER BY type_id, warning_id;"
}, {
  "table_name": "tele_marketing_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.tele_marketing_view`\nAS SELECT  \r\n        * except(created_at, updated_at),\r\n        timestamp_seconds(created_at) as created_at,\r\n        timestamp_seconds(updated_at) as updated_at\r\n\r\n\r\nFROM `kynaforkids-server-production.kynaforkids.tele_marketing` ;"
}, {
  "table_name": "aca_acc_cb_teacher_income_estimation_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.aca_acc_cb_teacher_income_estimation_view`\nAS WITH\r\nteacher_income_1_1_all AS (\r\nselect \r\n  t1.booking_id,\r\n  t1.booking_time,\r\n  FORMAT_DATE(\u0027%b %Y\u0027, t1.booking_time) AS month_year,\r\n  t1.booking_type,\r\n  t1.num_shift,\r\n  t1.teacher_name,\r\n  t1.teacher_country,\r\n  t1.booking_status,\r\n  t1.program,\r\n  t1.teacher_id,\r\n  t1.payment_content,\r\n  t1.teacher_source,\r\n  t1.student_country,\r\n  if(sum(t1.revenue) is null,0,sum(t1.revenue)) as revenue_oc,\r\n  if(sum(t1.revenue) is null,0,(sum(t1.revenue) * if(avg(t1.currency_exchange_rate) is null, 1, avg(t1.currency_exchange_rate)))) as revenue_vnd,\r\n  max(s2.sellingEx) as sellingEx,\r\n  max(t1.total_income) as total_income,\r\n  -- if(max(t1.income) is null, 0,max(t1.income))  + if(max(t1.bonus_income) is null, 0, max(t1.bonus_income))\r\n  -- + if(max(bsi.bonus_test_online_early_review) is null, 0, max(bsi.bonus_test_online_early_review))\r\n  -- + if(max(bsi.bonus_test_online_golden_hour) is null, 0, max(bsi.bonus_test_online_golden_hour))\r\n  -- - if(max(bsi.open_webcam_below_standard_penalty) is null, 0, max(bsi.open_webcam_below_standard_penalty))\r\n  -- - if(max(bsi.full_face_below_standard_penalty) is null, 0, max(bsi.full_face_below_standard_penalty))\r\n  -- - if(max(bsi.etiquette_violation_penalty) is null, 0, max(bsi.etiquette_violation_penalty))\r\n  -- - if(max(t1.rating_below_standard_penalty) is null, 0,max(t1.rating_below_standard_penalty)) \r\n  -- - if(max(t1.cancel_penalty_income) is null, 0, max(t1.cancel_penalty_income))  as total_income\r\n  \r\nfrom (\r\nSELECT \r\n  bs.id as booking_id,\r\n  bs.total_income,\r\n  bs.begin_at as booking_time,\r\n  case\r\n  when bs.is_compensatory_course \u003d 1 then \u0027buoi_bu\u0027\r\n  else \u0027buoi_chinh_thuc\u0027\r\n  end as booking_type,\r\n  (select max(p.`name`) from `kynaforkids-server-production.kynaforkids.profile` p where p.user_id \u003d bs.teacher_id) as teacher_name,\r\n  case\r\n    when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 1 then \u0027Philippines\u0027\r\n    when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 2 then \u0027Native\u0027\r\n    when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 3 then \u0027Vietnamese\u0027\r\n    when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 4 then \u0027Thailand\u0027\r\n    when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 5 then \u0027Indonesia\u0027\r\n  when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 8 then \u0027Laos\u0027\r\n  when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 9 then \u0027Malaysia\u0027\r\n  end as teacher_country,\r\n  `kynaforkids-server-production.kynaforkids.func_get_booking_status`(bs.status_id, bs.cancel_config_id) as booking_status,\r\n  (select bp.number_of_shift from `kynaforkids-server-production.kynaforkids.booking_program` bp where bp.id \u003d bs.program_id ) as num_shift,\r\n  \r\n  (`kynaforkids-server-production.kynaforkids.func_get_program_name_from_id`(bs.program_id)) as program,\r\n  bs.teacher_id,\r\n  case\r\n    when (select min(bo.payment_content) from `kynaforkids-server-production.kynaforkids.booking_order` bo\r\n    where  bo.student_payment_id \u003d bss.student_payment_id) \u003d 1 then \u0027Buổi Học thử\u0027\r\n    when (select bph.payment_fee from `kynaforkids-server-production.kynaforkids.booking_payment_history` bph \r\n    where bph.id \u003d bss.student_payment_id) \u003d 0  then \u0027Buổi tặng\u0027\r\n    else \u0027Buổi Ghi danh\u0027\r\n  end as payment_content,\r\n  (select bt.teacher_source from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bs.teacher_id \u003d bt.user_id) as teacher_source,\r\n  `kynaforkids-server-production.kynaforkids.func_get_booking_student_country`((select bst.country_id from  `kynaforkids-server-production.kynaforkids.booking_student` bst \r\n  where bs.id \u003d bss.booking_session_id and bss.student_id \u003d bst.user_id)) as student_country,\r\n  bss.revenue,\r\n  bss.currency_exchange_rate,\r\n  bs.income,\r\n (bs.bonus_income + (select max(bse.bonus_excess) from `kynaforkids-server-production.kynaforkids.booking_session_extend_bonus` bse \r\n  where bse.booking_id \u003d bs.id)) as bonus_income,\r\n  bs.rating_below_standard_penalty,\r\n  bs.cancel_penalty_income,\r\n  \r\nFROM `kynaforkids-server-production.kynaforkids.booking_session_view` bs\r\ninner join `kynaforkids-server-production.kynaforkids.booking_session_student` bss on bs.id \u003d bss.booking_session_id \r\n--where bs.program_id not in (5,14,15,21,22,46,52,61,62,63,64,65,66,67,88,102)\r\nwhere bs.program_id not in (select id from `kynaforkids-server-production.kynaforkids.booking_program`where type in (2,3,4))\r\n) t1\r\ninner join `kynaforkids-server-production.kynaforkids.booking_session_student` bss on t1.booking_id \u003d bss.booking_session_id\r\nleft join `kynaforkids-server-production.kynaforkids.booking_session_income` bsi on t1.booking_id \u003d bsi.booking_session_id\r\njoin\r\n\r\n(select t3.date, t3.sellingEx, t3.teacherCountry,\r\n  lead (t3.date) over (partition by t3.teacherCountry order by t3.date) as next_applied_date\r\n  from kynaforkids-server-production.kynaforkids.Acc_teacher_income_ex t3) s2\r\n\r\non date(t1.booking_time) \u003e\u003d s2.date and (date(t1.booking_time) \u003c s2.next_applied_date or s2.next_applied_date is null) and t1.teacher_country \u003d s2.teacherCountry\r\n\r\ngroup by booking_id, booking_time, booking_type, teacher_name, teacher_country, booking_status, program, num_shift, teacher_id, payment_content, teacher_source, student_country\r\n),\r\n\r\ntable_1_1 AS (\r\nSELECT ti11a.teacher_id, ti11a.teacher_name, ti11a.teacher_source, ti11a.teacher_country, ti11a.sellingEx, SUM(ti11a.total_income) as booking_1_1_income_oc, ti11a.month_year\r\n       \r\nFROM teacher_income_1_1_all ti11a\r\nWHERE --date(ti11a.booking_time) \u003e\u003d PARSE_DATE(\u0027%Y%m%d\u0027, @DS_START_DATE) AND date(ti11a.booking_time) \u003c\u003d PARSE_DATE(\u0027%Y%m%d\u0027, @DS_START_END)\r\n      date(ti11a.booking_time) \u003e\u003d \u00272024-09-01\u0027 --AND date(ti11a.booking_time) \u003c\u003d \u00272024-09-30\u0027 \r\nGROUP BY ti11a.teacher_id, ti11a.teacher_name, ti11a.teacher_source, ti11a.teacher_country, ti11a.sellingEx, ti11a.month_year\r\n),\r\n\r\nteacher_income_1_n_all AS(\r\nselect\r\n    t2.*,\r\n    total_income * sellingEX as teacher_income,\r\n    FORMAT_DATE(\u0027%b %Y\u0027, t2.begin_at) AS month_year,\r\nfrom\r\n(\r\nselect \r\n  t1.id,\r\n  max(t1.program_name) as program_name,\r\n  MAX(`kynaforkids-server-production.kynaforkids.func_get_booking_status`(t1.status_id, t1.cancel_config_id)) as booking_status,\r\n  max(t1.teacher_id) as teacher_id,\r\n  max(t1.teacher_name) as teacher_name,\r\n  max(t1.teacher_source) as teacher_source,\r\n  sum(t1.revenue) as revenue,\r\n  max(t1.total_income) as total_income,\r\n  max(t1.begin_at) as begin_at,\r\n  max(teacher_country_booking) as teacher_country_booking,\r\n  max(s2.sellingEx) as sellingEx\r\nfrom (\r\nSELECT\r\nbs.id,\r\n`kynaforkids-server-production.kynaforkids.func_get_program_name_from_id`(bs.program_id) as program_name,\r\nbs.status_id as status_id,\r\nbs.cancel_config_id as cancel_config_id,\r\nbs.teacher_id,\r\n( SELECT max(p.`name`) FROM  `kynaforkids-server-production.kynaforkids.profile` p  WHERE p.user_id \u003d bs.teacher_id) AS teacher_name,\r\n bs.total_income as total_income,\r\n if(bss.revenue is null,0,(bss.revenue * if(bss.currency_exchange_rate is null, 1, bss.currency_exchange_rate))) AS revenue,\r\n  bs.begin_at,\r\n  case\r\n    when SAFE_CAST(bs.teacher_country_id as INT64) \u003d 1 then \u0027Philippines\u0027\r\n    when SAFE_CAST(bs.teacher_country_id as INT64) \u003d 2 then \u0027Native\u0027\r\n    when SAFE_CAST(bs.teacher_country_id as INT64) \u003d 3 then \u0027Vietnamese\u0027\r\n    when SAFE_CAST(bs.teacher_country_id as INT64) \u003d 4 then \u0027Thailand\u0027\r\n    when SAFE_CAST(bs.teacher_country_id as INT64) \u003d 5 then \u0027Indonesia\u0027\r\n      when SAFE_CAST(bs.teacher_country_id as INT64) \u003d 8 then \u0027Laos\u0027\r\n      when SAFE_CAST(bs.teacher_country_id as INT64) \u003d 9 then \u0027Malaysia\u0027\r\n  end as teacher_country_booking,\r\n  (select bt.teacher_source from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bs.teacher_id \u003d bt.user_id) as teacher_source,\r\nFROM `kynaforkids-server-production.kynaforkids.booking_session_view` bs\r\nleft join `kynaforkids-server-production.kynaforkids.booking_session_student` bss  on bss.booking_session_id \u003d bs.id\r\nWHERE\r\n     bs.program_id in (select id from `kynaforkids-server-production.kynaforkids.booking_program`where  type in (2,3)) \r\n--bs.program_id in (5,14,15,21,22,46,52,61,62,63,64,65,66,67,88,102) \r\n--AND (DATE(bs.begin_at) \u003e\u003d PARSE_DATE(\u0027%Y%m%d\u0027, @DS_START_DATE) and DATE(bs.begin_at) \u003c\u003d PARSE_DATE(\u0027%Y%m%d\u0027, @DS_END_DATE))\r\n) t1\r\n\r\nleft join\r\n\r\n(select t3.date, t3.sellingEx, t3.teacherCountry,\r\n  lead (t3.date) over (partition by t3.teacherCountry order by t3.date) as next_applied_date\r\n  from kynaforkids-server-production.kynaforkids.Acc_teacher_income_ex t3) s2\r\n\r\non date(t1.begin_at) \u003e\u003d s2.date and (date(t1.begin_at) \u003c s2.next_applied_date or s2.next_applied_date is null) and t1.teacher_country_booking \u003d s2.teacherCountry\r\n\r\ngroup by t1.id\r\n) t2\r\n),\r\n\r\ntable_1_n AS (\r\nSELECT ti1na.teacher_id, ti1na.teacher_name, ti1na.teacher_source, ti1na.teacher_country_booking as teacher_country, ti1na.sellingEx, SUM(ti1na.total_income) as booking_1_n_income_oc, ti1na.month_year\r\nFROM teacher_income_1_n_all ti1na\r\nWHERE --date(ti1na.begin_at) \u003e\u003d PARSE_DATE(\u0027%Y%m%d\u0027, @DS_START_DATE) AND date(ti1na.begin_at) \u003c\u003d PARSE_DATE(\u0027%Y%m%d\u0027, @DS_START_END)\r\n      date(ti1na.begin_at) \u003e\u003d \u00272024-09-01\u0027 --AND date(ti1na.begin_at) \u003c\u003d \u00272024-09-30\u0027 \r\nGROUP BY ti1na.teacher_id, ti1na.teacher_name, ti1na.teacher_source, teacher_country, ti1na.sellingEx, ti1na.month_year\r\n),\r\n\r\ntable_all AS (\r\nSELECT \r\n      IF(t11.teacher_id is null, t1n.teacher_id, t11.teacher_id) as teacher_id,\r\n      IF(t11.teacher_name is null, t1n.teacher_name, t11.teacher_name) as teacher_name,\r\n      IF(t11.teacher_source is null, t1n.teacher_source, t11.teacher_source) as teacher_source,\r\n      IF(t11.teacher_country is null, t1n.teacher_country, t11.teacher_country) as teacher_country,\r\n      IF(t11.month_year is null, t1n.month_year, t11.month_year) as month_year,      \r\n      IF(t11.sellingEx is null, t1n.sellingEx, t11.sellingEx) as sellingEx,\r\n      IF(t11.booking_1_1_income_oc is null, 0, t11.booking_1_1_income_oc) as booking_1_1_income_oc,\r\n      IF(t1n.booking_1_n_income_oc is null, 0, t1n.booking_1_n_income_oc) as booking_1_n_income_oc,     \r\nFROM table_1_1 t11\r\nFULL JOIN table_1_n t1n ON (t11.teacher_id \u003d t1n.teacher_id and t11.month_year \u003d t1n.month_year) \r\n)\r\n\r\nSELECT *,\r\n      case when teacher_source \u003d 1 then \u0027Kyna\u0027\r\n           when teacher_source \u003d 3 then \u0027GGE\u0027\r\n           when teacher_source \u003d 4 then \u0027Murpher\u0027\r\n           else \u0027Back Office/Unkown\u0027\r\n      end as `source`,\r\n      CASE\r\n            WHEN teacher_source \u003d 1 AND teacher_country \u003d \u0027Indonesia\u0027 THEN 0.9992430757\r\n            WHEN teacher_source \u003d 1 AND teacher_country \u003d \u0027Laos\u0027 THEN 0.984236616\r\n            WHEN teacher_source \u003d 1 AND teacher_country \u003d \u0027Malaysia\u0027 THEN 1.012263295\r\n            WHEN teacher_source \u003d 1 AND teacher_country \u003d \u0027Native\u0027 THEN 1.006925708\r\n            WHEN teacher_source \u003d 1 AND teacher_country \u003d \u0027Philippines\u0027 THEN 0.998773998\r\n            WHEN teacher_source \u003d 1 AND teacher_country \u003d \u0027Thailand\u0027 THEN 1.000859693\r\n            WHEN teacher_source \u003d 1 AND teacher_country \u003d \u0027Vietnamese\u0027 THEN 1.040027165\r\n            WHEN teacher_source \u003d 3 AND teacher_country \u003d \u0027Philippines\u0027 THEN 0.9956269044\r\n            WHEN teacher_source \u003d 4 AND teacher_country \u003d \u0027Native\u0027 THEN 0.9995901338\r\n      ELSE NULL  -- Add a default value if needed\r\n      END AS rate \r\nFROM table_all \r\n\r\n\r\n\r\n\r\n;"
}, {
  "table_name": "Test_student_teacher",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.Test_student_teacher`\nAS \r\nSELECT \r\nmax(bo.student_code) as MaHV, \r\nmax(bo.email) as Email, \r\nmax(bo.phone_number) as Phone, \r\nmax(p.name) as GiaoVien,\r\nCASE\r\n    WHEN max (bo.international_country_id) \u003d 1 THEN \u0027Thailand\u0027\r\n    WHEN max (bo.international_country_id) \u003d 2 THEN \u0027Indo\u0027\r\n    WHEN max (bo.international_country_id) \u003d 3 THEN \u0027VietNam\u0027\r\n    WHEN max (bo.international_country_id) \u003d 4 THEN \u0027Khac\u0027\r\nEND as QuocGia,\r\nmax(bo.international_country_id) as international_country_id,\r\nmax (sessionStudent.teacher_id) as TeacherID,\r\ncountif(sessionStudent.rating \u003d 2) as total_dat,\r\ncountif(sessionStudent.rating \u003d 1)  as total_khongdat,\r\ncountif(sessionStudent.rating \u003d 3) as total_duoichuan,\r\ncountif(sessionStudent.rating \u003d 4) as total_nopay,\r\ncountif(sessionStudent.rating \u003d 4 and sessionStudent.program_id \u003d 8) as total_nopay_1_ca,\r\ncountif(sessionStudent.rating \u003d 4 and sessionStudent.program_id \u003d 13) as total_nopay_2_ca,\r\nmax(sessionStudent.begin_at) as begin_at,\r\ncountif(sessionStudent.country_id \u003d 1) as total_completed_booking_Th,\r\ncountif(sessionStudent.country_id \u003d 2) as total_completed_booking_Id,\r\ncountif(sessionStudent.country_id \u003d 3) as total_completed_booking_VN,\r\ncountif(sessionStudent.country_id \u003d 4) as total_completed_booking_Khac\r\nFROM `kynaforkids-server-production.kynaforkids.booking_order` bo\r\nINNER JOIN `kynaforkids-server-production.kynaforkids.booking_student` bst ON bst.student_code \u003d bo.student_code\r\nINNER JOIN (\r\nSELECT bss.student_id, bs.name, bs.teacher_id, bs.rating, date(bs.begin_at) as begin_at, bs.program_id, bstt.country_id\r\nFROM `kynaforkids-server-production.kynaforkids.booking_session_student` bss\r\nINNER JOIN `kynaforkids-server-production.kynaforkids.booking_session_view` bs ON bs.id \u003d bss.booking_session_id\r\nINNER JOIN `kynaforkids-server-production.kynaforkids.booking_student` bstt on bss.student_id \u003d bstt.user_id\r\nWHERE bs.status_id IN (5)\r\nAND bs.program_id IN (8,13)\r\n) sessionStudent ON sessionStudent.student_id \u003d bst.user_id\r\nINNER JOIN `kynaforkids-server-production.kynaforkids.profile` p ON p.user_id \u003d sessionStudent.teacher_id\r\nWHERE  bo.status \u003d 4\r\nAND bo.payment_status \u003d 1\r\nAND cast(bo.payment_content as INT64) in (2, 1)\r\nGROUP BY bo.student_code\r\n;"
}, {
  "table_name": "booking_lead_permate",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_lead_permate`\n(\n  id INT64,\n  booking_lead_id INT64,\n  pm_offer_id STRING,\n  pm_cid STRING,\n  pm_click_id STRING,\n  external_conversion_id STRING,\n  sale_value FLOAT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_affiliate_commission_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_affiliate_commission_config`\n(\n  id INT64,\n  name STRING,\n  country_id INT64,\n  affiliate_category_id INT64,\n  payment_content INT64,\n  payment_count INT64,\n  commission_percent FLOAT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  start_date INT64,\n  end_date INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "aca_training_trainee",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.aca_training_trainee`\n(\n  aca_training_id INT64,\n  user_id INT64,\n  is_join_meeting INT64,\n  is_avatar_similar_user INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (aca_training_id, user_id) NOT ENFORCED\n)\nCLUSTER BY aca_training_id, user_id;"
}, {
  "table_name": "ceo_cac_cost_thu_ho_cash_collection_view_2",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.ceo_cac_cost_thu_ho_cash_collection_view_2`\nAS WITH \r\ntutoring_new_students AS \r\n(\r\nWITH order_info AS (\r\n  (SELECT date(bo.created_at) AS ngay_tao_don,\r\n          date(bo.payment_at) AS ngay_duyet_don,\r\n          if(bo.accounting_date IS NULL, date(bo.created_at), bo.accounting_date) AS accounting_date,\r\n\r\n     (SELECT created_at\r\n      FROM `kynaforkids-server-production.kynaforkids.booking_lead`\r\n      WHERE id \u003d bo.lead_id) AS ngay_tao_lead,\r\n          bo.invoice_code,\r\n\r\n     -- (SELECT name\r\n     --  FROM `kynaforkids-server-production.kynaforkids.booking_lead`\r\n     --  WHERE id \u003d bo.lead_id) AS ten_phu_huynh,\r\n          -- bo.email,\r\n          -- bo.name,\r\n          bo.student_code,\r\n          bo.student_id,\r\n          bo.phone_number,\r\n          bo.id as order_id,\r\n          bo.international_country_id,\r\n          if(bo.total_video_course IS NULL, 0, bo.total_video_course) AS total_video_course,\r\n          bo.total,\r\n          `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(cast(bo.payment_content AS INT64)) AS noi_dung_thanh_toan,\r\n          `kynaforkids-server-production.kynaforkids.func_get_source`(bo.source) AS source,\r\n          `kynaforkids-server-production.kynaforkids.func_get_program_name_from_id`(bo.program_id) AS program,\r\n          `kynaforkids-server-production.kynaforkids.func_get_booking_order_status`(bo.status) AS order_status,\r\n          CASE WHEN bo.payment_status \u003d 0 THEN \u0027Chưa duyệt\u0027 \r\n               WHEN bo.payment_status \u003d 1 THEN \u0027Đã duyệt\u0027 \r\n               WHEN bo.payment_status \u003d 2 THEN \u0027Không duyệt\u0027 \r\n               WHEN bo.payment_status \u003d 3 THEN \u0027Cần điều chỉnh\u0027 \r\n               WHEN bo.payment_status \u003d 4 THEN \u0027Đã điều chỉnh\u0027 \r\n               ELSE \u0027Khác\u0027 END AS payment_status,\r\n          bo.total - if(bo.discount_money IS NULL, 0, bo.discount_money) AS price,\r\n          -- bo.duration,\r\n          -- bo.note AS note,\r\n          bo.lead_id AS lead_id,\r\n          -- bll.gclid,\r\n\r\n     -- (SELECT sale_id\r\n     --  FROM `kynaforkids-server-production.kynaforkids.booking_lead`\r\n     --  WHERE id \u003d bo.lead_id) AS sale_id,\r\n     \r\n     IF (bll.actual_utm_campaign IS NULL,\r\n                                   bll.utm_campaign,\r\n                                   bll.actual_utm_campaign) AS affiliate_campaign,\r\n    --  bll.actual_utm_campaign as affiliate_campaign, \r\n    --  (SELECT actual_lead_id\r\n    --   FROM `kynaforkids-server-production.kynaforkids.booking_lead`\r\n    --   WHERE id \u003d bo.lead_id) AS actual_lead_id,\r\n    --       if(bll.actual_lead_id IS NULL, bll.utm_campaign,\r\n    --            (SELECT bl.utm_campaign\r\n    --             FROM `kynaforkids-server-production.kynaforkids.booking_lead` bl\r\n    --             WHERE bl.id \u003d bll.actual_lead_id)) AS affiliate_campaign,\r\n\r\n     -- (SELECT fanpage_name\r\n     --  FROM `kynaforkids-server-production.kynaforkids.booking_lead`\r\n     --  WHERE id \u003d bo.lead_id) AS fanpage_name,\r\n          -- if(bll.actual_lead_id IS NULL, bll.landing_page_name,\r\n          --      (SELECT bl.landing_page_name\r\n          --       FROM `kynaforkids-server-production.kynaforkids.booking_lead` bl\r\n          --       WHERE bl.id \u003d bll.actual_lead_id)) AS landingpage_name,\r\n          -- if(bll.actual_lead_id IS NULL, bll.affiliate_id,\r\n          --      (SELECT bl.affiliate_id\r\n          --       FROM `kynaforkids-server-production.kynaforkids.booking_lead` bl\r\n          --       WHERE bl.id \u003d bll.actual_lead_id)) AS affiliate_id,\r\n          bo.currency_exchange_rate,\r\n          ((bo.total - if(bo.discount_money IS NULL, 0, bo.discount_money)) * bo.currency_exchange_rate) AS price_vnd,\r\n          `kynaforkids-server-production.kynaforkids.func_get_country`(bo.international_country_id) AS country,\r\n          -- bo.total_lesson,\r\n\r\n     -- (SELECT string_agg(t1.video_course_name)\r\n     --  FROM `kynaforkids-server-production.kynaforkids.view_tutoring_video_course_name` t1\r\n     --  WHERE t1.id \u003d bo.id) AS video_course_name,\r\n          -- if(bll.actual_lead_id IS NULL,\r\n          --      (SELECT max(u.email)\r\n          --       FROM `kynaforkids-server-production.kynaforkids.kynaforkids_user` u\r\n          --       WHERE bll.affiliate_id \u003d u.id),\r\n          --      (SELECT max(u.email)\r\n          --       FROM `kynaforkids-server-production.kynaforkids.booking_lead` bl, `kynaforkids-server-production.kynaforkids.kynaforkids_user` u\r\n          --       WHERE bll.actual_lead_id \u003d bl.id\r\n          --         AND bl.affiliate_id \u003d u.id)) AS affiliate_email,\r\n\r\n     -- (SELECT max(u.email)\r\n     --  FROM `kynaforkids-server-production.kynaforkids.kynaforkids_user` u,\r\n     --       `kynaforkids-server-production.kynaforkids.affiliate_user` au\r\n     --  WHERE au.affiliate_id \u003d bo.affiliate_id\r\n     --    AND au.user_id \u003d u.id) AS affiliate_emaill,\r\n\r\n     -- (SELECT ac.name\r\n     --  FROM `kynaforkids-server-production.kynaforkids.affiliate_category` ac,\r\n     --       `kynaforkids-server-production.kynaforkids.affiliate_user` au\r\n     --  WHERE bo.affiliate_id \u003d au.affiliate_id\r\n     --    AND au.affiliate_category_id \u003d ac.id) AS loai_affiliate,\r\n          -- IF (bll.actual_lead_id IS NULL,\r\n          --       (SELECT ac.name\r\n          --        FROM `kynaforkids-server-production.kynaforkids.affiliate_user` au,\r\n          --             `kynaforkids-server-production.kynaforkids.affiliate_category` ac\r\n          --        WHERE bll.affiliate_id \u003d au.user_id\r\n          --          AND au.affiliate_category_id \u003d ac.id),\r\n          --       (SELECT ac.name\r\n          --        FROM `kynaforkids-server-production.kynaforkids.booking_lead` bl,\r\n          --             `kynaforkids-server-production.kynaforkids.affiliate_user` au,\r\n          --             `kynaforkids-server-production.kynaforkids.affiliate_category` ac\r\n          --        WHERE bl.id \u003d bll.actual_lead_id\r\n          --          AND bl.affiliate_id \u003d au.user_id\r\n          --          AND au.affiliate_category_id \u003d ac.id)) AS affiliate_type\r\n   FROM `kynaforkids-server-production.kynaforkids.booking_order_view` bo\r\n   LEFT JOIN `kynaforkids-server-production.kynaforkids.booking_lead` bll ON bll.id \u003d bo.lead_id\r\n\r\n--    WHERE DATE(bo.created_at) \u003e\u003d \u00272024-08-01\u0027 \r\n   )\r\n),\r\n\r\ntemp_table as\r\n(\r\nSELECT \r\n       t1.order_id,\r\n       t1.ngay_tao_don,\r\n       t1.ngay_duyet_don,\r\n       t1.accounting_date,\r\n       t1.ngay_tao_lead,\r\n       t1.invoice_code,\r\n     --   t1.ten_phu_huynh,\r\n     --   t1.email,\r\n     --   t1.name,\r\n     --   t1.student_code,\r\n       t1.phone_number,\r\n       t1.international_country_id as country_id,\r\n       t1.total_video_course,\r\n       t1.total,\r\n       t1.noi_dung_thanh_toan,\r\n       t1.source,\r\n       t1.program,\r\n       t1.order_status,\r\n       t1.payment_status,\r\n     --   t1.price,\r\n       ((t1.price + t1.total_video_course) * t1.currency_exchange_rate) AS total_VND,\r\n     --   (t1.price + t1.total_video_course) AS total_nguyen_te,\r\n     --   t1.duration,\r\n     --   t1.note,\r\n       t1.lead_id,\r\n     --   `kynaforkids-server-production.kynaforkids.func_get_email_from_kynaforkids_user`(t1.sale_id) AS sale_email,\r\n       t1.affiliate_campaign,\r\n     --   t1.landingpage_name,\r\n     --   t1.fanpage_name,\r\n     --   t1.gclid,\r\n     --   t1.affiliate_id,\r\n     --   t1.affiliate_email,\r\n     --   t1.affiliate_type,\r\n     --   t1.currency_exchange_rate,\r\n     --   t1.price_vnd,\r\n       t1.country,\r\n     --   t1.total_lesson,\r\n     --   t1.video_course_name,\r\n     --   t1.affiliate_emaill,\r\n     --   t1.loai_affiliate\r\n      t1.student_id,\r\n      t1.student_code,\r\n      (\r\n         SELECT COUNT(distinct bo.id) \r\n         FROM `kynaforkids.booking_order_view` bo \r\n         WHERE (bo.student_id \u003d t1.student_id OR bo.student_code \u003d t1.student_code) AND bo.payment_status in (0,1,3) AND bo.status in (4,6) AND `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(cast(bo.payment_content AS INT64)) in (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) AND date(bo.accounting_date) \u003c\u003d date(t1.accounting_date)\r\n      ) as num_completed_orders_same_student, \r\n\r\n        (\r\n         SELECT COUNT(distinct bo.id) \r\n         FROM `kynaforkids.booking_order_view` bo \r\n         WHERE (RIGHT(bo.phone_number,9) \u003d RIGHT(t1.phone_number,9)) AND bo.payment_status in (0,1,3) AND bo.status in (4,6) AND `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(cast(bo.payment_content AS INT64)) in (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) AND date(bo.accounting_date) \u003c\u003d date(t1.accounting_date)\r\n      ) as num_completed_orders_same_phone,\r\n\r\nFROM order_info t1\r\nWHERE \r\n      -- t1.source \u003d \u0027Marketing\u0027  \r\n      t1.accounting_date \u003e\u003d \u00272024-01-01\u0027 \r\n      AND t1.payment_status in (\u0027Đã duyệt\u0027,\u0027Chưa duyệt\u0027,\u0027Cần điều chỉnh\u0027) \r\n      AND t1.order_status in (\u0027Hoàn thành\u0027, \u0027Chờ xác nhận thanh toán\u0027)\r\n      AND t1.noi_dung_thanh_toan in (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n      AND (t1.price + t1.total_video_course) \u003e 0\r\n      -- AND t1.ngay_tao_lead \u003e\u003d \u00272024-01-01\u0027\r\n)\r\n\r\nSELECT \r\n        date(accounting_date) as ngay_hach_toan,\r\n        SUM(total_VND) as total_tutoring_order_value,\r\nFROM\r\n(SELECT \r\n       accounting_date,total_VND,\r\n       if(not(student_id is null AND student_code is null),if(t2.num_completed_orders_same_student \u003e 1, \u0027Học viên cũ\u0027, \u0027Học viên mới\u0027),if(t2.num_completed_orders_same_phone \u003e 1, \u0027có order cùng phone chưa rõ HV cũ/mới\u0027, \u0027Học viên mới\u0027)) as old_new_student,\r\n       \r\n\r\nFROM temp_table t2\r\n-- WHERE not(student_id is null AND student_code is null)\r\n)\r\nWHERE old_new_student \u003d \u0027Học viên mới\u0027\r\nGROUP BY ngay_hach_toan -- có thể group theo cả country nữa\r\nORDER BY ngay_hach_toan desc\r\n),\r\n\r\nai_single_new_students AS \r\n(\r\nWITH \r\norder_ai_tutor_single AS\r\n(SELECT \r\n        --ord.*,\r\n        ord.id as order_id,\r\n        date(timestamp_seconds(ord.created_at)) as created_at,\r\n      --   date(ord.updated_at) as updated_at,\r\n        date(timestamp_seconds(ord.completed_at)) as completed_at,\r\n      --   ord.created_by,\r\n      --   ord.telesale_id,\r\n        ord.register_source,        \r\n        ord.country_id,\r\n        `kynaforkids-server-production.kynaforkids.func_get_country`(ord.country_id) as country,\r\n        ord.currency_exchange_rate,\r\n        ord.total as total_oc,\r\n        \r\n        \r\n       -- ord.user_id,\r\n        ori.phone_number as order_phone_number,\r\n        ori.email as order_email,\r\n        ori.lead_id,\r\n      --   if((ori.phone_number) in (SELECT * FROM users_1_1_phone_number),\"Đã học 1-1\",\"Chưa học 1-1\") as check_1_1, \r\n\r\n        \r\n\r\n        ord.invoice_code as order_code,\r\n        ord.status as order_status_id,\r\n        ord.payment_method_id,\r\n        ord.payment_method_status as payment_status_id,\r\n        ord.affiliate_id,\r\n        (SELECT email FROM kynaforkids-server-production.kynaforkids.user us WHERE ord.affiliate_id \u003d us.id) as affiliate_email,\r\n        (SELECT au.affiliate_category_id FROM kynaforkids-server-production.kynaforkids.affiliate_user au WHERE au.user_id \u003d ord.affiliate_id) as affiliate_category_id,\r\n        ord.utm_campaign,\r\n\r\n\r\n        ordd.package_id,\r\n        ordd.package_subscription_id,\r\n        pks.subscription_month,\r\n        pks.name as subscription_name,\r\n        pks.price as subscription_price,\r\n        pk.name as package_name,\r\n\r\n        \r\n       \r\nFROM `kynaforkids-server-production.kynaforkids.order` ord\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.order_detail` ordd ON (ord.id \u003d ordd.order_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.order_register_info` ori ON (ord.id \u003d ori.order_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.package_subscriptions` pks ON (ordd.package_subscription_id \u003d pks.id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.package` pk ON (pk.id \u003d ordd.package_id)\r\n\r\n\r\n\r\nWHERE \r\n      ord.invoice_code like \u0027KYNA%\u0027\r\n      AND pk.name like \u0027%AI Tutor%\u0027\r\n      AND ordd.package_combo_id is null\r\n),\r\n\r\norder_ai_tutor_combo AS\r\n(SELECT \r\n        --ord.*,\r\n        ord.id as order_id,\r\n        date(timestamp_seconds(ord.created_at)) as created_at,\r\n      --   date(ord.updated_at) as updated_at,\r\n        date(timestamp_seconds(ord.completed_at)) as completed_at,\r\n      --   ord.created_by,\r\n      --   ord.telesale_id,\r\n        ord.register_source,        \r\n        ord.country_id,\r\n        `kynaforkids-server-production.kynaforkids.func_get_country`(ord.country_id) as country,\r\n        ord.currency_exchange_rate,\r\n        ord.total as total_oc,\r\n        \r\n        \r\n       -- ord.user_id,\r\n        ori.phone_number as order_phone_number,\r\n        ori.email as order_email,\r\n        ori.lead_id,\r\n      --   if((ori.phone_number) in (SELECT * FROM users_1_1_phone_number),\"Đã học 1-1\",\"Chưa học 1-1\") as check_1_1, \r\n\r\n\r\n        -- ord.invoice_code as order_code,\r\n        -- ord.status as order_status_id,\r\n        -- case when ord.status \u003d 1 then \u0027Mới tạo\u0027\r\n        --      when ord.status \u003d 2 then \u0027Đã xác nhận\u0027\r\n        --      when ord.status \u003d 3 then \u0027Hoàn thành\u0027\r\n        --      when ord.status \u003d 4 then \u0027Hủy\u0027\r\n        --      when ord.status \u003d 5 then \u0027Đã hoàn tiền\u0027   \r\n        -- end as order_status,\r\n\r\n        -- ord.payment_method_id,\r\n        -- ord.payment_method_status,\r\n        \r\n        -- ord.affiliate_id,  \r\n        -- ord.affiliate_email,\r\n        -- ord.affiliate_category_name,\r\n        \r\n\r\n        ord.invoice_code as order_code,\r\n        ord.status as order_status_id,\r\n        ord.payment_method_id,\r\n        ord.payment_method_status as payment_status_id,\r\n        ord.affiliate_id,\r\n        (SELECT email FROM kynaforkids-server-production.kynaforkids.user us WHERE ord.affiliate_id \u003d us.id) as affiliate_email,\r\n        (SELECT au.affiliate_category_id FROM kynaforkids-server-production.kynaforkids.affiliate_user au WHERE au.user_id \u003d ord.affiliate_id) as affiliate_category_id,\r\n        ord.utm_campaign,\r\n\r\n\r\n        ordd.package_id,\r\n        ordd.package_subscription_id,\r\n        pks.subscription_month,\r\n        pks.name as subscription_name,\r\n        pks.price as subscription_price,\r\n        pk.name as package_name,\r\n\r\n\r\n        \r\n       \r\nFROM `kynaforkids-server-production.kynaforkids.order` ord\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.order_detail` ordd ON (ord.id \u003d ordd.order_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.order_register_info` ori ON (ord.id \u003d ori.order_id)\r\nLEFT JOIN `kynaforkids.package_combo_subscription_item` pcs ON (ordd.package_subscription_id \u003d pcs.id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.package_subscriptions` pks ON (pcs.package_subscription_id \u003d pks.id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.package` pk ON (pk.id \u003d pcs.package_id)\r\n-- LEFT JOIN `kynaforkids-server-production.kynaforkids.package` pk ON (pk.id \u003d ordd.package_combo_id)\r\n\r\n\r\nWHERE \r\n      ord.invoice_code like \u0027KYNA%\u0027\r\n      AND pk.name like \u0027%AI%\u0027\r\n      AND ordd.package_combo_id is not null\r\n),\r\n\r\norder_ai_tutor AS\r\n(\r\nSELECT country_id,order_id,payment_status_id,order_status_id,lead_id,total_oc,currency_exchange_rate,affiliate_category_id,completed_at,created_at FROM order_ai_tutor_single\r\n\r\nUNION ALL\r\n\r\nSELECT country_id,order_id,payment_status_id,order_status_id,lead_id,total_oc,currency_exchange_rate,affiliate_category_id,completed_at,created_at  FROM order_ai_tutor_combo\r\n\r\n),\r\n\r\ntemp_table as \r\n(\r\n\r\nSELECT \r\n      country_id,order_id,payment_status_id,order_status_id,lead_id,total_oc,currency_exchange_rate,\r\n      (SELECT ac.name FROM `kynaforkids.affiliate_category` ac WHERE ac.id \u003d oat.affiliate_category_id) AS affiliate_category_name,\r\n      if(oat.completed_at is null, oat.created_at, oat.completed_at) as created_at,\r\nFROM order_ai_tutor oat\r\n),\r\n\r\nsingle_ai_order as (\r\nSELECT   \r\n         tt.created_at as ngay_hach_toan,\r\n        (select blv.affiliate_campaign from `kynaforkids.mkt_booking_lead_view` blv\r\n         where blv.id \u003d tt.lead_id) as utm_campaign,\r\n         tt.country_id,\r\n         tt.lead_id,\r\n\r\n         tt.total_oc,\r\n         tt.currency_exchange_rate,\r\n\r\n        --  tt.total_oc * tt.currency_exchange_rate as total_VND,\r\n         tt.order_id,\r\n         case \r\n              when tt.country_id \u003d 3 then 1\r\n              when tt.country_id \u003d 1 then \r\n                  (SELECT ce.rate FROM `kynaforkids-server-production.kynaforkids.currency_exchange_config` ce \r\n                    WHERE ce.from \u003d \u0027THB\u0027 and ce.to \u003d \u0027VND\u0027 and date(timestamp_seconds(ce.date_start)) \u003c\u003d tt.created_at and date(timestamp_seconds(ce.date_end)) \u003e\u003d tt.created_at)\r\n              when tt.country_id \u003d 2 then \r\n                  (SELECT ce.rate FROM `kynaforkids-server-production.kynaforkids.currency_exchange_config` ce \r\n                    WHERE ce.from \u003d \u0027IDR\u0027 and ce.to \u003d \u0027VND\u0027 and date(timestamp_seconds(ce.date_start)) \u003c\u003d tt.created_at and date(timestamp_seconds(ce.date_end)) \u003e\u003d tt.created_at)\r\n               when tt.country_id \u003d 5 then \r\n                  (SELECT ce.rate FROM `kynaforkids-server-production.kynaforkids.currency_exchange_config` ce \r\n                    WHERE ce.from \u003d \u0027KIP\u0027 and ce.to \u003d \u0027VND\u0027 and date(timestamp_seconds(ce.date_start)) \u003c\u003d tt.created_at and date(timestamp_seconds(ce.date_end)) \u003e\u003d tt.created_at)      \r\n         else null\r\n     end as ty_gia,\r\n\r\n      case\r\n              when aov.created_at \u003d aov.first_time_purchase_phone then \u0027New Customers\u0027\r\n              else \u0027Returning Customers\u0027\r\n      end as type_order_phone,\r\n      case\r\n              when aov.created_at \u003d aov.first_time_purchase_email then \u0027New Customers\u0027\r\n              else \u0027Returning Customers\u0027\r\n      end as type_order_email\r\nFROM temp_table tt\r\nLEFT JOIN `kynaforkids.Acc_order_video` aov ON (tt.order_id \u003d aov.id)\r\n\r\nWHERE \r\n      tt.created_at \u003e\u003d \u00272024-08-01\u0027 --and tt.created_at \u003c\u003d \u00272024-10-31\u0027\r\n      and tt.payment_status_id in (2,4,5,6)\r\n      and tt.order_status_id in (2,3)\r\n)\r\n\r\nSELECT \r\n      sao.ngay_hach_toan,\r\n      -- COUNT(distinct sao.order_id) as num_new_students_AI_single,\r\n      SUM(sao.ty_gia * sao.total_oc) as total_ai_single_order_value\r\n\r\nFROM single_ai_order sao\r\nWHERE sao.type_order_email \u003d \u0027New Customers\u0027 and sao.type_order_phone \u003d \u0027New Customers\u0027 \r\nGROUP BY sao.ngay_hach_toan       -- có thể group theo country nữa\r\nORDER BY sao.ngay_hach_toan DESC\r\n)\r\n\r\n\r\nSELECT\r\n      if(tns.ngay_hach_toan is null, ais.ngay_hach_toan, tns.ngay_hach_toan) as ngay_hach_toan,\r\n      ROUND(0.01*(if(tns.total_tutoring_order_value is null, 0, tns.total_tutoring_order_value)  + if(ais.total_ai_single_order_value is null, 0, ais.total_ai_single_order_value))) as cash_collection_cost\r\n\r\nFROM tutoring_new_students tns\r\nFULL JOIN ai_single_new_students ais ON(tns.ngay_hach_toan \u003d ais.ngay_hach_toan)  -- có thể group theo ngay hạch toán và cả country, hiện chưa làm tới mức country\r\nORDER BY ngay_hach_toan DESC\r\n\r\n\r\n\r\n;"
}, {
  "table_name": "wh_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.wh_log`\n(\n  id INT64,\n  import_id INT64,\n  export_id INT64,\n  location_id INT64,\n  export_status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "bot_page",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.bot_page`\n(\n  id INT64,\n  flow_id INT64,\n  name STRING,\n  is_default INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_teacher_leave_request",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_leave_request`\n(\n  id INT64,\n  teacher_id INT64,\n  type INT64,\n  note STRING,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  ticket_id INT64,\n  booking_teacher_contract_updating_id INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "b2b_contract",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.b2b_contract`\n(\n  code STRING,\n  name STRING,\n  description STRING,\n  file STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (code) NOT ENFORCED\n)\nCLUSTER BY code\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "quiz_input_type",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.quiz_input_type`\n(\n  id INT64,\n  name STRING,\n  image_url STRING,\n  width INT64,\n  height INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  image_toolbar STRING,\n  is_question_answer INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "my_kingdom_temp_table_2",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.kynaforkids.my_kingdom_temp_table_2`\nOPTIONS(\n  format\u003d\"CSV\",\n  uris\u003d[\"https://drive.google.com/open?id\u003d1b0dSqpVrtvZv5OnYmgyXPaJRPlHyg4A-\"]\n);"
}, {
  "table_name": "summer_camp",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.summer_camp`\n(\n  id INT64,\n  name STRING,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_tutor_session_result",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_tutor_session_result`\n(\n  id INT64,\n  session_id INT64,\n  booking_id INT64,\n  status INT64,\n  comment STRING,\n  vocabulary_point INT64,\n  vocabulary_comment STRING,\n  listening_point INT64,\n  listening_comment STRING,\n  use_of_english_point INT64,\n  use_of_english_comment STRING,\n  speaking_point INT64,\n  speaking_comment STRING,\n  pronunciation_point INT64,\n  pronunciation_comment STRING,\n  reading_and_writing_point INT64,\n  reading_and_writing_comment STRING,\n  created_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "commission_income_bd_video_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.commission_income_bd_video_view`\nAS SELECT \r\n  timestamp_seconds(o.completed_at) AS ngay_hach_toan\r\n, o.invoice_code\r\n, ci.currency_exchange_rate\r\n, o.total\r\n, ROUND(ci.total_amount + o.payment_fee) as total_amount\r\n, ROUND(ci.total_amount + o.payment_fee) * ci.currency_exchange_rate as total_amount_vnd\r\n, (\r\nCASE \r\nWHEN (o.sub_total !\u003d 0) then ((o.sub_total + (o.sub_total * o.shipping_fee) - (o.discount_amount + o.voucher_discount_amount)) * o.currency_exchange_rate)\r\nWHEN (o.sub_total\u003d0) then 0\r\nEND\r\n)  AS price_vnd\r\n,\u0027Đơn AI video\u0027 AS loai_don\r\n, (\r\nCASE \r\n  WHEN ori.user_type_id  \u003d 1 THEN \u0027Trẻ em\u0027\r\n  WHEN ori.user_type_id  \u003d 2 THEN \u0027Người lớn\u0027\r\nEND\r\n) AS loai_hoc_vien\r\n, \u0027Học viên mới\u0027 AS student_type\r\n, \u0027Ghi danh lần đầu\u0027 as payment_content\r\n, 3 as payment_content_id\r\n, (select au.affiliate_id from `kynaforkids-server-production.kynaforkids.affiliate_user` au where au.user_id \u003d o.affiliate_id ) as affiliate_id \r\n, ( SELECT au.country_id FROM `kynaforkids-server-production.kynaforkids.affiliate_user` au \r\n  WHERE au.user_id \u003d o.affiliate_id ) AS country_id\r\n,(SELECT MAX(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u, `kynaforkids-server-production.kynaforkids.affiliate_user` au \r\nWHERE au.user_id \u003d u.id AND au.user_id \u003d o.affiliate_id) as affiliate_email\r\n, (SELECT ac.name FROM `kynaforkids-server-production.kynaforkids.affiliate_category` ac, `kynaforkids-server-production.kynaforkids.affiliate_user` au \r\nWHERE  au.affiliate_category_id \u003d ac.id AND au.user_id \u003d o.affiliate_id) as loai_affiliate\r\n\r\n, (SELECT au.affiliate_category_id FROM `kynaforkids-server-production.kynaforkids.affiliate_user` au  \r\nWHERE au.user_id \u003d o.affiliate_id ) AS affiliate_category_id\r\n\r\n, `kynaforkids-server-production.kynaforkids.func_get_source_affiliate`((SELECT au.source_id FROM `kynaforkids-server-production.kynaforkids.affiliate_user` au \r\nWHERE au.user_id \u003d o.affiliate_id)) as nguon_affiliate\r\n\r\n, (SELECT au.source_id FROM `kynaforkids-server-production.kynaforkids.affiliate_user` au \r\nWHERE au.user_id \u003d o.affiliate_id) AS source_id\r\n\r\n,(SELECT MAX(u.email) from `kynaforkids-server-production.kynaforkids.user` u, `kynaforkids-server-production.kynaforkids.affiliate_user` au where au.bd_incharge_id \u003d u.id and au.user_id \u003d o.affiliate_id) as bd_incharge\r\n\r\n, \u0027Lần đầu\u0027 as lan_thanh_toan,\r\n\r\ncase\r\n    when order_status \u003d 1 then \u0027Mới tạo\u0027\r\n    when order_status \u003d 2 then \u0027Xác nhận\u0027\r\n    when order_status \u003d 3 then \u0027Hoàn thành\u0027\r\n    when order_status \u003d 4 then \u0027Hủy\u0027\r\n    when order_status \u003d 10 then \u0027Quy đổi hoa hồng\u0027\r\n    else \u0027Khác\u0027\r\nend as aff_commission_status\r\n\r\n, ci.affiliate_commission_percent as affiliate_commission_percent_bonus\r\n, ci.affiliate_commission_amount * ci.currency_exchange_rate AS hoa_hong_vnd\r\nFROM\r\n(\r\nSELECT \r\n    order_id\r\n    , MAX(affiliate_commission_percent) as affiliate_commission_percent\r\n    , MAX(currency_exchange_rate) as currency_exchange_rate\r\n    , SUM(affiliate_commission_amount) as affiliate_commission_amount\r\n    , SUM(total_amount) as total_amount\r\n    , MAX(order_status) as order_status\r\n    , COUNT(DISTINCT order_id) as total_order\r\n  FROM  `kynaforkids-server-production.kynaforkids.commission_income` GROUP BY order_id ) ci\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.order` o ON ci.order_id \u003d o.id\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.order_register_info` ori on o.id \u003d ori.order_id\r\nWHERE\r\nci.order_status in (3,10)\r\nAND o.id IN (\r\n\tSELECT \r\n\t\tod.order_id\r\n\tFROM\r\n\t\t`kynaforkids-server-production.kynaforkids.order_detail` od\r\n\tINNER JOIN\r\n\t\t`kynaforkids-server-production.kynaforkids.package` p ON p.id \u003d od.package_id\r\n\tINNER JOIN\r\n\t\t`kynaforkids-server-production.kynaforkids.package_category` pc ON pc.id \u003d p.category_id\r\n\tWHERE\r\n\t\t(`pc`.`id` \u003d 41)\r\n)\r\n-- AND (ci.affiliate_commission_amount \u003e 0)\r\n-- AND ci.order_id \u003d 688897\r\n-- AND ci.currency_exchange_rate !\u003d 1\r\nORDER BY o.id DESC\r\n\r\n\r\n;"
}, {
  "table_name": "offline_event_student_result_rating",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.offline_event_student_result_rating`\n(\n  id INT64,\n  offline_event_student_result_id INT64,\n  template_id INT64,\n  content STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  is_visible INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_student_program_lesson_action",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_program_lesson_action`\n(\n  id INT64,\n  booking_student_program_lesson_id INT64,\n  action STRING,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ceo_cac_general_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.ceo_cac_general_view`\nAS with \r\n-- new students bao gồm HV mới học Tutoring (từ đơn hoàn thành của booking_order) và HV mới mua lẻ AI Tutor (từ đơn hoàn thành của order)\r\n-- HV mới Tutoring check theo mã KE/student_id rồi tới số phone \r\n-- HV mới mua lẻ AI Tutor check theo số phone, email\r\n-- Bảng đang làm hiện chỉ group theo ngày hạch toán (có thể group theo cả sản phẩm và quốc gia)\r\nnew_students as\r\n(\r\nselect \r\n      FORMAT_DATE(\u0027%Y-%m\u0027, nst.ngay_hach_toan) AS year_month,\r\n      sum(nst.num_new_students_AI_single) as num_new_students_AI_single,\r\n      sum(nst.num_new_students_tutoring) as num_new_students_tutoring,\r\n      sum(nst.total_new_students) as total_new_students\r\nfrom `kynaforkids.ceo_cac_num_new_students_view` nst\r\nwhere FORMAT_DATE(\u0027%Y-%m\u0027, nst.ngay_hach_toan) \u003c\u003d FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE())\r\ngroup by year_month\r\n),\r\n\r\n-- affiliate cost bao gồm cost commission phát sinh cho HV mới Tutoring (1-1, Group, Class) hoặc cost commission phát sinh  khi HV mua lẻ AI Tutor\r\n-- có thể chia theo Tutoring hoặc mua lẻ AI Tutor\r\n-- có thể chia theo country học viên. Phần affiliate cost cho Tutoring chỉ có trên thị trường VN.\r\naffiliate_cost as \r\n(\r\nselect \r\n      FORMAT_DATE(\u0027%Y-%m\u0027, afc.ngay_hach_toan) AS year_month,\r\n      sum(afc.affiliate_cost) as affiliate_cost,\r\nfrom `kynaforkids-server-production.kynaforkids.ceo_cac_affiliate_referral_cost_view` afc\r\nwhere FORMAT_DATE(\u0027%Y-%m\u0027, afc.ngay_hach_toan) \u003c\u003d FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE())\r\ngroup by year_month\r\n\r\n),\r\n\r\n-- digital marketing cost là chi phí có thuế của việc chạy QC mkt trên các kênh QC hàng ngày.\r\n-- có thể chia theo Tutoring (not AI Tutor) hoặc AI Tutor\r\n-- có thể chia theo thị trường chạy QC xem như là country học viên\r\ndigital_mkt_cost as\r\n(\r\nselect\r\n      FORMAT_DATE(\u0027%Y-%m\u0027, dmkt.date_spend) AS year_month,\r\n      SUM(dmkt.spend_with_tax) as dmkt_cost,\r\n\r\nfrom `kynaforkids-server-production.kynaforkids.ceo_cac_digital_mkt_spending_view` dmkt\r\nwhere FORMAT_DATE(\u0027%Y-%m\u0027, dmkt.date_spend) \u003c\u003d FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE())\r\ngroup by year_month\r\n),\r\n\r\ntest_cost as\r\n(\r\nselect\r\n      ptc.year_month,\r\n      -- ptc.calc_ctv_month_cost as pt_ctv_cost,\r\n      (ptc.calc_month_adjustment + ptc.tester_booking_cost) as pt_tester_cost,\r\n      -- ptc.total_test_cost,\r\nfrom `kynaforkids-server-production.kynaforkids.ceo_cac_tester_cost_view` ptc\r\nwhere ptc.year_month \u003c\u003d FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE())\r\n),\r\n\r\nsale_fixed_cost as (\r\nselect \r\n      sfc1.year_month,\r\n      ROUND(0.6*sfc1.fixedSaleSalary) as fixedSaleSalary,\r\nfrom `kynaforkids.ceo_cac_sale_fixed_cost_view` sfc1\r\nWHERE sfc1.year_month \u003c\u003d FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE())\r\n),\r\n\r\nsale_cost as\r\n(\r\nselect\r\n      sbc.year_month, \r\n      sbc.sale_bonus_vnd + sfc.fixedSaleSalary as sale_all_cost\r\n\r\nfrom `kynaforkids-server-production.kynaforkids.ceo_cac_sale_commission_bonus_new_students_view` sbc\r\nleft join sale_fixed_cost sfc using(year_month)\r\n),\r\n\r\n-- trial_booking_cost_temp as (\r\n-- select      \r\n--             ym.year_month,\r\n--             tbc.teacher_cost_hoc_thu            \r\n-- from `kynaforkids.ceo_cac_trial_booking_cost_view` tbc\r\n-- full join `kynaforkids-server-production.kynaforkids.cac_year_month_table` ym using(year_month)\r\n-- where ym.year_month \u003c\u003d FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE())\r\n-- order by year_month desc\r\n-- ),\r\n\r\n\r\n-- trial_booking_cost as\r\n-- (\r\n-- select\r\n--       tbc1.year_month,\r\n--       IF(NOT(tbc1.year_month \u003d FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE())),\r\n--                               tbc1.teacher_cost_hoc_thu,\r\n--                               ROUND(EXTRACT(DAY FROM CURRENT_DATE()) / EXTRACT(DAY FROM LAST_DAY(CURRENT_DATE())) * tbc2.teacher_cost_hoc_thu)) as teacher_cost_hoc_thu,   \r\n\r\n-- from trial_booking_cost_temp tbc1 \r\n-- LEFT JOIN\r\n--     trial_booking_cost_temp tbc2 \r\n--  ON\r\n--     (CAST(SUBSTRING(tbc1.year_month, 1, 4) AS INT) * 12 + CAST(SUBSTRING(tbc1.year_month, 6, 2) AS INT)) - 1 \u003d\r\n--         (CAST(SUBSTRING(tbc2.year_month, 1, 4) AS INT) * 12 + CAST(SUBSTRING(tbc2.year_month, 6, 2) AS INT))\r\n-- ),\r\n\r\ntrial_booking_cost as (\r\nselect      \r\n            tbc.year_month,\r\n            tbc.teacher_cost_hoc_thu            \r\nfrom `kynaforkids.ceo_cac_trial_booking_cost_view` tbc\r\nwhere tbc.year_month \u003c\u003d FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE())\r\norder by year_month desc\r\n),\r\n\r\ncash_collection_cost as \r\n(\r\nselect\r\n      FORMAT_DATE(\u0027%Y-%m\u0027, ccc.ngay_hach_toan) as year_month,\r\n      sum(ccc.cash_collection_cost) as cash_collection_cost,\r\n      \r\nfrom `kynaforkids.ceo_cac_cost_thu_ho_cash_collection_view` ccc\r\nwhere FORMAT_DATE(\u0027%Y-%m\u0027, ccc.ngay_hach_toan) \u003c\u003d FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE())\r\ngroup by year_month\r\n),\r\n\r\nother_cost as \r\n(\r\nselect\r\n      FORMAT_DATE(\u0027%Y-%m\u0027, oc.ngay_hach_toan) as year_month,\r\n      sum(oc.other_cost) as other_cost,\r\n      \r\nfrom `kynaforkids.ceo_cac_other_cost_view` oc\r\nwhere FORMAT_DATE(\u0027%Y-%m\u0027, oc.ngay_hach_toan) \u003c\u003d FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE())\r\ngroup by year_month\r\n\r\n) \r\n\r\n\r\nselect \r\n      nst.*,\r\n      afc.* EXCEPT(year_month),\r\n      dmkt.* EXCEPT(year_month),\r\n      sc.* EXCEPT(year_month),\r\n      ptc.* EXCEPT(year_month),\r\n      tbc.* EXCEPT(year_month),\r\n      ccc.* EXCEPT(year_month),\r\n      oc.* EXCEPT(year_month),\r\n      \r\n      ROUND(afc.affiliate_cost + ptc.pt_tester_cost + dmkt.dmkt_cost + sc.sale_all_cost + tbc.teacher_cost_hoc_thu + ccc.cash_collection_cost + oc.other_cost) as all_cost,\r\n      ROUND((afc.affiliate_cost + ptc.pt_tester_cost + dmkt.dmkt_cost + sc.sale_all_cost + tbc.teacher_cost_hoc_thu + ccc.cash_collection_cost + oc.other_cost)/nst.total_new_students) as cac_general\r\n\r\nfrom  new_students nst \r\nleft join test_cost ptc on (nst.year_month \u003d ptc.year_month)\r\nleft join sale_cost sc on (nst.year_month \u003d sc.year_month)\r\nleft join digital_mkt_cost dmkt on (dmkt.year_month \u003d nst.year_month)\r\nleft join affiliate_cost afc on (afc.year_month \u003d nst.year_month)\r\nleft join trial_booking_cost tbc on (nst.year_month \u003d tbc.year_month)\r\nleft join cash_collection_cost ccc on (nst.year_month \u003d ccc.year_month)\r\nleft join other_cost oc on (nst.year_month \u003d oc.year_month)\r\norder by year_month desc;"
}, {
  "table_name": "booking_commission_db_tutoring",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.booking_commission_db_tutoring`\nAS SELECT \r\n  bo.accounting_date AS ngay_hach_toan\r\n, bo.invoice_code\r\n, bo.currency_exchange_rate\r\n, bo.total\r\n, bc.total_amount\r\n, bc.total_amount * bo.currency_exchange_rate as total_amount_vnd\r\n, ((bo.total - IF(bo.discount_money IS NULL, 0, bo.discount_money)) * bo.currency_exchange_rate)  AS price_vnd\r\n,(\r\nCASE\r\n  WHEN bo.program_type \u003d 1 THEN \"Đơn 1 kèm 1\"\r\n  WHEN bo.program_type \u003d 2 THEN \"Đơn AI kèm Group Talk\"\r\nEND\r\n) AS loai_don\r\n, (\r\nCASE \r\n  WHEN bo.user_type_id \u003d 1 THEN \u0027Trẻ em\u0027\r\n  WHEN bo.user_type_id \u003d 2 THEN \u0027Người lớn\u0027\r\nEND\r\n) AS loai_hoc_vien\r\n, (\r\nCASE\r\n  WHEN bo.student_type \u003d 1 THEN \u0027Học viên mới\u0027\r\n  WHEN bo.student_type \u003d 2 THEN \u0027Học viên cũ\u0027\r\nEND\r\n) AS student_type\r\n, `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(bo.payment_content) AS payment_content\r\n, bo.payment_content as payment_content_id\r\n, bc.affiliate_id as affiliate_id \r\n, ( SELECT au.country_id FROM `kynaforkids-server-production.kynaforkids.affiliate_user` au \r\n  WHERE au.affiliate_id \u003d CAST(bc.affiliate_id AS INT64) ) AS country_id\r\n,(SELECT MAX(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u, `kynaforkids-server-production.kynaforkids.affiliate_user` au WHERE au.user_id \u003d u.id AND au.affiliate_id \u003d CAST(bc.affiliate_id AS INT64)) as affiliate_email\r\n\r\n, (SELECT ac.name FROM `kynaforkids-server-production.kynaforkids.affiliate_category` ac, `kynaforkids-server-production.kynaforkids.affiliate_user` au WHERE CAST(bc.affiliate_id AS INT64) \u003d au.affiliate_id AND au.affiliate_category_id \u003d ac.id) as loai_affiliate\r\n\r\n, (SELECT au.affiliate_category_id FROM `kynaforkids-server-production.kynaforkids.affiliate_user` au  WHERE CAST(bc.affiliate_id AS INT64) \u003d au.affiliate_id ) AS affiliate_category_id\r\n\r\n, `kynaforkids-server-production.kynaforkids.func_get_source_affiliate`((SELECT au.source_id FROM `kynaforkids-server-production.kynaforkids.affiliate_user` au \r\nWHERE CAST(bc.affiliate_id AS INT64) \u003d au.affiliate_id)) as nguon_affiliate\r\n\r\n, (SELECT au.source_id FROM `kynaforkids-server-production.kynaforkids.affiliate_user` au \r\nWHERE CAST(bc.affiliate_id AS INT64) \u003d au.affiliate_id) AS source_id\r\n\r\n,(SELECT MAX(u.email) from `kynaforkids-server-production.kynaforkids.user` u, `kynaforkids-server-production.kynaforkids.affiliate_user` au where au.bd_incharge_id \u003d u.id and au.affiliate_id \u003d cast(bc.affiliate_id as INT64)) as bd_incharge\r\n, (\r\nSELECT \r\n  ( CASE\r\n    WHEN bacc.payment_count \u003d 1 THEN \u0027Lần đầu\u0027\r\n    WHEN bacc.payment_count \u003d 2 THEN \u0027Lần sau\u0027\r\n    ELSE NULL\r\n  END ) as lan_thanh_toan\r\nFROM `kynaforkids-server-production.kynaforkids.booking_affiliate_commission_config` bacc\r\nWHERE bacc.id \u003d bc.affiliate_commission_config_id\r\n) as lan_thanh_toan\r\n, bc.affiliate_commission_percent_bonus\r\n, bc.affiliate_commission_amount_bonus * bc.currency_exchange_rate AS hoa_hong_vnd\r\nFROM `kynaforkids-server-production.kynaforkids.booking_commission` bc \r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_order` bo ON bo.id \u003d bc.order_id\r\nWHERE\r\nCAST(bc.affiliate_id AS INT64) \u003e 0 and bc.status \u003d 3\r\n-- AND (DATE(bo.accounting_date) \u003e\u003d \u00272024-11-01\u0027 AND DATE(bo.accounting_date) \u003c\u003d \u00272024-11-30\u0027)\r\n--  AND bc.order_id \u003d 115826\r\n-- AND (DATE(bo.accounting_date) \u003e\u003d PARSE_DATE(\u0027%Y%m%d\u0027, @DS_START_DATE) AND DATE(bo.accounting_date) \u003c\u003d PARSE_DATE(\u0027%Y%m%d\u0027, @DS_END_DATE))\r\n  -- and bc.order_id is not null\r\nORDER BY bc.affiliate_id;"
}, {
  "table_name": "regions",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.regions`\n(\n  id INT64,\n  country_id INT64,\n  name STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "b2b_student_comment",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.b2b_student_comment`\n(\n  id INT64,\n  type INT64,\n  student_id INT64,\n  test_at INT64,\n  result STRING,\n  level_id INT64,\n  program_id INT64,\n  is_passed INT64,\n  performer INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "autocall_call_student_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.autocall_call_student_log`\n(\n  phone_number STRING,\n  booking_session_begin_at INT64,\n  user_id INT64,\n  booking_session_id INT64,\n  call_result INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  call_result_status STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (booking_session_begin_at, phone_number) NOT ENFORCED\n)\nCLUSTER BY booking_session_begin_at, phone_number\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "game_type",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.game_type`\n(\n  id INT64,\n  name STRING,\n  timeout_time INT64,\n  thumbnail STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "summer_camp_lesson_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.summer_camp_lesson_config`\n(\n  id INT64,\n  camp_id INT64,\n  lesson_id INT64,\n  group_id INT64,\n  stage_id INT64,\n  point INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "coo_students_booking_control_2024_mapped",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.coo_students_booking_control_2024_mapped`\n(\n  user_id INT64,\n  student_code STRING,\n  student_name STRING,\n  cancelled_by_KBC INT64\n);"
}, {
  "table_name": "partner_box_card_item",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.partner_box_card_item`\n(\n  id INT64,\n  partner_box_card_id INT64,\n  partner_box_card_package_id INT64,\n  status INT64,\n  serial_code STRING,\n  active_code STRING,\n  active_date INT64,\n  used_date INT64,\n  expiry_date INT64,\n  user_id INT64,\n  phone_number STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  price NUMERIC(13, 2),\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_session_student_rating",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_session_student_rating`\n(\n  id INT64,\n  booking_session_id INT64,\n  student_id INT64,\n  lecture_content INT64,\n  system INT64,\n  lecturers INT64,\n  customer_care INT64,\n  student_rating_comment STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "summer_camp_student_share_template",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.summer_camp_student_share_template`\n(\n  id INT64,\n  camp_id INT64,\n  type INT64,\n  template STRING,\n  media_url STRING,\n  landing_page STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_tutor_session",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_tutor_session`\n(\n  id INT64,\n  children_id INT64,\n  booking_id INT64,\n  mode INT64,\n  lesson_id INT64,\n  data STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "affiliate_category_package",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.affiliate_category_package`\n(\n  package_id INT64,\n  affiliate_category_id INT64,\n  affiliate_commission_percent INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n);"
}, {
  "table_name": "qc_booking_test_action",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.qc_booking_test_action`\n(\n  id INT64,\n  booking_session_id INT64,\n  type INT64,\n  note STRING,\n  data STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "summer_camp_award",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.summer_camp_award`\n(\n  id INT64,\n  camp_id INT64,\n  summer_camp_stage_id INT64,\n  award_level INT64,\n  award_name STRING,\n  award_quantity INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  image_link STRING,\n  group_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_document_lesson",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_document_lesson`\n(\n  lesson_id INT64,\n  document_id INT64,\n  wiziq_content_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (document_id, lesson_id) NOT ENFORCED\n)\nCLUSTER BY document_id, lesson_id;"
}, {
  "table_name": "kpi_lead",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.kynaforkids.kpi_lead`\nOPTIONS(\n  sheet_range\u003d\"KPI Lead!A:C\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/1bhGn1N9A7G5g8AF9tWuYtiL_kcKsU0Zqqj-MYpq1i2Y/edit?gid\u003d1831233391#gid\u003d1831233391\"]\n);"
}, {
  "table_name": "booking_level",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_level`\n(\n  id INT64,\n  name STRING,\n  `order` INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  next_level_id INT64,\n  total_extra_lesson INT64,\n  program_id INT64,\n  mapping_order_index INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  difficulty_level INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_document_bk",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_document_bk`\n(\n  id INT64,\n  document_name STRING,\n  path STRING,\n  type STRING,\n  extension STRING,\n  program_id INT64,\n  `order` INT64,\n  visible INT64,\n  is_show_teacher INT64,\n  is_show_learning INT64,\n  pdf_total_page INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "wh_inventory",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.wh_inventory`\n(\n  import_id INT64,\n  product_id INT64,\n  location_id INT64,\n  amount_per_unit NUMERIC(15, 2),\n  price_adjusted NUMERIC(15, 2),\n  price_adjustment_type INT64,\n  total_quantity INT64,\n  remain_quantity INT64,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (import_id, product_id, location_id) NOT ENFORCED\n)\nCLUSTER BY import_id, product_id, location_id;"
}, {
  "table_name": "alita_check",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.kynaforkids.alita_check`\nOPTIONS(\n  sheet_range\u003d\"\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/17HjEwX_6lnjOa1hqy0cPMH131Xxp6nlPYJuwWY5FZpo/edit?gid\u003d0#gid\u003d0\"]\n);"
}, {
  "table_name": "Order_Tutoring",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.Order_Tutoring`\n(\n  Date STRING,\n  Order_Code STRING,\n  Payment_Content STRING,\n  Source STRING,\n  Original_Price FLOAT64,\n  Ex FLOAT64,\n  Market STRING,\n  Code_Contract STRING\n);"
}, {
  "table_name": "affiliate_lead",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.affiliate_lead`\n(\n  id INT64,\n  name STRING,\n  email STRING,\n  phone_number STRING,\n  source_id INT64,\n  country_id INT64,\n  bd_incharge_id INT64,\n  status INT64,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  status_updated_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ceo_cac_num_new_students_weekly_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.ceo_cac_num_new_students_weekly_view`\nAS WITH \r\n-- Base CTE for collecting order information with simplified selection criteria\r\norder_info AS (\r\n  SELECT \r\n      COALESCE(bo.accounting_date, bo.created_at) AS accounting_date,\r\n      (SELECT created_at\r\n       FROM `kynaforkids-server-production.kynaforkids.booking_lead`\r\n       WHERE id \u003d bo.lead_id) AS ngay_tao_lead,\r\n      bo.student_code,\r\n      bo.student_id,\r\n      bo.phone_number,\r\n      bo.id as order_id,\r\n      bo.international_country_id,\r\n      COALESCE(bo.total_video_course, 0) AS total_video_course,\r\n      bo.total,\r\n      `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(CAST(bo.payment_content AS INT64)) AS noi_dung_thanh_toan,\r\n      `kynaforkids-server-production.kynaforkids.func_get_source`(bo.source) AS source,\r\n      `kynaforkids-server-production.kynaforkids.func_get_program_name_from_id`(bo.program_id) AS program,\r\n      bo.program_type,\r\n      `kynaforkids-server-production.kynaforkids.func_get_booking_order_status`(bo.status) AS order_status,\r\n      CASE \r\n          WHEN bo.payment_status \u003d 0 THEN \u0027Chưa duyệt\u0027 \r\n          WHEN bo.payment_status \u003d 1 THEN \u0027Đã duyệt\u0027 \r\n          WHEN bo.payment_status \u003d 2 THEN \u0027Không duyệt\u0027 \r\n          WHEN bo.payment_status \u003d 3 THEN \u0027Cần điều chỉnh\u0027 \r\n          WHEN bo.payment_status \u003d 4 THEN \u0027Đã điều chỉnh\u0027 \r\n          ELSE \u0027Khác\u0027 \r\n      END AS payment_status,\r\n      COALESCE(bo.total, 0) - COALESCE(bo.discount_money, 0) AS price,\r\n      bo.lead_id,\r\n      bo.currency_exchange_rate,\r\n      `kynaforkids-server-production.kynaforkids.func_get_country`(bo.international_country_id) AS country,\r\n      bo.order_type,\r\n      bo.order_type_sub\r\n  FROM `kynaforkids-server-production.kynaforkids.booking_order_view` bo\r\n  LEFT JOIN `kynaforkids-server-production.kynaforkids.booking_lead` bll \r\n      ON bll.id \u003d bo.lead_id\r\n  WHERE bo.program_type \u003d 1\r\n    AND bo.order_type \u003d 1\r\n    AND COALESCE(bo.total_video_course, 0) + COALESCE(bo.total, 0) \u003e 0\r\n),\r\n\r\n-- Consolidated temp table with dynamic filter conditions based on current month vs previous months\r\ntutoring_orders AS (\r\n  SELECT \r\n      t1.order_id,\r\n      t1.order_type,\r\n      t1.order_type_sub,\r\n      t1.accounting_date,\r\n      t1.phone_number,\r\n      t1.international_country_id as country_id,\r\n      t1.total_video_course,\r\n      t1.total,\r\n      t1.noi_dung_thanh_toan,\r\n      t1.source,\r\n      t1.program,\r\n      t1.program_type,\r\n      t1.order_status,\r\n      t1.payment_status,\r\n      t1.country,\r\n      t1.student_id,\r\n      t1.student_code,\r\n      -- Count previous orders by same student\r\n      (\r\n        SELECT COUNT(DISTINCT bo.order_id) \r\n        FROM order_info bo \r\n        WHERE (bo.student_id \u003d t1.student_id OR bo.student_code \u003d t1.student_code) and (t1.student_code is not null or t1.student_id is not null) and (t1.student_code !\u003d \u0027\u0027) \r\n          AND bo.payment_status \u003d \u0027Đã duyệt\u0027  \r\n          AND bo.order_status \u003d \u0027Hoàn thành\u0027 \r\n          AND bo.noi_dung_thanh_toan IN (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n          AND DATE(bo.accounting_date) \u003c DATE(t1.accounting_date)\r\n      ) as num_completed_orders_same_student,\r\n      -- Count previous orders by same phone number\r\n      (\r\n        SELECT COUNT(DISTINCT bo.order_id) \r\n        FROM order_info bo \r\n        WHERE RIGHT(bo.phone_number, 9) \u003d RIGHT(t1.phone_number, 9) \r\n          AND bo.payment_status \u003d \u0027Đã duyệt\u0027 \r\n          AND bo.order_status \u003d \u0027Hoàn thành\u0027 \r\n          AND bo.noi_dung_thanh_toan IN (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n          AND DATE(bo.accounting_date) \u003c DATE(t1.accounting_date)\r\n      ) as num_completed_orders_same_phone,\r\n      -- Flag for current month to apply different filtering logic\r\n      FORMAT_DATE(\u0027%Y-%m\u0027, t1.accounting_date) \u003d FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE()) AS is_current_month\r\n  FROM order_info t1\r\n  WHERE t1.accounting_date \u003e\u003d \u00272020-01-01\u0027 \r\n    AND (\r\n        -- Current month conditions (more lenient)\r\n        (FORMAT_DATE(\u0027%Y-%m\u0027, t1.accounting_date) \u003e\u003d FORMAT_DATE(\u0027%Y-%m\u0027, date_sub(CURRENT_DATE(),interval 8 day))\r\n         AND t1.payment_status IN (\u0027Đã duyệt\u0027, \u0027Chưa duyệt\u0027, \u0027Cần điều chỉnh\u0027) \r\n         AND t1.order_status IN (\u0027Hoàn thành\u0027, \u0027Chờ xác nhận thanh toán\u0027))\r\n        OR\r\n        -- Past months conditions (more strict)\r\n        (FORMAT_DATE(\u0027%Y-%m\u0027, t1.accounting_date) \u003c FORMAT_DATE(\u0027%Y-%m\u0027, date_sub(CURRENT_DATE(),interval 8 day))\r\n         AND t1.payment_status \u003d \u0027Đã duyệt\u0027\r\n         AND t1.order_status \u003d \u0027Hoàn thành\u0027)\r\n    )\r\n    AND t1.noi_dung_thanh_toan IN (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n    AND (t1.price + t1.total_video_course) \u003e 0\r\n),\r\n\r\n-- Identify whether students are new or returning\r\nstudent_classification AS (\r\n  SELECT \r\n      *,\r\n      CASE \r\n          WHEN NOT(student_id IS NULL AND student_code IS NULL) THEN\r\n              IF(num_completed_orders_same_student \u003e 0, \u0027Học viên cũ\u0027, \u0027Học viên mới\u0027)\r\n          ELSE\r\n              IF(num_completed_orders_same_phone \u003e 0, \u0027có order cùng phone chưa rõ HV cũ/mới\u0027, \u0027Học viên mới\u0027)\r\n      END AS old_new_student\r\n  FROM tutoring_orders\r\n),\r\n\r\n-- Aggregate tutoring data by month\r\ntutoring_new_students AS (\r\n  SELECT \r\n      FORMAT_DATE(\u0027%Y-%m-%d\u0027, DATE_TRUNC(DATE(accounting_date), WEEK(MONDAY))) AS year_week,\r\n      COUNT(*) AS num_all_students_tutoring,\r\n      COUNTIF(old_new_student \u003d \u0027Học viên mới\u0027) AS num_new_students_tutoring\r\n  FROM student_classification\r\n  GROUP BY year_week\r\n),\r\n\r\n-- AI Tutor Single Package Orders\r\norder_ai_tutor_single AS (\r\n  SELECT \r\n      ord.id AS order_id,\r\n      DATE(IF(ord.completed_at IS NULL, ord.created_at, ord.completed_at)) AS accounting_date,\r\n      ord.country_id,\r\n      `kynaforkids-server-production.kynaforkids.func_get_country`(ord.country_id) AS country,\r\n      ord.currency_exchange_rate,\r\n      ord.total AS total_oc,\r\n      ori.phone_number AS order_phone_number,\r\n      ori.email AS order_email,\r\n      ord.invoice_code AS order_code,\r\n      ord.status AS order_status_id,\r\n      ord.payment_method_id,\r\n      ord.payment_method_status AS payment_status_id,\r\n      ordd.package_id,\r\n      ordd.package_subscription_id,\r\n      pks.subscription_month,\r\n      pks.name AS subscription_name,\r\n      pks.price AS subscription_price,\r\n      pk.name AS package_name,\r\n      CASE\r\n          WHEN aov.created_at \u003d aov.first_time_purchase_email \r\n               AND aov.created_at \u003d aov.first_time_purchase_phone \r\n          THEN \u0027New Customers\u0027\r\n          ELSE \u0027Returning Customers\u0027\r\n      END AS customer_type\r\n  FROM `kynaforkids-server-production.kynaforkids.order_view` ord\r\n  LEFT JOIN `kynaforkids-server-production.kynaforkids.order_detail` ordd \r\n      ON ord.id \u003d ordd.order_id\r\n  LEFT JOIN `kynaforkids-server-production.kynaforkids.order_register_info` ori \r\n      ON ord.id \u003d ori.order_id\r\n  LEFT JOIN `kynaforkids-server-production.kynaforkids.package_subscriptions` pks \r\n      ON ordd.package_subscription_id \u003d pks.id\r\n  LEFT JOIN `kynaforkids-server-production.kynaforkids.package` pk \r\n      ON pk.id \u003d ordd.package_id\r\n  LEFT JOIN `kynaforkids.Acc_order_video` aov \r\n      ON ord.id \u003d aov.id\r\n  WHERE (ord.invoice_code LIKE \u0027KYNA%\u0027 OR ord.invoice_code LIKE \u0027GRAI%\u0027)\r\n    AND pk.name LIKE \u0027%AI Tutor%\u0027\r\n    AND ordd.package_combo_id IS NULL\r\n    AND ord.payment_method_status \u003d 2\r\n    AND ord.status \u003d 3\r\n    AND DATE(IF(ord.completed_at IS NULL, ord.created_at, ord.completed_at)) \u003e\u003d \u00272024-08-01\u0027\r\n),\r\n\r\n-- AI Tutor Combo Package Orders\r\norder_ai_tutor_combo AS (\r\n  SELECT \r\n      ord.id AS order_id,\r\n      DATE(IF(ord.completed_at IS NULL, ord.created_at, ord.completed_at)) AS accounting_date,\r\n      ord.country_id,\r\n      `kynaforkids-server-production.kynaforkids.func_get_country`(ord.country_id) AS country,\r\n      ord.currency_exchange_rate,\r\n      ord.total AS total_oc,\r\n      ori.phone_number AS order_phone_number,\r\n      ori.email AS order_email,\r\n      ord.invoice_code AS order_code,\r\n      ord.status AS order_status_id,\r\n      ord.payment_method_id,\r\n      ord.payment_method_status AS payment_status_id,\r\n      ordd.package_id,\r\n      ordd.package_subscription_id,\r\n      pks.subscription_month,\r\n      pks.name AS subscription_name,\r\n      pks.price AS subscription_price,\r\n      pk.name AS package_name,\r\n      CASE\r\n          WHEN aov.created_at \u003d aov.first_time_purchase_email \r\n               AND aov.created_at \u003d aov.first_time_purchase_phone \r\n          THEN \u0027New Customers\u0027\r\n          ELSE \u0027Returning Customers\u0027\r\n      END AS customer_type\r\n  FROM `kynaforkids-server-production.kynaforkids.order_view` ord\r\n  LEFT JOIN `kynaforkids-server-production.kynaforkids.order_detail` ordd \r\n      ON ord.id \u003d ordd.order_id\r\n  LEFT JOIN `kynaforkids-server-production.kynaforkids.order_register_info` ori \r\n      ON ord.id \u003d ori.order_id\r\n  LEFT JOIN `kynaforkids.package_combo_subscription_item` pcs \r\n      ON ordd.package_subscription_id \u003d pcs.id\r\n  LEFT JOIN `kynaforkids-server-production.kynaforkids.package_subscriptions` pks \r\n      ON pcs.package_subscription_id \u003d pks.id\r\n  LEFT JOIN `kynaforkids-server-production.kynaforkids.package` pk \r\n      ON pk.id \u003d pcs.package_id\r\n  LEFT JOIN `kynaforkids.Acc_order_video` aov \r\n      ON ord.id \u003d aov.id\r\n  WHERE (ord.invoice_code LIKE \u0027KYNA%\u0027 OR ord.invoice_code LIKE \u0027GRAI%\u0027)\r\n    AND pk.name LIKE \u0027%AI%\u0027\r\n    AND ordd.package_combo_id IS NOT NULL\r\n    AND ord.payment_method_status \u003d 2\r\n    AND ord.status \u003d 3\r\n    AND DATE(IF(ord.completed_at IS NULL, ord.created_at, ord.completed_at)) \u003e\u003d \u00272024-08-01\u0027\r\n),\r\n\r\n-- Combine single and combo AI tutor orders\r\nai_students AS (\r\n  SELECT * FROM order_ai_tutor_single\r\n  UNION ALL\r\n  SELECT * FROM order_ai_tutor_combo\r\n),\r\n\r\n-- Aggregate AI data by month\r\nai_single_new_students AS (\r\n  SELECT \r\n      FORMAT_DATE(\u0027%Y-%m-%d\u0027, DATE_TRUNC(DATE(accounting_date), WEEK(MONDAY))) AS year_week,\r\n      COUNT(DISTINCT IF(customer_type \u003d \u0027New Customers\u0027, order_id, NULL)) AS num_new_students_AI_single,\r\n      COUNT(DISTINCT order_id) AS num_all_students_AI_single\r\n  FROM ai_students\r\n  GROUP BY year_week\r\n)\r\n\r\n-- Final result combining tutoring and AI student data\r\nSELECT\r\n    COALESCE(tns.year_week, ais.year_week) AS year_week,\r\n    COALESCE(tns.num_new_students_tutoring, 0) AS num_new_students_tutoring,\r\n    COALESCE(ais.num_new_students_AI_single, 0) AS num_new_students_AI_single,\r\n    COALESCE(tns.num_new_students_tutoring, 0) + COALESCE(ais.num_new_students_AI_single, 0) AS total_new_students,\r\n    COALESCE(tns.num_all_students_tutoring, 0) AS num_all_students_tutoring,\r\n    COALESCE(ais.num_all_students_AI_single, 0) AS num_all_students_AI_single,\r\n    COALESCE(tns.num_all_students_tutoring, 0) + COALESCE(ais.num_all_students_AI_single, 0) AS num_all_students,\r\n    ROUND(\r\n        (COALESCE(tns.num_new_students_tutoring, 0) + COALESCE(ais.num_new_students_AI_single, 0)) / \r\n        NULLIF((COALESCE(tns.num_all_students_tutoring, 0) + COALESCE(ais.num_all_students_AI_single, 0)), 0),\r\n        4\r\n    ) AS rate_new\r\nFROM tutoring_new_students tns\r\nFULL JOIN ai_single_new_students ais \r\n    ON tns.year_week \u003d ais.year_week\r\n-- WHERE tns.year_week \u003d FORMAT_DATE(\u0027%Y-%m\u0027, current_date())\r\nORDER BY year_week DESC;\r\n\r\n;"
}, {
  "table_name": "ceo_cac_tester_other_adjustment",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ceo_cac_tester_other_adjustment`\n(\n  year_month STRING,\n  year INT64,\n  month INT64,\n  test_other_adjustment INT64,\n  Note STRING\n);"
}, {
  "table_name": "booking_package_subscription_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_package_subscription_config`\n(\n  id INT64,\n  package_subscription_id INT64,\n  price NUMERIC(15, 2),\n  currency STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  is_sell INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "mkt_booking_lead_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.mkt_booking_lead_view`\nAS WITH bl_info AS\r\n(    SELECT   bl.id,\r\n\r\n          -- (SELECT MAX(u.email)\r\n          -- FROM `kynaforkids-server-production.kynaforkids.kynaforkids_user` u\r\n          -- WHERE u.id \u003d bl.sale_id) AS sale_email,\r\n\r\n               `kynaforkids-server-production.kynaforkids.func_get_email_from_kynaforkids_user`(bl.sale_id) AS sale_email,\r\n\r\n          -- (SELECT u.email\r\n          -- FROM `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr` ts,\r\n          --      `kynaforkids-server-production.kynaforkids.kynaforkids_user` u\r\n          -- WHERE bl.sale_id \u003d ts.telesales_id\r\n          -- AND u.id \u003d ts.telesales_supervisor_id) AS sup_sale_email,\r\n\r\n          -- bl.name AS parent_name,\r\n          -- bl.children_name,\r\n          -- bl.email,\r\n          -- bl.phone_number AS phone_number,\r\n          -- bl.address,\r\n          bl.country_id,\r\n\r\n          -- (SELECT location.name\r\n          -- FROM `kynaforkids-server-production.kynaforkids.location` LOCATION\r\n          -- WHERE bl.location_id \u003d location.id) AS tinh_thanh_pho,\r\n          --      bl.quiz_score,\r\n     \r\n          IF (bl.actual_utm_campaign IS NULL,\r\n                                   bl.utm_campaign,\r\n                                   bl.actual_utm_campaign) AS affiliate_campaign,\r\n\r\n          -- IF (bl.actual_affiliate_id IS NULL,\r\n          --     (SELECT MAX(u.email)\r\n          --      FROM `kynaforkids-server-production.kynaforkids.affiliate_user` au,\r\n          --           `kynaforkids-server-production.kynaforkids.kynaforkids_user` u\r\n          --      WHERE au.affiliate_id \u003d bl.affiliate_id\r\n          --        AND au.user_id\u003du.id),\r\n          --     (SELECT MAX(u.email)\r\n          --      FROM `kynaforkids-server-production.kynaforkids.affiliate_user` au,\r\n          --           `kynaforkids-server-production.kynaforkids.kynaforkids_user` u\r\n          --      WHERE au.affiliate_id \u003d bl.actual_affiliate_id\r\n          --        AND au.user_id\u003du.id)) AS affiliate_email,\r\n               \r\n          --  IF (bl.actual_affiliate_id IS NULL,\r\n          --        (SELECT MAX(u.email)\r\n          --         FROM `kynaforkids-server-production.kynaforkids.affiliate_user` au,\r\n          --              `kynaforkids-server-production.kynaforkids.kynaforkids_user` u\r\n          --         WHERE au.affiliate_id \u003d bl.affiliate_id\r\n          --           AND au.bd_incharge_id \u003d u.id),\r\n          --        (SELECT MAX(u.email)\r\n          --         FROM `kynaforkids-server-production.kynaforkids.affiliate_user` au,\r\n          --              `kynaforkids-server-production.kynaforkids.kynaforkids_user` u\r\n          --         WHERE au.affiliate_id \u003d bl.actual_affiliate_id\r\n          --           AND au.bd_incharge_id \u003d u.id)) AS bd_incharge_email,\r\n               \r\n          --   IF (bl.actual_affiliate_id IS NULL,\r\n          --           (SELECT MAX(ac.name)\r\n          --            FROM `kynaforkids-server-production.kynaforkids.affiliate_category` ac,\r\n          --                 `kynaforkids-server-production.kynaforkids.affiliate_user` au\r\n          --            WHERE bl.affiliate_id \u003d au.affiliate_id\r\n          --              AND au.affiliate_category_id \u003d ac.id),\r\n          --           (SELECT MAX(ac.name)\r\n          --            FROM `kynaforkids-server-production.kynaforkids.affiliate_category` ac,\r\n          --                 `kynaforkids-server-production.kynaforkids.affiliate_user` au\r\n          --            WHERE bl.actual_affiliate_id \u003d au.affiliate_id\r\n          --              AND au.affiliate_category_id \u003d ac.id)) AS affiliate_type,\r\n          --  bl.landing_page_name,\r\n\r\n          -- (SELECT MAX(bla.id)\r\n          --  FROM `kynaforkids-server-production.kynaforkids.booking_lead_action` bla\r\n          --  WHERE bla.lead_id \u003d bl.id) AS note_id,\r\n\r\n          (SELECT ac.source_id\r\n               FROM `kynaforkids-server-production.kynaforkids.affiliate_category` ac,\r\n               `kynaforkids-server-production.kynaforkids.affiliate_user` au\r\n               WHERE bl.actual_affiliate_id \u003d au.affiliate_id\r\n               AND au.affiliate_category_id \u003d ac.id) AS source_id,\r\n          \r\n          bl.actual_affiliate_id,\r\n          bl.source,\r\n          `kynaforkids-server-production.kynaforkids.func_get_order_status`(bl.thai_lead_status) AS thai_lead_status,\r\n          `kynaforkids-server-production.kynaforkids.func_get_booking_lead_status`(bl.status) AS lead_status,\r\n          `kynaforkids-server-production.kynaforkids.func_get_country`(bl.country_id) AS country,\r\n          bl.created_at AS created_at,\r\n          bl.updated_at,\r\n          bl.create_order_at AS created_order_at,\r\n          -- bl.fanpage_name,\r\n          CAST(\r\n               (SELECT STRING_AGG(rcl.reason_cancel, \u0027, \u0027)\r\n               FROM `kynaforkids-server-production.kynaforkids.reason_cancel_lead` rcl\r\n               WHERE CAST(rcl.reason_cancel_id AS STRING) IN\r\n                    (SELECT *\r\n                    FROM UNNEST(SPLIT(bl.reason_cancel_id)))) AS string) AS reason_cancel,\r\n\r\n          bl.reason_cancel_id,\r\n          -- (SELECT u.email\r\n          --  FROM `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr` ts,\r\n          --       `kynaforkids-server-production.kynaforkids.kynaforkids_user` u\r\n          --  WHERE ts.telesales_id \u003d bl.sale_id\r\n          --    AND ts.telesales_supervisor_id \u003d u.id) AS sup_email,\r\n          bl.booking_test_id as test_approved_lead_id,\r\n          CASE WHEN bl.is_blocked \u003d 0 THEN \u0027Open\u0027 ELSE \u0027Bloked\u0027 END AS Bloked_Open,\r\n          -- bl.gclid,\r\n          IF (\r\n               (SELECT bs.teacher_note_at\r\n               FROM `kynaforkids-server-production.kynaforkids.booking_session_view` bs\r\n               WHERE bs.id \u003d bl.booking_test_id) IS NULL,\r\n                                                       \u0027Chưa có nhận xét\u0027,\r\n                                                       \u0027Đã có nhận xét\u0027) AS nhan_xet_gv,\r\n          bl.ip_address, \r\n     FROM `kynaforkids-server-production.kynaforkids.booking_lead_view` bl\r\n     WHERE bl.Upsell !\u003d1 \r\n         \r\n),\r\n\r\nlead_info AS\r\n(\r\nSELECT    *,\r\n          IF (bli.actual_affiliate_id IS NULL,\r\n                                     `kynaforkids-server-production.kynaforkids.func_get_source`(bli.source),\r\n                                     `kynaforkids-server-production.kynaforkids.func_get_source`(bli.source_id)) AS sourse,\r\n\r\n          -- (SELECT bla.note\r\n          --  FROM `kynaforkids-server-production.kynaforkids.booking_lead_action` bla\r\n          --  WHERE bla.id \u003d t1.note_id) AS note\r\nFROM bl_info bli\r\n)\r\n\r\nSELECT *\r\nFROM lead_info li\r\nWHERE li.sourse \u003d \u0027Marketing\u0027  \r\n      AND date(li.created_at) \u003e\u003d \u00272015-01-01\u0027\r\n     --  AND li.Bloked_Open \u003d \u0027Open\u0027\r\n      AND li.sale_email !\u003d \u0027lp.marketing@kynaforkids.vn\u0027\r\n      AND (li.ip_address !\u003d \u0027113.176.100.139\u0027\r\n      AND li.ip_address !\u003d \u0027171.225.184.82\u0027\r\n      AND li.ip_address !\u003d \u002742.1.91.79\u0027\r\n      OR  li.ip_address is null)\r\n     ;"
}, {
  "table_name": "international_zip_code",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.international_zip_code`\n(\n  id INT64,\n  district_id INT64,\n  zip_code STRING,\n  mapping STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_order",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_order`\n(\n  id INT64,\n  order_type INT64,\n  order_type_sub INT64,\n  program_type INT64,\n  has_sold_with_video_course INT64,\n  total_video_course NUMERIC(15, 2),\n  invoice_code STRING,\n  contract_code STRING,\n  email STRING,\n  name STRING,\n  phone_number STRING,\n  customer_type INT64,\n  total NUMERIC(13, 2),\n  commission_config_id INT64,\n  discount_money NUMERIC(13, 2),\n  note STRING,\n  payment_method STRING,\n  student_payment_id INT64,\n  source INT64,\n  payment_content INT64,\n  adjust_order_id INT64,\n  total_lesson INT64,\n  total_gift_lesson INT64,\n  duration INT64,\n  country_id INT64,\n  student_code STRING,\n  student_id INT64,\n  lead_id INT64,\n  status INT64,\n  completed_at INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  payment_status INT64,\n  payment_at INT64,\n  program_id INT64,\n  level_id INT64,\n  is_tutorial_booking_class INT64,\n  affiliate_id INT64,\n  international_country_id INT64,\n  currency_code STRING,\n  user_type_id INT64,\n  currency_exchange_rate FLOAT64,\n  teacher_type_data STRING,\n  accounting_date INT64,\n  approval_by INT64,\n  root_order_ids STRING,\n  is_low_price INT64,\n  max_students INT64,\n  booking_order_gift_id INT64,\n  is_gift_order INT64,\n  record_number INT64,\n  revenue_calculate_commission NUMERIC(15, 2),\n  booking_price_config_flash_sale_id INT64,\n  sc_approved_by INT64,\n  sc_approved_at INT64,\n  sc_approved_status INT64,\n  approved_status INT64,\n  student_type INT64,\n  bd_incharge_id INT64,\n  teacher_gender_priority STRING,\n  priority_country_group_region_ids STRING,\n  other_requirement STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "adwords_product",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.adwords_product`\n(\n  id INT64,\n  name STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ceo_cac_cost_thu_ho_cash_collection_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.ceo_cac_cost_thu_ho_cash_collection_view`\nAS WITH \r\ntutoring_new_students AS (\r\n    SELECT\r\n        DATE(IF(bo.accounting_date IS NULL, bo.created_at, bo.accounting_date)) AS ngay_hach_toan,\r\n        SUM((bo.total - COALESCE(bo.discount_money, 0) + COALESCE(bo.total_video_course, 0)) * bo.currency_exchange_rate) AS total_tutoring_order_value\r\n    FROM\r\n        `kynaforkids-server-production.kynaforkids.booking_order_view` bo\r\n    WHERE\r\n        DATE(IF(bo.accounting_date IS NULL, bo.created_at, bo.accounting_date)) \u003e\u003d \u00272024-01-01\u0027\r\n        AND bo.payment_status IN (0, 1, 3)\r\n        AND bo.status IN (4, 6)\r\n        AND bo.payment_content in (2,3,4)\r\n        AND (bo.total - COALESCE(bo.discount_money, 0) + COALESCE(bo.total_video_course, 0)) \u003e 0\r\n        AND (\r\n            ((bo.student_id IS NOT NULL OR bo.student_code IS NOT NULL)\r\n            AND NOT EXISTS (\r\n                SELECT 1\r\n                FROM `kynaforkids-server-production.kynaforkids.booking_order_view` bo2\r\n                WHERE (bo2.student_id \u003d bo.student_id OR bo2.student_code \u003d bo.student_code)\r\n                  AND bo2.payment_status IN (0, 1, 3)\r\n                  AND bo2.status IN (4, 6)\r\n                  AND bo2.payment_content in (2,3,4)\r\n                  AND DATE(bo2.accounting_date) \u003c DATE(IF(bo.accounting_date IS NULL, bo.created_at, bo.accounting_date))\r\n            ))\r\n            OR\r\n            ((bo.student_id IS NULL AND bo.student_code IS NULL)\r\n            AND NOT EXISTS (\r\n                SELECT 1\r\n                FROM `kynaforkids-server-production.kynaforkids.booking_order_view` bo2\r\n                WHERE RIGHT(bo2.phone_number, 9) \u003d RIGHT(bo.phone_number, 9)\r\n                  AND bo2.payment_status IN (0, 1, 3)\r\n                  AND bo2.status IN (4, 6)\r\n                  AND bo2.payment_content in (2,3,4)\r\n                  AND DATE(bo2.accounting_date) \u003c DATE(IF(bo.accounting_date IS NULL, bo.created_at, bo.accounting_date))\r\n            ))\r\n        )\r\n    GROUP BY\r\n        ngay_hach_toan\r\n),\r\nai_single_new_students AS (\r\n    SELECT\r\n        DATE(IF(ord.completed_at IS NULL, TIMESTAMP_SECONDS(ord.created_at), TIMESTAMP_SECONDS(ord.completed_at))) AS ngay_hach_toan,\r\n        SUM(ord.total * ord.currency_exchange_rate) AS total_ai_single_order_value\r\n    FROM\r\n        `kynaforkids-server-production.kynaforkids.order` ord\r\n    WHERE\r\n        ord.invoice_code LIKE \u0027KYNA%\u0027\r\n        AND ord.payment_method_status IN (2, 4, 5, 6)\r\n        AND ord.status IN (2, 3)\r\n        AND DATE(IF(ord.completed_at IS NULL, TIMESTAMP_SECONDS(ord.created_at), TIMESTAMP_SECONDS(ord.completed_at))) \u003e\u003d \u00272024-01-01\u0027\r\n        AND EXISTS (\r\n            SELECT 1\r\n            FROM `kynaforkids-server-production.kynaforkids.order_detail` ordd\r\n            LEFT JOIN `kynaforkids-server-production.kynaforkids.package` pk ON ordd.package_id \u003d pk.id\r\n            WHERE ordd.order_id \u003d ord.id\r\n            AND (\r\n                (ordd.package_combo_id IS NULL AND pk.name LIKE \u0027%AI Tutor%\u0027)\r\n                OR\r\n                (ordd.package_combo_id IS NOT NULL AND EXISTS (\r\n                    SELECT 1\r\n                    FROM `kynaforkids-server-production.kynaforkids.package_combo_subscription_item` pcs\r\n                    LEFT JOIN `kynaforkids-server-production.kynaforkids.package` pk2 ON pcs.package_id \u003d pk2.id\r\n                    WHERE pcs.id \u003d ordd.package_subscription_id\r\n                    AND pk2.name LIKE \u0027%AI%\u0027\r\n                ))\r\n            )\r\n        )\r\n        AND EXISTS (\r\n            SELECT 1\r\n            FROM `kynaforkids-server-production.kynaforkids.Acc_order_video` aov\r\n            WHERE aov.id \u003d ord.id\r\n            AND aov.created_at \u003d aov.first_time_purchase_phone\r\n            AND aov.created_at \u003d aov.first_time_purchase_email\r\n        )\r\n    GROUP BY\r\n        ngay_hach_toan\r\n)\r\nSELECT\r\n    COALESCE(tns.ngay_hach_toan, ais.ngay_hach_toan) AS ngay_hach_toan,\r\n    COALESCE(tns.total_tutoring_order_value, 0) AS total_tutoring_order_value,\r\n    COALESCE(ais.total_ai_single_order_value, 0) AS total_ai_single_order_value,\r\n    ROUND(COALESCE(tns.total_tutoring_order_value, 0) + COALESCE(ais.total_ai_single_order_value, 0)) AS total_order_value,\r\n    ROUND(0.01 * (COALESCE(tns.total_tutoring_order_value, 0) + COALESCE(ais.total_ai_single_order_value, 0))) AS cash_collection_cost\r\nFROM\r\n    tutoring_new_students tns\r\nFULL JOIN\r\n    ai_single_new_students ais\r\nON\r\n    tns.ngay_hach_toan \u003d ais.ngay_hach_toan\r\nORDER BY\r\n    ngay_hach_toan DESC\r\n;"
}, {
  "table_name": "booking_notification_detail",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_notification_detail`\n(\n  id INT64,\n  user_id INT64,\n  type INT64,\n  title STRING,\n  body STRING,\n  object_id INT64,\n  is_read INT64,\n  expired_at INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "commission_income_affiliate_video",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.commission_income_affiliate_video`\nAS SELECT \r\n t1.affiliate_id\r\n  , (select max(u.email) \r\n  from `kynaforkids-server-production.kynaforkids.user` u, `kynaforkids-server-production.kynaforkids.affiliate_user` au\r\n  where au.user_id \u003d u.id and au.affiliate_id \u003d t1.affiliate_id\r\n  ) as affiliate_email\r\n  , (\r\n    select max(u.phone_number) \r\n    from `kynaforkids-server-production.kynaforkids.user` u, `kynaforkids-server-production.kynaforkids.affiliate_user` au \r\n    where au.user_id \u003d u.id and au.affiliate_id \u003d t1.affiliate_id \r\n    ) as phone_number\r\n  , (\r\n    select max(p.name) \r\n    from `kynaforkids-server-production.kynaforkids.profile` p, `kynaforkids-server-production.kynaforkids.affiliate_user` au \r\n    where au.user_id \u003d p.user_id and au.affiliate_id \u003d t1.affiliate_id\r\n    ) as name\r\n  , (\r\n    select ac.name \r\n    from `kynaforkids-server-production.kynaforkids.affiliate_category` ac, `kynaforkids-server-production.kynaforkids.affiliate_user` au  \r\n    where t1.affiliate_id \u003d au.affiliate_id and au.affiliate_category_id \u003d ac.id\r\n    ) as loai_affiliate\r\n  , `kynaforkids-server-production.kynaforkids.func_get_source_affiliate`((\r\n    select au.source_id \r\n    from `kynaforkids-server-production.kynaforkids.affiliate_category` ac, `kynaforkids-server-production.kynaforkids.affiliate_user` au  \r\n    where t1.affiliate_id \u003d au.affiliate_id and au.affiliate_category_id \u003d ac.id\r\n    )) as Nguon\r\n  , (\r\n    select max(u.email)\r\n    from `kynaforkids-server-production.kynaforkids.user` u, `kynaforkids-server-production.kynaforkids.affiliate_user` au\r\n    where u.id \u003d au.bd_incharge_id and t1.affiliate_id \u003d au.affiliate_id ) as bd_incharge\r\n  , (\r\n    select \r\n      ( \r\n      case \r\n            when max(ac.status) is null then \u0027Chưa tạo hợp đồng\u0027\r\n            when max(ac.status) \u003d 1 then \u0027Đã duyệt\u0027\r\n            when max(ac.status) \u003d 0 then \u0027Đang chờ duyệt\u0027\r\n            when max(ac.status) \u003d 2 then \u0027Đã hủy\u0027\r\n      else null\r\n    end  ) as trang_thai_hop_dong\r\n    from `kynaforkids-server-production.kynaforkids.affiliate_contract` ac \r\n    where ac.affiliate_id \u003d t1.affiliate_id) as trang_thai_hop_dong\r\n  , (\r\n    select ac.bank_export_name \r\n    from `kynaforkids-server-production.kynaforkids.affiliate_contract` ac \r\n    where ac.affiliate_id \u003d t1.affiliate_id) as ngan_hang\r\n  ,   t1.ngay_thu_nhap_video as thang\r\n  , SUM(t1.total_order) as total_order\r\n  , 0 as tong_don_ghi_danh_lan_dau\r\n  , 0 as phan_tram_lan_dau\r\n  , 0 as hoa_hong_lan_dau\r\n  , 0 as phan_tram_lan_dau_bonus\r\n  , 0 as hoa_hong_lan_dau_bonus\r\n  , 0 as tong_gon_ghi_danh_lai\r\n  , 0 as hoa_hong_ghi_danh_lai\r\n  , 0 as tong_hoa_hong_cuoi\r\n  , 0 as total_amount\r\n   -- ngalltt start 22/01/2025\r\n  , 1 as co_phat_sinh_thu_nhap\r\n  -- ngalltt end 22/01/2025\r\n  , 0 as thuong_thang\r\n  , 0 as du_no_ki_truoc\r\n  , 0 as dieu_chinh_khac\r\n  , 0 as dieu_chinh_thanh_toan\r\n  , 0 as tong_tien_lan_dau_tutoring\r\n  , 0 as tong_tien_ghi_danh_lai_tutoring\r\n  , 0 as tong_thu_nhap_tutoring\r\n  , 0 as tong_don_tutoring\r\n  , 0 as tong_tien_lan_dau_grai\r\n  , 0 as tong_tien_ghi_danh_lai_grai\r\n  , 0 as tong_thu_nhap_grai\r\n  , 0 as tong_don_grai\r\n  , 0 as tong_tien_lan_dau\r\n  , 0 as tong_tien_ghi_danh_lai\r\n  , 0 as tong_thu_nhap \r\n  , SUM(doanh_thu_video) as doanh_thu_video\r\n  , SUM(hoa_hong_video) as hoa_hong_video\r\nFROM\r\n(\r\nSELECT \r\n FORMAT_DATETIME(\u0027%Y-%m\u0027, timestamp_seconds(o.created_at)) AS ngay_thu_nhap_video\r\n , (select au.affiliate_id from `kynaforkids-server-production.kynaforkids.affiliate_user` au where au.user_id \u003d o.affiliate_id ) as affiliate_id \r\n , ( o.total * o.currency_exchange_rate) as doanh_thu_video\r\n , ci.affiliate_commission_amount as hoa_hong_video\r\n , o.id as order_id\r\n , ci.total_order\r\nFROM\r\n  `kynaforkids-server-production.kynaforkids.order` o\r\nLEFT JOIN (\r\n  SELECT \r\n    order_id\r\n    , SUM(affiliate_commission_amount * currency_exchange_rate) as affiliate_commission_amount\r\n    , MAX(order_status) as order_status\r\n    , COUNT(DISTINCT order_id) as total_order\r\n  FROM  `kynaforkids-server-production.kynaforkids.commission_income` GROUP BY order_id ) ci ON ci.order_id \u003d o.id\r\nWHERE\r\nci.order_status \u003d 3\r\n-- AND (ci.affiliate_commission_amount \u003e 0)\r\n-- AND o.affiliate_id \u003d 52687\r\n) t1\r\nWHERE t1.affiliate_id is not null\r\nGROUP BY t1.ngay_thu_nhap_video, t1.affiliate_id\r\n\r\n;"
}, {
  "table_name": "dictionary",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.dictionary`\n(\n  id INT64,\n  word STRING,\n  phonetic_symbol STRING,\n  detail STRING,\n  language_prefix STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "tele_marketing",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.tele_marketing`\n(\n  id INT64,\n  name STRING,\n  children_name STRING,\n  email STRING,\n  phone_number STRING,\n  source INT64,\n  address STRING,\n  province_id INT64,\n  location_id INT64,\n  district_id INT64,\n  ward_id INT64,\n  student_class STRING,\n  student_year_of_birth INT64,\n  country_id INT64,\n  user_type_id INT64,\n  is_blocked INT64,\n  is_transfer_to_lead INT64,\n  sale_id INT64,\n  recall_date INT64,\n  is_remind INT64,\n  subject_code STRING,\n  ip_address STRING,\n  status INT64,\n  utm_campaign STRING,\n  landing_page_name STRING,\n  subjects STRING,\n  line_id STRING,\n  fanpage_name STRING,\n  tracking_id STRING,\n  ads_id STRING,\n  gclid STRING,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  lead_id INT64,\n  affiliate_id INT64,\n  reason_cancel_id STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  visible INT64,\n  actual_affiliate_id INT64,\n  actual_telemarketing_id INT64,\n  is_exception INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_order_voucher",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_order_voucher`\n(\n  id INT64,\n  booking_order_id INT64,\n  voucher_config_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  discount NUMERIC(15, 2),\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "summer_camp_student_point",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.summer_camp_student_point`\n(\n  id INT64,\n  camp_id INT64,\n  student_id INT64,\n  summer_camp_stage_id INT64,\n  payment_id INT64,\n  point INT64,\n  rank INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "package_active_code",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.package_active_code`\n(\n  id INT64,\n  package_id INT64,\n  subscription_id INT64,\n  code STRING,\n  status INT64,\n  order_id INT64,\n  student_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  has_sent_student INT64,\n  date_send_student INT64,\n  student_sent_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_commission",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_commission`\n(\n  id INT64,\n  country_id INT64,\n  currency_code STRING,\n  currency_exchange_rate FLOAT64,\n  lead_id INT64,\n  order_id INT64,\n  order_type INT64,\n  program_id INT64,\n  total_amount FLOAT64,\n  rate FLOAT64,\n  affiliate_id INT64,\n  affiliate_commission_amount FLOAT64,\n  affiliate_commission_amount_bonus FLOAT64,\n  affiliate_commission_percent FLOAT64,\n  affiliate_commission_percent_bonus FLOAT64,\n  affiliate_commission_config_id INT64,\n  booking_id INT64,\n  test_online_bonus FLOAT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_lesson_comment_template",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_lesson_comment_template`\n(\n  lesson_id INT64,\n  comment_template STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (lesson_id) NOT ENFORCED\n)\nCLUSTER BY lesson_id;"
}, {
  "table_name": "b2b_company_department",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.b2b_company_department`\n(\n  id INT64,\n  department_id INT64,\n  company_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_teacher_extend_data",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_extend_data`\n(\n  id INT64,\n  teacher_id INT64,\n  teaching_training_date INT64,\n  test_training_date INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  tax_code_status INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_ai_lesson",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_ai_lesson`\n(\n  id INT64,\n  name STRING,\n  lesson_type INT64,\n  lesson_id INT64,\n  level_id INT64,\n  next_lesson_id INT64,\n  visible INT64,\n  `order` INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  document STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_student_comment",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_comment`\n(\n  id INT64,\n  user_id INT64,\n  program_id INT64,\n  current_level_id INT64,\n  start_date INT64,\n  end_date INT64,\n  comment STRING,\n  type INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  section_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_monitor_event_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_monitor_event_log`\n(\n  id INT64,\n  booking_id INT64,\n  event_name STRING,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  issue_report_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ai_picture_mode_grammar_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_picture_mode_grammar_config`\n(\n  id INT64,\n  ai_topic_picture_mode_id INT64,\n  structure STRING,\n  grammar STRING,\n  `using` STRING,\n  translate STRING,\n  example STRING,\n  example_translate STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "seo_setting",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.seo_setting`\n(\n  id INT64,\n  name STRING,\n  key STRING,\n  value STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "user_type",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.user_type`\n(\n  id INT64,\n  name STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_status_permission",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_status_permission`\n(\n  from_status_id INT64,\n  action_name STRING,\n  action_by INT64,\n  to_status_id INT64,\n  visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n);"
}, {
  "table_name": "user_tag",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.user_tag`\n(\n  user_id INT64,\n  tag_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n)\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "education_department_school",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.education_department_school`\n(\n  id INT64,\n  education_department_id INT64,\n  name STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ai_study_mode_command",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_study_mode_command`\n(\n  id INT64,\n  name STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_session_student_test_history",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_session_student_test_history`\n(\n  id INT64,\n  booking_session_student_test_id INT64,\n  program_type INT64,\n  test_program_id INT64,\n  test_level_id INT64,\n  pronunciation INT64,\n  vocabulary INT64,\n  writing INT64,\n  reading INT64,\n  speaking INT64,\n  listening INT64,\n  achieved STRING,\n  improve STRING,\n  summary STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "reason_cancel_lead",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.reason_cancel_lead`\nAS           ( SELECT \u00271\u0027 AS reason_cancel_id, \u0027Học phí cao\u0027 AS reason_cancel )\r\nUNION ALL ( SELECT \u00272\u0027 AS reason_cancel_id, \u0027Thời gian buổi học ngắn\u0027 AS reason_cancel)\r\nUNION ALL ( SELECT \u00273\u0027 AS reason_cancel_id, \u0027Ox không đồng ý\u0027 AS reason_cancel)\r\nUNION ALL ( SELECT \u00274\u0027 AS reason_cancel_id, \u0027Bé không thích học Online 1 chổ\u0027 AS reason_cancel)\r\nUNION ALL ( SELECT \u00275\u0027 AS reason_cancel_id, \u0027Đang học ở trung tâm khác\u0027 AS reason_cancel)\r\nUNION ALL ( SELECT \u00276\u0027 AS reason_cancel_id, \u0027Bé \u003c 3 tuổi\u0027 AS reason_cancel)\r\nUNION ALL ( SELECT \u00277\u0027 AS reason_cancel_id, \u0027Bé \u003e18 tuổi\u0027 AS reason_cancel)\r\nUNION ALL ( SELECT \u00278\u0027 AS reason_cancel_id, \u0027Trùng\u0027 AS reason_cancel)\r\nUNION ALL ( SELECT \u00279\u0027 AS reason_cancel_id, \u0027Nhầm số/ Bé nghịch\u0027 AS reason_cancel)\r\nUNION ALL ( SELECT \u002710\u0027 AS reason_cancel_id, \u0027Thuê bao/ KNM trên 5 lần\u0027 AS reason_cancel)\r\nUNION ALL ( SELECT \u002711\u0027 AS reason_cancel_id, \u0027Quan tâm chương trình khác\u0027 AS reason_cancel)\r\nUNION ALL ( SELECT \u002712\u0027 AS reason_cancel_id, \u0027Tìm trung tâm dạy trực tiếp\u0027 AS reason_cancel)\r\nUNION ALL ( SELECT \u002713\u0027 AS reason_cancel_id, \u0027Tham khảo sau\u0027 AS reason_cancel)\r\nUNION ALL ( SELECT \u002714\u0027 AS reason_cancel_id, \u0027Thanh toán thất bại/Hình thức thanh toán không phù hợp\u0027 AS reason_cancel)\r\nUNION ALL ( SELECT \u002715\u0027 AS reason_cancel_id, \u0027Tester hời hợt/Chất lượng test không tốt\u0027 AS reason_cancel)\r\nUNION ALL ( SELECT \u002716\u0027 AS reason_cancel_id, \u0027Hẹn đăng ký sau (Trên 30 ngày)\u0027 AS reason_cancel)\r\nUNION ALL ( SELECT \u002717\u0027 AS reason_cancel_id, \u0027Thuê bao khoá nhiều lần trong nhiều ngày\u0027 AS reason_cancel)\r\nUNION ALL ( SELECT \u002718\u0027 AS reason_cancel_id, \u0027SĐT bị sai\u0027 AS reason_cancel)\r\nUNION ALL ( SELECT \u002719\u0027 AS reason_cancel_id, \u0027KNM trên 5 lần trong nhiều ngày\u0027 AS reason_cancel)\r\nUNION ALL ( SELECT \u002720\u0027 AS reason_cancel_id, \u0027Trùng - Đã ghi danh trước\u0027 AS reason_cancel)\r\n\r\n;"
}, {
  "table_name": "contest_student_session_detail",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.contest_student_session_detail`\n(\n  id INT64,\n  contest_student_session_id INT64,\n  type INT64,\n  detail_id INT64,\n  created_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "email_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.email_log`\n(\n  id INT64,\n  type STRING,\n  recipients STRING,\n  sender STRING,\n  account_id STRING,\n  email_data STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "writing",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.writing`\n(\n  id INT64,\n  name STRING,\n  question STRING,\n  image_url STRING,\n  audio_url STRING,\n  time INT64,\n  is_lock_pass INT64,\n  visible INT64,\n  is_deleted INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  sample_answer STRING,\n  ai_prompt_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  is_auto_approve INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "upsell_tre_em_temp",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.kynaforkids.upsell_tre_em_temp`\nOPTIONS(\n  sheet_range\u003d\"A:N\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/1nSXsfBUyNV5LQ2qH9eRP44aL1pcKow3BT1q9oBjBCGo/edit?gid\u003d284209028#gid\u003d284209028\"]\n);"
}, {
  "table_name": "booking_teacher_priority_source",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_priority_source`\n(\n  id INT64,\n  teacher_type INT64,\n  priority STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_document_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.booking_document_view`\nAS SELECT  o.* except(created_at, updated_at),\r\n        timestamp_seconds(created_at) as created_at,\r\n        timestamp_seconds(updated_at) as updated_at\r\n\r\nFROM `kynaforkids-server-production.kynaforkids.booking_document` o;"
}, {
  "table_name": "booking_teacher_bonus_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_bonus_config`\n(\n  id INT64,\n  country_id INT64,\n  type INT64,\n  base_bonus NUMERIC(15, 2),\n  max_bonus NUMERIC(15, 2),\n  min_total_booking_has_max_bonus INT64,\n  fee_cancel_penalty NUMERIC(15, 2),\n  number_of_shift INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  program_type_id INT64,\n  applied_from INT64,\n  applied_to INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_document_lesson_bk",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_document_lesson_bk`\n(\n  lesson_id INT64,\n  document_id INT64,\n  wiziq_content_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (document_id, lesson_id) NOT ENFORCED\n)\nCLUSTER BY document_id, lesson_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ops_ip_phone",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ops_ip_phone`\n(\n  ops_id INT64,\n  ip_phone STRING,\n  notes STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (ops_id) NOT ENFORCED\n)\nCLUSTER BY ops_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "sms_subscription",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.sms_subscription`\n(\n  code STRING,\n  combo_package_id INT64,\n  duration_by_day INT64,\n  price NUMERIC(15, 2),\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (code) NOT ENFORCED\n)\nCLUSTER BY code\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "document_lesson",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.document_lesson`\n(\n  id INT64,\n  name STRING,\n  thumbnail STRING,\n  content_type STRING,\n  content STRING,\n  visible INT64,\n  `order` INT64,\n  document_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_session",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_session`\n(\n  id INT64,\n  teacher_id INT64,\n  teacher_priority_map_type INT64,\n  booking_class_id INT64,\n  schedule_id INT64,\n  lesson_id INT64,\n  name STRING,\n  begin_at INT64,\n  end_at INT64,\n  status_id INT64,\n  error_id INT64,\n  cancel_status_id INT64,\n  income NUMERIC(15, 2),\n  bonus_income NUMERIC(15, 2),\n  rating_below_standard_penalty NUMERIC(15, 2),\n  cancel_penalty_income NUMERIC(15, 2),\n  total_income NUMERIC(15, 2),\n  rating INT64,\n  is_rating_approved INT64,\n  cskh_note STRING,\n  academic_note STRING,\n  video_link STRING,\n  class_id STRING,\n  recording_url STRING,\n  co_presenter_url STRING,\n  presenter_url STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  is_compensatory_course INT64,\n  teacher_note STRING,\n  vocabulary INT64,\n  use_of_english INT64,\n  pronunciation INT64,\n  listening INT64,\n  speaking INT64,\n  reading_and_writing INT64,\n  teacher_note_at INT64,\n  cancel_config_id INT64,\n  last_action_at INT64,\n  program_id INT64,\n  lecture_content INT64,\n  system INT64,\n  lecturers INT64,\n  customer_care INT64,\n  student_rating_comment STRING,\n  student_rate_time INT64,\n  is_exception INT64,\n  wiziq_video_link STRING,\n  lms_type INT64,\n  number_of_shift INT64,\n  bbb_server_point INT64,\n  is_created_bbb_compensatory INT64,\n  ops_id INT64,\n  class_status INT64,\n  student_attitude INT64,\n  student_attitude_note STRING,\n  student_level INT64,\n  teaching_time INT64,\n  teaching_progress INT64,\n  total_slide_teacher_access INT64,\n  teacher_open_webcam_time_percent INT64,\n  rating_temp INT64,\n  teacher_type INT64,\n  teacher_country_id STRING,\n  bonus_income_temp NUMERIC(15, 2),\n  teacher_base_salary NUMERIC(15, 2),\n  teacher_base_bonus NUMERIC(15, 2),\n  currency STRING,\n  is_student_join_meeeting INT64,\n  is_teacher_join_meeeting INT64,\n  record_number INT64,\n  disable_monitor INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ai_pronunciation_question",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_pronunciation_question`\n(\n  id INT64,\n  content STRING,\n  banner STRING,\n  ai_pronunciation_lesson_id INT64,\n  ai_pronunciation_type_activity_id INT64,\n  type INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  ipa STRING,\n  translate STRING,\n  visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "user_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.user_view`\nAS SELECT         \r\n    * EXCEPT(created_at, confirmed_at, updated_at),       \r\n    TIMESTAMP_SECONDS(created_at) as created_at,       \r\n    TIMESTAMP_SECONDS(confirmed_at) as confirmed_at,       \r\n    TIMESTAMP_SECONDS(updated_at) as updated_at\r\nFROM `kynaforkids-server-production.kynaforkids.user` ;"
}, {
  "table_name": "booking_lead_remind",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_lead_remind`\n(\n  id INT64,\n  lead_id INT64,\n  action INT64,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_session_income",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_session_income`\n(\n  booking_session_id INT64,\n  open_webcam_below_standard_penalty NUMERIC(15, 2),\n  full_face_below_standard_penalty FLOAT64,\n  etiquette_violation_penalty NUMERIC(15, 2),\n  bonus_test_online_early_review NUMERIC(15, 2),\n  bonus_test_online_golden_hour NUMERIC(15, 2),\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  hot_bonus_income NUMERIC(15, 2),\n  duo_bonus_income NUMERIC(15, 2),\n  PRIMARY KEY (booking_session_id) NOT ENFORCED\n)\nCLUSTER BY booking_session_id;"
}, {
  "table_name": "task_management_action",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.task_management_action`\n(\n  id INT64,\n  name STRING,\n  template STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "bot_flow",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.bot_flow`\n(\n  id INT64,\n  name STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "user_course",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.user_course`\n(\n  user_id INT64,\n  course_id INT64,\n  started_date INT64,\n  current_lesson_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  is_completed INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n);"
}, {
  "table_name": "contest_school_campaign",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.contest_school_campaign`\n(\n  id INT64,\n  contest_school_id INT64,\n  contest_campaign_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "redmine_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.redmine_log`\n(\n  id INT64,\n  type INT64,\n  issue_id INT64,\n  params STRING,\n  data STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_study_mode_flow_type",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_study_mode_flow_type`\n(\n  id INT64,\n  name STRING,\n  description STRING,\n  activities STRING,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  max_activity_in_stage INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_program",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_program`\n(\n  id INT64,\n  name STRING,\n  en_name STRING,\n  short_name STRING,\n  visible INT64,\n  number_of_shift INT64,\n  type INT64,\n  is_build_record INT64,\n  has_student_comment_weekly INT64,\n  countries_student_comment_weekly STRING,\n  is_add_timeline_complete_level INT64,\n  is_add_timeline_new_student INT64,\n  is_add_timeline_monthly_report INT64,\n  program_type INT64,\n  program_model INT64,\n  subject INT64,\n  contract_information STRING,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  age_size INT64,\n  class_size INT64,\n  mapping_order_index INT64,\n  program_group INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_order_revert_info",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_order_revert_info`\n(\n  id INT64,\n  order_id INT64,\n  order_revert_id INT64,\n  student_id INT64,\n  program_id INT64,\n  total_amount NUMERIC(15, 2),\n  total_app_amount NUMERIC(15, 2),\n  total_lesson NUMERIC(15, 2),\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  remain_lesson_info STRING,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "kynavn_order_details",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.kynavn_order_details`\n(\n  order_id INT64,\n  course_id INT64\n);"
}, {
  "table_name": "Acc_order_video_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.Acc_order_video_view`\nAS SELECT * except(ngay_sale_len_don,completed_at,created_at,first_time_purchase_phone,first_time_purchase_email),\r\n      timestamp_seconds(ngay_sale_len_don) as ngay_sale_len_don,\r\n      timestamp_seconds(completed_at) as completed_at,\r\n      timestamp_seconds(first_time_purchase_phone) as first_time_purchase_phone,\r\n      timestamp_seconds(first_time_purchase_email) as first_time_purchase_email,\r\n      timestamp_seconds(created_at) as created_at,\r\nFROM `kynaforkids-server-production.kynaforkids.Acc_order_video`;"
}, {
  "table_name": "ai_pronunciation_type_activity",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_pronunciation_type_activity`\n(\n  id INT64,\n  name STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "wheel_camp_award_product",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.wheel_camp_award_product`\n(\n  id INT64,\n  wheel_camp_award_id INT64,\n  wheel_camp_product_id INT64,\n  quantity INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_class_fixed_teacher",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_class_fixed_teacher`\n(\n  class_id INT64,\n  teacher_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (teacher_id, class_id) NOT ENFORCED\n)\nCLUSTER BY teacher_id, class_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "gso_commune",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.gso_commune`\n(\n  id INT64,\n  gso_id STRING,\n  name STRING,\n  en_name STRING,\n  level STRING,\n  district_id STRING,\n  district_name STRING,\n  province_id STRING,\n  province_name STRING,\n  updated INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "user_cache",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.user_cache`\n(\n  user_id INT64,\n  user_course_updated_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (user_id) NOT ENFORCED\n)\nCLUSTER BY user_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "user_point_history",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.user_point_history`\n(\n  id INT64,\n  changed_point INT64,\n  history_type INT64,\n  user_id INT64,\n  ref_id INT64,\n  created_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  is_log_google_form_success INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "contest_quiz_info",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.contest_quiz_info`\n(\n  id INT64,\n  contest_round_id INT64,\n  quiz_id INT64,\n  block_id INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "speech",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.speech`\n(\n  id INT64,\n  name STRING,\n  slug STRING,\n  image_url STRING,\n  package_id INT64,\n  course_id INT64,\n  pre_speech STRING,\n  percent_can_pass INT64,\n  type INT64,\n  visible INT64,\n  is_deleted INT64,\n  `order` INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  dictionary_keyword_tag STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ceo_cac_other_cost_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.ceo_cac_other_cost_view`\nAS WITH order_info AS (\r\n(SELECT date(bo.created_at) AS ngay_tao_don,\r\n          date(bo.payment_at) AS ngay_duyet_don,\r\n          if(bo.accounting_date IS NULL, bo.created_at, bo.accounting_date) AS accounting_date,\r\n\r\n     (SELECT created_at\r\n      FROM `kynaforkids-server-production.kynaforkids.booking_lead`\r\n      WHERE id \u003d bo.lead_id) AS ngay_tao_lead,\r\n          bo.invoice_code,\r\n\r\n          bo.student_code,\r\n          bo.student_id,\r\n          bo.phone_number,\r\n          bo.id as order_id,\r\n          bo.international_country_id,\r\n          if(bo.total_video_course IS NULL, 0, bo.total_video_course) AS total_video_course,\r\n          bo.total,\r\n          `kynaforkids-server-production.kynaforkids.func_get_source`(bo.source) AS source,\r\n          `kynaforkids-server-production.kynaforkids.func_get_program_name_from_id`(bo.program_id) AS program,\r\n          `kynaforkids-server-production.kynaforkids.func_get_booking_order_status`(bo.status) AS order_status,\r\n          bo.total - if(bo.discount_money IS NULL, 0, bo.discount_money) AS price,\r\n          bo.lead_id AS lead_id,\r\n\r\n     \r\n     IF (bll.actual_utm_campaign IS NULL,\r\n                                   bll.utm_campaign,\r\n                                   bll.actual_utm_campaign) AS affiliate_campaign,\r\n  \r\n          bo.currency_exchange_rate,\r\n          ((bo.total - if(bo.discount_money IS NULL, 0, bo.discount_money)) * bo.currency_exchange_rate) AS price_vnd,\r\n          `kynaforkids-server-production.kynaforkids.func_get_country`(bo.international_country_id) AS country,\r\n    \r\nFROM `kynaforkids-server-production.kynaforkids.booking_order_view` bo\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_lead` bll ON bll.id \u003d bo.lead_id\r\nwhere bo.payment_status in (1) \r\n         and bo.order_type not in (3)\r\n         and bo.program_type in (1)\r\n   )\r\n),\r\n\r\ntutoring_order_value as \r\n(\r\n  select\r\n        FORMAT_DATE(\u0027%Y-%m\u0027, oi.accounting_date) as year_month,\r\n        round(sum((oi.price + oi.total_video_course) * oi.currency_exchange_rate)) as total_tutoring_order_value,\r\n  from order_info oi\r\n  group by year_month\r\n  order by year_month desc\r\n\r\n\r\n),\r\n\r\nai_order_value as\r\n(\r\nSELECT \r\n        FORMAT_DATE(\u0027%Y-%m\u0027, aov.completed_at) as year_month,\r\n        ROUND(SUM(aov.currency_exchange_rate * aov.total_oc)) as total_ai_single_order_value\r\nFROM `kynaforkids-server-production.kynaforkids.Acc_order_video_view` aov\r\nWHERE \r\n        aov.payment_status_id in (2) and aov.Mon_hoc like \"%AI Tutor%\"\r\n        and aov.status in (\u0027Hoàn thành\u0027)\r\nGROUP BY year_month\r\nORDER BY year_month DESC\r\n)\r\n\r\nSELECT\r\n      coalesce(tns.year_month,ais.year_month) as year_month,\r\n      if(tns.total_tutoring_order_value is null, 0, tns.total_tutoring_order_value) as total_tutoring_order_value,\r\n      if(ais.total_ai_single_order_value is null, 0, ais.total_ai_single_order_value) as total_ai_single_order_value,\r\n      ROUND(if(tns.total_tutoring_order_value is null, 0, tns.total_tutoring_order_value)  + if(ais.total_ai_single_order_value is null, 0, ais.total_ai_single_order_value)) as total_order_value,\r\n      ROUND(0.0012*(if(tns.total_tutoring_order_value is null, 0, tns.total_tutoring_order_value)  + if(ais.total_ai_single_order_value is null, 0, ais.total_ai_single_order_value))) as other_cost,\r\n      ROUND(0.012*(if(tns.total_tutoring_order_value is null, 0, tns.total_tutoring_order_value)  + if(ais.total_ai_single_order_value is null, 0, ais.total_ai_single_order_value))) as cash_collection_cost\r\n\r\n\r\nFROM tutoring_order_value tns\r\nFULL JOIN ai_order_value ais ON(tns.year_month \u003d ais.year_month)\r\nwhere coalesce(tns.year_month,ais.year_month) \u003e\u003d \u00272024-01\u0027\r\nORDER BY year_month DESC\r\n\r\n\r\n\r\n\r\n;"
}, {
  "table_name": "user_zalo_info",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.user_zalo_info`\n(\n  id INT64,\n  user_id INT64,\n  follower_id STRING,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "bbb_balancer",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.bbb_balancer`\n(\n  bbb_server_point STRING,\n  schedule_id INT64,\n  num_of_bookings INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n);"
}, {
  "table_name": "autocall_avoid_booking_student",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.autocall_avoid_booking_student`\n(\n  user_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (user_id) NOT ENFORCED\n)\nCLUSTER BY user_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "bbb_monitor_booking",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.bbb_monitor_booking`\n(\n  id INT64,\n  booking_session_id INT64,\n  bbb_server_point INT64,\n  internal_id STRING,\n  moderator_count INT64,\n  participant_count INT64,\n  total_student INT64,\n  total_student_access INT64,\n  total_teacher_access INT64,\n  video_count INT64,\n  voice_count INT64,\n  has_user_joined INT64,\n  is_recording INT64,\n  is_running INT64,\n  call_support INT64,\n  update_counter INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  ops_called INT64,\n  ops_chatted INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_level_lesson_skeleton",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_level_lesson_skeleton`\n(\n  level_id INT64,\n  lesson_id INT64,\n  `order` INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n);"
}, {
  "table_name": "package_rating",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.package_rating`\n(\n  id INT64,\n  package_id INT64,\n  user_id INT64,\n  name STRING,\n  score INT64,\n  content STRING,\n  visible INT64,\n  `order` INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_program_curriculum",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_program_curriculum`\n(\n  id INT64,\n  name STRING,\n  program_id INT64,\n  curriculum_id STRING,\n  `order` INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_student_program_action",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_program_action`\n(\n  id INT64,\n  user_id INT64,\n  program_id INT64,\n  action INT64,\n  note STRING,\n  file_upload STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "mkt_report_line_performance_v2_new_students_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.mkt_report_line_performance_v2_new_students_view`\nAS with bo_mkt_performance as\r\n(\r\nselect \r\n       mlp_bo.calc_date, mlp_bo.line_mkt, mlp_bo.country_id, mlp_bo.channel_id, mlp_bo.product_id,\r\n       sum(mlp_bo.spend) as spend, \r\n       sum(spend_with_tax) as spend_with_tax, \r\n       sum(num_leads) as num_leads, \r\n       sum(num_orders) as num_orders, \r\n       sum(order_value) as order_value,\r\n       SUM(num_leads_test) as num_leads_test, \r\n       SUM(num_leads_test_approved) as num_leads_test_approved,\r\n       SUM(leads_wait_for_order) as leads_wait_for_order\r\nfrom `kynaforkids-server-production.kynaforkids.temp_mkt_line_performance_by_new_students_view` mlp_bo\r\ngroup by mlp_bo.calc_date, mlp_bo.line_mkt, mlp_bo.country_id, mlp_bo.channel_id, mlp_bo.product_id  \r\norder by calc_date, line_mkt\r\n),\r\n\r\n-- join_ai_part as \r\n-- (\r\n-- select bmp.*,\r\n--        --ai_bo.line_mkt, \r\n--        ai_bo.ai_part_vnd, ai_bo.order_vnd, ai_bo.num_orders_with_ai \r\n-- from bo_mkt_performance bmp\r\n-- left join `kynaforkids-server-production.nhan_kynaforkids.temp_mkt_order_tutoring_separated_view` ai_bo on (bmp.calc_date \u003d ai_bo.calc_date and bmp.line_mkt \u003d ai_bo.line_mkt) \r\n-- ),\r\n\r\njoin_ai_single as\r\n(\r\nselect \r\n        if(bmp.line_mkt is null, aio.line_mkt, bmp.line_mkt) as line_mkt,\r\n        if(bmp.calc_date is null, aio.calc_date, bmp.calc_date) as calc_date,\r\n        \r\n        bmp.* EXCEPT(line_mkt, calc_date, country_id, channel_id, product_id), \r\n      \r\n        aio.ai_single_order_vnd, aio.num_single_ai_orders,\r\n\r\n        if(bmp.country_id is null, aio.country_id, bmp.country_id) as country_id,\r\n        \r\n        if(bmp.channel_id is null, aio.channel_id, bmp.channel_id) as channel_id,\r\n        \r\n        if(bmp.product_id is null, aio.product_id, bmp.product_id) as product_id,\r\nfrom bo_mkt_performance bmp\r\nfull join `kynaforkids-server-production.datateam_kynaforkids.mkt_standalone_order_ai_new_students_view` aio on (bmp.calc_date \u003d aio.calc_date and bmp.line_mkt \u003d aio.line_mkt and bmp.country_id \u003d aio.country_id and bmp.channel_id \u003d aio.channel_id and bmp.product_id \u003d aio.product_id)\r\norder by calc_date\r\n),\r\n\r\ntemp_table_1 as (\r\nselect jas.*,\r\n       line.id as line_id,\r\nfrom join_ai_single jas\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.adwords_meta_line` line on (jas.line_mkt \u003d line.name)\r\n\r\n)\r\n\r\nselect tt1.*,\r\n       case \r\n          WHEN country_id \u003d 1 THEN \u0027Thailand\u0027\r\n          WHEN country_id \u003d 2 THEN \u0027Indo\u0027\r\n          WHEN country_id \u003d 3 THEN \u0027Việt Nam\u0027\r\n          WHEN country_id \u003d 4 THEN \u0027Khác\u0027\r\n          WHEN country_id \u003d 5 THEN \u0027Lào\u0027\r\n          WHEN country_id \u003d 6 THEN \u0027Malaysia\u0027\r\n          else \"Chưa biết\"\r\n      end as country,\r\n\r\n      case \r\n            when product_id \u003d 1 then \u0027Kids - 1 kèm 1\u0027\r\n            when product_id \u003d 2 then \u0027KEA - 1 kèm 1\u0027\r\n            when product_id \u003d 3 then \u0027Toán - 1 kèm 1\u0027\r\n            when product_id \u003d 4 then \u0027Kids - Class\u0027\r\n            when product_id \u003d 5 then \u0027Tuyển dụng GV\u0027\r\n            when product_id \u003d 6 then \u0027Khác\u0027\r\n            when product_id \u003d 7 then \u0027AI Tutor\u0027\r\n            else \"Chưa biết\"\r\n      end as product_name,\r\n\r\n      case \r\n          when channel_id \u003d 1 then \u0027Facebook\u0027\r\n          when channel_id \u003d 2 then \u0027Tiktok\u0027\r\n          when channel_id \u003d 3 then \u0027Google\u0027\r\n          else \"Chưa biết\"\r\n      end as channel_name,\r\n      if(tt1.ai_single_order_vnd is null,0, tt1.ai_single_order_vnd) + if(tt1.order_value is null, 0, tt1.order_value) as total_order_value,\r\n      \r\n      -- if(tt1.order_value is null, 0,tt1.order_value) /if(if(tt1.ai_single_order_vnd is null,0, tt1.ai_single_order_vnd) + if(tt1.order_value is null, 0, tt1.order_value) \u003d 0, null,(if(tt1.ai_single_order_vnd is null,0, tt1.ai_single_order_vnd) + if(tt1.order_value is null, 0, tt1.order_value))) as percent_tut_rev,      \r\n      -- if(tt1.ai_single_order_vnd is null, 0,tt1.ai_single_order_vnd) /if(if(tt1.ai_single_order_vnd is null,0, tt1.ai_single_order_vnd) + if(tt1.order_value is null, 0, tt1.order_value) \u003d 0, null,(if(tt1.ai_single_order_vnd is null,0, tt1.ai_single_order_vnd) + if(tt1.order_value is null, 0, tt1.order_value))) as percent_ai_rev,\r\n\r\nfrom temp_table_1 tt1\r\n;"
}, {
  "table_name": "booking_order_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.booking_order_view`\nAS SELECT \r\n    * EXCEPT(completed_at, created_at, updated_at, accounting_date, payment_at),        \r\n    TIMESTAMP_SECONDS(completed_at) as completed_at,        \r\n    TIMESTAMP_SECONDS(created_at) as created_at,        \r\n    TIMESTAMP_SECONDS(updated_at) as updated_at,        \r\n    TIMESTAMP_SECONDS(payment_at) as payment_at,         \r\n    TIMESTAMP_SECONDS(accounting_date) as accounting_date\r\nFROM `kynaforkids.booking_order`;"
}, {
  "table_name": "wheel_camp_award",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.wheel_camp_award`\n(\n  id INT64,\n  wheel_camp_id INT64,\n  wheel_camp_user_code_id INT64,\n  name STRING,\n  level INT64,\n  begin_at INT64,\n  end_at INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "card",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.card`\n(\n  id INT64,\n  box_card_id INT64,\n  order_id INT64,\n  user_id INT64,\n  status INT64,\n  serial_code STRING,\n  active_code STRING,\n  active_date INT64,\n  price INT64,\n  used_date INT64,\n  is_deleted INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  record_number INT64,\n  is_assign_user INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "label",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.label`\n(\n  id INT64,\n  type INT64,\n  label STRING,\n  class STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "favorite_menu",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.favorite_menu`\n(\n  id INT64,\n  user_id INT64,\n  menu_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "timesheet_team_role",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.timesheet_team_role`\n(\n  team_id INT64,\n  role STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n)\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "writing_session",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.writing_session`\n(\n  id INT64,\n  user_id INT64,\n  writing_id INT64,\n  quiz_id INT64,\n  total_score FLOAT64,\n  start_time INT64,\n  end_time INT64,\n  is_graded INT64,\n  input_student STRING,\n  comment_teacher STRING,\n  note_json_data STRING,\n  is_send_mail INT64,\n  is_passed INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  is_booking_practice INT64,\n  overall FLOAT64,\n  graded_by INT64,\n  graded_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "wh_export",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.wh_export`\n(\n  id INT64,\n  location_id INT64,\n  reason_id STRING,\n  serial_code STRING,\n  price_adjusted NUMERIC(15, 2),\n  price_adjustment_type INT64,\n  status INT64,\n  description STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  department_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "quiz_toeic_section_review",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.quiz_toeic_section_review`\n(\n  id INT64,\n  start_score INT64,\n  end_score INT64,\n  type INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ticket",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ticket`\n(\n  id INT64,\n  subject STRING,\n  content STRING,\n  issue_id INT64,\n  status_id INT64,\n  deadline INT64,\n  handled_by INT64,\n  team_in_charge INT64,\n  remind_at INT64,\n  status_label INT64,\n  is_deleted INT64,\n  extend_data STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  teacher_id INT64,\n  is_read INT64,\n  ticket_clone_id INT64,\n  note STRING,\n  redmine_issue_id INT64,\n  booking_id INT64,\n  student_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "writing_ai_prompt",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.writing_ai_prompt`\n(\n  id INT64,\n  name STRING,\n  prompt STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  ai_model STRING,\n  type STRING,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_teacher_complain",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_complain`\n(\n  id INT64,\n  teacher_note STRING,\n  academic_note STRING,\n  booking_id INT64,\n  teacher_id INT64,\n  program_id INT64,\n  booking_complain_scenario_id INT64,\n  approved_status INT64,\n  adjustment_income NUMERIC(15, 2),\n  handled_by INT64,\n  attachments STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  approve_date INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "order_register_info",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.order_register_info`\n(\n  id INT64,\n  order_id INT64,\n  name STRING,\n  email STRING,\n  phone_number STRING,\n  line_id STRING,\n  created_at INT64,\n  updated_at INT64,\n  children_name STRING,\n  user_type_id INT64,\n  lead_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  lead_tele_marketing_id INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "contest_round_phase_info",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.contest_round_phase_info`\n(\n  id INT64,\n  contest_round_info_id INT64,\n  contest_campaign_id INT64,\n  name STRING,\n  begin_at INT64,\n  end_at INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "otp",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.otp`\n(\n  id INT64,\n  otp_code STRING,\n  ref_data STRING,\n  phone STRING,\n  is_used INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_picture_mode_topic",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_picture_mode_topic`\n(\n  id INT64,\n  name STRING,\n  banner STRING,\n  description STRING,\n  ai_picture_mode_level_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  vocabulary STRING,\n  grammar STRING,\n  skill_id INT64,\n  visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  dictionary_keyword_tag STRING,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "wh_export_transaction",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.wh_export_transaction`\n(\n  export_id INT64,\n  product_id INT64,\n  import_id INT64,\n  quantity INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  amount_per_unit NUMERIC(15, 2),\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (import_id, product_id, export_id) NOT ENFORCED\n)\nCLUSTER BY import_id, product_id, export_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_tutor_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_tutor_config`\n(\n  id INT64,\n  student_id INT64,\n  program_id INT64,\n  type INT64,\n  status INT64,\n  setting_data STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_payment_gift_reset",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_payment_gift_reset`\n(\n  id INT64,\n  student_payment_id INT64,\n  lesson INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "affiliate_category",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.affiliate_category`\n(\n  id INT64,\n  name STRING,\n  affiliate_group_id INT64,\n  source_id INT64,\n  categories_can_not_override STRING,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "CEO_CAC_fixedSaleSalary",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.kynaforkids.CEO_CAC_fixedSaleSalary`\nOPTIONS(\n  sheet_range\u003d\"fixedSaleSalary!A:G\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/1uPAxX1jOKkYFZhKrAhqNwEIhO7Qc11K484YjjzJahx8/edit?usp\u003dsharing\"]\n);"
}, {
  "table_name": "document",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.document`\n(\n  id INT64,\n  name STRING,\n  link STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  is_free INT64,\n  type STRING,\n  size INT64,\n  extension STRING,\n  thumbnail STRING,\n  description STRING,\n  description_detail STRING,\n  document_type_id INT64,\n  package_id INT64,\n  slug STRING,\n  `order` INT64,\n  visible INT64,\n  content_type INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "token",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.token`\n(\n  user_id INT64,\n  code STRING,\n  created_at INT64,\n  type INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n)\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_vocab_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_vocab_config`\n(\n  id INT64,\n  ai_topic_id INT64,\n  content STRING,\n  type STRING,\n  ipa STRING,\n  translate STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "dtp_student_session",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.dtp_student_session`\n(\n  id INT64,\n  student_id INT64,\n  dtp_learning_path_id INT64,\n  score INT64,\n  is_passed INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  number_of_learning INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  is_send_result INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_session_student_test",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_session_student_test`\n(\n  id INT64,\n  booking_session_id INT64,\n  student_id INT64,\n  program_type INT64,\n  test_program_id INT64,\n  test_level_id INT64,\n  pronunciation INT64,\n  vocabulary INT64,\n  writing INT64,\n  reading INT64,\n  speaking INT64,\n  listening INT64,\n  is_review INT64,\n  is_student_absent INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  student_age_tag INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "speech_question_answer",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.speech_question_answer`\n(\n  id INT64,\n  speech_question_id INT64,\n  text STRING,\n  is_correct INT64,\n  is_deleted INT64,\n  `order` INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  audio_url STRING,\n  ipa STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ad_hoc_ai_tutor_chua_mua_tron_doi",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ad_hoc_ai_tutor_chua_mua_tron_doi`\n(\n  string_field_0 STRING\n);"
}, {
  "table_name": "affiliate_user_staging",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.affiliate_user_staging`\n(\n  user_id INT64,\n  affiliate_id INT64,\n  affiliate_category_id INT64,\n  commission_percent INT64,\n  status INT64,\n  affiliate_manager_id INT64,\n  is_affiliate_manager INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  total_commission_amount FLOAT64,\n  total_commission_estimate_amount FLOAT64,\n  country_id INT64,\n  bd_incharge_id INT64,\n  source_id INT64,\n  note STRING,\n  action_status INT64,\n  priority INT64,\n  affiliate_lead_id INT64,\n  email_contact STRING,\n  action_status_updated_at INT64,\n  contract_status INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (user_id) NOT ENFORCED\n)\nCLUSTER BY user_id;"
}, {
  "table_name": "booking_commission_affiliate_grai",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.booking_commission_affiliate_grai`\nAS -- doanh thu với đơn ai group talk\r\nSELECT \r\n\tt1.ngay_thu_nhap_grai\r\n\t,t1. affiliate_id\r\n\t,SUM(CASE WHEN t1.payment_content \u003d 2 THEN (t1.thuc_nhan_hoc_phi + t1.total_video) ELSE 0 END) as tong_tien_lan_dau_grai\r\n\t,SUM(CASE WHEN t1.payment_content \u003d 3 THEN ((t1.thuc_nhan_hoc_phi + t1.total_video)) ELSE 0 END) as tra_gop_lan_sau_grai\r\n\t,SUM(CASE WHEN t1.payment_content \u003d 4 THEN ((t1.thuc_nhan_hoc_phi + t1.total_video)) ELSE 0 END) as tong_tien_ghi_danh_lai_grai\r\n\t,SUM(CASE WHEN t1.payment_content \u003d 1 THEN ((t1.thuc_nhan_hoc_phi + t1.total_video)) ELSE 0 END) as tong_tien_hoc_thu_grai\r\n\t,SUM(t1.thuc_nhan_hoc_phi + t1.total_video) as tong_thu_nhap_grai\r\n\t, COUNT(t1.order_id) as tong_don_grai\r\nFROM\r\n(\r\n\tSELECT \r\n\t\tFORMAT_DATETIME(\u0027%Y-%m\u0027, bo.accounting_date) AS ngay_thu_nhap_grai\r\n\t\t, bc.affiliate_id\r\n\t\t, ( \r\n\t\tCASE\r\n\t\tWHEN bo.order_type \u003d 2 THEN bo.revenue_calculate_commission * bo.currency_exchange_rate\r\n\t\tELSE bo.total * bo.currency_exchange_rate\r\n\t\tEND\r\n\t\t) AS thuc_nhan_hoc_phi\r\n\t\t, bo.total_video_course * bo.currency_exchange_rate as total_video\r\n\t\t, bo.payment_content\r\n\t\t, bo.id as order_id\r\n\tFROM `kynaforkids-server-production.kynaforkids.booking_commission` bc \r\n\tLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_order_view` bo ON bc.order_id \u003d bo.id\r\n\tWHERE bc.status \u003d 3\r\n\tAND bo.program_type \u003d 2\r\n        -- AND bc.affiliate_id\u003d 541190 \r\n        -- AND (date(bo.accounting_date) \u003e\u003d \u00272024-11-01\u0027 and date(bo.accounting_date) \u003c\u003d \u00272024-11-30\u0027)\r\n\t) t1\r\n\tGROUP BY t1.ngay_thu_nhap_grai, t1.affiliate_id\r\n\r\n\r\n;"
}, {
  "table_name": "dtp_package",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.dtp_package`\n(\n  id INT64,\n  name STRING,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "CEO_CAC_fixedSaleSalary_month",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.CEO_CAC_fixedSaleSalary_month`\nAS WITH table_1 as\r\n(\r\n    SELECT \r\n\r\n    FORMAT_DATE(\u0027%Y-%m\u0027, fss.date) AS year_month,\r\n    (fss.salaryCost - fss.saleBonus - if(fss.yearBonus is null,0,fss.yearBonus)) as fixedSaleSalary,\r\n    -- (fss.salaryCost - fss.saleBonus) as fixedSaleSalary,\r\n    \r\n    fss.employeeCode\r\n\r\n    FROM `kynaforkids-server-production.accounting_kynaforkids.CEO_CAC_fixedSaleSalary` fss\r\n)\r\n,\r\ntable_2 as\r\n(\r\nSELECT\r\n        t1.year_month,\r\n        sum(t1.fixedSaleSalary) as fixedSaleSalary,\r\n        COUNT(DISTINCT t1.employeeCode) as numberEmployee\r\nFROM table_1 t1\r\nWhere t1.year_month is not null\r\nGROUP BY t1.year_month\r\nORDER BY t1.year_month desc\r\n)\r\n\r\nSELECT *, (t2.fixedSaleSalary/t2.numberEmployee) as avgFixdSalary\r\nFROM table_2 t2;"
}, {
  "table_name": "bbb_access_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.bbb_access_log`\n(\n  id INT64,\n  booking_session_id INT64,\n  bbb_internal_id STRING,\n  class_id STRING,\n  user_id INT64,\n  user_name STRING,\n  access_time INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ceo_cac_general_sales_part_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.ceo_cac_general_sales_part_view`\nAS select * from `kynaforkids-server-production.datateam_kynaforkids.report_cac_kyna_sale_cost_part_91ba7bf9-c30e-4ed3-98d9-a0dea42a833e`\r\n\r\n-- -- OLD --\r\n-- with \r\n-- -- new students bao gồm HV mới học Tutoring (từ đơn hoàn thành của booking_order) và HV mới mua lẻ AI Tutor (từ đơn hoàn thành của order)\r\n-- -- HV mới Tutoring check theo mã KE/student_id rồi tới số phone \r\n-- -- HV mới mua lẻ AI Tutor check theo số phone, email\r\n-- -- Bảng đang làm hiện chỉ group theo ngày hạch toán (có thể group theo cả sản phẩm và quốc gia)\r\n\r\n-- new_students as\r\n-- (\r\n-- select \r\n--      *\r\n-- -- from `kynaforkids-server-production.kynaforkids.ceo_cac_num_new_students_view` nst\r\n-- from `kynaforkids-server-production.datateam_kynaforkids.report_cac_kyna_new_students_91ba7bf9-c30e-4ed3-98d9-a0dea42a833e` nst\r\n-- where nst.year_month \u003c\u003d FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE())\r\n-- ),\r\n\r\n-- sale_fixed_cost as (\r\n-- select \r\n--       sfc1.year_month,\r\n--       round((select rate_new from new_students nst where nst.year_month \u003d sfc1.year_month) * sfc1.fixedSaleSalary) as fixedSaleSalary,\r\n-- from `kynaforkids.ceo_cac_sale_fixed_cost_view` sfc1\r\n-- WHERE sfc1.year_month \u003c\u003d FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE())\r\n-- ),\r\n\r\n-- sale_cost as\r\n-- (\r\n-- select\r\n--       coalesce(sfc.year_month,sbc.year_month) as year_month, \r\n--       coalesce(sbc.sale_bonus_vnd,0) + coalesce(sfc.fixedSaleSalary,0) as sale_all_cost\r\n\r\n-- from sale_fixed_cost sfc\r\n-- left join `kynaforkids-server-production.kynaforkids.ceo_cac_sale_commission_bonus_new_students_view` sbc using(year_month)\r\n-- )\r\n\r\n\r\n-- -- select \r\n-- --       nst.*,\r\n-- --       sc.* EXCEPT(year_month),\r\n-- -- from  new_students nst \r\n-- -- left join sale_cost sc on (nst.year_month \u003d sc.year_month)\r\n-- -- order by year_month desc\r\n\r\n-- select * from sale_cost;"
}, {
  "table_name": "booking_teacher_lead_bonus",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_lead_bonus`\n(\n  id INT64,\n  teacher_id INT64,\n  introduced_by INT64,\n  interviewed_by INT64,\n  bonus_config_id INT64,\n  interview_bonus_config_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "quiz_toeic_part_review",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.quiz_toeic_part_review`\n(\n  id INT64,\n  start_correct INT64,\n  end_correct INT64,\n  part_number INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  type INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "dictionary_history",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.dictionary_history`\n(\n  id INT64,\n  user_id INT64,\n  keyword STRING,\n  detail STRING,\n  search_count INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "affiliate_user_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.affiliate_user_view`\nAS SELECT        \r\n    * EXCEPT(created_at, updated_at, action_status_updated_at),     \r\n    TIMESTAMP_SECONDS(created_at) as created_at,      \r\n    TIMESTAMP_SECONDS(updated_at) as updated_at,      \r\n    TIMESTAMP_SECONDS(action_status_updated_at) as action_status_updated_at\r\nFROM `kynaforkids-server-production.kynaforkids.affiliate_user`;"
}, {
  "table_name": "booking_sale_commission_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_sale_commission_config`\n(\n  id INT64,\n  name STRING,\n  payment_content INT64,\n  source INT64,\n  count INT64,\n  commission_percent FLOAT64,\n  country_id INT64,\n  start_date INT64,\n  end_date INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ai_default_level",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_default_level`\n(\n  id INT64,\n  booking_level_id INT64,\n  pronunciation_level_id INT64,\n  ai_level_id INT64,\n  picture_level_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  type INT64,\n  exercise_solve_level_id INT64,\n  ai_ver2_level INT64,\n  ai_ver2_level_premium INT64,\n  group_talk_level_id INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "affiliate_group",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.affiliate_group`\n(\n  id INT64,\n  name STRING,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "affiliate_post_sample",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.affiliate_post_sample`\n(\n  id INT64,\n  content STRING,\n  content_bk STRING,\n  country_id INT64,\n  link STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  course_link STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "wh_export_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.wh_export_view`\nAS SELECT * except(created_at,updated_at),\r\n      timestamp_seconds(created_at) as created_at,\r\n      timestamp_seconds(updated_at) as updated_at,\r\nFROM `kynaforkids-server-production.kynaforkids.wh_export`;"
}, {
  "table_name": "bbb_error_stat",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.bbb_error_stat`\n(\n  id INT64,\n  booking_session_id INT64,\n  report_by INT64,\n  error_message STRING,\n  error_at INT64,\n  bbb_server_point INT64,\n  booking_schedule_id INT64,\n  booking_begin_at INT64,\n  booking_begin_day_at INT64,\n  booking_begin_week_at INT64,\n  booking_begin_month_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "affiliate_user_view_tam_test",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.affiliate_user_view_tam_test`\nOPTIONS(\n  labels\u003d[(\"goog-terraform-provisioned\", \"true\")]\n)\nAS SELECT        \r\n    * EXCEPT(created_at, updated_at, action_status_updated_at),     \r\n    TIMESTAMP_SECONDS(created_at) as created_at,      \r\n    TIMESTAMP_SECONDS(updated_at) as updated_at,      \r\n    TIMESTAMP_SECONDS(action_status_updated_at) as action_status_updated_at\r\nFROM `kynaforkids-server-production.kynaforkids.affiliate_user`;"
}, {
  "table_name": "b2b_company",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.b2b_company`\n(\n  id INT64,\n  organization_id STRING,\n  name STRING,\n  country_id INT64,\n  contact_address STRING,\n  sale_in_charge_id INT64,\n  aca_in_charge_id INT64,\n  ops_in_charge_id INT64,\n  source_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  is_cooperate_with_elsa INT64,\n  has_kyna_ai_tutor INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "course",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.course`\n(\n  id INT64,\n  thumbnail STRING,\n  name STRING,\n  slug STRING,\n  teacher_id INT64,\n  learn_type INT64,\n  is_show_chatbox INT64,\n  package_id INT64,\n  `order` INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  is_free INT64,\n  kyna_course_id INT64,\n  dictionary_keyword_tag STRING,\n  support_country_type INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "Acc_LTV_COGS",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.kynaforkids.Acc_LTV_COGS`\n(\n  date DATE,\n  serverCost FLOAT64,\n  teacherCost FLOAT64,\n  percentGPMargin FLOAT64,\n  market STRING\n)\nOPTIONS(\n  sheet_range\u003d\"COGS!A:E\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/11CJglKZscD46EQOLhky7R1gIUDRL8-WJF9g5s0fdHvY/edit?gid\u003d928074935#gid\u003d928074935\"]\n);"
}, {
  "table_name": "banner",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.banner`\n(\n  id INT64,\n  name STRING,\n  country_id INT64,\n  type INT64,\n  page_slug STRING,\n  link STRING,\n  desktop_image STRING,\n  mobile_image STRING,\n  `from` INT64,\n  `to` INT64,\n  delay_second INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "bbb_feedback",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.bbb_feedback`\n(\n  id INT64,\n  internal_id STRING,\n  audio_rate INT64,\n  video_rate INT64,\n  webcam_rate INT64,\n  design_rate INT64,\n  content_rate INT64,\n  plan_rate INT64,\n  comment STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "temp_mkt_standalone_order_ai_new_students_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.temp_mkt_standalone_order_ai_new_students_view`\nAS WITH \r\norder_ai_tutor_single AS\r\n(SELECT \r\n        --ord.*,\r\n        ord.id as order_id,\r\n        date(timestamp_seconds(ord.created_at)) as created_at,\r\n      --   date(ord.updated_at) as updated_at,\r\n      --   date(ord.completed_at) as completed_at,\r\n      --   ord.created_by,\r\n      --   ord.telesale_id,\r\n        ord.register_source,        \r\n        ord.country_id,\r\n        `kynaforkids-server-production.kynaforkids.func_get_country`(ord.country_id) as country,\r\n        ord.currency_exchange_rate,\r\n        ord.total as total_oc,\r\n        \r\n        \r\n       -- ord.user_id,\r\n        ori.phone_number as order_phone_number,\r\n        ori.email as order_email,\r\n        ori.lead_id,\r\n      --   if((ori.phone_number) in (SELECT * FROM users_1_1_phone_number),\"Đã học 1-1\",\"Chưa học 1-1\") as check_1_1, \r\n\r\n        \r\n\r\n        ord.invoice_code as order_code,\r\n        ord.status as order_status_id,\r\n        ord.payment_method_id,\r\n        ord.payment_method_status as payment_status_id,\r\n        ord.affiliate_id,\r\n        (SELECT email FROM kynaforkids-server-production.kynaforkids.user us WHERE ord.affiliate_id \u003d us.id) as affiliate_email,\r\n        (SELECT au.affiliate_category_id FROM kynaforkids-server-production.kynaforkids.affiliate_user au WHERE au.user_id \u003d ord.affiliate_id) as affiliate_category_id,\r\n        ord.utm_campaign,\r\n\r\n\r\n        ordd.package_id,\r\n        ordd.package_subscription_id,\r\n        pks.subscription_month,\r\n        pks.name as subscription_name,\r\n        pks.price as subscription_price,\r\n        pk.name as package_name,\r\n\r\n        \r\n       \r\nFROM `kynaforkids-server-production.kynaforkids.order` ord\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.order_detail` ordd ON (ord.id \u003d ordd.order_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.order_register_info` ori ON (ord.id \u003d ori.order_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.package_subscriptions` pks ON (ordd.package_subscription_id \u003d pks.id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.package` pk ON (pk.id \u003d ordd.package_id)\r\n\r\n\r\n\r\nWHERE \r\n      (ord.invoice_code like \u0027KYNA%\u0027 or ord.invoice_code like \u0027GRAI%\u0027)\r\n      AND pk.name like \u0027%AI Tutor%\u0027\r\n      AND ordd.package_combo_id is null\r\n),\r\n\r\norder_ai_tutor_combo AS\r\n(SELECT \r\n        --ord.*,\r\n        ord.id as order_id,\r\n        date(timestamp_seconds(ord.created_at)) as created_at,\r\n      --   date(ord.updated_at) as updated_at,\r\n      --   date(ord.completed_at) as completed_at,\r\n      --   ord.created_by,\r\n      --   ord.telesale_id,\r\n        ord.register_source,        \r\n        ord.country_id,\r\n        `kynaforkids-server-production.kynaforkids.func_get_country`(ord.country_id) as country,\r\n        ord.currency_exchange_rate,\r\n        ord.total as total_oc,\r\n        \r\n        \r\n       -- ord.user_id,\r\n        ori.phone_number as order_phone_number,\r\n        ori.email as order_email,\r\n        ori.lead_id,\r\n      --   if((ori.phone_number) in (SELECT * FROM users_1_1_phone_number),\"Đã học 1-1\",\"Chưa học 1-1\") as check_1_1, \r\n\r\n\r\n        -- ord.invoice_code as order_code,\r\n        -- ord.status as order_status_id,\r\n        -- case when ord.status \u003d 1 then \u0027Mới tạo\u0027\r\n        --      when ord.status \u003d 2 then \u0027Đã xác nhận\u0027\r\n        --      when ord.status \u003d 3 then \u0027Hoàn thành\u0027\r\n        --      when ord.status \u003d 4 then \u0027Hủy\u0027\r\n        --      when ord.status \u003d 5 then \u0027Đã hoàn tiền\u0027   \r\n        -- end as order_status,\r\n\r\n        -- ord.payment_method_id,\r\n        -- ord.payment_method_status,\r\n        \r\n        -- ord.affiliate_id,  \r\n        -- ord.affiliate_email,\r\n        -- ord.affiliate_category_name,\r\n        \r\n\r\n        ord.invoice_code as order_code,\r\n        ord.status as order_status_id,\r\n        ord.payment_method_id,\r\n        ord.payment_method_status as payment_status_id,\r\n        ord.affiliate_id,\r\n        (SELECT email FROM kynaforkids-server-production.kynaforkids.user us WHERE ord.affiliate_id \u003d us.id) as affiliate_email,\r\n        (SELECT au.affiliate_category_id FROM kynaforkids-server-production.kynaforkids.affiliate_user au WHERE au.user_id \u003d ord.affiliate_id) as affiliate_category_id,\r\n        ord.utm_campaign,\r\n\r\n\r\n        ordd.package_id,\r\n        ordd.package_subscription_id,\r\n        pks.subscription_month,\r\n        pks.name as subscription_name,\r\n        pks.price as subscription_price,\r\n        pk.name as package_name,\r\n\r\n\r\n        \r\n       \r\nFROM `kynaforkids-server-production.kynaforkids.order` ord\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.order_detail` ordd ON (ord.id \u003d ordd.order_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.order_register_info` ori ON (ord.id \u003d ori.order_id)\r\nLEFT JOIN `kynaforkids.package_combo_subscription_item` pcs ON (ordd.package_subscription_id \u003d pcs.id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.package_subscriptions` pks ON (pcs.package_subscription_id \u003d pks.id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.package` pk ON (pk.id \u003d pcs.package_id)\r\n-- LEFT JOIN `kynaforkids-server-production.kynaforkids.package` pk ON (pk.id \u003d ordd.package_combo_id)\r\n\r\n\r\nWHERE \r\n      (ord.invoice_code like \u0027KYNA%\u0027 or ord.invoice_code like \u0027GRAI%\u0027)\r\n      AND pk.name like \u0027%AI%\u0027\r\n      AND ordd.package_combo_id is not null\r\n),\r\n\r\norder_ai_tutor AS\r\n(\r\nSELECT * FROM order_ai_tutor_single\r\n\r\nUNION ALL\r\n\r\nSELECT * FROM order_ai_tutor_combo\r\n\r\n),\r\n\r\ntemp_table as \r\n(\r\n\r\nSELECT \r\n      oat.*,\r\n      (SELECT ac.name FROM `kynaforkids.affiliate_category` ac WHERE ac.id \u003d oat.affiliate_category_id) AS affiliate_category_name,\r\nFROM order_ai_tutor oat\r\n),\r\n\r\nsingle_ai_order as (\r\nSELECT   \r\n         tt.created_at as order_date,\r\n        (select blv.affiliate_campaign from `kynaforkids.mkt_booking_lead_view` blv\r\n         where blv.id \u003d tt.lead_id) as utm_campaign,\r\n         tt.country_id,\r\n         tt.lead_id,\r\n\r\n         tt.total_oc,\r\n         tt.currency_exchange_rate,\r\n\r\n        --  tt.total_oc * tt.currency_exchange_rate as total_VND,\r\n         tt.order_id,\r\n         case \r\n              when tt.country_id \u003d 3 then 1\r\n              when tt.country_id \u003d 1 then \r\n                  (SELECT ce.rate FROM `kynaforkids-server-production.kynaforkids.currency_exchange_config_view` ce \r\n                    WHERE ce.from \u003d \u0027THB\u0027 and ce.to \u003d \u0027VND\u0027 and date(ce.date_start) \u003c\u003d tt.created_at and date(ce.date_end) \u003e\u003d tt.created_at)\r\n              when tt.country_id \u003d 2 then \r\n                  (SELECT ce.rate FROM `kynaforkids-server-production.kynaforkids.currency_exchange_config_view` ce \r\n                    WHERE ce.from \u003d \u0027IDR\u0027 and ce.to \u003d \u0027VND\u0027 and date(ce.date_start) \u003c\u003d tt.created_at and date(ce.date_end) \u003e\u003d tt.created_at)\r\n               when tt.country_id \u003d 5 then \r\n                  (SELECT ce.rate FROM `kynaforkids-server-production.kynaforkids.currency_exchange_config_view` ce \r\n                    WHERE ce.from \u003d \u0027KIP\u0027 and ce.to \u003d \u0027VND\u0027 and date(ce.date_start) \u003c\u003d tt.created_at and date(ce.date_end) \u003e\u003d tt.created_at)      \r\n         else null\r\n     end as ty_gia,\r\n\r\n      case\r\n              when aov.created_at \u003d aov.first_time_purchase_phone then \u0027New Customers\u0027\r\n              else \u0027Returning Customers\u0027\r\n      end as type_order_phone,\r\n      case\r\n              when aov.created_at \u003d aov.first_time_purchase_email then \u0027New Customers\u0027\r\n              else \u0027Returning Customers\u0027\r\n      end as type_order_email\r\nFROM temp_table tt\r\nLEFT JOIN `kynaforkids.Acc_order_video` aov ON (tt.order_id \u003d aov.id)\r\n\r\nWHERE \r\n      tt.created_at \u003e\u003d \u00272024-08-01\u0027 --and tt.created_at \u003c\u003d \u00272024-10-31\u0027\r\n      and tt.payment_status_id in (2) --,4,5,6)\r\n      and tt.order_status_id in (3)--,2)\r\n),\r\n\r\nadd_line_id_1 as (\r\nSELECT \r\n       MIN(sao.order_date) as calc_date,\r\n       MIN(sao.lead_id) as lead_id,\r\n       sao.order_id,\r\n       MIN(sao.country_id) as order_country_id,\r\n       MIN(sao.total_oc * sao.ty_gia) as total_VND,\r\n       MIN(sao.utm_campaign) as utm_campaign,\r\n\r\nFROM single_ai_order sao\r\nWHERE sao.type_order_email \u003d \u0027New Customers\u0027 and sao.type_order_phone \u003d \u0027New Customers\u0027 \r\ngroup by sao.order_id\r\n),\r\n\r\nadd_line_id_2 as (\r\nSELECT \r\n        ali1.*, \r\n       (SELECT max(auc.line_id) FROM `kynaforkids-server-production.kynaforkids.adwords_utm_campaign` auc\r\n         WHERE lower(auc.name) \u003d lower(ali1.utm_campaign)) as line_id,\r\n        \r\n\r\nFROM add_line_id_1 ali1\r\n)\r\n\r\nselect \r\n       ali.calc_date,\r\n       if(line.name is not null, line.name, \u0027Line_without_ID\u0027) as line_mkt,\r\n       if((select max(ac.country_id) from `kynaforkids-server-production.kynaforkids.adwords_meta_campaign` ac where line.id \u003d ac.line_id) is null,\r\n          ali.order_country_id,\r\n          (select max(ac.country_id) from `kynaforkids-server-production.kynaforkids.adwords_meta_campaign` ac where line.id \u003d ac.line_id)) as country_id,\r\n          (select max(ac.channel_id) from `kynaforkids-server-production.kynaforkids.adwords_meta_campaign` ac where line.id \u003d ac.line_id) as channel_id,\r\n       (select max(ac.product_id) from `kynaforkids-server-production.kynaforkids.adwords_meta_campaign` ac where line.id \u003d ac.line_id) as product_id,\r\n       \r\n       sum(ali.total_VND) as ai_single_order_vnd,\r\n      --  count(distinct ali.lead_id) as num_leads,\r\n       count(distinct ali.order_id) as num_single_ai_orders\r\n       \r\nfrom add_line_id_2 ali\r\nleft join `kynaforkids-server-production.kynaforkids.adwords_meta_line` line ON (ali.line_id \u003d line.id)\r\n-- where line.name like \"%AI%\"\r\nwhere calc_date \u003e\u003d \u00272024-08-01\u0027 \r\ngroup by ali.calc_date, line_mkt, country_id, channel_id, product_id\r\norder by ali.calc_date\r\n\r\n-- SELECT * FROM add_line_id_2\r\n-- where calc_date \u003e\u003d \u00272024-12-01\u0027\r\n\r\n-- SELECT count(*) from order_ai_tutor_single;\r\n-- SELECT count(*) from order_ai_tutor_combo;\r\n-- SELECT count(*) from order_ai_tutor;;"
}, {
  "table_name": "career",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.career`\n(\n  id INT64,\n  title STRING,\n  short_title STRING,\n  slug STRING,\n  category_id INT64,\n  content STRING,\n  quantity INT64,\n  publish_date INT64,\n  end_date INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  link_submit STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_order_contract",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_order_contract`\n(\n  id INT64,\n  order_id INT64,\n  contract_url STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_cancel_compensate",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_cancel_compensate`\n(\n  id INT64,\n  booking_id INT64,\n  alternative_booking_id INT64,\n  teacher_id INT64,\n  begin_at INT64,\n  end_at INT64,\n  status INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "qc_booking_test",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.qc_booking_test`\n(\n  booking_session_id INT64,\n  teacher_id INT64,\n  begin_at INT64,\n  rating INT64,\n  is_rating_applied INT64,\n  status INT64,\n  assignee INT64,\n  approved_by INT64,\n  approved_at INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  last_rating_at INT64,\n  last_confirm_by INT64,\n  last_confirm_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (booking_session_id) NOT ENFORCED\n)\nCLUSTER BY booking_session_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_pronunciation_student_answer",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_pronunciation_student_answer`\n(\n  id INT64,\n  student_id INT64,\n  ai_pronunciation_lesson_id INT64,\n  point INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "thai_commission",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.thai_commission`\n(\n  id INT64,\n  lead_id INT64,\n  total_amount FLOAT64,\n  real_income FLOAT64,\n  affiliate_commission_percent FLOAT64,\n  affiliate_id INT64,\n  affiliate_commission_amount FLOAT64,\n  status INT64,\n  completed_at INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "order_shipping",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.order_shipping`\n(\n  order_id INT64,\n  contact_name STRING,\n  email STRING,\n  phone_number STRING,\n  address STRING,\n  hamlet STRING,\n  location_id INT64,\n  notes STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n);"
}, {
  "table_name": "potential_booking",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.potential_booking`\n(\n  id INT64,\n  potential_teacher_id INT64,\n  booking_id INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  age_size INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "bot_route_fulfillment",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.bot_route_fulfillment`\n(\n  route_id INT64,\n  fulfillment_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (route_id, fulfillment_id) NOT ENFORCED\n)\nCLUSTER BY route_id, fulfillment_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "data_export_update",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.data_export_update`\n(\n  id INT64,\n  name STRING,\n  description STRING,\n  mysql_columns STRING,\n  mysql_table STRING,\n  mysql_columns_character_special STRING,\n  mysql_columns_timestamp STRING,\n  mysql_columns_string STRING,\n  mysql_columns_float STRING,\n  last_output_result STRING,\n  last_run_at INT64,\n  last_is_success INT64,\n  begin_at_run INT64,\n  field_update_name STRING,\n  big_query_table STRING,\n  visible INT64,\n  db_connection STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "potential_teacher",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.potential_teacher`\n(\n  id INT64,\n  begin_at INT64,\n  end_at INT64,\n  teacher_id INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  number_of_shift INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_certificate",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_certificate`\n(\n  id INT64,\n  student_id INT64,\n  program_id INT64,\n  level_id INT64,\n  certificate_url STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "contest_notification_request",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.contest_notification_request`\n(\n  id INT64,\n  type INT64,\n  campaign_id INT64,\n  round_id INT64,\n  send_at INT64,\n  log STRING,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "payment_method",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.payment_method`\n(\n  id INT64,\n  name STRING,\n  key STRING,\n  icon STRING,\n  type INT64,\n  `group` INT64,\n  default_gateway_id INT64,\n  visible INT64,\n  `order` INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_lesson_resource",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_lesson_resource`\n(\n  id INT64,\n  booking_lesson_id INT64,\n  slide_number INT64,\n  type INT64,\n  path STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_package_tutoring",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_package_tutoring`\n(\n  id INT64,\n  program_id INT64,\n  teacher_type_id INT64,\n  lesson_per_week INT64,\n  price_per_lesson NUMERIC(15, 2),\n  lesson INT64,\n  total NUMERIC(15, 2),\n  duration INT64,\n  country_id INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "autocall_booking_student_phone_number",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.autocall_booking_student_phone_number`\n(\n  user_id INT64,\n  phone_number STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (user_id, phone_number) NOT ENFORCED\n)\nCLUSTER BY user_id, phone_number\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "group_talk",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.group_talk`\n(\n  id INT64,\n  title STRING,\n  description STRING,\n  banner STRING,\n  user_type_id INT64,\n  max_students INT64,\n  subject INT64,\n  program_id INT64,\n  level_id INT64,\n  topic_id INT64,\n  schedule_id INT64,\n  begin_at INT64,\n  end_at INT64,\n  status_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  is_show_learning INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ceo_cac_general_aff_dmkt_trial_cashcollect_other_test_part_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.ceo_cac_general_aff_dmkt_trial_cashcollect_other_test_part_view`\nAS select * from `kynaforkids-server-production.datateam_kynaforkids.report_cac_kyna_aff_dmkt_trial_cashcollect_other_test_part_91ba7bf9-c30e-4ed3-98d9-a0dea42a833e`\r\n\r\n-- --OLD--\r\n-- with \r\n-- -- affiliate cost bao gồm cost commission phát sinh cho HV mới Tutoring (1-1, Group, Class) hoặc cost commission phát sinh  khi HV mua lẻ AI Tutor\r\n-- -- có thể chia theo Tutoring hoặc mua lẻ AI Tutor\r\n-- -- có thể chia theo country học viên. Phần affiliate cost cho Tutoring chỉ có trên thị trường VN.\r\n-- affiliate_cost as \r\n-- (\r\n-- select \r\n--       afc.*\r\n-- from `kynaforkids-server-production.kynaforkids.ceo_cac_affiliate_referral_cost_view` afc\r\n-- where afc.year_month \u003c\u003d FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE())\r\n\r\n-- ),\r\n\r\n-- -- digital marketing cost là chi phí có thuế của việc chạy QC mkt trên các kênh QC hàng ngày.\r\n-- -- có thể chia theo Tutoring (not AI Tutor) hoặc AI Tutor\r\n-- -- có thể chia theo thị trường chạy QC xem như là country học viên\r\n\r\n-- digital_mkt_cost as\r\n-- (\r\n-- select\r\n--       FORMAT_DATE(\u0027%Y-%m\u0027, dmkt.date_spend) AS year_month,\r\n--       SUM(dmkt.spend_with_tax) as dmkt_cost,\r\n\r\n-- from `kynaforkids-server-production.kynaforkids.ceo_cac_digital_mkt_spending_view` dmkt\r\n-- where FORMAT_DATE(\u0027%Y-%m\u0027, dmkt.date_spend) \u003c\u003d FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE())\r\n-- group by year_month\r\n-- ),\r\n\r\n-- test_cost as\r\n-- (\r\n-- select\r\n--       ptc.year_month,\r\n--       -- ptc.calc_ctv_month_cost as pt_ctv_cost,\r\n--       (ptc.calc_month_adjustment + ptc.tester_booking_cost) as pt_tester_cost,\r\n--       -- ptc.total_test_cost,\r\n-- from `kynaforkids-server-production.kynaforkids.ceo_cac_tester_cost_view` ptc\r\n-- where ptc.year_month \u003c\u003d FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE())\r\n-- ),\r\n\r\n\r\n-- trial_booking_cost as (\r\n-- select      \r\n--             tbc.year_month,\r\n--             tbc.teacher_cost_hoc_thu            \r\n-- from `kynaforkids.ceo_cac_trial_booking_cost_view` tbc\r\n-- where tbc.year_month \u003c\u003d FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE())\r\n-- order by year_month desc\r\n-- ),\r\n\r\n-- other_cost as \r\n-- (\r\n-- select\r\n--       *      \r\n-- from `kynaforkids.ceo_cac_other_cost_view` oc\r\n\r\n-- ) \r\n\r\n\r\n-- select \r\n--       dmkt.year_month,\r\n--       coalesce(afc.affiliate_cost,0) as affiliate_cost,\r\n--       dmkt.* EXCEPT(year_month),\r\n--       ptc.* EXCEPT(year_month),\r\n--       tbc.* EXCEPT(year_month),\r\n--       oc.* EXCEPT(year_month),\r\n      \r\n--      -- ROUND(afc.affiliate_cost + ptc.pt_tester_cost + dmkt.dmkt_cost + sc.sale_all_cost + tbc.teacher_cost_hoc_thu + oc.cash_collection_cost + oc.other_cost) as all_cost,\r\n--      -- ROUND((afc.affiliate_cost + ptc.pt_tester_cost + dmkt.dmkt_cost + sc.sale_all_cost + tbc.teacher_cost_hoc_thu + oc.cash_collection_cost + oc.other_cost)/nst.total_new_students) as cac_general\r\n\r\n-- from digital_mkt_cost dmkt\r\n-- left join test_cost ptc on (dmkt.year_month \u003d ptc.year_month)\r\n-- left join affiliate_cost afc on (afc.year_month \u003d dmkt.year_month)\r\n-- left join trial_booking_cost tbc on (dmkt.year_month \u003d tbc.year_month)\r\n-- left join other_cost oc on (dmkt.year_month \u003d oc.year_month)\r\n-- order by dmkt.year_month desc\r\n\r\n\r\n\r\n\r\n\r\n;"
}, {
  "table_name": "group_talk_topic",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.group_talk_topic`\n(\n  id INT64,\n  name STRING,\n  code STRING,\n  program_id INT64,\n  level_id INT64,\n  lesson_id INT64,\n  `order` INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "affiliate_user_post_tracking_action",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.affiliate_user_post_tracking_action`\n(\n  id INT64,\n  affiliate_user_post_tracking_id INT64,\n  action INT64,\n  status_from INT64,\n  status_to INT64,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "view_tutoring_video_course_name",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.view_tutoring_video_course_name`\nAS select t1. id, (select t5.name from `kynaforkids-server-production.kynaforkids.package` t5 where t4.package_id \u003d t5.id) as video_course_name\r\nfrom `kynaforkids-server-production.kynaforkids.booking_order` t1 \r\nleft join `kynaforkids-server-production.kynaforkids.booking_order_video_course` t2 on t1.id \u003d t2.booking_order_id \r\nleft join `kynaforkids-server-production.kynaforkids.booking_package_subscription_config` t3 on t3.id \u003d t2.booking_package_subscription_config_id\r\nleft join `kynaforkids-server-production.kynaforkids.package_subscriptions` t4 on t4.id \u003d t3.package_subscription_id\r\nwhere t2.booking_package_subscription_config_id is not null;"
}, {
  "table_name": "booking_session_extend_bonus",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_session_extend_bonus`\n(\n  booking_id INT64,\n  bonus_excess NUMERIC(15, 2),\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (booking_id) NOT ENFORCED\n)\nCLUSTER BY booking_id;"
}, {
  "table_name": "contest_notification_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.contest_notification_log`\n(\n  id INT64,\n  campaign_id INT64,\n  type INT64,\n  student_id INT64,\n  title STRING,\n  content STRING,\n  is_read INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "mission_user_completed",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.mission_user_completed`\n(\n  id INT64,\n  user_id INT64,\n  object_id INT64,\n  object_type INT64,\n  mission_id INT64,\n  point INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_session_tutor_homework",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_session_tutor_homework`\n(\n  id INT64,\n  booking_id INT64,\n  question_file STRING,\n  question_note STRING,\n  expired_at INT64,\n  answer_file STRING,\n  answer_at INT64,\n  teacher_note STRING,\n  teacher_note_at INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_student_request",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_request`\n(\n  id INT64,\n  student_id INT64,\n  program_id INT64,\n  type INT64,\n  status_id INT64,\n  history_priority STRING,\n  apply_date INT64,\n  approved_by INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  redmine_issue_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  is_issue_updated INT64,\n  log STRING,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ai_ipa",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_ipa`\n(\n  id INT64,\n  content STRING,\n  ipa STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "lesson_homework_level",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.lesson_homework_level`\n(\n  id INT64,\n  lesson_id INT64,\n  level_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "contest_student_lead",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.contest_student_lead`\n(\n  id INT64,\n  student_name STRING,\n  parent_name STRING,\n  phone_number STRING,\n  contest_school_id INT64,\n  contest_class_id INT64,\n  contest_campaign_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_level_student",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_level_student`\n(\n  level_id INT64,\n  student_id INT64,\n  total_number_lessons_complete INT64,\n  total_number_lessons INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (level_id, student_id) NOT ENFORCED\n)\nCLUSTER BY level_id, student_id;"
}, {
  "table_name": "booking_level_outline",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_level_outline`\n(\n  id INT64,\n  link STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_student_final_report",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_final_report`\n(\n  id INT64,\n  lesson_id INT64,\n  completed_lesson_number INT64,\n  completed_lesson_percent INT64,\n  student_id INT64,\n  program_id INT64,\n  level_id INT64,\n  vocabulary INT64,\n  use_of_english INT64,\n  pronunciation INT64,\n  listening INT64,\n  speaking INT64,\n  reading_and_writing INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  student_attitude INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "affiliate_landing_page_tag",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.affiliate_landing_page_tag`\n(\n  affiliate_landing_page_id INT64,\n  affiliate_slug_tag STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (affiliate_landing_page_id, affiliate_slug_tag) NOT ENFORCED\n)\nCLUSTER BY affiliate_landing_page_id, affiliate_slug_tag;"
}, {
  "table_name": "booking_lead",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_lead`\n(\n  id INT64,\n  actual_lead_id INT64,\n  sale_id INT64,\n  name STRING,\n  children_name STRING,\n  email STRING,\n  phone_number STRING,\n  fixed_phone_number STRING,\n  source INT64,\n  address STRING,\n  location_id INT64,\n  quiz_score FLOAT64,\n  status INT64,\n  reason_cancel_id STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  utm_campaign STRING,\n  actual_utm_campaign STRING,\n  affiliate_id INT64,\n  actual_affiliate_id INT64,\n  landing_page_name STRING,\n  country_backup INT64,\n  country_id INT64,\n  user_type_id INT64,\n  user_id INT64,\n  program_id INT64,\n  created_type INT64,\n  subjects STRING,\n  recall_date INT64,\n  line_id STRING,\n  payment_method INT64,\n  payment_method_status INT64,\n  thai_lead_status INT64,\n  create_order_at INT64,\n  discount NUMERIC(15, 2),\n  shipping_fee FLOAT64,\n  serial_code STRING,\n  approved_at INT64,\n  upsell INT64,\n  fanpage_name STRING,\n  tracking_id STRING,\n  student_class STRING,\n  student_year_of_birth INT64,\n  student_id INT64,\n  booking_test_id INT64,\n  order_payment_status INT64,\n  is_blocked INT64,\n  intl_phone_number STRING,\n  gclid STRING,\n  count_status_update INT64,\n  labels STRING,\n  is_remind INT64,\n  ads_id STRING,\n  pancake_conversation_id STRING,\n  province_id INT64,\n  district_id INT64,\n  ward_id INT64,\n  is_review INT64,\n  record_number INT64,\n  subject_code STRING,\n  ip_address STRING,\n  bd_incharge_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_session_meeting_info",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_session_meeting_info`\n(\n  booking_session_id INT64,\n  percent_teacher_open_webcam_time INT64,\n  percent_student_open_webcam_time INT64,\n  percent_teacher_talk_time INT64,\n  percent_student_talk_time INT64,\n  percent_time_student_in_class INT64,\n  percent_time_teacher_full_face INT64,\n  percent_time_teacher_no_face INT64,\n  data_teacher_no_face STRING,\n  percent_time_student_full_face INT64,\n  percent_time_student_no_face INT64,\n  data_student_no_face STRING,\n  percent_silent_time INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  time_teacher_in_meeting INT64,\n  teacher_waiting_time INT64,\n  start_learning_time INT64,\n  end_learning_time INT64,\n  time_teacher_join_meeting INT64,\n  time_student_join_meeting INT64,\n  time_teacher_left_meeting INT64,\n  time_student_left_meeting INT64,\n  learning_dashboard_data STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (booking_session_id) NOT ENFORCED\n)\nCLUSTER BY booking_session_id;"
}, {
  "table_name": "bot_flow_route",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.bot_flow_route`\n(\n  flow_id INT64,\n  route_name STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (route_name) NOT ENFORCED\n)\nCLUSTER BY route_name\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "report_studio",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.report_studio`\n(\n  id INT64,\n  name STRING,\n  link STRING,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "Acc_order_video",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.Acc_order_video`\nAS WITH\r\norder_ai_tutor_single AS\r\n(SELECT \r\n        (select min(order_action.created_at) from `kynaforkids-server-production.kynaforkids.order_action` order_action \r\n  where order_action.order_id \u003d ord.id and not order_action.order_status \u003d 1 ) as ngay_sale_len_don,\r\n        ord.id,\r\n        ord.completed_at,\r\n        ord.created_by,\r\n        ord.telesale_id,\r\n        ord.register_source,        \r\n        ord.country_id,\r\n        `kynaforkids-server-production.kynaforkids.func_get_country`(ord.country_id) as country,\r\n        ord.currency_exchange_rate,\r\n      --   ord.total as total_oc,\r\n        ord.sub_total,\r\n       ordd.unit_price,\r\n        ori.name as student_name,\r\n        ori.phone_number as student_phone,\r\n        ori.email as student_email,\r\n        ord.invoice_code,\r\n        case\r\n            when ord.`status` \u003d 1 then \u0027Mới tạo\u0027\r\n            when ord.`status` \u003d 2 then \u0027Xác nhận\u0027\r\n            when ord.`status` \u003d 3 then \u0027Hoàn thành\u0027\r\n            when ord.`status` \u003d 4 then \u0027Hủy\u0027\r\n            else \u0027Khác\u0027\r\n\t      end as status,\r\n        ord.payment_method_id,\r\n        ord.payment_method_status as payment_status_id,\r\n        \r\n        case when ord.invoice_code like \u0027KYNA%\u0027 then ori.lead_id\r\n             when ord.invoice_code like \u0027GRAI%\u0027 then bo.lead_id \r\n            --  (select bo.affiliate_id from `kynaforkids.booking_order` bo where RIGHT(bo.invoice_code,8) \u003d RIGHT(ord.invoice_code,8))\r\n        end as lead_id,\r\n        \r\n        case when ord.invoice_code like \u0027KYNA%\u0027 then ord.affiliate_id\r\n             when ord.invoice_code like \u0027GRAI%\u0027 then bo.affiliate_id\r\n        end as affiliate_id,\r\n      --   ord.utm_campaign,\r\n        ordd.package_id,\r\n        ordd.package_subscription_id,\r\n        pk.name as Mon_hoc,\r\n        (select pm.`name` from `kynaforkids-server-production.kynaforkids.payment_method` pm where pm.id \u003d ord.payment_method_id) as payment_method,\r\n        case\r\n      when ord.payment_method_status \u003d 1 then \u0027Chờ thanh toán\u0027\r\n      when ord.payment_method_status \u003d 2 then \u0027Đã thanh toán\u0027\r\n      when ord.payment_method_status \u003d 3 then \u0027Thanh toán thất bại\u0027\r\n      when ord.payment_method_status \u003d 4 then \u0027Chờ giao hàng\u0027\r\n \twhen ord.payment_method_status \u003d 5 then \u0027Đang giao hàng\u0027\r\n      when ord.payment_method_status \u003d 6 then \u0027Đã giao hàng\u0027\r\n      when ord.payment_method_status \u003d 7 then \u0027Đang trả hàng\u0027\r\n      when ord.payment_method_status \u003d 8 then \u0027Đã trả hàng\u0027\r\n      else null\r\n\tend as payment_status,\r\n      -- (select pg.`name` from `kynaforkids-server-production.kynaforkids.payment_gateway` pg where pg.id \u003d ord.shipping_method_id) as shipping_company,\r\n--     (select max(pt.transaction_code) from `kynaforkids-server-production.kynaforkids.payment_transaction` pt where pt.order_id \u003d ord.id) as partner_code,\r\n     if(ord.discount_amount is null,0,ord.discount_amount) as discount_amount,\r\n    if(ordd.voucher_discount_amount is null,0,ordd.voucher_discount_amount) as voucher_discount_amount,\r\n    if(ord.shipping_fee is null,0,ord.shipping_fee) as shipping_fee,\r\n    (select u.email from `kynaforkids-server-production.kynaforkids.user` u where u.id \u003d ord.created_by) as SIC,\r\n    (select max(p.name) from `kynaforkids-server-production.kynaforkids.profile` p where p.user_id \u003d ord.created_by) as SIC_name,\r\n    case\r\n    when ordd.package_combo_id is not null then\r\n    (select pcsi.package_subscription_id from `kynaforkids-server-production.kynaforkids.package_combo_subscription_item` pcsi where pcsi.id \u003d ordd.package_subscription_id and pcsi.package_id \u003d ordd.package_id)\r\n    else ordd.package_subscription_id\r\n    end as package_subscription\r\n\r\n        \r\n       \r\nFROM `kynaforkids-server-production.kynaforkids.order` ord\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.order_detail` ordd ON (ord.id \u003d ordd.order_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.order_register_info` ori ON (ord.id \u003d ori.order_id)\r\n-- LEFT JOIN `kynaforkids-server-production.kynaforkids.package_subscriptions` pks ON (ordd.package_subscription_id \u003d pks.id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.package` pk ON (pk.id \u003d ordd.package_id)\r\n-- LEFT JOIN `kynaforkids.booking_lead` bll on bll.id \u003d ori.lead_id\r\nLEFT JOIN `kynaforkids.booking_order` bo on RIGHT(bo.invoice_code,8) \u003d RIGHT(ord.invoice_code,8)\r\n\r\n\r\n\r\n\r\nWHERE \r\n      ord.invoice_code like \u0027KYNA%\u0027 or ord.invoice_code like \u0027GRAI%\u0027\r\n--       AND pk.name like \u0027%AI Tutor%\u0027\r\n--       AND ordd.package_combo_id is null\r\n),\r\n\r\ntemp_table as (\r\nSELECT oats.*,\r\n       (SELECT us.email FROM kynaforkids-server-production.kynaforkids.user us WHERE oats.affiliate_id \u003d us.id) as affiliate_email,\r\n       (SELECT au.affiliate_category_id FROM kynaforkids-server-production.kynaforkids.affiliate_user au WHERE au.user_id \u003d oats.affiliate_id) as affiliate_category_id,\r\n        \r\n       if(oats.completed_at is null, oats.ngay_sale_len_don, oats.completed_at) as created_at,\r\n       t2.first_time_purchase_phone,\r\n       t3.first_time_purchase_email,\r\n       ps.subscription_month,\r\n       ps.name as subscription_name,\r\n       CASE WHEN(oats.sub_total !\u003d 0) then (oats.unit_price + (oats.unit_price/oats.sub_total) * (oats.shipping_fee - (oats.discount_amount + oats.voucher_discount_amount)))\r\n            WHEN (oats.sub_total\u003d0) then 0\r\n            END as total_oc,\r\n       \r\nFROM order_ai_tutor_single oats\r\n      LEFT JOIN\r\n\r\n      (select ans1.phone_number,\r\n      min(ans1.completed_at) as first_time_purchase_phone\r\n      from kynaforkids-server-production.kynaforkids.Acc_No_Students_Tutoring_AI as ans1\r\n      group by ans1.phone_number order by ans1.phone_number) t2\r\n\r\n      on oats.student_phone \u003d t2.phone_number\r\n\r\n      LEFT JOIN\r\n      \r\n      (select ans2.email,\r\n      min(ans2.completed_at) as first_time_purchase_email\r\n      from kynaforkids-server-production.kynaforkids.Acc_No_Students_Tutoring_AI as ans2\r\n      group by ans2.email order by ans2.email) t3\r\n\r\n      on oats.student_email \u003d t3.email\r\n\r\n      LEFT JOIN `kynaforkids-server-production.kynaforkids.package_subscriptions` ps ON (oats.package_subscription \u003d ps.id)\r\n)\r\n\r\nselect tt.* EXCEPT(affiliate_email),\r\n      if(bll.actual_lead_id is null, bll.utm_campaign,\r\n        (select bl.utm_campaign from `kynaforkids-server-production.kynaforkids.booking_lead` bl where bl.id \u003d bll.actual_lead_id)) as utm_campaign,\r\n      if(bll.actual_lead_id is null, bll.landing_page_name,\r\n        (select bl.landing_page_name from `kynaforkids-server-production.kynaforkids.booking_lead` bl where bl.id \u003d bll.actual_lead_id)) as landingpage_name,\r\n      -- if(bll.actual_lead_id is null, bll.affiliate_id,\r\n      --   (select bl.affiliate_id from `kynaforkids-server-production.kynaforkids.booking_lead` bl where bl.id \u003d bll.actual_lead_id)) as affiliate_id,\r\n      case when tt.invoice_code like \"KYNA%\" then tt.affiliate_email\r\n           else --if(bll.actual_lead_id is null, (select max(u.email) from `kynaforkids-server-production.kynaforkids.user` u where bll.affiliate_id \u003d u.id),\r\n      --     (select max(u.email) from `kynaforkids-server-production.kynaforkids.booking_lead` bl, `kynaforkids-server-production.kynaforkids.user` u where bll.actual_lead_id \u003d bl.id and bl.affiliate_id \u003d u.id))               \r\n                  (select max(u.email) from `kynaforkids-server-production.kynaforkids.user` u, `kynaforkids-server-production.kynaforkids.affiliate_user` au where au.affiliate_id \u003d  tt.affiliate_id and au.user_id \u003d u.id)\r\n  \r\n      end as affiliate_email,\r\n     \r\n      -- case when tt.invoice_code like \"KYNA%\" then (SELECT ac.name FROM `kynaforkids.affiliate_category` ac WHERE ac.id \u003d tt.affiliate_category_id)\r\n      --      else if (bll.actual_lead_id is null, (select ac.name from `kynaforkids-server-production.kynaforkids.affiliate_user` au, `kynaforkids-server-production.kynaforkids.affiliate_category` ac where \r\n      --     bll.affiliate_id \u003d au.user_id and au.affiliate_category_id \u003d ac.id),(select ac.name from `kynaforkids-server-production.kynaforkids.booking_lead` bl, \r\n      --     `kynaforkids-server-production.kynaforkids.affiliate_user` au, `kynaforkids-server-production.kynaforkids.affiliate_category` ac \r\n      --     where bl.id \u003d bll.actual_lead_id and bl.affiliate_id \u003d au.user_id and au.affiliate_category_id \u003d ac.id)) \r\n      -- end as affiliate_category_name,\r\n\r\n      case when tt.invoice_code like \"KYNA%\" then (SELECT ac.name FROM `kynaforkids.affiliate_category` ac WHERE ac.id \u003d tt.affiliate_category_id)\r\n           else  (select ac.name from `kynaforkids-server-production.kynaforkids.affiliate_category` ac, `kynaforkids-server-production.kynaforkids.affiliate_user` au  where \r\n      tt.affiliate_id \u003d au.affiliate_id and au.affiliate_category_id \u003d ac.id)\r\n      end as affiliate_category_name,\r\n\r\n\r\nfrom temp_table tt\r\nleft join `kynaforkids.booking_lead` bll on tt.lead_id \u003d bll.id\r\n-- left join `kynaforkids.booking_order` bo on bo.lead_id \u003d tt.lead_id\r\n\r\n;"
}, {
  "table_name": "booking_duo_access_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_duo_access_log`\n(\n  id INT64,\n  previous_booking_id INT64,\n  student_id INT64,\n  access_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "remain_lesson_scheduler",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.remain_lesson_scheduler`\n(\n  user_id INT64,\n  parent_id INT64,\n  email STRING,\n  program STRING,\n  student_code STRING,\n  student_status INT64,\n  total_lesson INT64,\n  used_lesson INT64,\n  remain_lesson INT64,\n  sale_in_charge_email STRING,\n  telesales_supervisor_email STRING,\n  country STRING,\n  max_order_id INT64,\n  booking_id INT64,\n  affiliate_email STRING,\n  affiliate_category STRING,\n  quoc_tich_gv STRING,\n  phone_hv INT64\n);"
}, {
  "table_name": "booking_periodic_quiz",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_periodic_quiz`\n(\n  booking_lesson_id INT64,\n  lesson_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n);"
}, {
  "table_name": "sale_bonus_income",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.sale_bonus_income`\n(\n  id INT64,\n  sale_id INT64,\n  date INT64,\n  date_cycle INT64,\n  country_id INT64,\n  total_order_completed INT64,\n  total_cod_activated INT64,\n  total_order_cod INT64,\n  total_order_returned INT64,\n  total_order_refund INT64,\n  total_percent_refund NUMERIC(15, 2),\n  total_percent_passed NUMERIC(15, 2),\n  total_order_bonus INT64,\n  total_bonus NUMERIC(15, 2),\n  total_income NUMERIC(15, 2),\n  status_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_conversation_template",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_conversation_template`\n(\n  id INT64,\n  ai_topic_id INT64,\n  ai_role_config_id INT64,\n  content STRING,\n  translate STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  banner STRING,\n  visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ceo_cac_sale_commission_bonus_new_students_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.ceo_cac_sale_commission_bonus_new_students_view`\nAS -- WITH \r\n-- order_info AS (\r\n--   (SELECT \r\n--       --     date(bo.created_at) AS ngay_tao_don,\r\n--       --     date(bo.payment_at) AS ngay_duyet_don,\r\n--           if(bo.accounting_date IS NULL, bo.created_at, bo.accounting_date) AS accounting_date,\r\n\r\n--      (SELECT created_at\r\n--       FROM `kynaforkids-server-production.kynaforkids.booking_lead`\r\n--       WHERE id \u003d bo.lead_id) AS ngay_tao_lead,\r\n--       --     bo.invoice_code,\r\n--           bo.student_code,\r\n--           bo.student_id,\r\n--           bo.phone_number,\r\n--           bo.id as order_id,\r\n--           bo.international_country_id,\r\n--           coalesce(bo.total_video_course, 0) AS total_video_course,\r\n--           bo.total,\r\n--           `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(cast(bo.payment_content AS INT64)) AS noi_dung_thanh_toan,\r\n--           `kynaforkids-server-production.kynaforkids.func_get_source`(bo.source) AS source,\r\n--           `kynaforkids-server-production.kynaforkids.func_get_program_name_from_id`(bo.program_id) AS program,\r\n--           bo.program_type,\r\n--           `kynaforkids-server-production.kynaforkids.func_get_booking_order_status`(bo.status) AS order_status,\r\n--           CASE WHEN bo.payment_status \u003d 0 THEN \u0027Chưa duyệt\u0027 \r\n--                WHEN bo.payment_status \u003d 1 THEN \u0027Đã duyệt\u0027 \r\n--                WHEN bo.payment_status \u003d 2 THEN \u0027Không duyệt\u0027 \r\n--                WHEN bo.payment_status \u003d 3 THEN \u0027Cần điều chỉnh\u0027 \r\n--                WHEN bo.payment_status \u003d 4 THEN \u0027Đã điều chỉnh\u0027 \r\n--                ELSE \u0027Khác\u0027 \r\n--           END AS payment_status,\r\n--           coalesce(bo.total,0) - coalesce(bo.discount_money,0) AS price,\r\n--           bo.lead_id AS lead_id,\r\n   \r\n--           bo.currency_exchange_rate,\r\n--           `kynaforkids-server-production.kynaforkids.func_get_country`(bo.international_country_id) AS country,\r\n          \r\n--           bo.order_type,\r\n--           bo.order_type_sub,\r\n--    FROM `kynaforkids-server-production.kynaforkids.booking_order_view` bo\r\n--    LEFT JOIN `kynaforkids-server-production.kynaforkids.booking_lead` bll ON bll.id \u003d bo.lead_id\r\n--    WHERE not (bo.order_type in (2) and bo.order_type_sub in (9)) \r\n--          and bo.program_type \u003d 1\r\n--          and coalesce(bo.total_video_course, 0) + coalesce(bo.total, 0) \u003e 0\r\n--    )\r\n-- ),\r\n\r\n-- -- tháng hiện tại lấy điều kiện mềm với đơn hàng: t1.payment_status in (\u0027Đã duyệt\u0027,\u0027Chưa duyệt\u0027,\u0027Cần điều chỉnh\u0027)  t1.order_status in (\u0027Hoàn thành\u0027, \u0027Chờ xác nhận thanh toán\u0027) --\r\n-- temp_table_2a as\r\n-- (\r\n-- SELECT \r\n--        t1.order_id,\r\n--        t1.order_type,\r\n--        t1.order_type_sub,\r\n--        t1.accounting_date,\r\n--        t1.phone_number,\r\n--        t1.international_country_id as country_id,\r\n--        t1.total_video_course,\r\n--        t1.total,\r\n--        t1.noi_dung_thanh_toan,\r\n--        t1.source,\r\n--        t1.program,\r\n--        t1.program_type,\r\n--        t1.order_status,\r\n--        t1.payment_status,\r\n--        t1.country,\r\n--        t1.student_id,\r\n--        t1.student_code,\r\n--       (\r\n--          SELECT COUNT(distinct bo.order_id) \r\n--          FROM order_info bo \r\n--          WHERE (bo.student_id \u003d t1.student_id OR bo.student_code \u003d t1.student_code) \r\n--          AND bo.payment_status in (\u0027Đã duyệt\u0027)  \r\n--          AND bo.order_status in (\u0027Hoàn thành\u0027) \r\n--          AND bo.noi_dung_thanh_toan in (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n--          AND date(bo.accounting_date) \u003c date(t1.accounting_date)\r\n--       ) as num_completed_orders_same_student, \r\n\r\n--         (\r\n--          SELECT COUNT(distinct bo.order_id) \r\n--          FROM order_info bo \r\n--          WHERE (RIGHT(bo.phone_number,9) \u003d RIGHT(t1.phone_number,9)) \r\n--                   AND bo.payment_status in (\u0027Đã duyệt\u0027) \r\n--                   AND bo.order_status in (\u0027Hoàn thành\u0027) \r\n--                   AND bo.noi_dung_thanh_toan in (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n--                   and date(bo.accounting_date) \u003c date(t1.accounting_date)\r\n--       ) as num_completed_orders_same_phone,\r\n\r\n-- FROM order_info t1\r\n-- WHERE \r\n--       t1.accounting_date \u003e\u003d \u00272024-01-01\u0027 \r\n--       AND t1.payment_status in (\u0027Đã duyệt\u0027,\u0027Chưa duyệt\u0027,\u0027Cần điều chỉnh\u0027) \r\n--       AND t1.order_status in (\u0027Hoàn thành\u0027, \u0027Chờ xác nhận thanh toán\u0027)\r\n--       AND t1.noi_dung_thanh_toan in (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n--       AND (t1.price + t1.total_video_course) \u003e 0\r\n--       AND FORMAT_DATE(\u0027%Y-%m\u0027, t1.accounting_date) \u003d FORMAT_DATE(\u0027%Y-%m\u0027, current_date())\r\n-- ),\r\n\r\n-- -- tháng quá khứ lấy điều kiện chặt: t1.payment_status in (\u0027Đã duyệt\u0027); t1.order_status in (\u0027Hoàn thành\u0027)\r\n-- temp_table_2b as\r\n-- (\r\n-- SELECT \r\n--        t1.order_id,\r\n--        t1.order_type,\r\n--        t1.order_type_sub,\r\n--        t1.accounting_date,\r\n--        t1.phone_number,\r\n--        t1.international_country_id as country_id,\r\n--        t1.total_video_course,\r\n--        t1.total,\r\n--        t1.noi_dung_thanh_toan,\r\n--        t1.source,\r\n--        t1.program,\r\n--        t1.program_type,\r\n--        t1.order_status,\r\n--        t1.payment_status,\r\n--        t1.country,\r\n--        t1.student_id,\r\n--        t1.student_code,\r\n--       (\r\n--          SELECT COUNT(distinct bo.order_id) \r\n--          FROM order_info bo \r\n--          WHERE (bo.student_id \u003d t1.student_id OR bo.student_code \u003d t1.student_code) \r\n--          AND bo.payment_status in (\u0027Đã duyệt\u0027)  \r\n--          AND bo.order_status in (\u0027Hoàn thành\u0027) \r\n--          AND bo.noi_dung_thanh_toan in (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n--          AND date(bo.accounting_date) \u003c date(t1.accounting_date)\r\n--       ) as num_completed_orders_same_student, \r\n\r\n--         (\r\n--          SELECT COUNT(distinct bo.order_id) \r\n--          FROM order_info bo \r\n--          WHERE (RIGHT(bo.phone_number,9) \u003d RIGHT(t1.phone_number,9)) \r\n--                   AND bo.payment_status in (\u0027Đã duyệt\u0027) \r\n--                   AND bo.order_status in (\u0027Hoàn thành\u0027) \r\n--                   AND bo.noi_dung_thanh_toan in (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n--                   and date(bo.accounting_date) \u003c date(t1.accounting_date)\r\n--       ) as num_completed_orders_same_phone,\r\n\r\n-- FROM order_info t1\r\n-- WHERE \r\n--       t1.accounting_date \u003e\u003d \u00272024-01-01\u0027 \r\n--       AND t1.payment_status in (\u0027Đã duyệt\u0027) --,\u0027Chưa duyệt\u0027,\u0027Cần điều chỉnh\u0027) \r\n--       AND t1.order_status in (\u0027Hoàn thành\u0027) --, \u0027Chờ xác nhận thanh toán\u0027)\r\n--       AND t1.noi_dung_thanh_toan in (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n--       AND (t1.price + t1.total_video_course) \u003e 0\r\n--       AND FORMAT_DATE(\u0027%Y-%m\u0027, t1.accounting_date) \u003c FORMAT_DATE(\u0027%Y-%m\u0027, current_date())\r\n-- ),\r\n\r\n-- temp_table_2 as\r\n-- (\r\n-- select * from temp_table_2a\r\n\r\n-- UNION ALL\r\n\r\n-- select * from temp_table_2b\r\n-- ),\r\n\r\n-- temp_table_3 as\r\n-- (SELECT \r\n--        t2.*,\r\n--        if(not(student_id is null AND student_code is null),if(t2.num_completed_orders_same_student \u003e 0, \u0027Học viên cũ\u0027, \u0027Học viên mới\u0027),if(t2.num_completed_orders_same_phone \u003e 0, \u0027có order cùng phone chưa rõ HV cũ/mới\u0027, \u0027Học viên mới\u0027)) as old_new_student,\r\n       \r\n\r\n-- FROM temp_table_2 t2\r\n-- ),\r\n\r\n-- sale_commission_data as (\r\n-- SELECT \r\n   \r\n--     tt3.accounting_date as ngay_hach_toan,\r\n--     (select b.currency_exchange_rate from `kynaforkids-server-production.kynaforkids.booking_order_view` b where a.order_id\u003db.id) AS ty_gia,\r\n--     a.amount AS thu_nhap,\r\n-- FROM `kynaforkids-server-production.kynaforkids.booking_sale_commission` a\r\n-- inner join temp_table_3 tt3 on tt3.order_id \u003d a.order_id\r\n-- WHERE tt3.old_new_student in (\u0027Học viên mới\u0027)\r\n-- ),\r\n\r\n-- table_1 as\r\n-- (\r\n-- select \r\n--       scd.*,\r\n--       scd.ty_gia * scd.thu_nhap as sale_tutoring_bonus_vnd,\r\n--       FORMAT_DATE(\u0027%Y-%m\u0027, scd.ngay_hach_toan) as year_month,\r\n  \r\n-- from sale_commission_data scd  \r\n-- where scd.ty_gia * scd.thu_nhap \u003c 20000000\r\n-- ),\r\n\r\n-- sale_tutoring_bonus as\r\n-- (\r\n-- select\r\n--       year_month,\r\n--       ROUND(sum(sale_tutoring_bonus_vnd)) as sale_tutoring_bonus_vnd,\r\n-- from table_1 t1\r\n-- where year_month \u003e\u003d \u00272024-01\u0027\r\n-- group by year_month\r\n-- order by year_month desc\r\n-- ),\r\n\r\n-- -- ai single new student orders\r\n-- -- CTE 1: Thu thập đơn hàng AI Tutor với lọc sớm\r\n-- order_ai_tutor AS (\r\n--     SELECT\r\n--         ord.id AS order_id,\r\n--         COALESCE(\r\n--             DATE(ord.completed_at),\r\n--             DATE(ord.created_at)\r\n--         ) AS accounting_date,\r\n        \r\n--         ord.total,\r\n--         ord.currency_exchange_rate,\r\n--         ord.sub_total,\r\n--          ordd.unit_price,\r\n--         if(ord.discount_amount is null,0,ord.discount_amount) as discount_amount,\r\n--         if(ordd.voucher_discount_amount is null,0,ordd.voucher_discount_amount) as voucher_discount_amount,\r\n--         if(ord.shipping_fee is null,0,ord.shipping_fee) as shipping_fee,\r\n\r\n--     FROM `kynaforkids-server-production.kynaforkids.order_view` ord\r\n--     JOIN `kynaforkids-server-production.kynaforkids.order_detail` ordd\r\n--         ON ord.id \u003d ordd.order_id\r\n--     LEFT JOIN `kynaforkids.package_combo_subscription_item` pcs\r\n--         ON ordd.package_subscription_id \u003d pcs.id AND ordd.package_combo_id IS NOT NULL\r\n--     JOIN `kynaforkids-server-production.kynaforkids.package_subscriptions` pks\r\n--         ON COALESCE(pcs.package_subscription_id, ordd.package_subscription_id) \u003d pks.id\r\n--     JOIN `kynaforkids-server-production.kynaforkids.package` pk\r\n--         ON COALESCE(pcs.package_id, ordd.package_id) \u003d pk.id\r\n--     WHERE\r\n--         ord.payment_method_status \u003d 2\r\n--         AND ord.status \u003d 3\r\n--         AND (ord.invoice_code LIKE \u0027KYNA%\u0027 OR ord.invoice_code LIKE \u0027GRAI%\u0027)\r\n--         AND (\r\n--             (ordd.package_combo_id IS NULL AND pk.name LIKE \u0027%AI Tutor%\u0027)\r\n--             OR\r\n--             (ordd.package_combo_id IS NOT NULL AND pk.name LIKE \u0027%AI%\u0027)\r\n--         )\r\n-- ),\r\n\r\n\r\n-- -- CTE 2: Xác định khách hàng mới\r\n-- new_customers AS (\r\n--     SELECT\r\n--         oat.order_id,\r\n--         min(oat.accounting_date) as accounting_date,\r\n--         min(oat.currency_exchange_rate) as currency_exchange_rate,\r\n        \r\n--         CASE WHEN(min(oat.sub_total) !\u003d 0) then (min(oat.unit_price) + (min(oat.unit_price)/min(oat.sub_total)) * (min(oat.shipping_fee) - (min(oat.discount_amount) + min(oat.voucher_discount_amount))))\r\n--             WHEN (min(oat.sub_total)\u003d0) then 0\r\n--         END as total_oc,\r\n        \r\n--         CASE\r\n--             WHEN min(oat.accounting_date) \u003d DATE(min(aov.first_time_purchase_phone))\r\n--              AND min(oat.accounting_date) \u003d DATE(min(aov.first_time_purchase_email))\r\n--             THEN \u0027New Customer\u0027\r\n--             ELSE \u0027Returning Customer\u0027\r\n--         END AS customer_type\r\n--     FROM order_ai_tutor oat\r\n--     LEFT JOIN `kynaforkids.Acc_order_video_view` aov\r\n--         ON oat.order_id \u003d aov.id\r\n--     WHERE\r\n--         oat.accounting_date \u003e\u003d \u00272024-01-01\u0027\r\n--     GROUP BY order_id\r\n-- ),  \r\n\r\n\r\n-- -- Truy vấn cuối: Đếm học sinh mới theo ngày\r\n-- sale_ai_bonus as\r\n-- (\r\n-- SELECT\r\n--     FORMAT_DATE(\u0027%Y-%m\u0027,accounting_date) AS year_month,\r\n-- --     COUNT(distinct order_id) AS num_new_students_AI_single,\r\n-- --     ROUND(SUM(total_oc * currency_exchange_rate)) as total_order_value,\r\n--     ROUND(SUM(total_oc * currency_exchange_rate) * 0.08) as sale_ai_tutor_commission_vnd,\r\n-- FROM new_customers\r\n-- WHERE customer_type \u003d \u0027New Customer\u0027\r\n-- GROUP BY year_month\r\n-- ORDER BY year_month DESC\r\n-- )\r\n\r\n-- select \r\n--       stb.year_month,\r\n--       stb.sale_tutoring_bonus_vnd,\r\n--       sab.sale_ai_tutor_commission_vnd,\r\n--       stb.sale_tutoring_bonus_vnd + coalesce(sab.sale_ai_tutor_commission_vnd,0) as sale_bonus_vnd\r\n      \r\n\r\n-- from sale_tutoring_bonus stb\r\n-- left join sale_ai_bonus sab using(year_month)\r\n-- order by stb.year_month desc\r\n\r\n-- -- where a.order_id \u003d 62963\r\n\r\n-- -- Base CTE for order information with standardized formatting and reduced redundancy\r\n-- WITH order_info AS (\r\n--   SELECT\r\n--     COALESCE(bo.accounting_date, bo.created_at) AS accounting_date,\r\n--     bl.created_at AS ngay_tao_lead,\r\n--     bo.student_code,\r\n--     bo.student_id,\r\n--     bo.phone_number,\r\n--     bo.id AS order_id,\r\n--     bo.international_country_id,\r\n--     COALESCE(bo.total_video_course, 0) AS total_video_course,\r\n--     bo.total,\r\n--     `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(CAST(bo.payment_content AS INT64)) AS noi_dung_thanh_toan,\r\n--     `kynaforkids-server-production.kynaforkids.func_get_source`(bo.source) AS source,\r\n--     `kynaforkids-server-production.kynaforkids.func_get_program_name_from_id`(bo.program_id) AS program,\r\n--     bo.program_type,\r\n--     `kynaforkids-server-production.kynaforkids.func_get_booking_order_status`(bo.status) AS order_status,\r\n--     CASE \r\n--       WHEN bo.payment_status \u003d 0 THEN \u0027Chưa duyệt\u0027 \r\n--       WHEN bo.payment_status \u003d 1 THEN \u0027Đã duyệt\u0027 \r\n--       WHEN bo.payment_status \u003d 2 THEN \u0027Không duyệt\u0027 \r\n--       WHEN bo.payment_status \u003d 3 THEN \u0027Cần điều chỉnh\u0027 \r\n--       WHEN bo.payment_status \u003d 4 THEN \u0027Đã điều chỉnh\u0027 \r\n--       ELSE \u0027Khác\u0027 \r\n--     END AS payment_status,\r\n--     COALESCE(bo.total, 0) - COALESCE(bo.discount_money, 0) AS price,\r\n--     bo.lead_id,\r\n--     bo.currency_exchange_rate,\r\n--     `kynaforkids-server-production.kynaforkids.func_get_country`(bo.international_country_id) AS country,\r\n--     bo.order_type,\r\n--     bo.order_type_sub\r\n--   FROM `kynaforkids-server-production.kynaforkids.booking_order_view` bo\r\n--   LEFT JOIN `kynaforkids-server-production.kynaforkids.booking_lead` bl ON bl.id \u003d bo.lead_id\r\n--   WHERE NOT (bo.order_type \u003d 2 AND bo.order_type_sub \u003d 9)\r\n--     AND bo.program_type \u003d 1\r\n--     AND COALESCE(bo.total_video_course, 0) + COALESCE(bo.total, 0) \u003e 0\r\n-- ),\r\n\r\n-- -- Combining previous completed orders for student and phone tracking\r\n-- -- This replaces two separate subqueries with a single pre-computed lookup table\r\n-- previous_orders AS (\r\n--   SELECT\r\n--     bo.student_id,\r\n--     bo.student_code,\r\n--     RIGHT(bo.phone_number, 9) AS phone_number_suffix,\r\n--     bo.accounting_date,\r\n--     COUNT(DISTINCT bo.order_id) AS num_orders\r\n--   FROM order_info bo\r\n--   WHERE bo.payment_status \u003d \u0027Đã duyệt\u0027\r\n--     AND bo.order_status \u003d \u0027Hoàn thành\u0027\r\n--     AND bo.noi_dung_thanh_toan IN (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027)\r\n--   GROUP BY bo.student_id, bo.student_code, RIGHT(bo.phone_number, 9), bo.accounting_date\r\n-- ),\r\n\r\n-- -- Combined logic for both current and past months with a filter flag\r\n-- combined_orders AS (\r\n--   SELECT\r\n--     t1.order_id,\r\n--     t1.order_type,\r\n--     t1.order_type_sub,\r\n--     t1.accounting_date,\r\n--     t1.phone_number,\r\n--     t1.international_country_id AS country_id,\r\n--     t1.total_video_course,\r\n--     t1.total,\r\n--     t1.noi_dung_thanh_toan,\r\n--     t1.source,\r\n--     t1.program,\r\n--     t1.program_type,\r\n--     t1.order_status,\r\n--     t1.payment_status,\r\n--     t1.country,\r\n--     t1.student_id,\r\n--     t1.student_code,\r\n--     t1.price,\r\n--     FORMAT_DATE(\u0027%Y-%m\u0027, t1.accounting_date) \u003d FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE()) AS is_current_month,\r\n--     (\r\n--       SELECT COUNT(DISTINCT po.num_orders)\r\n--       FROM previous_orders po\r\n--       WHERE (po.student_id \u003d t1.student_id OR po.student_code \u003d t1.student_code)\r\n--         AND DATE(po.accounting_date) \u003c DATE(t1.accounting_date)\r\n--     ) AS num_completed_orders_same_student,\r\n--     (\r\n--       SELECT COUNT(DISTINCT po.num_orders)\r\n--       FROM previous_orders po\r\n--       WHERE po.phone_number_suffix \u003d RIGHT(t1.phone_number, 9)\r\n--         AND DATE(po.accounting_date) \u003c DATE(t1.accounting_date)\r\n--     ) AS num_completed_orders_same_phone\r\n--   FROM order_info t1\r\n--   WHERE t1.accounting_date \u003e\u003d \u00272024-01-01\u0027\r\n--     AND t1.noi_dung_thanh_toan IN (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027)\r\n--     AND (t1.price + t1.total_video_course) \u003e 0\r\n--     AND (\r\n--       -- Current month conditions\r\n--       (\r\n--         FORMAT_DATE(\u0027%Y-%m\u0027, t1.accounting_date) \u003d FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE())\r\n--         AND t1.payment_status IN (\u0027Đã duyệt\u0027, \u0027Chưa duyệt\u0027, \u0027Cần điều chỉnh\u0027,\u0027Đã điều chỉnh\u0027)\r\n--         AND t1.order_status IN (\u0027Hoàn thành\u0027, \u0027Chờ xác nhận thanh toán\u0027)\r\n--       )\r\n--       -- Past month conditions\r\n--       OR (\r\n--         FORMAT_DATE(\u0027%Y-%m\u0027, t1.accounting_date) \u003c FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE())\r\n--         AND t1.payment_status \u003d \u0027Đã duyệt\u0027\r\n--         AND t1.order_status \u003d \u0027Hoàn thành\u0027\r\n--       )\r\n--     )\r\n-- ),\r\n\r\n-- -- Student classification with simplified logic\r\n-- student_classification AS (\r\n--   SELECT\r\n--     co.*,\r\n--     CASE\r\n--       WHEN co.student_id IS NOT NULL OR (co.student_code IS NOT NULL AND trim(co.student_code) !\u003d \u0027\u0027) THEN\r\n--         CASE WHEN co.num_completed_orders_same_student \u003e 0 THEN \u0027Học viên cũ\u0027 ELSE \u0027Học viên mới\u0027 END\r\n--       ELSE\r\n--         CASE WHEN co.num_completed_orders_same_phone \u003e 0 THEN \u0027có order cùng phone chưa rõ HV cũ/mới\u0027 ELSE \u0027Học viên mới\u0027 END\r\n--     END AS old_new_student\r\n--   FROM combined_orders co\r\n-- ),\r\n\r\nWITH\r\n\r\norder_info AS (\r\n  SELECT \r\n      COALESCE(bo.accounting_date, bo.created_at) AS accounting_date,\r\n      (SELECT created_at\r\n       FROM `kynaforkids-server-production.kynaforkids.booking_lead`\r\n       WHERE id \u003d bo.lead_id) AS ngay_tao_lead,\r\n      bo.student_code,\r\n      bo.student_id,\r\n      bo.phone_number,\r\n      bo.id as order_id,\r\n      bo.international_country_id,\r\n      COALESCE(bo.total_video_course, 0) AS total_video_course,\r\n      bo.total,\r\n      `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(CAST(bo.payment_content AS INT64)) AS noi_dung_thanh_toan,\r\n      `kynaforkids-server-production.kynaforkids.func_get_source`(bo.source) AS source,\r\n      `kynaforkids-server-production.kynaforkids.func_get_program_name_from_id`(bo.program_id) AS program,\r\n      bo.program_type,\r\n      `kynaforkids-server-production.kynaforkids.func_get_booking_order_status`(bo.status) AS order_status,\r\n      CASE \r\n          WHEN bo.payment_status \u003d 0 THEN \u0027Chưa duyệt\u0027 \r\n          WHEN bo.payment_status \u003d 1 THEN \u0027Đã duyệt\u0027 \r\n          WHEN bo.payment_status \u003d 2 THEN \u0027Không duyệt\u0027 \r\n          WHEN bo.payment_status \u003d 3 THEN \u0027Cần điều chỉnh\u0027 \r\n          WHEN bo.payment_status \u003d 4 THEN \u0027Đã điều chỉnh\u0027 \r\n          ELSE \u0027Khác\u0027 \r\n      END AS payment_status,\r\n      COALESCE(bo.total, 0) - COALESCE(bo.discount_money, 0) AS price,\r\n      bo.lead_id,\r\n      bo.currency_exchange_rate,\r\n      `kynaforkids-server-production.kynaforkids.func_get_country`(bo.international_country_id) AS country,\r\n      bo.order_type,\r\n      bo.order_type_sub\r\n  FROM `kynaforkids-server-production.kynaforkids.booking_order_view` bo\r\n  LEFT JOIN `kynaforkids-server-production.kynaforkids.booking_lead` bll \r\n      ON bll.id \u003d bo.lead_id\r\n  WHERE bo.program_type \u003d 1\r\n    AND bo.order_type \u003d 1\r\n    AND COALESCE(bo.total_video_course, 0) + COALESCE(bo.total, 0) \u003e 0\r\n),\r\n\r\n-- Consolidated temp table with dynamic filter conditions based on current month vs previous months\r\ntutoring_orders AS (\r\n  SELECT \r\n      t1.order_id,\r\n      t1.order_type,\r\n      t1.order_type_sub,\r\n      t1.accounting_date,\r\n      t1.phone_number,\r\n      t1.international_country_id as country_id,\r\n      t1.total_video_course,\r\n      t1.total,\r\n      t1.noi_dung_thanh_toan,\r\n      t1.source,\r\n      t1.program,\r\n      t1.program_type,\r\n      t1.order_status,\r\n      t1.payment_status,\r\n      t1.country,\r\n      t1.student_id,\r\n      t1.student_code,\r\n      -- Count previous orders by same student\r\n      (\r\n        SELECT COUNT(DISTINCT bo.order_id) \r\n        FROM order_info bo \r\n        WHERE (bo.student_id \u003d t1.student_id OR bo.student_code \u003d t1.student_code) and (t1.student_code is not null or t1.student_id is not null) and (t1.student_code !\u003d \u0027\u0027) \r\n          AND bo.payment_status \u003d \u0027Đã duyệt\u0027  \r\n          AND bo.order_status \u003d \u0027Hoàn thành\u0027 \r\n          AND bo.noi_dung_thanh_toan IN (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n          AND DATE(bo.accounting_date) \u003c DATE(t1.accounting_date)\r\n      ) as num_completed_orders_same_student,\r\n      -- Count previous orders by same phone number\r\n      (\r\n        SELECT COUNT(DISTINCT bo.order_id) \r\n        FROM order_info bo \r\n        WHERE RIGHT(bo.phone_number, 9) \u003d RIGHT(t1.phone_number, 9) \r\n          AND bo.payment_status \u003d \u0027Đã duyệt\u0027 \r\n          AND bo.order_status \u003d \u0027Hoàn thành\u0027 \r\n          AND bo.noi_dung_thanh_toan IN (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n          AND DATE(bo.accounting_date) \u003c DATE(t1.accounting_date)\r\n      ) as num_completed_orders_same_phone,\r\n      -- Flag for current month to apply different filtering logic\r\n      FORMAT_DATE(\u0027%Y-%m\u0027, t1.accounting_date) \u003d FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE()) AS is_current_month\r\n  FROM order_info t1\r\n  WHERE t1.accounting_date \u003e\u003d \u00272020-01-01\u0027 \r\n    AND (\r\n        -- Current month conditions (more lenient)\r\n        (FORMAT_DATE(\u0027%Y-%m\u0027, t1.accounting_date) \u003e\u003d FORMAT_DATE(\u0027%Y-%m\u0027, date_sub(CURRENT_DATE(),interval 8 day))\r\n         AND t1.payment_status IN (\u0027Đã duyệt\u0027, \u0027Chưa duyệt\u0027, \u0027Cần điều chỉnh\u0027, \u0027Đã điều chỉnh\u0027) \r\n         AND t1.order_status IN (\u0027Hoàn thành\u0027, \u0027Chờ xác nhận thanh toán\u0027))\r\n        OR\r\n        -- Past months conditions (more strict)\r\n        (FORMAT_DATE(\u0027%Y-%m\u0027, t1.accounting_date) \u003c FORMAT_DATE(\u0027%Y-%m\u0027, date_sub(CURRENT_DATE(),interval 8 day))\r\n         AND t1.payment_status \u003d \u0027Đã duyệt\u0027\r\n         AND t1.order_status \u003d \u0027Hoàn thành\u0027)\r\n    )\r\n    AND t1.noi_dung_thanh_toan IN (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n    AND (t1.price + t1.total_video_course) \u003e 0\r\n),\r\n\r\n-- Identify whether students are new or returning\r\nstudent_classification AS (\r\n  SELECT \r\n      *,\r\n      CASE \r\n          WHEN NOT(student_id IS NULL AND (student_code IS NULL OR trim(student_code) \u003d \u0027\u0027)) THEN\r\n              IF(num_completed_orders_same_student \u003e 0, \u0027Học viên cũ\u0027, \u0027Học viên mới\u0027)\r\n          ELSE\r\n              IF(num_completed_orders_same_phone \u003e 0, \u0027có order cùng phone chưa rõ HV cũ/mới\u0027, \u0027Học viên mới\u0027)\r\n      END AS old_new_student\r\n  FROM tutoring_orders\r\n),\r\n\r\n-- Sale commission calculation for new students\r\nsale_commission_data AS (\r\n  SELECT\r\n    sc.accounting_date AS ngay_hach_toan,\r\n    bo.currency_exchange_rate AS ty_gia,\r\n    bsc.amount AS thu_nhap\r\n  FROM student_classification sc\r\n  LEFT JOIN `kynaforkids-server-production.kynaforkids.booking_sale_commission` bsc ON sc.order_id \u003d bsc.order_id\r\n  LEFT JOIN `kynaforkids-server-production.kynaforkids.booking_order_view` bo ON sc.order_id \u003d bo.id\r\n  WHERE sc.old_new_student \u003d \u0027Học viên mới\u0027\r\n),\r\n\r\n-- VND conversion for sale tutoring bonus\r\ntutoring_bonus_calculation AS (\r\n  SELECT\r\n    FORMAT_DATE(\u0027%Y-%m\u0027, ngay_hach_toan) AS year_month,\r\n    ty_gia * thu_nhap AS sale_tutoring_bonus_vnd\r\n  FROM sale_commission_data\r\n  WHERE ty_gia * thu_nhap \u003c 20000000\r\n),\r\n\r\n-- Aggregated tutoring bonus by month\r\nsale_tutoring_bonus AS (\r\n  SELECT\r\n    year_month,\r\n    ROUND(SUM(sale_tutoring_bonus_vnd)) AS sale_tutoring_bonus_vnd\r\n  FROM tutoring_bonus_calculation\r\n  WHERE year_month \u003e\u003d \u00272024-01\u0027\r\n  GROUP BY year_month\r\n),\r\n\r\n-- AI Tutor order processing with simplified joins\r\norder_ai_tutor AS (\r\n  SELECT\r\n    ord.id AS order_id,\r\n    COALESCE(DATE(ord.completed_at), DATE(ord.created_at)) AS accounting_date,\r\n    ord.currency_exchange_rate,\r\n    ordd.unit_price,\r\n    ord.sub_total,\r\n    COALESCE(ord.discount_amount, 0) AS discount_amount,\r\n    COALESCE(ordd.voucher_discount_amount, 0) AS voucher_discount_amount,\r\n    COALESCE(ord.shipping_fee, 0) AS shipping_fee\r\n  FROM `kynaforkids-server-production.kynaforkids.order_view` ord\r\n  JOIN `kynaforkids-server-production.kynaforkids.order_detail` ordd ON ord.id \u003d ordd.order_id\r\n  LEFT JOIN `kynaforkids.package_combo_subscription_item` pcs \r\n    ON ordd.package_subscription_id \u003d pcs.id AND ordd.package_combo_id IS NOT NULL\r\n  JOIN `kynaforkids-server-production.kynaforkids.package_subscriptions` pks\r\n    ON COALESCE(pcs.package_subscription_id, ordd.package_subscription_id) \u003d pks.id\r\n  JOIN `kynaforkids-server-production.kynaforkids.package` pk\r\n    ON COALESCE(pcs.package_id, ordd.package_id) \u003d pk.id\r\n  WHERE ord.payment_method_status \u003d 2\r\n    AND ord.status \u003d 3\r\n    AND (ord.invoice_code LIKE \u0027KYNA%\u0027 OR ord.invoice_code LIKE \u0027GRAI%\u0027)\r\n    AND (\r\n      (ordd.package_combo_id IS NULL AND pk.name LIKE \u0027%AI Tutor%\u0027)\r\n      OR (ordd.package_combo_id IS NOT NULL AND pk.name LIKE \u0027%AI%\u0027)\r\n    )\r\n),\r\n\r\n-- New customer identification with simplified logic\r\nnew_customers AS (\r\n  SELECT\r\n    oat.order_id,\r\n    MIN(oat.accounting_date) AS accounting_date,\r\n    MIN(oat.currency_exchange_rate) AS currency_exchange_rate,\r\n    CASE \r\n      WHEN MIN(oat.sub_total) !\u003d 0 THEN \r\n        (MIN(oat.unit_price) + (MIN(oat.unit_price)/MIN(oat.sub_total)) * \r\n         (MIN(oat.shipping_fee) - (MIN(oat.discount_amount) + MIN(oat.voucher_discount_amount))))\r\n      ELSE 0\r\n    END AS total_oc,\r\n    CASE\r\n      WHEN MIN(oat.accounting_date) \u003d DATE(MIN(aov.first_time_purchase_phone)) AND \r\n           MIN(oat.accounting_date) \u003d DATE(MIN(aov.first_time_purchase_email))\r\n      THEN \u0027New Customer\u0027\r\n      ELSE \u0027Returning Customer\u0027\r\n    END AS customer_type\r\n  FROM order_ai_tutor oat\r\n  LEFT JOIN `kynaforkids.Acc_order_video_view` aov ON oat.order_id \u003d aov.id\r\n  WHERE oat.accounting_date \u003e\u003d \u00272024-01-01\u0027\r\n  GROUP BY order_id\r\n),\r\n\r\n-- AI tutor commission calculation\r\nsale_ai_bonus AS (\r\n  SELECT\r\n    FORMAT_DATE(\u0027%Y-%m\u0027, accounting_date) AS year_month,\r\n    ROUND(SUM(total_oc * currency_exchange_rate) * 0.08) AS sale_ai_tutor_commission_vnd\r\n  FROM new_customers\r\n  WHERE customer_type \u003d \u0027New Customer\u0027\r\n  GROUP BY year_month\r\n)\r\n\r\n-- sale_ai_bonus AS (\r\n-- select * from `datateam_kynaforkids.sale_ai_bonus_day_D`\r\n-- )\r\n\r\n-- Final result combining both commission types\r\nSELECT \r\n  stb.year_month,\r\n  stb.sale_tutoring_bonus_vnd,\r\n  sab.sale_ai_tutor_commission_vnd,\r\n  stb.sale_tutoring_bonus_vnd + COALESCE(sab.sale_ai_tutor_commission_vnd, 0) AS sale_bonus_vnd\r\nFROM sale_tutoring_bonus stb\r\nLEFT JOIN sale_ai_bonus sab USING(year_month)\r\nORDER BY stb.year_month DESC;;"
}, {
  "table_name": "ticket_issue_country",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ticket_issue_country`\n(\n  id INT64,\n  issue_id INT64,\n  country_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "adwords_meta_ad",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.adwords_meta_ad`\n(\n  id STRING,\n  name STRING,\n  campaign_id STRING,\n  account_id STRING,\n  ad_group_id STRING,\n  status STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ai_pronunciation_topic",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_pronunciation_topic`\n(\n  id INT64,\n  name STRING,\n  banner STRING,\n  description STRING,\n  ai_pronunciation_level_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  dictionary_keyword_tag STRING,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "order_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.order_view`\nAS SELECT  o.* except(created_at, updated_at, completed_at, telesale_follow_at),\r\n        timestamp_seconds(created_at) as created_at,\r\n        timestamp_seconds(updated_at) as updated_at,\r\n        timestamp_seconds(completed_at) as completed_at,\r\n        timestamp_seconds(telesale_follow_at) as telesale_follow_at,\r\n\r\n\r\nFROM `kynaforkids-server-production.kynaforkids.order` o;"
}, {
  "table_name": "quiz_question_media",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.quiz_question_media`\n(\n  id INT64,\n  quiz_question_id INT64,\n  type INT64,\n  url STRING,\n  position STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "dtp_grade",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.dtp_grade`\n(\n  id INT64,\n  name STRING,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_picture_mode_practice_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_picture_mode_practice_config`\n(\n  id INT64,\n  ai_topic_picture_mode_id INT64,\n  name STRING,\n  type INT64,\n  speech_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "wh_import_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.wh_import_view`\nAS SELECT * except(created_at,updated_at),\r\n      timestamp_seconds(created_at) as created_at,\r\n      timestamp_seconds(updated_at) as updated_at,\r\nFROM `kynaforkids-server-production.kynaforkids.wh_import`;"
}, {
  "table_name": "booking_student_update_info_status",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_update_info_status`\n(\n  user_id INT64,\n  type INT64,\n  send_message_from_date INT64,\n  send_message_to_date INT64,\n  show_notification_from_date INT64,\n  show_notification_to_date INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (user_id) NOT ENFORCED\n)\nCLUSTER BY user_id;"
}, {
  "table_name": "aca_training",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.aca_training`\n(\n  id INT64,\n  title STRING,\n  description STRING,\n  max_trainee INT64,\n  country_id INT64,\n  subject INT64,\n  program_id INT64,\n  lesson_id INT64,\n  schedule_id INT64,\n  begin_at INT64,\n  end_at INT64,\n  trainer_id INT64,\n  status_id INT64,\n  booking_session_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  is_test INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ai_tutor_rating",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_tutor_rating`\n(\n  id INT64,\n  mode INT64,\n  topic_id INT64,\n  rating INT64,\n  comment STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ai_picture_mode_question_type",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_picture_mode_question_type`\n(\n  id INT64,\n  name STRING,\n  ai_picture_mode_level_id INT64,\n  ai_picture_mode_topic_id INT64,\n  scenario_check STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  scenario_grammar_check STRING,\n  visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_duo_speak_room_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_duo_speak_room_log`\n(\n  id INT64,\n  room_id INT64,\n  note STRING,\n  created_at INT64,\n  created_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_cancel_compensate_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_cancel_compensate_log`\n(\n  id INT64,\n  booking_cancel_compensate_id INT64,\n  action_id INT64,\n  note STRING,\n  detail_change STRING,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "detect_face_teacher_history",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.detect_face_teacher_history`\n(\n  id INT64,\n  teacher_id INT64,\n  internal_id STRING,\n  booking_id INT64,\n  booking_date_at INT64,\n  exec_done_at INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ticket_scheduler",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ticket_scheduler`\n(\n  id INT64,\n  ticket_id INT64,\n  type INT64,\n  time INT64,\n  status_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "redmine_booking_student_program",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.redmine_booking_student_program`\n(\n  id INT64,\n  redmine_issue_id INT64,\n  user_id INT64,\n  program_id INT64,\n  type INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ticket_category",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ticket_category`\n(\n  id INT64,\n  name STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_order_gift_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.booking_order_gift_view`\nAS SELECT * except(transfer_to_admin_at,sent_to_shipping_at,created_at,updated_at),\r\n      timestamp_seconds(transfer_to_admin_at) as transfer_to_admin_at,\r\n      timestamp_seconds(sent_to_shipping_at) as sent_to_shipping_at,\r\n      timestamp_seconds(created_at) as created_at,\r\n      timestamp_seconds(updated_at) as updated_at\r\nFROM `kynaforkids-server-production.kynaforkids.booking_order_gift`;"
}, {
  "table_name": "ai_tutor_search_history",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_tutor_search_history`\n(\n  id INT64,\n  user_id INT64,\n  type INT64,\n  mode INT64,\n  keyword STRING,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "teacher",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.teacher`\n(\n  user_id INT64,\n  position STRING,\n  introduce STRING,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (user_id) NOT ENFORCED\n)\nCLUSTER BY user_id;"
}, {
  "table_name": "homework_label",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.homework_label`\n(\n  id INT64,\n  name STRING,\n  type INT64,\n  homework_label_parent_id INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_commission_income_affiliate",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.booking_commission_income_affiliate`\nAS -- doanh thu tháng\r\nSELECT \r\nbci.affiliate_id as affiliate_id \r\n, (select max(u.email) \r\n  from `kynaforkids-server-production.kynaforkids.user` u, `kynaforkids-server-production.kynaforkids.affiliate_user` au\r\n  where au.user_id \u003d u.id and au.affiliate_id \u003d cast(bci.affiliate_id as INT64)\r\n  ) as affiliate_email\r\n, (\r\n  select max(u.phone_number) \r\n  from `kynaforkids-server-production.kynaforkids.user` u, `kynaforkids-server-production.kynaforkids.affiliate_user` au \r\n  where au.user_id \u003d u.id and au.affiliate_id \u003d cast(bci.affiliate_id as INT64) \r\n  ) as phone_number\r\n, (\r\n  select max(p.name) \r\n  from `kynaforkids-server-production.kynaforkids.profile` p, `kynaforkids-server-production.kynaforkids.affiliate_user` au \r\n  where au.user_id \u003d p.user_id and au.affiliate_id \u003d cast(bci.affiliate_id as INT64) \r\n  ) as name\r\n, (\r\n  select ac.name \r\n  from `kynaforkids-server-production.kynaforkids.affiliate_category` ac, `kynaforkids-server-production.kynaforkids.affiliate_user` au  \r\n  where cast(bci.affiliate_id as INT64) \u003d au.affiliate_id and au.affiliate_category_id \u003d ac.id\r\n  ) as loai_affiliate\r\n, `kynaforkids-server-production.kynaforkids.func_get_source_affiliate`(au.source_id) as Nguon\r\n, (\r\n  select max(u.email)\r\n  from `kynaforkids-server-production.kynaforkids.user` u, `kynaforkids-server-production.kynaforkids.affiliate_user` au\r\n  where u.id \u003d au.bd_incharge_id and cast(bci.affiliate_id as INT64) \u003d au.affiliate_id ) as bd_incharge\r\n, (\r\n  select \r\n    ( \r\n    case \r\n      when max(ac.status) is null then \u0027Chưa tạo hợp đồng\u0027\r\n      when max(ac.status) \u003d 1 then \u0027Đã duyệt\u0027\r\n      when max(ac.status) \u003d 0 then \u0027Đang chờ duyệt\u0027\r\n      when max(ac.status) \u003d 2 then \u0027Đã hủy\u0027\r\n    else null\r\n    end ) as trang_thai_hop_dong\r\n  from `kynaforkids-server-production.kynaforkids.affiliate_contract` ac \r\n  where ac.affiliate_id \u003d bci.affiliate_id) as trang_thai_hop_dong\r\n, (\r\n  select max(ac.bank_export_name)\r\n  from `kynaforkids-server-production.kynaforkids.affiliate_contract` ac \r\n  where ac.affiliate_id \u003d au.affiliate_id) as ngan_hang\r\n, FORMAT_DATETIME(\u0027%Y-%m\u0027, TIMESTAMP_SECONDS(bci.date)) as thang\r\n, bci.total_order as total_order\r\n, bci.total_enrollment_order as tong_don_ghi_danh_lan_dau\r\n, bci.enrollment_commission_percent as phan_tram_lan_dau\r\n, bci.enrollment_commisson_amount as hoa_hong_lan_dau\r\n, bci.enrollment_commission_percent_bonus as phan_tram_lan_dau_bonus\r\n, bci.enrollment_commisson_amount_bonus as hoa_hong_lan_dau_bonus\r\n, bci.total_re_register_order as tong_gon_ghi_danh_lai\r\n, bci.re_register_commisson_amount as hoa_hong_ghi_danh_lai\r\n, bci.final_total_commission_amount as tong_hoa_hong_cuoi\r\n, bci.total_amount as total_amount\r\n-- ngaltt start 22/01/2025\r\n-- , if(bci.total_amount \u003e 0, \u0027Có\u0027,\u0027Không\u0027) as co_phat_sinh_thu_nhap\r\n, if(bci.total_amount \u003e 0, 1, 0) as co_phat_sinh_thu_nhap\r\n-- ngaltt end 22/01/2025\r\n, bci.bonus as thuong_thang\r\n, bci.debt_income as du_no_ki_truoc\r\n, bci.adjustment_other as dieu_chinh_khac\r\n, bci.payment_adjustment as dieu_chinh_thanh_toan\r\nFROM `kynaforkids-server-production.kynaforkids.booking_commission_income` bci \r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.affiliate_user` au on bci.affiliate_id \u003d au.affiliate_id\r\nWHERE \r\nau.country_id \u003d 3\r\n-- AND au.affiliate_id \u003d 541189\r\n-- AND FORMAT_DATETIME(\u0027%Y-%m\u0027, TIMESTAMP_SECONDS(bci.date)) \u003d \u00272024-10\u0027\r\n;"
}, {
  "table_name": "booking_rebuild",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_rebuild`\n(\n  id INT64,\n  booking_session_id INT64,\n  status INT64,\n  video_link STRING,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_teacher_program_salary",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_program_salary`\n(\n  user_id INT64,\n  program_id INT64,\n  new_salary FLOAT64,\n  note STRING,\n  approved_status INT64,\n  approved_by INT64,\n  approved_at INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (user_id, program_id) NOT ENFORCED\n)\nCLUSTER BY user_id, program_id;"
}, {
  "table_name": "user_location_support",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.user_location_support`\n(\n  id INT64,\n  user_id INT64,\n  country_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "kpi_revenue",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.kynaforkids.kpi_revenue`\nOPTIONS(\n  sheet_range\u003d\"KPI Doanh thu!A:D\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/1bhGn1N9A7G5g8AF9tWuYtiL_kcKsU0Zqqj-MYpq1i2Y/edit?gid\u003d817461505#gid\u003d817461505\"]\n);"
}, {
  "table_name": "trial_user_referral_code_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.trial_user_referral_code_log`\n(\n  id INT64,\n  user_id INT64,\n  referral_code_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  is_notification_sent INT64,\n  note STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "contest_import",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.contest_import`\n(\n  id INT64,\n  name STRING,\n  campaign_id INT64,\n  link STRING,\n  log STRING,\n  type INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_session_student_test_teacher_rating",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_session_student_test_teacher_rating`\n(\n  id INT64,\n  booking_session_student_test_id INT64,\n  template_id INT64,\n  content STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_economy_room",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_economy_room`\n(\n  id INT64,\n  first_booking_id INT64,\n  secondary_booking_id INT64,\n  program_id INT64,\n  teacher_id INT64,\n  lesson_id INT64,\n  begin_at INT64,\n  status INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  record_number INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_timeline",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_timeline`\n(\n  id INT64,\n  user_id INT64,\n  subject INT64,\n  program_id INT64,\n  level_id INT64,\n  manager_id INT64,\n  timeline_action_id INT64,\n  description STRING,\n  country_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_section",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_section`\n(\n  id INT64,\n  level_id INT64,\n  name STRING,\n  `order` INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_program_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_program_config`\n(\n  id INT64,\n  program_id INT64,\n  standard_teaching_time INT64,\n  minimum_teaching_time INT64,\n  program_teaching_time INT64,\n  record_number INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  rating_template_default_id INT64,\n  can_swap INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "kynavn_courses",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.kynaforkids.kynavn_courses`\nOPTIONS(\n  sheet_range\u003d\"A:E\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/1GqkZdu8VyErHd75r7ECeX-4BtmAHzPBSTa0wEtbyVQQ/edit?usp\u003dsharing\"]\n);"
}, {
  "table_name": "user_zalo_message",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.user_zalo_message`\n(\n  id INT64,\n  user_id INT64,\n  phone_number STRING,\n  type STRING,\n  template_id INT64,\n  message STRING,\n  status INT64,\n  status_code INT64,\n  response STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "arena_result",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.arena_result`\n(\n  id INT64,\n  arena_id INT64,\n  candidate_id INT64,\n  name STRING,\n  total_score NUMERIC(15, 2),\n  start_time INT64,\n  end_time INT64,\n  session_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_session_teacher_reject",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_session_teacher_reject`\n(\n  teacher_id INT64,\n  student_id INT64,\n  date INT64,\n  program_id INT64,\n  booking_class_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n);"
}, {
  "table_name": "currency_exchange_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.currency_exchange_config`\n(\n  id INT64,\n  `from` STRING,\n  `to` STRING,\n  rate FLOAT64,\n  visible INT64,\n  date_start INT64,\n  date_end INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "aca_student_country",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.aca_student_country`\n(\n  id INT64,\n  user_id INT64,\n  subject INT64,\n  country_id INT64,\n  max_students INT64,\n  allow_assign_student INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  registered_students INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "order_action",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.order_action`\n(\n  id INT64,\n  order_id INT64,\n  user_id INT64,\n  action STRING,\n  contact_status INT64,\n  order_status INT64,\n  note STRING,\n  recall_date INT64,\n  created_at INT64,\n  updated_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_student_manager",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_manager`\n(\n  user_id INT64,\n  is_user_test INT64,\n  subject INT64,\n  manager_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n);"
}, {
  "table_name": "ticket_rating",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ticket_rating`\n(\n  ticket_id INT64,\n  star_number INT64,\n  comment STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (ticket_id) NOT ENFORCED\n)\nCLUSTER BY ticket_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "promotion_package",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.promotion_package`\n(\n  promotion_id INT64,\n  package_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n)\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "Acc_No_Students_Tutoring_AI",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.Acc_No_Students_Tutoring_AI`\nAS \t\r\n\t\tSELECT if(o.completed_at is null,o.created_at,o.completed_at) as completed_at,\r\n\t\t\t\t\to.invoice_code,\r\n\t\t\t\t\t(select ori.email from `kynaforkids-server-production.kynaforkids.order_register_info` ori where ori.order_id \u003d o.id) as email,\r\n\t\t\t\t\t(select ori.phone_number from `kynaforkids-server-production.kynaforkids.order_register_info` ori where ori.order_id \u003d o.id) as phone_number,\r\n\t\tfrom `kynaforkids-server-production.kynaforkids.order` o\r\n\t\twhere o.status \u003d 3\r\n\r\n\t\tUNION ALL\r\n\r\n\t\tSELECT if(bo.accounting_date is null, bo.created_at, bo.accounting_date) as completed_at,\r\n\t\t\t\t\tbo.invoice_code,\r\n\t\t\t\t\tbo.email,\r\n\t\t\t\t\tbo.phone_number,\r\n\t\tfrom `kynaforkids-server-production.kynaforkids.booking_order` bo\r\n\t\twhere bo.approved_status \u003d 1;"
}, {
  "table_name": "booking_timeslot_ignore_mapping",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_timeslot_ignore_mapping`\n(\n  id INT64,\n  booking_schedule_id INT64,\n  booking_country_id INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "user_privacy_agreements",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.user_privacy_agreements`\n(\n  id INT64,\n  user_id INT64,\n  agreed_at INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "interview_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.interview_view`\nAS SELECT * except(begin_at,end_at,created_at,updated_at,group_created_at),\r\n      timestamp_seconds(begin_at) as begin_at,\r\n      timestamp_seconds(end_at) as end_at,\r\n      timestamp_seconds(created_at) as created_at,\r\n      timestamp_seconds(updated_at) as updated_at,\r\n      timestamp_seconds(group_created_at) as group_created_at\r\nFROM `kynaforkids-server-production.kynaforkids.interview`;"
}, {
  "table_name": "sales_intern_telemarketing_hour_timesheet",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.kynaforkids.sales_intern_telemarketing_hour_timesheet`\nOPTIONS(\n  sheet_range\u003d\"Sheet2!A:D\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/1r_wiqJqtIQc6rNjhyrAB52dG5UkYbzNfvHutdLwJD5k\"]\n);"
}, {
  "table_name": "booking_session_student_metadata",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_session_student_metadata`\n(\n  id INT64,\n  booking_session_id INT64,\n  student_id INT64,\n  meta_key INT64,\n  meta_value STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_cancel_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_cancel_config`\n(\n  id INT64,\n  name STRING,\n  has_compensate INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  cancel_by INT64,\n  booking_type INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "international_country_currency",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.international_country_currency`\n(\n  id INT64,\n  currency_code STRING,\n  international_country_id INT64,\n  currency_decimals INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "dtp_learning_path",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.dtp_learning_path`\n(\n  id INT64,\n  dtp_package_id INT64,\n  dtp_grade_id INT64,\n  week_index INT64,\n  ai_lesson_id INT64,\n  ai_lesson_name STRING,\n  ai_lesson_type INT64,\n  study_mode INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_level_note",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_level_note`\n(\n  id INT64,\n  level_id INT64,\n  note STRING,\n  type INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  language STRING,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "international_district",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.international_district`\n(\n  id INT64,\n  province_id INT64,\n  name STRING,\n  local_name STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "kyna_kids",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.kyna_kids`\n(\n  user_id INT64,\n  course_ids STRING,\n  fingermath INT64,\n  soroban INT64,\n  email STRING,\n  name STRING,\n  phone_number STRING,\n  password_hash STRING,\n  auth_key STRING,\n  is_migrated INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (user_id) NOT ENFORCED\n)\nCLUSTER BY user_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_teacher_group_mail",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_group_mail`\n(\n  id INT64,\n  country_filter INT64,\n  subject_filter INT64,\n  status_filter INT64,\n  tester_filter INT64,\n  google_group_email STRING,\n  members JSON,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ai_pronunciation_answer",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_pronunciation_answer`\n(\n  id INT64,\n  content STRING,\n  ai_pronunciation_question_id INT64,\n  is_corrent INT64,\n  is_correct INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  ipa STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_lead_quiz",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_lead_quiz`\n(\n  id INT64,\n  lead_id INT64,\n  quiz_session_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_teacher_lead_status",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_lead_status`\n(\n  id INT64,\n  name STRING,\n  step INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  is_end_status INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "location",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.location`\n(\n  id INT64,\n  gov_id STRING,\n  name STRING,\n  parent_id INT64,\n  level INT64,\n  position INT64,\n  warehouse_id INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  type INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_student_priority_date_request",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_priority_date_request`\n(\n  id INT64,\n  request_id INT64,\n  day STRING,\n  schedule_id STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "gift",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.gift`\n(\n  id INT64,\n  name STRING,\n  point INT64,\n  image_url STRING,\n  description STRING,\n  max_number_of_convert INT64,\n  number_of_convert INT64,\n  start_time INT64,\n  end_time INT64,\n  visible INT64,\n  gift_type INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_order_voucher_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_order_voucher_config`\n(\n  id INT64,\n  code STRING,\n  type INT64,\n  begin_at INT64,\n  end_at INT64,\n  country_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  visible INT64,\n  description STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "quiz_section_result",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.quiz_section_result`\n(\n  id INT64,\n  quiz_session_id INT64,\n  section_id INT64,\n  total_score FLOAT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "quiz_part",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.quiz_part`\n(\n  id INT64,\n  name STRING,\n  quiz_section_id INT64,\n  `order` INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  total_point FLOAT64,\n  percent_point FLOAT64,\n  percent_can_pass FLOAT64,\n  time INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "feedback",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.feedback`\n(\n  id INT64,\n  email STRING,\n  phone_number STRING,\n  issue STRING,\n  feedback STRING,\n  page STRING,\n  files STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  status INT64,\n  note STRING,\n  device_info STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "quiz_answer_option",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.quiz_answer_option`\n(\n  id INT64,\n  quiz_question_id INT64,\n  type INT64,\n  hint STRING,\n  correct_value STRING,\n  point FLOAT64,\n  checkbox_ratio FLOAT64,\n  group_index INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  position STRING,\n  image_attribute STRING,\n  is_deleted INT64,\n  width INT64,\n  height INT64,\n  answer_explain STRING,\n  is_input_math INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_teacher_income_extend",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_income_extend`\n(\n  booking_teacher_income_id INT64,\n  num_real_class_not_approve_of_test_program INT64,\n  num_real_class_approve_of_test_program INT64,\n  income_basic_salary_not_approve_of_test_program NUMERIC(15, 2),\n  income_basic_salary_approve_of_test_program NUMERIC(15, 2),\n  num_of_qualified_class_of_test_program INT64,\n  income_of_qualified_class_of_test_program NUMERIC(15, 2),\n  num_real_class_not_approve_of_official_program INT64,\n  num_real_class_approve_of_official_program INT64,\n  income_basic_salary_not_approve_of_official_program NUMERIC(15, 2),\n  income_basic_salary_approve_of_official_program NUMERIC(15, 2),\n  num_of_qualified_class_of_official_program INT64,\n  income_of_qualified_class_of_official_program NUMERIC(15, 2),\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  income_of_duo_bonus NUMERIC(15, 2),\n  num_of_duo_bonus INT64,\n  final_income_of_duo_bonus NUMERIC(15, 2),\n  final_num_of_duo_bonus INT64,\n  PRIMARY KEY (booking_teacher_income_id) NOT ENFORCED\n)\nCLUSTER BY booking_teacher_income_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_income_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_income_config`\n(\n  id INT64,\n  from_minutes INT64,\n  to_minutes INT64,\n  value_compensation NUMERIC(15, 2),\n  country_id INT64,\n  shift INT64,\n  currency STRING,\n  applied_from INT64,\n  applied_to INT64,\n  cancel_by INT64,\n  is_percent INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  name STRING,\n  type_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "trial_user_info",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.trial_user_info`\n(\n  id INT64,\n  trial_user_id INT64,\n  phone_number STRING,\n  name STRING,\n  user_info STRING,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "tutoring_new_students_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.tutoring_new_students_view`\nAS WITH order_info AS (\r\n  SELECT \r\n    IF(DATE(bo.accounting_date) IS NULL, DATE(bo.created_at), DATE(bo.accounting_date)) AS accounting_date,\r\n    bo.student_id,\r\n    bo.student_code,\r\n    bo.phone_number,\r\n    CASE \r\n      WHEN bo.payment_status \u003d 0 THEN \u0027Chưa duyệt\u0027 \r\n      WHEN bo.payment_status \u003d 1 THEN \u0027Đã duyệt\u0027 \r\n      WHEN bo.payment_status \u003d 2 THEN \u0027Không duyệt\u0027 \r\n      WHEN bo.payment_status \u003d 3 THEN \u0027Cần điều chỉnh\u0027 \r\n      WHEN bo.payment_status \u003d 4 THEN \u0027Đã điều chỉnh\u0027 \r\n      ELSE \u0027Khác\u0027 \r\n    END AS payment_status,\r\n    `kynaforkids-server-production.kynaforkids.func_get_booking_order_status`(bo.status) AS order_status,\r\n    `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(CAST(bo.payment_content AS INT64)) AS noi_dung_thanh_toan,\r\n    bo.total,\r\n    bo.discount_money,\r\n    COALESCE(bo.total_video_course, 0) AS total_video_course\r\n  FROM `kynaforkids-server-production.kynaforkids.booking_order_view` bo\r\n  WHERE bo.order_type \u003d 1\r\n  --NOT (bo.order_type IN (2) AND bo.order_type_sub IN (9))\r\n    AND bo.program_type \u003d 1\r\n    AND COALESCE(bo.total_video_course, 0) + COALESCE(bo.total, 0) \u003e 0\r\n)\r\n\r\nSELECT \r\n  DATE(t1.accounting_date) AS ngay_hach_toan,\r\n  COUNT(*) AS num_new_students_tutoring\r\nFROM order_info t1\r\nWHERE t1.accounting_date \u003e\u003d \u00272024-01-01\u0027\r\n  AND t1.noi_dung_thanh_toan IN (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027)\r\n  AND (COALESCE(t1.total, 0) - COALESCE(t1.discount_money, 0) + t1.total_video_course) \u003e 0\r\n  AND (\r\n    (FORMAT_DATE(\u0027%Y-%m\u0027, t1.accounting_date) \u003d FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE())\r\n     AND t1.payment_status IN (\u0027Đã duyệt\u0027, \u0027Chưa duyệt\u0027, \u0027Cần điều chỉnh\u0027)\r\n     AND t1.order_status IN (\u0027Hoàn thành\u0027, \u0027Chờ xác nhận thanh toán\u0027))\r\n    OR\r\n    (FORMAT_DATE(\u0027%Y-%m\u0027, t1.accounting_date) \u003c FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE())\r\n     AND t1.payment_status \u003d \u0027Đã duyệt\u0027\r\n     AND t1.order_status \u003d \u0027Hoàn thành\u0027)\r\n  )\r\n  AND (\r\n    IF(NOT (t1.student_id IS NULL AND t1.student_code IS NULL),\r\n       NOT EXISTS (\r\n         SELECT 1\r\n         FROM order_info bo\r\n         WHERE (bo.student_id \u003d t1.student_id OR bo.student_code \u003d t1.student_code)\r\n           AND bo.payment_status \u003d \u0027Đã duyệt\u0027\r\n           AND bo.order_status \u003d \u0027Hoàn thành\u0027\r\n           AND bo.noi_dung_thanh_toan IN (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027)\r\n           AND DATE(bo.accounting_date) \u003c DATE(t1.accounting_date)\r\n       ),\r\n       NOT EXISTS (\r\n         SELECT 1\r\n         FROM order_info bo\r\n         WHERE RIGHT(bo.phone_number, 9) \u003d RIGHT(t1.phone_number, 9)\r\n           AND bo.payment_status \u003d \u0027Đã duyệt\u0027\r\n           AND bo.order_status \u003d \u0027Hoàn thành\u0027\r\n           AND bo.noi_dung_thanh_toan IN (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027)\r\n           AND DATE(bo.accounting_date) \u003c DATE(t1.accounting_date)\r\n       )\r\n    )\r\n  )\r\nGROUP BY ngay_hach_toan\r\nORDER BY ngay_hach_toan DESC;"
}, {
  "table_name": "wh_import",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.wh_import`\n(\n  id INT64,\n  reason_id INT64,\n  serial_code STRING,\n  status INT64,\n  description STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  location_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_monitor_issue_report",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_monitor_issue_report`\n(\n  id INT64,\n  student_id INT64,\n  booking_id INT64,\n  booking_monitor_issue_id INT64,\n  first_time_support INT64,\n  end_at INT64,\n  options STRING,\n  ops_in_charge_id INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  redmine_issue_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  event_log STRING,\n  handle_by INT64,\n  handle_time INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "user_mobile",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.user_mobile`\n(\n  user_id INT64,\n  app_id STRING,\n  device_token STRING,\n  mobile_name STRING,\n  mobile_type INT64,\n  mobile_os STRING,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n)\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "referral",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.referral`\n(\n  user_id INT64,\n  dynamic_link_id INT64,\n  register_count INT64,\n  used_count INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (user_id) NOT ENFORCED\n)\nCLUSTER BY user_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "wiziq_transaction",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.wiziq_transaction`\n(\n  id INT64,\n  type INT64,\n  action_name STRING,\n  booking_id INT64,\n  request_data STRING,\n  response_data STRING,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "box_card_subscriptions",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.box_card_subscriptions`\n(\n  box_card_id INT64,\n  package_subscription_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (box_card_id, package_subscription_id) NOT ENFORCED\n)\nCLUSTER BY box_card_id, package_subscription_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ceo_cac_other_cost_view_2",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.ceo_cac_other_cost_view_2`\nAS WITH \r\ntutoring_students AS \r\n(\r\nWITH order_info AS (\r\n  (SELECT date(bo.created_at) AS ngay_tao_don,\r\n          date(bo.payment_at) AS ngay_duyet_don,\r\n          if(bo.accounting_date IS NULL, date(bo.created_at), bo.accounting_date) AS accounting_date,\r\n\r\n     (SELECT created_at\r\n      FROM `kynaforkids-server-production.kynaforkids.booking_lead`\r\n      WHERE id \u003d bo.lead_id) AS ngay_tao_lead,\r\n          bo.invoice_code,\r\n\r\n     -- (SELECT name\r\n     --  FROM `kynaforkids-server-production.kynaforkids.booking_lead`\r\n     --  WHERE id \u003d bo.lead_id) AS ten_phu_huynh,\r\n          -- bo.email,\r\n          -- bo.name,\r\n          bo.student_code,\r\n          bo.student_id,\r\n          bo.phone_number,\r\n          bo.id as order_id,\r\n          bo.international_country_id,\r\n          if(bo.total_video_course IS NULL, 0, bo.total_video_course) AS total_video_course,\r\n          bo.total,\r\n          `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(cast(bo.payment_content AS INT64)) AS noi_dung_thanh_toan,\r\n          `kynaforkids-server-production.kynaforkids.func_get_source`(bo.source) AS source,\r\n          `kynaforkids-server-production.kynaforkids.func_get_program_name_from_id`(bo.program_id) AS program,\r\n          `kynaforkids-server-production.kynaforkids.func_get_booking_order_status`(bo.status) AS order_status,\r\n          CASE WHEN bo.payment_status \u003d 0 THEN \u0027Chưa duyệt\u0027 \r\n               WHEN bo.payment_status \u003d 1 THEN \u0027Đã duyệt\u0027 \r\n               WHEN bo.payment_status \u003d 2 THEN \u0027Không duyệt\u0027 \r\n               WHEN bo.payment_status \u003d 3 THEN \u0027Cần điều chỉnh\u0027 \r\n               WHEN bo.payment_status \u003d 4 THEN \u0027Đã điều chỉnh\u0027 \r\n               ELSE \u0027Khác\u0027 END AS payment_status,\r\n          bo.total - if(bo.discount_money IS NULL, 0, bo.discount_money) AS price,\r\n          -- bo.duration,\r\n          -- bo.note AS note,\r\n          bo.lead_id AS lead_id,\r\n          -- bll.gclid,\r\n\r\n     -- (SELECT sale_id\r\n     --  FROM `kynaforkids-server-production.kynaforkids.booking_lead`\r\n     --  WHERE id \u003d bo.lead_id) AS sale_id,\r\n     \r\n     IF (bll.actual_utm_campaign IS NULL,\r\n                                   bll.utm_campaign,\r\n                                   bll.actual_utm_campaign) AS affiliate_campaign,\r\n    --  bll.actual_utm_campaign as affiliate_campaign, \r\n    --  (SELECT actual_lead_id\r\n    --   FROM `kynaforkids-server-production.kynaforkids.booking_lead`\r\n    --   WHERE id \u003d bo.lead_id) AS actual_lead_id,\r\n    --       if(bll.actual_lead_id IS NULL, bll.utm_campaign,\r\n    --            (SELECT bl.utm_campaign\r\n    --             FROM `kynaforkids-server-production.kynaforkids.booking_lead` bl\r\n    --             WHERE bl.id \u003d bll.actual_lead_id)) AS affiliate_campaign,\r\n\r\n     -- (SELECT fanpage_name\r\n     --  FROM `kynaforkids-server-production.kynaforkids.booking_lead`\r\n     --  WHERE id \u003d bo.lead_id) AS fanpage_name,\r\n          -- if(bll.actual_lead_id IS NULL, bll.landing_page_name,\r\n          --      (SELECT bl.landing_page_name\r\n          --       FROM `kynaforkids-server-production.kynaforkids.booking_lead` bl\r\n          --       WHERE bl.id \u003d bll.actual_lead_id)) AS landingpage_name,\r\n          -- if(bll.actual_lead_id IS NULL, bll.affiliate_id,\r\n          --      (SELECT bl.affiliate_id\r\n          --       FROM `kynaforkids-server-production.kynaforkids.booking_lead` bl\r\n          --       WHERE bl.id \u003d bll.actual_lead_id)) AS affiliate_id,\r\n          bo.currency_exchange_rate,\r\n          ((bo.total - if(bo.discount_money IS NULL, 0, bo.discount_money)) * bo.currency_exchange_rate) AS price_vnd,\r\n          `kynaforkids-server-production.kynaforkids.func_get_country`(bo.international_country_id) AS country,\r\n          -- bo.total_lesson,\r\n\r\n     -- (SELECT string_agg(t1.video_course_name)\r\n     --  FROM `kynaforkids-server-production.kynaforkids.view_tutoring_video_course_name` t1\r\n     --  WHERE t1.id \u003d bo.id) AS video_course_name,\r\n          -- if(bll.actual_lead_id IS NULL,\r\n          --      (SELECT max(u.email)\r\n          --       FROM `kynaforkids-server-production.kynaforkids.kynaforkids_user` u\r\n          --       WHERE bll.affiliate_id \u003d u.id),\r\n          --      (SELECT max(u.email)\r\n          --       FROM `kynaforkids-server-production.kynaforkids.booking_lead` bl, `kynaforkids-server-production.kynaforkids.kynaforkids_user` u\r\n          --       WHERE bll.actual_lead_id \u003d bl.id\r\n          --         AND bl.affiliate_id \u003d u.id)) AS affiliate_email,\r\n\r\n     -- (SELECT max(u.email)\r\n     --  FROM `kynaforkids-server-production.kynaforkids.kynaforkids_user` u,\r\n     --       `kynaforkids-server-production.kynaforkids.affiliate_user` au\r\n     --  WHERE au.affiliate_id \u003d bo.affiliate_id\r\n     --    AND au.user_id \u003d u.id) AS affiliate_emaill,\r\n\r\n     -- (SELECT ac.name\r\n     --  FROM `kynaforkids-server-production.kynaforkids.affiliate_category` ac,\r\n     --       `kynaforkids-server-production.kynaforkids.affiliate_user` au\r\n     --  WHERE bo.affiliate_id \u003d au.affiliate_id\r\n     --    AND au.affiliate_category_id \u003d ac.id) AS loai_affiliate,\r\n          -- IF (bll.actual_lead_id IS NULL,\r\n          --       (SELECT ac.name\r\n          --        FROM `kynaforkids-server-production.kynaforkids.affiliate_user` au,\r\n          --             `kynaforkids-server-production.kynaforkids.affiliate_category` ac\r\n          --        WHERE bll.affiliate_id \u003d au.user_id\r\n          --          AND au.affiliate_category_id \u003d ac.id),\r\n          --       (SELECT ac.name\r\n          --        FROM `kynaforkids-server-production.kynaforkids.booking_lead` bl,\r\n          --             `kynaforkids-server-production.kynaforkids.affiliate_user` au,\r\n          --             `kynaforkids-server-production.kynaforkids.affiliate_category` ac\r\n          --        WHERE bl.id \u003d bll.actual_lead_id\r\n          --          AND bl.affiliate_id \u003d au.user_id\r\n          --          AND au.affiliate_category_id \u003d ac.id)) AS affiliate_type\r\n   FROM `kynaforkids-server-production.kynaforkids.booking_order_view` bo\r\n   LEFT JOIN `kynaforkids-server-production.kynaforkids.booking_lead` bll ON bll.id \u003d bo.lead_id\r\n\r\n--    WHERE DATE(bo.created_at) \u003e\u003d \u00272024-08-01\u0027 \r\n   )\r\n),\r\n\r\ntemp_table as\r\n(\r\nSELECT \r\n       t1.order_id,\r\n       t1.ngay_tao_don,\r\n       t1.ngay_duyet_don,\r\n       t1.accounting_date,\r\n       t1.ngay_tao_lead,\r\n       t1.invoice_code,\r\n     --   t1.ten_phu_huynh,\r\n     --   t1.email,\r\n     --   t1.name,\r\n     --   t1.student_code,\r\n       t1.phone_number,\r\n       t1.international_country_id as country_id,\r\n       t1.total_video_course,\r\n       t1.total,\r\n       t1.noi_dung_thanh_toan,\r\n       t1.source,\r\n       t1.program,\r\n       t1.order_status,\r\n       t1.payment_status,\r\n     --   t1.price,\r\n       ((t1.price + t1.total_video_course) * t1.currency_exchange_rate) AS total_VND,\r\n     --   (t1.price + t1.total_video_course) AS total_nguyen_te,\r\n     --   t1.duration,\r\n     --   t1.note,\r\n       t1.lead_id,\r\n     --   `kynaforkids-server-production.kynaforkids.func_get_email_from_kynaforkids_user`(t1.sale_id) AS sale_email,\r\n       t1.affiliate_campaign,\r\n     --   t1.landingpage_name,\r\n     --   t1.fanpage_name,\r\n     --   t1.gclid,\r\n     --   t1.affiliate_id,\r\n     --   t1.affiliate_email,\r\n     --   t1.affiliate_type,\r\n     --   t1.currency_exchange_rate,\r\n     --   t1.price_vnd,\r\n       t1.country,\r\n     --   t1.total_lesson,\r\n     --   t1.video_course_name,\r\n     --   t1.affiliate_emaill,\r\n     --   t1.loai_affiliate\r\n      t1.student_id,\r\n      t1.student_code,\r\n      (\r\n         SELECT COUNT(distinct bo.id) \r\n         FROM `kynaforkids.booking_order_view` bo \r\n         WHERE (bo.student_id \u003d t1.student_id OR bo.student_code \u003d t1.student_code) AND bo.payment_status in (0,1,3) AND bo.status in (4,6) AND `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(cast(bo.payment_content AS INT64)) in (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) AND date(bo.accounting_date) \u003c\u003d date(t1.accounting_date)\r\n      ) as num_completed_orders_same_student, \r\n\r\n        (\r\n         SELECT COUNT(distinct bo.id) \r\n         FROM `kynaforkids.booking_order_view` bo \r\n         WHERE (RIGHT(bo.phone_number,9) \u003d RIGHT(t1.phone_number,9)) AND bo.payment_status in (0,1,3) AND bo.status in (4,6) AND `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(cast(bo.payment_content AS INT64)) in (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) AND date(bo.accounting_date) \u003c\u003d date(t1.accounting_date)\r\n      ) as num_completed_orders_same_phone,\r\n\r\nFROM order_info t1\r\nWHERE \r\n      -- t1.source \u003d \u0027Marketing\u0027  \r\n      t1.accounting_date \u003e\u003d \u00272024-01-01\u0027 \r\n      AND t1.payment_status in (\u0027Đã duyệt\u0027,\u0027Chưa duyệt\u0027,\u0027Cần điều chỉnh\u0027) \r\n      AND t1.order_status in (\u0027Hoàn thành\u0027, \u0027Chờ xác nhận thanh toán\u0027)\r\n      AND t1.noi_dung_thanh_toan in (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n      AND (t1.price + t1.total_video_course) \u003e 0\r\n      -- AND t1.ngay_tao_lead \u003e\u003d \u00272024-01-01\u0027\r\n)\r\n\r\nSELECT \r\n        date(accounting_date) as ngay_hach_toan,\r\n        -- country_id,\r\n        SUM(total_VND) as total_tutoring_order_value,\r\nFROM\r\n(SELECT \r\n       accounting_date,total_VND,\r\n       if(not(student_id is null AND student_code is null),if(t2.num_completed_orders_same_student \u003e 1, \u0027Học viên cũ\u0027, \u0027Học viên mới\u0027),if(t2.num_completed_orders_same_phone \u003e 1, \u0027có order cùng phone chưa rõ HV cũ/mới\u0027, \u0027Học viên mới\u0027)) as old_new_student,\r\n       \r\n\r\nFROM temp_table t2\r\n-- WHERE not(student_id is null AND student_code is null)\r\n)\r\n-- WHERE old_new_student \u003d \u0027Học viên mới\u0027\r\nGROUP BY ngay_hach_toan --, country_id -- có thể group theo cả country nữa\r\nORDER BY ngay_hach_toan desc\r\n),\r\n\r\nai_single_students AS \r\n(\r\nWITH \r\norder_ai_tutor_single AS\r\n(SELECT \r\n        --ord.*,\r\n        ord.id as order_id,\r\n        date(timestamp_seconds(ord.created_at)) as created_at,\r\n      --   date(ord.updated_at) as updated_at,\r\n        date(timestamp_seconds(ord.completed_at)) as completed_at,\r\n      --   ord.created_by,\r\n      --   ord.telesale_id,\r\n        ord.register_source,        \r\n        ord.country_id,\r\n        `kynaforkids-server-production.kynaforkids.func_get_country`(ord.country_id) as country,\r\n        ord.currency_exchange_rate,\r\n        ord.total as total_oc,\r\n        \r\n        \r\n       -- ord.user_id,\r\n        ori.phone_number as order_phone_number,\r\n        ori.email as order_email,\r\n        ori.lead_id,\r\n      --   if((ori.phone_number) in (SELECT * FROM users_1_1_phone_number),\"Đã học 1-1\",\"Chưa học 1-1\") as check_1_1, \r\n\r\n        \r\n\r\n        ord.invoice_code as order_code,\r\n        ord.status as order_status_id,\r\n        ord.payment_method_id,\r\n        ord.payment_method_status as payment_status_id,\r\n        ord.affiliate_id,\r\n        (SELECT email FROM kynaforkids-server-production.kynaforkids.user us WHERE ord.affiliate_id \u003d us.id) as affiliate_email,\r\n        (SELECT au.affiliate_category_id FROM kynaforkids-server-production.kynaforkids.affiliate_user au WHERE au.user_id \u003d ord.affiliate_id) as affiliate_category_id,\r\n        ord.utm_campaign,\r\n\r\n\r\n        ordd.package_id,\r\n        ordd.package_subscription_id,\r\n        pks.subscription_month,\r\n        pks.name as subscription_name,\r\n        pks.price as subscription_price,\r\n        pk.name as package_name,\r\n\r\n        \r\n       \r\nFROM `kynaforkids-server-production.kynaforkids.order` ord\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.order_detail` ordd ON (ord.id \u003d ordd.order_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.order_register_info` ori ON (ord.id \u003d ori.order_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.package_subscriptions` pks ON (ordd.package_subscription_id \u003d pks.id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.package` pk ON (pk.id \u003d ordd.package_id)\r\n\r\n\r\n\r\nWHERE \r\n      ord.invoice_code like \u0027KYNA%\u0027\r\n      AND pk.name like \u0027%AI Tutor%\u0027\r\n      AND ordd.package_combo_id is null\r\n),\r\n\r\norder_ai_tutor_combo AS\r\n(SELECT \r\n        --ord.*,\r\n        ord.id as order_id,\r\n        date(timestamp_seconds(ord.created_at)) as created_at,\r\n      --   date(ord.updated_at) as updated_at,\r\n        date(timestamp_seconds(ord.completed_at)) as completed_at,\r\n      --   ord.created_by,\r\n      --   ord.telesale_id,\r\n        ord.register_source,        \r\n        ord.country_id,\r\n        `kynaforkids-server-production.kynaforkids.func_get_country`(ord.country_id) as country,\r\n        ord.currency_exchange_rate,\r\n        ord.total as total_oc,\r\n        \r\n        \r\n       -- ord.user_id,\r\n        ori.phone_number as order_phone_number,\r\n        ori.email as order_email,\r\n        ori.lead_id,\r\n      --   if((ori.phone_number) in (SELECT * FROM users_1_1_phone_number),\"Đã học 1-1\",\"Chưa học 1-1\") as check_1_1, \r\n\r\n\r\n        -- ord.invoice_code as order_code,\r\n        -- ord.status as order_status_id,\r\n        -- case when ord.status \u003d 1 then \u0027Mới tạo\u0027\r\n        --      when ord.status \u003d 2 then \u0027Đã xác nhận\u0027\r\n        --      when ord.status \u003d 3 then \u0027Hoàn thành\u0027\r\n        --      when ord.status \u003d 4 then \u0027Hủy\u0027\r\n        --      when ord.status \u003d 5 then \u0027Đã hoàn tiền\u0027   \r\n        -- end as order_status,\r\n\r\n        -- ord.payment_method_id,\r\n        -- ord.payment_method_status,\r\n        \r\n        -- ord.affiliate_id,  \r\n        -- ord.affiliate_email,\r\n        -- ord.affiliate_category_name,\r\n        \r\n\r\n        ord.invoice_code as order_code,\r\n        ord.status as order_status_id,\r\n        ord.payment_method_id,\r\n        ord.payment_method_status as payment_status_id,\r\n        ord.affiliate_id,\r\n        (SELECT email FROM kynaforkids-server-production.kynaforkids.user us WHERE ord.affiliate_id \u003d us.id) as affiliate_email,\r\n        (SELECT au.affiliate_category_id FROM kynaforkids-server-production.kynaforkids.affiliate_user au WHERE au.user_id \u003d ord.affiliate_id) as affiliate_category_id,\r\n        ord.utm_campaign,\r\n\r\n\r\n        ordd.package_id,\r\n        ordd.package_subscription_id,\r\n        pks.subscription_month,\r\n        pks.name as subscription_name,\r\n        pks.price as subscription_price,\r\n        pk.name as package_name,\r\n\r\n\r\n        \r\n       \r\nFROM `kynaforkids-server-production.kynaforkids.order` ord\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.order_detail` ordd ON (ord.id \u003d ordd.order_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.order_register_info` ori ON (ord.id \u003d ori.order_id)\r\nLEFT JOIN `kynaforkids.package_combo_subscription_item` pcs ON (ordd.package_subscription_id \u003d pcs.id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.package_subscriptions` pks ON (pcs.package_subscription_id \u003d pks.id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.package` pk ON (pk.id \u003d pcs.package_id)\r\n-- LEFT JOIN `kynaforkids-server-production.kynaforkids.package` pk ON (pk.id \u003d ordd.package_combo_id)\r\n\r\n\r\nWHERE \r\n      ord.invoice_code like \u0027KYNA%\u0027\r\n      AND pk.name like \u0027%AI%\u0027\r\n      AND ordd.package_combo_id is not null\r\n),\r\n\r\norder_ai_tutor AS\r\n(\r\nSELECT country_id,order_id,payment_status_id,order_status_id,lead_id,total_oc,currency_exchange_rate,affiliate_category_id,completed_at,created_at FROM order_ai_tutor_single\r\n\r\nUNION ALL\r\n\r\nSELECT country_id,order_id,payment_status_id,order_status_id,lead_id,total_oc,currency_exchange_rate,affiliate_category_id,completed_at,created_at  FROM order_ai_tutor_combo\r\n\r\n),\r\n\r\ntemp_table as \r\n(\r\n\r\nSELECT \r\n      country_id,order_id,payment_status_id,order_status_id,lead_id,total_oc,currency_exchange_rate,\r\n      (SELECT ac.name FROM `kynaforkids.affiliate_category` ac WHERE ac.id \u003d oat.affiliate_category_id) AS affiliate_category_name,\r\n      if(oat.completed_at is null, oat.created_at, oat.completed_at) as created_at,\r\nFROM order_ai_tutor oat\r\n),\r\n\r\nsingle_ai_order as (\r\nSELECT   \r\n         tt.created_at as ngay_hach_toan,\r\n        (select blv.affiliate_campaign from `kynaforkids.mkt_booking_lead_view` blv\r\n         where blv.id \u003d tt.lead_id) as utm_campaign,\r\n         tt.country_id,\r\n         tt.lead_id,\r\n\r\n         tt.total_oc,\r\n         tt.currency_exchange_rate,\r\n\r\n        --  tt.total_oc * tt.currency_exchange_rate as total_VND,\r\n         tt.order_id,\r\n         case \r\n              when tt.country_id \u003d 3 then 1\r\n              when tt.country_id \u003d 1 then \r\n                  (SELECT ce.rate FROM `kynaforkids-server-production.kynaforkids.currency_exchange_config` ce \r\n                    WHERE ce.from \u003d \u0027THB\u0027 and ce.to \u003d \u0027VND\u0027 and date(timestamp_seconds(ce.date_start)) \u003c\u003d tt.created_at and date(timestamp_seconds(ce.date_end)) \u003e\u003d tt.created_at)\r\n              when tt.country_id \u003d 2 then \r\n                  (SELECT ce.rate FROM `kynaforkids-server-production.kynaforkids.currency_exchange_config` ce \r\n                    WHERE ce.from \u003d \u0027IDR\u0027 and ce.to \u003d \u0027VND\u0027 and date(timestamp_seconds(ce.date_start)) \u003c\u003d tt.created_at and date(timestamp_seconds(ce.date_end)) \u003e\u003d tt.created_at)\r\n               when tt.country_id \u003d 5 then \r\n                  (SELECT ce.rate FROM `kynaforkids-server-production.kynaforkids.currency_exchange_config` ce \r\n                    WHERE ce.from \u003d \u0027KIP\u0027 and ce.to \u003d \u0027VND\u0027 and date(timestamp_seconds(ce.date_start)) \u003c\u003d tt.created_at and date(timestamp_seconds(ce.date_end)) \u003e\u003d tt.created_at)      \r\n         else null\r\n     end as ty_gia,\r\n\r\n      case\r\n              when aov.created_at \u003d aov.first_time_purchase_phone then \u0027New Customers\u0027\r\n              else \u0027Returning Customers\u0027\r\n      end as type_order_phone,\r\n      case\r\n              when aov.created_at \u003d aov.first_time_purchase_email then \u0027New Customers\u0027\r\n              else \u0027Returning Customers\u0027\r\n      end as type_order_email\r\nFROM temp_table tt\r\nLEFT JOIN `kynaforkids.Acc_order_video` aov ON (tt.order_id \u003d aov.id)\r\n\r\nWHERE \r\n      tt.created_at \u003e\u003d \u00272024-08-01\u0027 --and tt.created_at \u003c\u003d \u00272024-10-31\u0027\r\n      and tt.payment_status_id in (2,4,5,6)\r\n      and tt.order_status_id in (2,3)\r\n)\r\n\r\nSELECT \r\n      sao.ngay_hach_toan,\r\n      -- sao.country_id,\r\n      -- COUNT(distinct sao.order_id) as num_new_students_AI_single,\r\n      SUM(sao.ty_gia * sao.total_oc) as total_ai_single_order_value\r\n\r\nFROM single_ai_order sao\r\n-- WHERE sao.type_order_email \u003d \u0027New Customers\u0027 and sao.type_order_phone \u003d \u0027New Customers\u0027 \r\nGROUP BY sao.ngay_hach_toan --, sao.country_id       -- có thể group theo country nữa\r\nORDER BY sao.ngay_hach_toan DESC\r\n)\r\n\r\n\r\nSELECT\r\n      if(tns.ngay_hach_toan is null, ais.ngay_hach_toan, tns.ngay_hach_toan) as ngay_hach_toan,\r\n      ROUND(0.0012*(if(tns.total_tutoring_order_value is null, 0, tns.total_tutoring_order_value)  + if(ais.total_ai_single_order_value is null, 0, ais.total_ai_single_order_value))) as other_cost\r\n\r\nFROM tutoring_students tns\r\nFULL JOIN ai_single_students ais ON(tns.ngay_hach_toan \u003d ais.ngay_hach_toan)  -- có thể group theo ngay hạch toán và cả country, hiện chưa làm tới mức country\r\nORDER BY ngay_hach_toan DESC\r\n\r\n\r\n\r\n;"
}, {
  "table_name": "education_department",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.education_department`\n(\n  id INT64,\n  location_id INT64,\n  name STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_block_day",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_block_day`\n(\n  id INT64,\n  date INT64,\n  country_id INT64,\n  program_type INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  excluded_user_type STRING,\n  excluded_program_ids STRING,\n  excluded_program_subject STRING,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "tracking_notification",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.tracking_notification`\n(\n  id INT64,\n  user_id INT64,\n  data_id INT64,\n  data_type INT64,\n  type INT64,\n  content STRING,\n  log STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_lead_company",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_lead_company`\n(\n  lead_id INT64,\n  company_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (lead_id) NOT ENFORCED\n)\nCLUSTER BY lead_id;"
}, {
  "table_name": "booking_teacher_income",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_income`\n(\n  id INT64,\n  teacher_id INT64,\n  date INT64,\n  num_of_real_class INT64,\n  income_basic_salary NUMERIC(15, 2),\n  num_of_qualified_class INT64,\n  income_of_qualified_class NUMERIC(15, 2),\n  num_of_rating_no_payment_class INT64,\n  num_of_rating_below_standard INT64,\n  total_money_rating_below_standard NUMERIC(15, 2),\n  total_salary_qualified NUMERIC(15, 2),\n  num_of_open_webcam_below_standard INT64,\n  open_webcam_below_standard_penalty NUMERIC(15, 2),\n  number_of_etiquette_violation INT64,\n  etiquette_violation_penalty NUMERIC(15, 2),\n  income NUMERIC(15, 2),\n  loyalty_bonus_income NUMERIC(15, 2),\n  num_loyalty_bonus NUMERIC(15, 2),\n  loyalty_bonus NUMERIC(15, 2),\n  cancel_penalty NUMERIC(15, 2),\n  num_cancel_by_teacher INT64,\n  fee_cancel_penalty NUMERIC(15, 2),\n  num_bonus_excess INT64,\n  income_bonus_excess NUMERIC(15, 2),\n  adjustment_income FLOAT64,\n  note STRING,\n  tax NUMERIC(15, 2),\n  num_of_kyna_free_cancel INT64,\n  penalty_kyna_free_cancel NUMERIC(15, 2),\n  num_of_kyna_50_percent_cancel INT64,\n  penalty_kyna_50_percent_cancel NUMERIC(15, 2),\n  num_of_kyna_100_percent_cancel INT64,\n  penalty_kyna_100_percent_cancel NUMERIC(15, 2),\n  num_of_teacher_wrong_cancel INT64,\n  penalty_teacher_wrong_cancel NUMERIC(15, 2),\n  num_of_teacher_right_cancel INT64,\n  penalty_teacher_right_cancel NUMERIC(15, 2),\n  status_id INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  currency STRING,\n  adjustment_income_basic_salary NUMERIC(15, 2),\n  adjustment_num_of_real_class INT64,\n  adjustment_num_of_qualified_class INT64,\n  adjustment_income_of_qualified_class NUMERIC(15, 2),\n  adjustment_penalty_kyna_50_percent_cancel NUMERIC(15, 2),\n  adjustment_num_of_kyna_50_percent_cancel NUMERIC(15, 2),\n  adjustment_penalty_kyna_100_percent_cancel NUMERIC(15, 2),\n  adjustment_num_of_kyna_100_percent_cancel NUMERIC(15, 2),\n  adjustment_num_of_teacher_wrong_cancel INT64,\n  adjustment_penalty_teacher_wrong_cancel NUMERIC(15, 2),\n  adjustment_num_of_rating_below_standard INT64,\n  adjustment_total_money_rating_below_standard NUMERIC(15, 2),\n  adjustment_num_loyalty_bonus INT64,\n  adjustment_loyalty_bonus_income NUMERIC(15, 2),\n  adjustment_cancel_penalty NUMERIC(15, 2),\n  adjustment_num_cancel_penalty INT64,\n  adjustment_num_cancel_by_teacher INT64,\n  last_month_adjustment_income NUMERIC(15, 2),\n  final_income_basic_salary NUMERIC(15, 2),\n  final_num_of_real_class INT64,\n  final_num_of_qualified_class INT64,\n  final_income_of_qualified_class NUMERIC(15, 2),\n  final_penalty_kyna_50_percent_cancel NUMERIC(15, 2),\n  final_num_of_kyna_50_percent_cancel NUMERIC(15, 2),\n  final_penalty_kyna_100_percent_cancel NUMERIC(15, 2),\n  final_num_of_kyna_100_percent_cancel NUMERIC(15, 2),\n  final_num_of_teacher_wrong_cancel INT64,\n  final_penalty_teacher_wrong_cancel NUMERIC(15, 2),\n  final_num_of_rating_below_standard INT64,\n  final_total_money_rating_below_standard NUMERIC(15, 2),\n  final_num_loyalty_bonus INT64,\n  final_loyalty_bonus_income NUMERIC(15, 2),\n  final_cancel_penalty NUMERIC(15, 2),\n  final_num_cancel_by_teacher INT64,\n  final_income NUMERIC(15, 2),\n  total_income NUMERIC(15, 2),\n  other_adjustment NUMERIC(15, 2),\n  referral_income NUMERIC(15, 2),\n  intro_income NUMERIC(15, 2),\n  other_income NUMERIC(15, 2),\n  total_golden_hour INT64,\n  golden_hour_bonus NUMERIC(15, 2),\n  adjustment_total_golden_hour INT64,\n  adjustment_golden_hour_bonus NUMERIC(15, 2),\n  final_total_golden_hour INT64,\n  final_golden_hour_bonus NUMERIC(15, 2),\n  total_golden_hour_plus INT64,\n  golden_hour_bonus_plus NUMERIC(15, 2),\n  adjustment_total_golden_hour_plus INT64,\n  adjustment_golden_hour_bonus_plus NUMERIC(15, 2),\n  final_total_golden_hour_plus INT64,\n  final_golden_hour_bonus_plus NUMERIC(15, 2),\n  adjustment_num_of_open_webcam_below_standard INT64,\n  adjustment_open_webcam_below_standard_penalty NUMERIC(15, 2),\n  final_num_of_open_webcam_below_standard INT64,\n  final_open_webcam_below_standard_penalty NUMERIC(15, 2),\n  total_fsb_level_1 INT64,\n  fsb_level_1_bonus NUMERIC(15, 2),\n  adjustment_total_fsb_level_1 INT64,\n  adjustment_fsb_level_1_bonus NUMERIC(15, 2),\n  final_total_fsb_level_1 INT64,\n  final_fsb_level_1_bonus NUMERIC(15, 2),\n  total_fsb_level_2 INT64,\n  fsb_level_2_bonus NUMERIC(15, 2),\n  adjustment_total_fsb_level_2 INT64,\n  adjustment_fsb_level_2_bonus NUMERIC(15, 2),\n  final_total_fsb_level_2 INT64,\n  final_fsb_level_2_bonus NUMERIC(15, 2),\n  total_booking_test_early_review INT64,\n  booking_test_early_review_bonus NUMERIC(15, 2),\n  total_bonus_test_online_golden_hour INT64,\n  booking_test_online_golden_hour_bonus NUMERIC(15, 2),\n  is_end_contract INT64,\n  is_terminal_contract INT64,\n  times_full_face_below_standard_penaty INT64,\n  total_penaty_full_face_below_standard FLOAT64,\n  adjustment_number_of_etiquette_violation INT64,\n  adjustment_etiquette_violation_penalty FLOAT64,\n  final_number_of_etiquette_violation INT64,\n  final_etiquette_violation_penalty FLOAT64,\n  number_of_teacher_lead INT64,\n  teacher_lead_bonus NUMERIC(15, 2),\n  number_of_interview INT64,\n  interview_bonus NUMERIC(15, 2),\n  num_of_replacement_bonus INT64,\n  income_of_replacement_bonus NUMERIC(15, 2),\n  adjustment_num_of_replacement_bonus INT64,\n  adjustment_income_of_replacement_bonus NUMERIC(15, 2),\n  final_num_of_replacement_bonus INT64,\n  final_income_of_replacement_bonus NUMERIC(15, 2),\n  total_fsb_level_quarter INT64,\n  fsb_level_quarter_bonus NUMERIC(15, 2),\n  adjustment_total_fsb_level_quarter INT64,\n  adjustment_fsb_level_quarter_bonus NUMERIC(15, 2),\n  final_total_fsb_level_quarter INT64,\n  final_fsb_level_quarter_bonus NUMERIC(15, 2),\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  final_number_of_hot_bonus INT64,\n  final_hot_bonus FLOAT64,\n  adjustment_hot_bonus FLOAT64,\n  hot_bonus FLOAT64,\n  number_of_hot_bonus INT64,\n  adjustment_number_of_hot_bonus INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "rating_criteria",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.rating_criteria`\n(\n  id INT64,\n  name STRING,\n  description_english STRING,\n  description_math STRING,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_tutor_trial_user_ver2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_tutor_trial_user_ver2`\n(\n  id INT64,\n  children_id INT64,\n  name STRING,\n  age INT64,\n  current_level INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ceo_cac_trial_booking_cost_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.ceo_cac_trial_booking_cost_view`\nAS with\r\ntrial_bookings as (\r\nselect \r\n  t1.booking_id,\r\n  -- t1.revenue,\r\n  t1.booking_time,\r\n  -- t1.booking_type,\r\n  -- t1.teacher_country,\r\n  -- t1.teacher_source,\r\n  -- t1.student_code,\r\n  -- t1.booking_status,\r\n  t1.teacher_income,\r\n  -- t1.teacher_income_vnd,\r\n(select tex.sellingEx from `kynaforkids-server-production.kynaforkids.Acc_teacher_income_ex` tex where tex.teacherCountry \u003d t1.teacher_country and DATETIME_TRUNC(tex.date,MONTH) \u003d DATETIME_TRUNC(date(t1.booking_time),MONTH)) as teacher_income_ex,\r\n  -- t1.program,\r\n  `kynaforkids-server-production.kynaforkids.func_get_country`(t1.student_country_id) as student_country,\r\n  t1.total_income,\r\n  t1.payment_content,\r\nfrom (\r\nSELECT \r\n  bs.id as booking_id,\r\n  bs.begin_at as booking_time,\r\n  -- case\r\n  --       when bs.is_compensatory_course \u003d 1 then \u0027buoi_bu\u0027\r\n  --       else \u0027buoi_chinh_thuc\u0027\r\n  -- end as booking_type,\r\n  case\r\n    when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 1 then \u0027Philippines\u0027\r\n    when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 2 then \u0027Native\u0027\r\n    when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 3 then \u0027Vietnamese\u0027\r\n    when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 4 then \u0027Thailand\u0027\r\n    when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 5 then \u0027Indonesia\u0027\r\n  \twhen (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 8 then \u0027Laos\u0027\r\n  \twhen (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 9 then \u0027Malaysia\u0027\r\n  end as teacher_country,\r\n   (select bt.teacher_source from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bs.teacher_id \u003d bt.user_id) as teacher_source,\r\n  -- (select booking_student.student_code from `kynaforkids-server-production.kynaforkids.booking_student` booking_student\r\n  --  where bs.id \u003d bss.booking_session_id and booking_student.user_id \u003d bss.student_id) as student_code,\r\n  -- case \r\n  --     when status_id \u003d 1 then \u0027Draft\u0027\r\n  --     when status_id \u003d 2 then \u0027New\u0027\r\n  --     when status_id \u003d 3 then \u0027WaitingApprove\u0027\r\n  --     when status_id \u003d 4 then \u0027Approved\u0027\r\n  --     when status_id \u003d 5 then \u0027Completed\u0027\r\n  --     when status_id \u003d 6 then \u0027Rejected\u0027\r\n  --     when status_id \u003d 7 and bs.cancel_config_id \u003d 1 then \u0027Cancelled_by_teacher\u0027\r\n  --     when status_id \u003d 7 and bs.cancel_config_id \u003d 2 then \u0027Cancelled_by_student_without_compensate\u0027\r\n  --     when status_id \u003d 7 and bs.cancel_config_id \u003d 3 then \u0027Cancelled_by_kyna\u0027\r\n  --     when status_id \u003d 7 and bs.cancel_config_id \u003d 4 then \u0027Cancelled_by_student_has_compensate\u0027\r\n  --     when status_id \u003d 8 then \u0027Deleted\u0027\r\n  -- end as booking_status,\r\n  bs.total_income as teacher_income,\r\n  -- case\r\n  --     when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 3 then bs.total_income\r\n  --     when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 4 then ceiling(bs.total_income * 694.76)\r\n  --     when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 5 then ceiling(bs.total_income * 1.61)\r\n  -- else ceiling(bs.total_income * 23500) \r\n  -- end as teacher_income_vnd,\r\n--   (select pro.name from `kynaforkids-server-production.kynaforkids.booking_program` pro where bs.program_id \u003d pro.id) as program,\r\n  (select bst.country_id from  `kynaforkids-server-production.kynaforkids.booking_student` bst where bs.id \u003d bss.booking_session_id and bss.student_id \u003d bst.user_id) as student_country_id,\r\n  bs.total_income,\r\n  -- bss.revenue,\r\n   case\r\n    when (select min(cast(bo.payment_content as INT64)) from `kynaforkids-server-production.kynaforkids.booking_order` bo\r\n    where  bo.student_payment_id \u003d bss.student_payment_id) \u003d 1 then \u0027Buổi Học thử\u0027\r\n    when (select bph.payment_fee from `kynaforkids-server-production.kynaforkids.booking_payment_history` bph \r\n    where bph.id \u003d bss.student_payment_id) \u003d 0  then \u0027Buổi Ops tặng\u0027\r\n    else \u0027Buổi Ghi danh\u0027\r\n  end as payment_content,\r\n\r\nFROM `kynaforkids-server-production.kynaforkids.booking_session_view` bs\r\ninner join `kynaforkids-server-production.kynaforkids.booking_session_student` bss on bs.id \u003d bss.booking_session_id \r\nwhere bs.program_id not in (select id from `kynaforkids-server-production.kynaforkids.booking_program`where  type in (2,3)) and status_id in (5,7)) t1\r\ninner join `kynaforkids-server-production.kynaforkids.booking_session_student` bss on t1.booking_id \u003d bss.booking_session_id\r\n\r\nwhere payment_content \u003d \u0027Buổi Học thử\u0027\r\n      and DATE(t1.booking_time) \u003e\u003d \u00272024-01-01\u0027\r\n),\r\n\r\ntable_1 as \r\n(\r\nselect\r\n    date(booking_time) as ngay_hoc,\r\n    -- student_country,\r\n    -- \u0027Tutoring\u0027 as product,\r\n    ROUND(sum(teacher_income * teacher_income_ex)) as teacher_cost_hoc_thu,\r\n\r\nfrom trial_bookings\r\ngroup by ngay_hoc -- student_country\r\n),\r\n\r\ntrial_cost_temp as\r\n(\r\nselect\r\n      FORMAT_DATE(\u0027%Y-%m\u0027, t1.ngay_hoc) as year_month,\r\n      sum(t1.teacher_cost_hoc_thu) as teacher_cost_hoc_thu,\r\n      min(if(t1.teacher_cost_hoc_thu is not null, 1, 0)) as is_cost_finalized,      \r\n\r\nfrom table_1 t1 \r\ngroup by year_month      \r\n),\r\n\r\nTrialCostData AS (\r\n    SELECT\r\n        *,\r\n        ROW_NUMBER() OVER (ORDER BY year_month DESC) AS RowNum\r\n    FROM\r\n        trial_cost_temp\r\n    WHERE trial_cost_temp.is_cost_finalized \u003d 1\r\n),\r\n\r\nMostRecentKnownCost AS (\r\n    SELECT\r\n        teacher_cost_hoc_thu\r\n    FROM\r\n        TrialCostData\r\n    WHERE\r\n        RowNum \u003d 1 AND is_cost_finalized \u003d 1\r\n),\r\n\r\nProjectedCost AS (\r\n    SELECT\r\n        *,\r\n        CASE\r\n            WHEN is_cost_finalized \u003d 1 THEN teacher_cost_hoc_thu\r\n            WHEN is_cost_finalized \u003d 0 THEN ROUND((SELECT max(teacher_cost_hoc_thu) FROM MostRecentKnownCost) * \r\n                 IF(year_month \u003c  FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE()),1,(EXTRACT(DAY FROM CURRENT_DATE()) / EXTRACT(DAY FROM LAST_DAY(CURRENT_DATE())))))\r\n        END AS teacher_cost_projected\r\n    FROM\r\n        trial_cost_temp\r\n)\r\n\r\nselect pc.year_month,\r\n       pc.teacher_cost_projected as teacher_cost_hoc_thu\r\nfrom ProjectedCost pc\r\norder by year_month desc\r\n;"
}, {
  "table_name": "booking_complain_type_options",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_complain_type_options`\n(\n  id INT64,\n  name STRING,\n  type INT64,\n  action_value INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "tele_marketing_remind",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.tele_marketing_remind`\n(\n  id INT64,\n  tele_marketing_id INT64,\n  action INT64,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "summer_student_join_event",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.summer_student_join_event`\n(\n  id INT64,\n  student_id INT64,\n  parent_id INT64,\n  level_id INT64,\n  avatar STRING,\n  `from` INT64,\n  `to` INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "package_screenshot",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.package_screenshot`\n(\n  id INT64,\n  package_id INT64,\n  description STRING,\n  image_url STRING,\n  visible INT64,\n  `order` INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "dtp_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.dtp_config`\n(\n  id INT64,\n  company_name STRING,\n  quota INT64,\n  expired_at INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "lesson",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.lesson`\n(\n  id INT64,\n  name STRING,\n  thumbnail STRING,\n  content_type STRING,\n  content STRING,\n  visible INT64,\n  `order` INT64,\n  course_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  resolution_types INT64,\n  is_homework_level_ending INT64,\n  is_checkpoint INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "lesson_homework_label",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.lesson_homework_label`\n(\n  id INT64,\n  lesson_id INT64,\n  homework_label_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "setting",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.setting`\n(\n  id INT64,\n  key STRING,\n  name STRING,\n  value STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_pronunciation_student_answer_detail",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_pronunciation_student_answer_detail`\n(\n  id INT64,\n  ai_pronunciation_student_answer_id INT64,\n  ai_pronunciation_question_id INT64,\n  ai_pronunciation_answer_id INT64,\n  speech_text STRING,\n  point INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_teacher_lead_teaching_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_lead_teaching_log`\n(\n  id INT64,\n  teacher_id INT64,\n  booking_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "package_combo_subscription_item",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.package_combo_subscription_item`\n(\n  id INT64,\n  package_subscription_id INT64,\n  package_id INT64,\n  price FLOAT64,\n  discount_price FLOAT64,\n  discount_percent FLOAT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  is_deleted INT64,\n  qa_package_subscription_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "writing_toeic_session_answer",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.writing_toeic_session_answer`\n(\n  id INT64,\n  writing_toeic_session_id INT64,\n  quiz_section_id INT64,\n  quiz_part_id INT64,\n  question_id INT64,\n  writing_session_id INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "package_premium_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.package_premium_config`\n(\n  id INT64,\n  package_id INT64,\n  is_premium INT64,\n  level_key STRING,\n  country_id INT64,\n  app_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ticket_issue_owner",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ticket_issue_owner`\n(\n  id INT64,\n  issue_id INT64,\n  owner_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "kynavn_order_shipping",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.kynaforkids.kynavn_order_shipping`\nOPTIONS(\n  sheet_range\u003d\"A:O\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/1pg94s_T9-UAmrIbAn1YAY7no1F0HUJ1g7tYX2MweCVg/edit?usp\u003dsharing\"]\n);"
}, {
  "table_name": "Acc_LTV_CAC",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.kynaforkids.Acc_LTV_CAC`\nOPTIONS(\n  sheet_range\u003d\"CAC!A:D\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/11CJglKZscD46EQOLhky7R1gIUDRL8-WJF9g5s0fdHvY/edit?gid\u003d928074935#gid\u003d928074935\"]\n);"
}, {
  "table_name": "booking_scheduler",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_scheduler`\n(\n  id INT64,\n  booking_session_id INT64,\n  type INT64,\n  time INT64,\n  status_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ai_topic",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_topic`\n(\n  id INT64,\n  name STRING,\n  banner STRING,\n  description STRING,\n  ai_level_id INT64,\n  ai_tag_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  dictionary_keyword_tag STRING,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "user_lesson",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.user_lesson`\n(\n  user_id INT64,\n  lesson_id INT64,\n  last_activity_id INT64,\n  started_date INT64,\n  is_completed INT64,\n  completed_date INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n)\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "group_talk_booking",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.group_talk_booking`\n(\n  id INT64,\n  group_talk_id INT64,\n  booking_session_id INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_rival_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_rival_config`\n(\n  id INT64,\n  from_schedule_id INT64,\n  to_schedule_id INT64,\n  from_minutes_to_booking INT64,\n  to_minutes_to_booking INT64,\n  number_booking_on_schedule INT64,\n  number_teacher_on_schedule INT64,\n  timeout_minutes INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "sales_dn_temp",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.kynaforkids.sales_dn_temp`\nOPTIONS(\n  sheet_range\u003d\"A:N\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/10HXF63d790w2VxxYBtmfBPXy_6b6q6uM5WDeINb7JCg/edit?gid\u003d0#gid\u003d0\"]\n);"
}, {
  "table_name": "contest_class",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.contest_class`\n(\n  id INT64,\n  name STRING,\n  contest_school_id INT64,\n  block_id INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "quiz_session_answer",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.quiz_session_answer`\n(\n  id INT64,\n  quiz_session_id INT64,\n  quiz_section_id INT64,\n  quiz_part_id INT64,\n  quiz_question_id INT64,\n  quiz_answer_option_id INT64,\n  input_value STRING,\n  score FLOAT64,\n  is_correct INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_test_online_request",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_test_online_request`\n(\n  id INT64,\n  program_id INT64,\n  level_id INT64,\n  teacher_type_id INT64,\n  date INT64,\n  schedule_id INT64,\n  number_request INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_notification",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_notification`\n(\n  id INT64,\n  name STRING,\n  title STRING,\n  content STRING,\n  params STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "interview",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.interview`\n(\n  id INT64,\n  name STRING,\n  email STRING,\n  phone_number STRING,\n  country_id INT64,\n  timezone STRING,\n  country_group_id INT64,\n  region_id INT64,\n  subject INT64,\n  gender INT64,\n  bio STRING,\n  tags STRING,\n  education_background STRING,\n  teaching_experience STRING,\n  link_cv STRING,\n  link_profile_image STRING,\n  schedule_id INT64,\n  begin_at INT64,\n  end_at INT64,\n  interview_by INT64,\n  resume_screening_by INT64,\n  candidate_status INT64,\n  offer_send_at INT64,\n  offer_status INT64,\n  training_start_time INT64,\n  training_status INT64,\n  training_option INT64,\n  point INT64,\n  comment STRING,\n  status INT64,\n  is_tester INT64,\n  offer_pay_rate STRING,\n  external_interview_id STRING,\n  bbb_server_point INT64,\n  video_link STRING,\n  record_number INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  birthday INT64,\n  booking_training_id INT64,\n  ref_interview_id INT64,\n  group_created_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  difficulty_level STRING,\n  can_resend_mail INT64,\n  offer_template_id INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "document_skill",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.document_skill`\n(\n  document_id INT64,\n  skill_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n)\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_student_payment_campaign",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_payment_campaign`\n(\n  id INT64,\n  student_id INT64,\n  payment_id INT64,\n  campaign_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "partner_box_card_package",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.partner_box_card_package`\n(\n  id INT64,\n  partner_box_card_id INT64,\n  po_package_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  price NUMERIC(13, 2),\n  quantity INT64,\n  discount_type INT64,\n  discount_value INT64,\n  expiry_month INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_session_saver",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_session_saver`\n(\n  id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "speech_question_type",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.speech_question_type`\n(\n  id INT64,\n  name STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "gift_partner",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.gift_partner`\n(\n  id INT64,\n  name STRING,\n  google_form_config STRING,\n  created_by INT64,\n  updated_by INT64,\n  created_at INT64,\n  updated_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "homework_label_program",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.homework_label_program`\n(\n  id INT64,\n  homework_label_id INT64,\n  program_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_price_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_price_config`\n(\n  id INT64,\n  teacher_nationality INT64,\n  country_id INT64,\n  currency_code STRING,\n  program_id INT64,\n  payment_content INT64,\n  min_price NUMERIC(15, 2),\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  max_students INT64,\n  user_type_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_student_subject_manager",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_subject_manager`\n(\n  id INT64,\n  student_id INT64,\n  manager_id INT64,\n  subject INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "trial_user_referral_code",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.trial_user_referral_code`\n(\n  id INT64,\n  user_id INT64,\n  code STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "summer_camp_booking_session_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.summer_camp_booking_session_log`\n(\n  id INT64,\n  camp_id INT64,\n  student_id INT64,\n  summer_camp_stage_id INT64,\n  booking_session_id INT64,\n  point INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "tele_marketing_action",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.tele_marketing_action`\n(\n  id INT64,\n  tele_marketing_id INT64,\n  action INT64,\n  status_from INT64,\n  status_to INT64,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_student_program_certificate_commitment_note",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_program_certificate_commitment_note`\n(\n  id INT64,\n  booking_student_program_certificate_commitment_id INT64,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_lead_utm_campaign",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_lead_utm_campaign`\n(\n  utm_campaign STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (utm_campaign) NOT ENFORCED\n)\nCLUSTER BY utm_campaign;"
}, {
  "table_name": "conversation_auto_message",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.conversation_auto_message`\n(\n  id INT64,\n  conversation_type_id INT64,\n  subject STRING,\n  auto_message_content STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "placement_test_level_template",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.placement_test_level_template`\n(\n  id INT64,\n  program_type INT64,\n  level_id INT64,\n  type INT64,\n  content STRING,\n  hint STRING,\n  is_required INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "tag",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.tag`\n(\n  id INT64,\n  name STRING,\n  slug STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  `order` INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "summer_camp_level_group",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.summer_camp_level_group`\n(\n  camp_id INT64,\n  level_id INT64,\n  group_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (group_id, level_id, camp_id) NOT ENFORCED\n)\nCLUSTER BY group_id, level_id, camp_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "adwords_meta_business",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.adwords_meta_business`\n(\n  id STRING,\n  channel_id INT64,\n  name STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_no_show_error",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_no_show_error`\n(\n  id INT64,\n  begin_at INT64,\n  teacher_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_student_program_lesson",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_program_lesson`\n(\n  id INT64,\n  student_id INT64,\n  program_id INT64,\n  lesson_id INT64,\n  day INT64,\n  schedule_id INT64,\n  teacher_type INT64,\n  booking_order_teacher_type_id INT64,\n  begin_at INT64,\n  end_at INT64,\n  status INT64,\n  `order` INT64,\n  is_compensatory INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  max_students INT64,\n  student_priority_map_type INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "user_point",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.user_point`\n(\n  user_id INT64,\n  point INT64,\n  point_usable INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n)\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "game_type_layout",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.game_type_layout`\n(\n  id INT64,\n  game_type_id INT64,\n  name STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "referral_history",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.referral_history`\n(\n  user_id INT64,\n  dynamic_link_id INT64,\n  register_user_id INT64,\n  created_at INT64,\n  created_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (user_id, register_user_id, dynamic_link_id) NOT ENFORCED\n)\nCLUSTER BY user_id, register_user_id, dynamic_link_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ceo_cac_digital_mkt_spending_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.ceo_cac_digital_mkt_spending_view`\nAS WITH \r\naff_campaign_inf AS\r\n(\r\n  SELECT\r\n    aci.`campaign_id`,\r\n    ac.name as campaign_name,\r\n    date(TIMESTAMP_SECONDS(aci.`date`)+ INTERVAL 7 HOUR) as date_spend,\r\n    aci.`spend`,\r\n    ac.account_id,\r\n    ac.channel_id,\r\n    ac.effective_status,\r\n    ac.product_id,\r\n    ac.user_id,\r\n    ac.country_id,\r\n    ac.line_id,\r\n  \r\n    CASE\r\n          WHEN ac.channel_id \u003d 1 AND  date(TIMESTAMP_SECONDS(aci.`date`)+ INTERVAL 7 HOUR) \u003e\u003d \u00272025-03-01\u0027 THEN ROUND(1.05 * aci.spend)\r\n          WHEN ac.channel_id \u003d 1 AND  date(TIMESTAMP_SECONDS(aci.`date`)+ INTERVAL 7 HOUR) \u003c \u00272025-03-01\u0027 THEN ROUND(1.07 * aci.spend)\r\n          WHEN ac.channel_id \u003d 2 THEN ROUND(1.05 * aci.spend)\r\n          WHEN ac.channel_id \u003d 3 THEN ROUND(1.05 * aci.spend)\r\n    END AS spend_with_tax,\r\n  FROM\r\n    `kynaforkids-server-production.kynaforkids.adwords_meta_campaign_insight` aci\r\n\r\n  LEFT JOIN `kynaforkids-server-production.kynaforkids.adwords_meta_campaign` ac\r\n        ON  ac.id \u003d aci.campaign_id\r\n  WHERE date(TIMESTAMP_SECONDS(aci.`date`)) \u003e\u003d \u00272024-01-01\u0027\r\n\r\n),\r\n\r\nmkt_spend as(\r\n  SELECT  ci.date_spend, ci.channel_id, ci.product_id, ci.country_id, \r\n        SUM(ci.spend) as spend, SUM(ci.spend_with_tax) as spend_with_tax,\r\n        case \r\n          WHEN ci.country_id \u003d 1 THEN \u0027Thailand\u0027\r\n          WHEN ci.country_id \u003d 2 THEN \u0027Indo\u0027\r\n          WHEN ci.country_id \u003d 3 THEN \u0027Việt Nam\u0027\r\n          WHEN ci.country_id \u003d 4 THEN \u0027Khác\u0027\r\n          WHEN ci.country_id \u003d 5 THEN \u0027Lào\u0027\r\n          WHEN ci.country_id \u003d 6 THEN \u0027Malaysia\u0027\r\n          else \"Chưa biết\"\r\n        end as country,\r\n\r\n        case \r\n              when ci.product_id \u003d 1 then \u0027Kids - 1 kèm 1\u0027\r\n              when ci.product_id \u003d 2 then \u0027KEA - 1 kèm 1\u0027\r\n              when ci.product_id \u003d 3 then \u0027Toán - 1 kèm 1\u0027\r\n              when ci.product_id \u003d 4 then \u0027Kids - Class\u0027\r\n              when ci.product_id \u003d 5 then \u0027Tuyển dụng GV\u0027\r\n              when ci.product_id \u003d 6 then \u0027Khác\u0027\r\n              when ci.product_id \u003d 7 then \u0027AI Tutor\u0027\r\n              else \"Chưa biết\"\r\n        end as product_name,\r\n\r\n        case \r\n            when ci.channel_id \u003d 1 then \u0027Facebook\u0027\r\n            when ci.channel_id \u003d 2 then \u0027Tiktok\u0027\r\n            when ci.channel_id \u003d 3 then \u0027Google\u0027\r\n            else \"Chưa biết\"\r\n        end as channel_name\r\n        -- CASE WHEN ci.line_id is not null then line.name\r\n        --      ELSE \u0027Line_without_ID\u0027\r\n        -- END as line_mkt\r\n  FROM aff_campaign_inf ci\r\n  -- LEFT JOIN `kynaforkids-server-production.kynaforkids.adwords_meta_line` line ON(line.id \u003d ci.line_id)\r\n  GROUP BY ci.date_spend, ci.country_id, ci.channel_id, ci.product_id\r\n  ORDER BY date_spend DESC\r\n)\r\n\r\n\r\n\r\nSELECT * \r\nFROM mkt_spend\r\n;"
}, {
  "table_name": "booking_complain_scenario",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_complain_scenario`\n(\n  id INT64,\n  name STRING,\n  option_ids STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "bot_session",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.bot_session`\n(\n  id INT64,\n  user_id INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "writing_session_ielts_score",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.writing_session_ielts_score`\n(\n  id INT64,\n  writing_session_id INT64,\n  main_criteria_id INT64,\n  point FLOAT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "offline_event_student_result",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.offline_event_student_result`\n(\n  id INT64,\n  offline_event_student_id INT64,\n  program_type INT64,\n  test_program_id INT64,\n  test_level_id INT64,\n  pronunciation INT64,\n  vocabulary INT64,\n  writing INT64,\n  reading INT64,\n  speaking INT64,\n  listening INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  is_print INT64,\n  student_age_tag INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "payment_gateway",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.payment_gateway`\n(\n  id INT64,\n  payment_method_id INT64,\n  name STRING,\n  key STRING,\n  `group` INT64,\n  icon STRING,\n  `order` INT64,\n  visible INT64,\n  is_international INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ltv_order_1_1",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.ltv_order_1_1`\nAS select \r\nt1.user_id,\r\nt1.email,\r\n(select max(u.phone_number) from `kynaforkids-server-production.kynaforkids.user` u where u.id \u003d t1.user_id) as phone_number,\r\n(select max(p.name) from `kynaforkids-server-production.kynaforkids.profile` p where p.user_id \u003d t1.user_id) as `name`,\r\nt1.first_time_purchase,\r\nt1.number_of_perchase,\r\nt1.total_value_purchased,\r\nt1.max_purchased,\r\nt1.min_purchased,\r\n\u0027Kynaforkids 1-1\u0027 as System,\r\nconcat(substr((select max(u.phone_number) from `kynaforkids-server-production.kynaforkids.user` u where u.id \u003d t1.user_id), 1, 6), \u0027******\u0027) as Encrypt_phone_number\r\nfrom\r\n(\r\nSelect \r\n\t\t(select max(u.id) from `kynaforkids-server-production.kynaforkids.user` u where u.email \u003d bo.email) as user_id,\r\n    max(bo.email) as email,\r\n\t\tmin(bo.created_at) as first_time_purchase,\r\n    count(distinct(bo.id)) as number_of_perchase,\r\n\t\tsum(bo.total) - sum(if(bo.discount_money is null, 0, bo.discount_money)) as total_value_purchased,\r\n    min(bo.total - if(bo.discount_money is null, 0, bo.discount_money)) as min_purchased,\r\n    max(bo.total - if(bo.discount_money is null, 0, bo.discount_money)) as max_purchased\r\n\tfrom `kynaforkids-server-production.kynaforkids.booking_order` bo\r\n\twhere bo.payment_status \u003d 1 and bo.total !\u003d 0\r\n\tgroup by bo.email\r\n  order by bo.email ) as t1;"
}, {
  "table_name": "booking_lesson_package",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_lesson_package`\n(\n  id INT64,\n  lesson_id INT64,\n  package_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "speech_transaction",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.speech_transaction`\n(\n  id INT64,\n  speech_id INT64,\n  speech_question_id INT64,\n  text STRING,\n  audio_url STRING,\n  request_data STRING,\n  response_data STRING,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_order_note_history",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_order_note_history`\n(\n  id INT64,\n  booking_order_id INT64,\n  type INT64,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "placement_test_level",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.placement_test_level`\n(\n  id INT64,\n  name STRING,\n  outline_level STRING,\n  program_id INT64,\n  level_equivalent STRING,\n  outline_equivalent_level STRING,\n  next_level_id INT64,\n  next_speak_level_id INT64,\n  number_of_lesson INT64,\n  number_of_speak_lesson INT64,\n  `order` INT64,\n  visible INT64,\n  show_in_teacher_rating INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  age_tag_ids STRING,\n  warning STRING,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "po_package_user_type",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.po_package_user_type`\n(\n  id INT64,\n  po_package_id INT64,\n  user_type_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ticket_attachments",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ticket_attachments`\n(\n  id INT64,\n  ticket_id INT64,\n  attachment_url STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "commission_income",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.commission_income`\n(\n  id INT64,\n  order_id INT64,\n  package_subscription_id INT64,\n  affiliate_id INT64,\n  affiliate_commission_percent FLOAT64,\n  affiliate_commission_amount FLOAT64,\n  affiliate_manager_id INT64,\n  affiliate_manager_percent FLOAT64,\n  affiliate_manager_amount FLOAT64,\n  teacher_id INT64,\n  teacher_commission_percent FLOAT64,\n  teacher_commission_amount FLOAT64,\n  total_amount FLOAT64,\n  kyna_amount FLOAT64,\n  acp_for_teacher FLOAT64,\n  order_status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  package_id INT64,\n  completed_at INT64,\n  country_id INT64,\n  currency_exchange_rate FLOAT64,\n  manager_currency_exchange_rate FLOAT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "auth_item",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.auth_item`\n(\n  name STRING,\n  type INT64,\n  description STRING,\n  rule_name STRING,\n  data STRING,\n  created_at INT64,\n  updated_at INT64,\n  is_internal_role INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (name) NOT ENFORCED\n)\nCLUSTER BY name\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_order_refund_history",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_order_refund_history`\n(\n  id INT64,\n  type INT64,\n  order_id INT64,\n  student_id INT64,\n  program_id INT64,\n  remain_amount NUMERIC(15, 2),\n  remain_lesson INT64,\n  total_pay NUMERIC(15),\n  amount NUMERIC(15, 2),\n  total_revenue NUMERIC(15),\n  difference_amount NUMERIC(15, 2),\n  approved_by INT64,\n  currency STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_class_priority_date",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_class_priority_date`\n(\n  id INT64,\n  name STRING,\n  days STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_session_violation_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_session_violation_config`\n(\n  id INT64,\n  name STRING,\n  name_en STRING,\n  description STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "kpi_bd",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.kynaforkids.kpi_bd`\nOPTIONS(\n  sheet_range\u003d\"KPI BD!A:D\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/1bhGn1N9A7G5g8AF9tWuYtiL_kcKsU0Zqqj-MYpq1i2Y/edit?gid\u003d1276999245#gid\u003d1276999245\"]\n);"
}, {
  "table_name": "redmine_booking_order",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.redmine_booking_order`\n(\n  id INT64,\n  redmine_issue_id INT64,\n  booking_order_id INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  type INT64,\n  user_seen_update_order STRING,\n  is_booking_order_updated INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "gift_partner_voucher",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.gift_partner_voucher`\n(\n  gift_id INT64,\n  brand STRING,\n  max_usage_number_per_user INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  terms_of_use STRING,\n  partner_id INT64,\n  PRIMARY KEY (gift_id) NOT ENFORCED\n)\nCLUSTER BY gift_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_teacher_contract_history",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_contract_history`\n(\n  id INT64,\n  teacher_id INT64,\n  program_id INT64,\n  send_date INT64,\n  completion_date INT64,\n  contract_type INT64,\n  appendix_type INT64,\n  contract_number STRING,\n  contract_begin_at INT64,\n  contract_end_at INT64,\n  contract_status INT64,\n  view_contract_url_completed STRING,\n  eversign_contract_hash STRING,\n  eversign_access_token STRING,\n  system_type INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  service_provider_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_duo_room",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_duo_room`\n(\n  id INT64,\n  booking_session_id INT64,\n  master_meeting_id STRING,\n  breakout_meeting_id STRING,\n  student_id INT64,\n  is_document_uploaded INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  video_link STRING,\n  sample_record_is_building INT64,\n  sample_record_link STRING,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "affiliate_user_post_tracking_action_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.affiliate_user_post_tracking_action_view`\nAS SELECT\r\n  * EXCEPT(created_at, updated_at),\r\n  TIMESTAMP_SECONDS(created_at) AS created_at,\r\n  TIMESTAMP_SECONDS(updated_at) AS updated_at\r\nFROM `kynaforkids-server-production.kynaforkids.affiliate_user_post_tracking_action`;"
}, {
  "table_name": "package",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.package`\n(\n  id INT64,\n  category_id INT64,\n  name STRING,\n  short_name STRING,\n  slug STRING,\n  type INT64,\n  is_feature INT64,\n  icon_url STRING,\n  image_url STRING,\n  video_url STRING,\n  age_range STRING,\n  device STRING,\n  max_device STRING,\n  overview STRING,\n  outline STRING,\n  guideline STRING,\n  seo_keyword STRING,\n  seo_title STRING,\n  seo_description STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  `order` INT64,\n  image_alt STRING,\n  seo_name STRING,\n  show_footer INT64,\n  percent_affiliate FLOAT64,\n  is_package_for_parent INT64,\n  is_free INT64,\n  package_subscriptions_id INT64,\n  total_user_learn INT64,\n  package_type INT64,\n  original_type INT64,\n  commission_type_id INT64,\n  teacher_commission_percent FLOAT64,\n  affiliate_commission_percent_for_teacher FLOAT64,\n  teacher_commission_expire_date INT64,\n  partner_id INT64,\n  redirect_url STRING,\n  teacher_id INT64,\n  cover_image STRING,\n  video_cover_image STRING,\n  user_bought_count INT64,\n  total_time INT64,\n  window_app_link STRING,\n  mac_app_link STRING,\n  ios_app_link STRING,\n  android_app_link STRING,\n  is_show_backend INT64,\n  country_id INT64,\n  currency_code STRING,\n  is_3rd_party INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ai_level",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_level`\n(\n  id INT64,\n  name STRING,\n  user_type_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "queue_kpoint",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.queue_kpoint`\n(\n  id INT64,\n  channel STRING,\n  job STRING,\n  pushed_at INT64,\n  ttr INT64,\n  delay INT64,\n  priority INT64,\n  reserved_at INT64,\n  attempt INT64,\n  done_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "affiliate_landing_page",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.affiliate_landing_page`\n(\n  id INT64,\n  link STRING,\n  country_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ops_student_country",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ops_student_country`\n(\n  ops_id INT64,\n  student_country_id INT64,\n  max_students INT64,\n  allow_assign_task INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  total_students INT64,\n  PRIMARY KEY (ops_id, student_country_id) NOT ENFORCED\n)\nCLUSTER BY ops_id, student_country_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "order_backup",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.order_backup`\n(\n  id INT64,\n  invoice_code STRING,\n  user_id INT64,\n  promotion_code STRING,\n  payment_method_id INT64,\n  send_to_shipping_status INT64,\n  regulate_shipping INT64,\n  regulate_shipping_status INT64,\n  payment_method_status INT64,\n  contact_status INT64,\n  reason_cancel_shipping_id INT64,\n  reason_cancel_id INT64,\n  affiliate_id INT64,\n  status INT64,\n  sub_total NUMERIC(13, 2),\n  discount_amount NUMERIC(13, 2),\n  voucher_discount_amount NUMERIC(13, 2),\n  shipping_fee NUMERIC(13, 2),\n  payment_fee NUMERIC(13, 2),\n  is_free_ship INT64,\n  total NUMERIC(13, 2),\n  active_code STRING,\n  gift_id INT64,\n  is_activated INT64,\n  telesale_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  is_upgrade INT64,\n  register_source STRING,\n  register_source_key STRING,\n  recall_date INT64,\n  shipping_method_id INT64,\n  pickup_location_id INT64,\n  affiliate_email STRING,\n  affiliate_category_name STRING,\n  sale_bonus_config_id INT64,\n  landing_page_slug STRING,\n  landing_page_name STRING,\n  ref_key STRING,\n  utm_campaign STRING,\n  completed_at INT64,\n  is_assign_user INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_role_config_manual",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_role_config_manual`\n(\n  id INT64,\n  student_id INT64,\n  my_role STRING,\n  ai_role STRING,\n  situation STRING,\n  situation_en STRING,\n  status INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_teacher_warning",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_warning`\n(\n  id INT64,\n  booking_id INT64,\n  teacher_id INT64,\n  details STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "offline_event_student_note",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.offline_event_student_note`\n(\n  id INT64,\n  offline_event_student_id INT64,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_student_program_note",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_program_note`\n(\n  id INT64,\n  student_id INT64,\n  program_id INT64,\n  action_id INT64,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "teacher_commission_type",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.teacher_commission_type`\n(\n  id INT64,\n  name STRING,\n  from_percent FLOAT64,\n  to_percent FLOAT64,\n  default_percent FLOAT64,\n  is_required_expiration_date INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  vat_ratio FLOAT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ceo_cac_num_new_students_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.ceo_cac_num_new_students_view`\nAS -- WITH \r\n-- tutoring_new_students AS \r\n-- (\r\n-- WITH order_info AS (\r\n--   (SELECT \r\n--       --     date(bo.created_at) AS ngay_tao_don,\r\n--       --     date(bo.payment_at) AS ngay_duyet_don,\r\n--           if(bo.accounting_date IS NULL, bo.created_at, bo.accounting_date) AS accounting_date,\r\n\r\n--      (SELECT created_at\r\n--       FROM `kynaforkids-server-production.kynaforkids.booking_lead`\r\n--       WHERE id \u003d bo.lead_id) AS ngay_tao_lead,\r\n--       --     bo.invoice_code,\r\n--           bo.student_code,\r\n--           bo.student_id,\r\n--           bo.phone_number,\r\n--           bo.id as order_id,\r\n--           bo.international_country_id,\r\n--           coalesce(bo.total_video_course, 0) AS total_video_course,\r\n--           bo.total,\r\n--           `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(cast(bo.payment_content AS INT64)) AS noi_dung_thanh_toan,\r\n--           `kynaforkids-server-production.kynaforkids.func_get_source`(bo.source) AS source,\r\n--           `kynaforkids-server-production.kynaforkids.func_get_program_name_from_id`(bo.program_id) AS program,\r\n--           bo.program_type,\r\n--           `kynaforkids-server-production.kynaforkids.func_get_booking_order_status`(bo.status) AS order_status,\r\n--           CASE WHEN bo.payment_status \u003d 0 THEN \u0027Chưa duyệt\u0027 \r\n--                WHEN bo.payment_status \u003d 1 THEN \u0027Đã duyệt\u0027 \r\n--                WHEN bo.payment_status \u003d 2 THEN \u0027Không duyệt\u0027 \r\n--                WHEN bo.payment_status \u003d 3 THEN \u0027Cần điều chỉnh\u0027 \r\n--                WHEN bo.payment_status \u003d 4 THEN \u0027Đã điều chỉnh\u0027 \r\n--                ELSE \u0027Khác\u0027 \r\n--           END AS payment_status,\r\n--           coalesce(bo.total,0) - coalesce(bo.discount_money,0) AS price,\r\n--           bo.lead_id AS lead_id,\r\n   \r\n--           bo.currency_exchange_rate,\r\n--           `kynaforkids-server-production.kynaforkids.func_get_country`(bo.international_country_id) AS country,\r\n          \r\n--           bo.order_type,\r\n--           bo.order_type_sub,\r\n--    FROM `kynaforkids-server-production.kynaforkids.booking_order_view` bo\r\n--    LEFT JOIN `kynaforkids-server-production.kynaforkids.booking_lead` bll ON bll.id \u003d bo.lead_id\r\n--    WHERE --not (bo.order_type in (2) and bo.order_type_sub in (9)) \r\n--          bo.program_type \u003d 1\r\n--          and bo.order_type \u003d 1\r\n--          and coalesce(bo.total_video_course, 0) + coalesce(bo.total, 0) \u003e 0\r\n--    )\r\n-- ),\r\n\r\n-- -- tháng hiện tại lấy điều kiện mềm với đơn hàng: t1.payment_status in (\u0027Đã duyệt\u0027,\u0027Chưa duyệt\u0027,\u0027Cần điều chỉnh\u0027)  t1.order_status in (\u0027Hoàn thành\u0027, \u0027Chờ xác nhận thanh toán\u0027) --\r\n-- temp_table_2a as\r\n-- (\r\n-- SELECT \r\n--        t1.order_id,\r\n--        t1.order_type,\r\n--        t1.order_type_sub,\r\n--        t1.accounting_date,\r\n--        t1.phone_number,\r\n--        t1.international_country_id as country_id,\r\n--        t1.total_video_course,\r\n--        t1.total,\r\n--        t1.noi_dung_thanh_toan,\r\n--        t1.source,\r\n--        t1.program,\r\n--        t1.program_type,\r\n--        t1.order_status,\r\n--        t1.payment_status,\r\n--        t1.country,\r\n--        t1.student_id,\r\n--        t1.student_code,\r\n--       (\r\n--          SELECT COUNT(distinct bo.order_id) \r\n--          FROM order_info bo \r\n--          WHERE (bo.student_id \u003d t1.student_id OR bo.student_code \u003d t1.student_code) \r\n--          AND bo.payment_status in (\u0027Đã duyệt\u0027)  \r\n--          AND bo.order_status in (\u0027Hoàn thành\u0027) \r\n--          AND bo.noi_dung_thanh_toan in (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n--          AND date(bo.accounting_date) \u003c date(t1.accounting_date)\r\n--       ) as num_completed_orders_same_student, \r\n\r\n--         (\r\n--          SELECT COUNT(distinct bo.order_id) \r\n--          FROM order_info bo \r\n--          WHERE (RIGHT(bo.phone_number,9) \u003d RIGHT(t1.phone_number,9)) \r\n--                   AND bo.payment_status in (\u0027Đã duyệt\u0027) \r\n--                   AND bo.order_status in (\u0027Hoàn thành\u0027) \r\n--                   AND bo.noi_dung_thanh_toan in (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n--                   and date(bo.accounting_date) \u003c date(t1.accounting_date)\r\n--       ) as num_completed_orders_same_phone,\r\n\r\n-- FROM order_info t1\r\n-- WHERE \r\n--       t1.accounting_date \u003e\u003d \u00272024-01-01\u0027 \r\n--       AND t1.payment_status in (\u0027Đã duyệt\u0027,\u0027Chưa duyệt\u0027,\u0027Cần điều chỉnh\u0027) \r\n--       AND t1.order_status in (\u0027Hoàn thành\u0027, \u0027Chờ xác nhận thanh toán\u0027)\r\n--       AND t1.noi_dung_thanh_toan in (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n--       AND (t1.price + t1.total_video_course) \u003e 0\r\n--       AND FORMAT_DATE(\u0027%Y-%m\u0027, t1.accounting_date) \u003d FORMAT_DATE(\u0027%Y-%m\u0027, current_date())\r\n-- ),\r\n\r\n-- -- tháng quá khứ lấy điều kiện chặt: t1.payment_status in (\u0027Đã duyệt\u0027); t1.order_status in (\u0027Hoàn thành\u0027)\r\n-- temp_table_2b as\r\n-- (\r\n-- SELECT \r\n--        t1.order_id,\r\n--        t1.order_type,\r\n--        t1.order_type_sub,\r\n--        t1.accounting_date,\r\n--        t1.phone_number,\r\n--        t1.international_country_id as country_id,\r\n--        t1.total_video_course,\r\n--        t1.total,\r\n--        t1.noi_dung_thanh_toan,\r\n--        t1.source,\r\n--        t1.program,\r\n--        t1.program_type,\r\n--        t1.order_status,\r\n--        t1.payment_status,\r\n--        t1.country,\r\n--        t1.student_id,\r\n--        t1.student_code,\r\n--       (\r\n--          SELECT COUNT(distinct bo.order_id) \r\n--          FROM order_info bo \r\n--          WHERE (bo.student_id \u003d t1.student_id OR bo.student_code \u003d t1.student_code) \r\n--          AND bo.payment_status in (\u0027Đã duyệt\u0027)  \r\n--          AND bo.order_status in (\u0027Hoàn thành\u0027) \r\n--          AND bo.noi_dung_thanh_toan in (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n--          AND date(bo.accounting_date) \u003c date(t1.accounting_date)\r\n--       ) as num_completed_orders_same_student, \r\n\r\n--         (\r\n--          SELECT COUNT(distinct bo.order_id) \r\n--          FROM order_info bo \r\n--          WHERE (RIGHT(bo.phone_number,9) \u003d RIGHT(t1.phone_number,9)) \r\n--                   AND bo.payment_status in (\u0027Đã duyệt\u0027) \r\n--                   AND bo.order_status in (\u0027Hoàn thành\u0027) \r\n--                   AND bo.noi_dung_thanh_toan in (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n--                   and date(bo.accounting_date) \u003c date(t1.accounting_date)\r\n--       ) as num_completed_orders_same_phone,\r\n\r\n-- FROM order_info t1\r\n-- WHERE \r\n--       t1.accounting_date \u003e\u003d \u00272024-01-01\u0027 \r\n--       AND t1.payment_status in (\u0027Đã duyệt\u0027) --,\u0027Chưa duyệt\u0027,\u0027Cần điều chỉnh\u0027) \r\n--       AND t1.order_status in (\u0027Hoàn thành\u0027) --, \u0027Chờ xác nhận thanh toán\u0027)\r\n--       AND t1.noi_dung_thanh_toan in (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n--       AND (t1.price + t1.total_video_course) \u003e 0\r\n--       AND FORMAT_DATE(\u0027%Y-%m\u0027, t1.accounting_date) \u003c FORMAT_DATE(\u0027%Y-%m\u0027, current_date())\r\n-- ),\r\n\r\n-- temp_table_2 as\r\n-- (\r\n-- select * from temp_table_2a\r\n\r\n-- UNION ALL\r\n\r\n-- select * from temp_table_2b\r\n-- ),\r\n\r\n-- temp_table_3 as\r\n-- (SELECT \r\n--        t2.*,\r\n--        if(not(student_id is null AND student_code is null),if(t2.num_completed_orders_same_student \u003e 0, \u0027Học viên cũ\u0027, \u0027Học viên mới\u0027),if(t2.num_completed_orders_same_phone \u003e 0, \u0027có order cùng phone chưa rõ HV cũ/mới\u0027, \u0027Học viên mới\u0027)) as old_new_student,\r\n       \r\n\r\n-- FROM temp_table_2 t2\r\n-- -- WHERE not(student_id is null AND student_code is null)\r\n-- )\r\n\r\n\r\n-- select \r\n--      FORMAT_DATE(\u0027%Y-%m\u0027, tt3.accounting_date) AS year_month,\r\n--      COUNT(*) as num_all_students_tutoring,\r\n--      COUNTIF(tt3.old_new_student in (\u0027Học viên mới\u0027)) as num_new_students_tutoring,\r\n-- --      COUNTIF(tt3.old_new_student in (\u0027Học viên mới\u0027)) / count(*) AS rate_new,\r\n     \r\n-- from temp_table_3 tt3   \r\n-- group by year_month\r\n\r\n\r\n-- -- SELECT \r\n-- --         date(accounting_date) as ngay_hach_toan,\r\n-- --         COUNT(*) as num_new_students_tutoring,\r\n-- -- FROM temp_table_3\r\n-- -- WHERE old_new_student \u003d \u0027Học viên mới\u0027\r\n-- -- GROUP BY ngay_hach_toan -- có thể group theo cả country nữa\r\n-- -- ORDER BY ngay_hach_toan desc\r\n-- ),\r\n\r\n-- ai_single_new_students AS \r\n-- (\r\n-- WITH \r\n-- order_ai_tutor_single AS\r\n-- (SELECT \r\n--         ord.id as order_id,\r\n--         date(ord.created_at) as created_at,\r\n--         date(ord.completed_at) as completed_at,\r\n--         ord.country_id,\r\n--         `kynaforkids-server-production.kynaforkids.func_get_country`(ord.country_id) as country,\r\n--         ord.currency_exchange_rate,\r\n--         ord.total as total_oc,\r\n--         ori.phone_number as order_phone_number,\r\n--         ori.email as order_email,\r\n--         ord.invoice_code as order_code,\r\n--         ord.status as order_status_id,\r\n--         ord.payment_method_id,\r\n--         ord.payment_method_status as payment_status_id,\r\n\r\n\r\n--         ordd.package_id,\r\n--         ordd.package_subscription_id,\r\n--         pks.subscription_month,\r\n--         pks.name as subscription_name,\r\n--         pks.price as subscription_price,\r\n--         pk.name as package_name,\r\n\r\n        \r\n       \r\n-- FROM `kynaforkids-server-production.kynaforkids.order_view` ord\r\n-- LEFT JOIN `kynaforkids-server-production.kynaforkids.order_detail` ordd ON (ord.id \u003d ordd.order_id)\r\n-- LEFT JOIN `kynaforkids-server-production.kynaforkids.order_register_info` ori ON (ord.id \u003d ori.order_id)\r\n-- LEFT JOIN `kynaforkids-server-production.kynaforkids.package_subscriptions` pks ON (ordd.package_subscription_id \u003d pks.id)\r\n-- LEFT JOIN `kynaforkids-server-production.kynaforkids.package` pk ON (pk.id \u003d ordd.package_id)\r\n\r\n\r\n\r\n-- WHERE \r\n--       ord.invoice_code like \u0027KYNA%\u0027 or ord.invoice_code like \u0027GRAI%\u0027      \r\n--       AND pk.name like \u0027%AI Tutor%\u0027\r\n--       AND ordd.package_combo_id is null\r\n-- ),\r\n\r\n-- order_ai_tutor_combo AS\r\n-- (SELECT \r\n--         ord.id as order_id,\r\n--         date(ord.created_at) as created_at,\r\n--         date(ord.completed_at) as completed_at,\r\n--         ord.country_id,\r\n--         `kynaforkids-server-production.kynaforkids.func_get_country`(ord.country_id) as country,\r\n--         ord.currency_exchange_rate,\r\n--         ord.total as total_oc,\r\n--         ori.phone_number as order_phone_number,\r\n--         ori.email as order_email,\r\n--         ord.invoice_code as order_code,\r\n--         ord.status as order_status_id,\r\n--         ord.payment_method_id,\r\n--         ord.payment_method_status as payment_status_id,\r\n\r\n\r\n\r\n--         ordd.package_id,\r\n--         ordd.package_subscription_id,\r\n--         pks.subscription_month,\r\n--         pks.name as subscription_name,\r\n--         pks.price as subscription_price,\r\n--         pk.name as package_name,\r\n\r\n\r\n        \r\n       \r\n-- FROM `kynaforkids-server-production.kynaforkids.order_view` ord\r\n-- LEFT JOIN `kynaforkids-server-production.kynaforkids.order_detail` ordd ON (ord.id \u003d ordd.order_id)\r\n-- LEFT JOIN `kynaforkids-server-production.kynaforkids.order_register_info` ori ON (ord.id \u003d ori.order_id)\r\n-- LEFT JOIN `kynaforkids.package_combo_subscription_item` pcs ON (ordd.package_subscription_id \u003d pcs.id)\r\n-- LEFT JOIN `kynaforkids-server-production.kynaforkids.package_subscriptions` pks ON (pcs.package_subscription_id \u003d pks.id)\r\n-- LEFT JOIN `kynaforkids-server-production.kynaforkids.package` pk ON (pk.id \u003d pcs.package_id)\r\n-- -- LEFT JOIN `kynaforkids-server-production.kynaforkids.package` pk ON (pk.id \u003d ordd.package_combo_id)\r\n\r\n\r\n-- WHERE \r\n--       ord.invoice_code like \u0027KYNA%\u0027 or ord.invoice_code like \u0027GRAI%\u0027\r\n--       AND pk.name like \u0027%AI%\u0027\r\n--       AND ordd.package_combo_id is not null\r\n-- ),\r\n\r\n-- order_ai_tutor AS\r\n-- (\r\n-- SELECT * FROM order_ai_tutor_single\r\n\r\n-- UNION ALL\r\n\r\n-- SELECT * FROM order_ai_tutor_combo\r\n\r\n-- ),\r\n\r\n-- temp_table as \r\n-- (\r\n\r\n-- SELECT \r\n--       oat.* EXCEPT(created_at),\r\n--       if(oat.completed_at is null, oat.created_at, oat.completed_at) as created_at,\r\n-- FROM order_ai_tutor oat\r\n-- ),\r\n\r\n-- single_ai_order as (\r\n-- SELECT   \r\n--          tt.created_at as ngay_hach_toan,\r\n--          tt.country_id,\r\n--          tt.order_id,\r\n--          case \r\n--               when tt.country_id \u003d 3 then 1\r\n--               when tt.country_id \u003d 1 then \r\n--                   (SELECT ce.rate FROM `kynaforkids-server-production.kynaforkids.currency_exchange_config_view` ce \r\n--                     WHERE ce.from \u003d \u0027THB\u0027 and ce.to \u003d \u0027VND\u0027 and date(ce.date_start) \u003c\u003d tt.created_at and date(ce.date_end) \u003e\u003d tt.created_at)\r\n--               when tt.country_id \u003d 2 then \r\n--                   (SELECT ce.rate FROM `kynaforkids-server-production.kynaforkids.currency_exchange_config_view` ce \r\n--                     WHERE ce.from \u003d \u0027IDR\u0027 and ce.to \u003d \u0027VND\u0027 and date(ce.date_start) \u003c\u003d tt.created_at and date(ce.date_end) \u003e\u003d tt.created_at)\r\n--                when tt.country_id \u003d 5 then \r\n--                   (SELECT ce.rate FROM `kynaforkids-server-production.kynaforkids.currency_exchange_config_view` ce \r\n--                     WHERE ce.from \u003d \u0027KIP\u0027 and ce.to \u003d \u0027VND\u0027 and date(ce.date_start) \u003c\u003d tt.created_at and date(ce.date_end) \u003e\u003d tt.created_at)      \r\n--          else null\r\n--      end as ty_gia,\r\n\r\n--       case\r\n--               when aov.created_at \u003d aov.first_time_purchase_phone then \u0027New Customers\u0027\r\n--               else \u0027Returning Customers\u0027\r\n--       end as type_order_phone,\r\n--       case\r\n--               when aov.created_at \u003d aov.first_time_purchase_email then \u0027New Customers\u0027\r\n--               else \u0027Returning Customers\u0027\r\n--       end as type_order_email\r\n-- FROM temp_table tt\r\n-- LEFT JOIN `kynaforkids.Acc_order_video` aov ON (tt.order_id \u003d aov.id)\r\n\r\n-- WHERE \r\n--       tt.created_at \u003e\u003d \u00272024-08-01\u0027 \r\n--       and tt.payment_status_id in (2)\r\n--       and tt.order_status_id in (3)\r\n-- )\r\n\r\n-- SELECT \r\n--       FORMAT_DATE(\u0027%Y-%m\u0027, sao.ngay_hach_toan) AS year_month,\r\n--       COUNT(distinct IF(sao.type_order_email \u003d \u0027New Customers\u0027 and sao.type_order_phone \u003d \u0027New Customers\u0027, sao.order_id, null)) as num_new_students_AI_single,\r\n--       COUNT(distinct sao.order_id) as num_all_students_AI_single,\r\n\r\n-- FROM single_ai_order sao\r\n-- -- WHERE sao.type_order_email \u003d \u0027New Customers\u0027 and sao.type_order_phone \u003d \u0027New Customers\u0027 \r\n-- GROUP BY year_month     -- có thể group theo country nữa\r\n-- ORDER BY year_month DESC\r\n-- )\r\n\r\n\r\n-- SELECT\r\n--       coalesce(tns.year_month, ais.year_month) as year_month,\r\n--       coalesce(tns.num_new_students_tutoring, 0) as num_new_students_tutoring,\r\n--       coalesce(ais.num_new_students_AI_single, 0) as num_new_students_AI_single,\r\n--       coalesce(tns.num_new_students_tutoring, 0) + coalesce(ais.num_new_students_AI_single, 0) as total_new_students,\r\n--       tns.num_all_students_tutoring,\r\n--       ais.num_all_students_AI_single,\r\n--       coalesce(tns.num_all_students_tutoring,0) + coalesce(ais.num_all_students_AI_single,0) as num_all_students, \r\n--       -- round(tns.rate_new,2) as rate_new,\r\n--       round ((coalesce(tns.num_new_students_tutoring, 0) + coalesce(ais.num_new_students_AI_single, 0))/(coalesce(tns.num_all_students_tutoring,0) + coalesce(ais.num_all_students_AI_single,0)),4) as rate_new,\r\n-- FROM tutoring_new_students tns\r\n-- FULL JOIN ai_single_new_students ais ON(tns.year_month \u003d ais.year_month)  -- có thể group theo ngay hạch toán và cả country, hiện chưa làm tới mức country\r\n-- ORDER BY year_month DESC\r\n\r\n-- Optimized SQL Query for Student Analysis\r\n-- Main CTE structure for analyzing new and returning students across tutoring and AI programs\r\n\r\nWITH \r\n-- Base CTE for collecting order information with simplified selection criteria\r\norder_info AS (\r\n  SELECT \r\n      COALESCE(bo.accounting_date, bo.created_at) AS accounting_date,\r\n      (SELECT created_at\r\n       FROM `kynaforkids-server-production.kynaforkids.booking_lead`\r\n       WHERE id \u003d bo.lead_id) AS ngay_tao_lead,\r\n      bo.student_code,\r\n      bo.student_id,\r\n      bo.phone_number,\r\n      bo.id as order_id,\r\n      bo.international_country_id,\r\n      COALESCE(bo.total_video_course, 0) AS total_video_course,\r\n      bo.total,\r\n      `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(CAST(bo.payment_content AS INT64)) AS noi_dung_thanh_toan,\r\n      `kynaforkids-server-production.kynaforkids.func_get_source`(bo.source) AS source,\r\n      `kynaforkids-server-production.kynaforkids.func_get_program_name_from_id`(bo.program_id) AS program,\r\n      bo.program_type,\r\n      `kynaforkids-server-production.kynaforkids.func_get_booking_order_status`(bo.status) AS order_status,\r\n      CASE \r\n          WHEN bo.payment_status \u003d 0 THEN \u0027Chưa duyệt\u0027 \r\n          WHEN bo.payment_status \u003d 1 THEN \u0027Đã duyệt\u0027 \r\n          WHEN bo.payment_status \u003d 2 THEN \u0027Không duyệt\u0027 \r\n          WHEN bo.payment_status \u003d 3 THEN \u0027Cần điều chỉnh\u0027 \r\n          WHEN bo.payment_status \u003d 4 THEN \u0027Đã điều chỉnh\u0027 \r\n          ELSE \u0027Khác\u0027 \r\n      END AS payment_status,\r\n      COALESCE(bo.total, 0) - COALESCE(bo.discount_money, 0) AS price,\r\n      bo.lead_id,\r\n      bo.currency_exchange_rate,\r\n      `kynaforkids-server-production.kynaforkids.func_get_country`(bo.international_country_id) AS country,\r\n      bo.order_type,\r\n      bo.order_type_sub\r\n  FROM `kynaforkids-server-production.kynaforkids.booking_order_view` bo\r\n  LEFT JOIN `kynaforkids-server-production.kynaforkids.booking_lead` bll \r\n      ON bll.id \u003d bo.lead_id\r\n  WHERE bo.program_type \u003d 1\r\n    AND bo.order_type \u003d 1\r\n    AND COALESCE(bo.total_video_course, 0) + COALESCE(bo.total, 0) \u003e 0\r\n),\r\n\r\n-- Consolidated temp table with dynamic filter conditions based on current month vs previous months\r\ntutoring_orders AS (\r\n  SELECT \r\n      t1.order_id,\r\n      t1.order_type,\r\n      t1.order_type_sub,\r\n      t1.accounting_date,\r\n      t1.phone_number,\r\n      t1.international_country_id as country_id,\r\n      t1.total_video_course,\r\n      t1.total,\r\n      t1.noi_dung_thanh_toan,\r\n      t1.source,\r\n      t1.program,\r\n      t1.program_type,\r\n      t1.order_status,\r\n      t1.payment_status,\r\n      t1.country,\r\n      t1.student_id,\r\n      t1.student_code,\r\n      -- Count previous orders by same student\r\n      (\r\n        SELECT COUNT(DISTINCT bo.order_id) \r\n        FROM order_info bo \r\n        WHERE (bo.student_id \u003d t1.student_id OR bo.student_code \u003d t1.student_code) and (t1.student_code is not null or t1.student_id is not null) and (t1.student_code !\u003d \u0027\u0027) \r\n          AND bo.payment_status \u003d \u0027Đã duyệt\u0027  \r\n          AND bo.order_status \u003d \u0027Hoàn thành\u0027 \r\n          AND bo.noi_dung_thanh_toan IN (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n          AND DATE(bo.accounting_date) \u003c DATE(t1.accounting_date)\r\n      ) as num_completed_orders_same_student,\r\n      -- Count previous orders by same phone number\r\n      (\r\n        SELECT COUNT(DISTINCT bo.order_id) \r\n        FROM order_info bo \r\n        WHERE RIGHT(bo.phone_number, 9) \u003d RIGHT(t1.phone_number, 9) \r\n          AND bo.payment_status \u003d \u0027Đã duyệt\u0027 \r\n          AND bo.order_status \u003d \u0027Hoàn thành\u0027 \r\n          AND bo.noi_dung_thanh_toan IN (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n          AND DATE(bo.accounting_date) \u003c DATE(t1.accounting_date)\r\n      ) as num_completed_orders_same_phone,\r\n      -- Flag for current month to apply different filtering logic\r\n      FORMAT_DATE(\u0027%Y-%m\u0027, t1.accounting_date) \u003d FORMAT_DATE(\u0027%Y-%m\u0027, CURRENT_DATE()) AS is_current_month\r\n  FROM order_info t1\r\n  WHERE t1.accounting_date \u003e\u003d \u00272020-01-01\u0027 \r\n    AND (\r\n        -- Current month conditions (more lenient)\r\n        (FORMAT_DATE(\u0027%Y-%m\u0027, t1.accounting_date) \u003e\u003d FORMAT_DATE(\u0027%Y-%m\u0027, date_sub(CURRENT_DATE(),interval 8 day))\r\n         AND t1.payment_status IN (\u0027Đã duyệt\u0027, \u0027Chưa duyệt\u0027, \u0027Cần điều chỉnh\u0027) \r\n         AND t1.order_status IN (\u0027Hoàn thành\u0027, \u0027Chờ xác nhận thanh toán\u0027))\r\n        OR\r\n        -- Past months conditions (more strict)\r\n        (FORMAT_DATE(\u0027%Y-%m\u0027, t1.accounting_date) \u003c FORMAT_DATE(\u0027%Y-%m\u0027, date_sub(CURRENT_DATE(),interval 8 day))\r\n         AND t1.payment_status \u003d \u0027Đã duyệt\u0027\r\n         AND t1.order_status \u003d \u0027Hoàn thành\u0027)\r\n    )\r\n    AND t1.noi_dung_thanh_toan IN (\u0027Ghi danh lần đầu\u0027, \u0027Ghi danh lại\u0027, \u0027Trả góp lần sau\u0027) \r\n    AND (t1.price + t1.total_video_course) \u003e 0\r\n),\r\n\r\n-- Identify whether students are new or returning\r\nstudent_classification AS (\r\n  SELECT \r\n      *,\r\n      CASE \r\n          WHEN NOT(student_id IS NULL AND student_code IS NULL) THEN\r\n              IF(num_completed_orders_same_student \u003e 0, \u0027Học viên cũ\u0027, \u0027Học viên mới\u0027)\r\n          ELSE\r\n              IF(num_completed_orders_same_phone \u003e 0, \u0027có order cùng phone chưa rõ HV cũ/mới\u0027, \u0027Học viên mới\u0027)\r\n      END AS old_new_student\r\n  FROM tutoring_orders\r\n),\r\n\r\n-- Aggregate tutoring data by month\r\ntutoring_new_students AS (\r\n  SELECT \r\n      FORMAT_DATE(\u0027%Y-%m\u0027, accounting_date) AS year_month,\r\n      COUNT(*) AS num_all_students_tutoring,\r\n      COUNTIF(old_new_student \u003d \u0027Học viên mới\u0027) AS num_new_students_tutoring\r\n  FROM student_classification\r\n  GROUP BY year_month\r\n),\r\n\r\n-- -- AI Tutor Single Package Orders\r\n-- order_ai_tutor_single AS (\r\n--   SELECT \r\n--       ord.id AS order_id,\r\n--       DATE(IF(ord.completed_at IS NULL, ord.created_at, ord.completed_at)) AS accounting_date,\r\n--       ord.country_id,\r\n--       `kynaforkids-server-production.kynaforkids.func_get_country`(ord.country_id) AS country,\r\n--       ord.currency_exchange_rate,\r\n--       ord.total AS total_oc,\r\n--       ori.phone_number AS order_phone_number,\r\n--       ori.email AS order_email,\r\n--       ord.invoice_code AS order_code,\r\n--       ord.status AS order_status_id,\r\n--       ord.payment_method_id,\r\n--       ord.payment_method_status AS payment_status_id,\r\n--       ordd.package_id,\r\n--       ordd.package_subscription_id,\r\n--       pks.subscription_month,\r\n--       pks.name AS subscription_name,\r\n--       pks.price AS subscription_price,\r\n--       pk.name AS package_name,\r\n--       CASE\r\n--           WHEN aov.created_at \u003d aov.first_time_purchase_email \r\n--                AND aov.created_at \u003d aov.first_time_purchase_phone \r\n--           THEN \u0027New Customers\u0027\r\n--           ELSE \u0027Returning Customers\u0027\r\n--       END AS customer_type\r\n--   FROM `kynaforkids-server-production.kynaforkids.order_view` ord\r\n--   LEFT JOIN `kynaforkids-server-production.kynaforkids.order_detail` ordd \r\n--       ON ord.id \u003d ordd.order_id\r\n--   LEFT JOIN `kynaforkids-server-production.kynaforkids.order_register_info` ori \r\n--       ON ord.id \u003d ori.order_id\r\n--   LEFT JOIN `kynaforkids-server-production.kynaforkids.package_subscriptions` pks \r\n--       ON ordd.package_subscription_id \u003d pks.id\r\n--   LEFT JOIN `kynaforkids-server-production.kynaforkids.package` pk \r\n--       ON pk.id \u003d ordd.package_id\r\n--   LEFT JOIN `kynaforkids.Acc_order_video` aov \r\n--       ON ord.id \u003d aov.id\r\n--   WHERE (ord.invoice_code LIKE \u0027KYNA%\u0027 OR ord.invoice_code LIKE \u0027GRAI%\u0027)\r\n--     AND pk.name LIKE \u0027%AI Tutor%\u0027\r\n--     AND ordd.package_combo_id IS NULL\r\n--     AND ord.payment_method_status \u003d 2\r\n--     AND ord.status \u003d 3\r\n--     AND DATE(IF(ord.completed_at IS NULL, ord.created_at, ord.completed_at)) \u003e\u003d \u00272024-08-01\u0027\r\n-- ),\r\n\r\n-- -- AI Tutor Combo Package Orders\r\n-- order_ai_tutor_combo AS (\r\n--   SELECT \r\n--       ord.id AS order_id,\r\n--       DATE(IF(ord.completed_at IS NULL, ord.created_at, ord.completed_at)) AS accounting_date,\r\n--       ord.country_id,\r\n--       `kynaforkids-server-production.kynaforkids.func_get_country`(ord.country_id) AS country,\r\n--       ord.currency_exchange_rate,\r\n--       ord.total AS total_oc,\r\n--       ori.phone_number AS order_phone_number,\r\n--       ori.email AS order_email,\r\n--       ord.invoice_code AS order_code,\r\n--       ord.status AS order_status_id,\r\n--       ord.payment_method_id,\r\n--       ord.payment_method_status AS payment_status_id,\r\n--       ordd.package_id,\r\n--       ordd.package_subscription_id,\r\n--       pks.subscription_month,\r\n--       pks.name AS subscription_name,\r\n--       pks.price AS subscription_price,\r\n--       pk.name AS package_name,\r\n--       CASE\r\n--           WHEN aov.created_at \u003d aov.first_time_purchase_email \r\n--                AND aov.created_at \u003d aov.first_time_purchase_phone \r\n--           THEN \u0027New Customers\u0027\r\n--           ELSE \u0027Returning Customers\u0027\r\n--       END AS customer_type\r\n--   FROM `kynaforkids-server-production.kynaforkids.order_view` ord\r\n--   LEFT JOIN `kynaforkids-server-production.kynaforkids.order_detail` ordd \r\n--       ON ord.id \u003d ordd.order_id\r\n--   LEFT JOIN `kynaforkids-server-production.kynaforkids.order_register_info` ori \r\n--       ON ord.id \u003d ori.order_id\r\n--   LEFT JOIN `kynaforkids.package_combo_subscription_item` pcs \r\n--       ON ordd.package_subscription_id \u003d pcs.id\r\n--   LEFT JOIN `kynaforkids-server-production.kynaforkids.package_subscriptions` pks \r\n--       ON pcs.package_subscription_id \u003d pks.id\r\n--   LEFT JOIN `kynaforkids-server-production.kynaforkids.package` pk \r\n--       ON pk.id \u003d pcs.package_id\r\n--   LEFT JOIN `kynaforkids.Acc_order_video` aov \r\n--       ON ord.id \u003d aov.id\r\n--   WHERE (ord.invoice_code LIKE \u0027KYNA%\u0027 OR ord.invoice_code LIKE \u0027GRAI%\u0027)\r\n--     AND pk.name LIKE \u0027%AI%\u0027\r\n--     AND ordd.package_combo_id IS NOT NULL\r\n--     AND ord.payment_method_status \u003d 2\r\n--     AND ord.status \u003d 3\r\n--     AND DATE(IF(ord.completed_at IS NULL, ord.created_at, ord.completed_at)) \u003e\u003d \u00272024-08-01\u0027\r\n-- ),\r\n\r\n-- -- Combine single and combo AI tutor orders\r\n-- ai_students AS (\r\n--   SELECT * FROM order_ai_tutor_single\r\n--   UNION ALL\r\n--   SELECT * FROM order_ai_tutor_combo\r\n-- ),\r\n\r\n-- -- Aggregate AI data by month\r\n-- ai_single_new_students AS (\r\n--   SELECT \r\n--       FORMAT_DATE(\u0027%Y-%m\u0027, accounting_date) AS year_month,\r\n--       COUNT(DISTINCT IF(customer_type \u003d \u0027New Customers\u0027, order_id, NULL)) AS num_new_students_AI_single,\r\n--       COUNT(DISTINCT order_id) AS num_all_students_AI_single\r\n--   FROM ai_students\r\n--   GROUP BY year_month\r\n-- )\r\nai_single_new_students AS (\r\nselect * from `datateam_kynaforkids.ai_new_students_day_D`\r\n)\r\n-- Final result combining tutoring and AI student data\r\nSELECT\r\n    COALESCE(tns.year_month, ais.year_month) AS year_month,\r\n    COALESCE(tns.num_new_students_tutoring, 0) AS num_new_students_tutoring,\r\n    COALESCE(ais.num_new_students_AI_single, 0) AS num_new_students_AI_single,\r\n    COALESCE(tns.num_new_students_tutoring, 0) + COALESCE(ais.num_new_students_AI_single, 0) AS total_new_students,\r\n    COALESCE(tns.num_all_students_tutoring, 0) AS num_all_students_tutoring,\r\n    COALESCE(ais.num_all_students_AI_single, 0) AS num_all_students_AI_single,\r\n    COALESCE(tns.num_all_students_tutoring, 0) + COALESCE(ais.num_all_students_AI_single, 0) AS num_all_students,\r\n    ROUND(\r\n        (COALESCE(tns.num_new_students_tutoring, 0) + COALESCE(ais.num_new_students_AI_single, 0)) / \r\n        NULLIF((COALESCE(tns.num_all_students_tutoring, 0) + COALESCE(ais.num_all_students_AI_single, 0)), 0),\r\n        4\r\n    ) AS rate_new\r\nFROM tutoring_new_students tns\r\nFULL JOIN ai_single_new_students ais \r\n    ON tns.year_month \u003d ais.year_month\r\n-- WHERE tns.year_month \u003d FORMAT_DATE(\u0027%Y-%m\u0027, current_date())\r\nORDER BY year_month DESC;\r\n\r\n;"
}, {
  "table_name": "menu",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.menu`\n(\n  id INT64,\n  name STRING,\n  description STRING,\n  icon STRING,\n  parent_menu_id INT64,\n  `order` INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  module_name STRING,\n  controller_name STRING,\n  action_name STRING,\n  short_link STRING,\n  is_show INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_grammar_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_grammar_config`\n(\n  id INT64,\n  ai_topic_id INT64,\n  structure STRING,\n  grammar STRING,\n  `using` STRING,\n  translate STRING,\n  example STRING,\n  example_translate STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "group_talk_student",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.group_talk_student`\n(\n  id INT64,\n  group_talk_id INT64,\n  booking_student_id INT64,\n  booking_order_teacher_type_id INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "mission",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.mission`\n(\n  id INT64,\n  object_type INT64,\n  description STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "contest_student_join_campaign",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.contest_student_join_campaign`\n(\n  id INT64,\n  contest_student_id INT64,\n  contest_campaign_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "user_zalo_follow",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.user_zalo_follow`\n(\n  id INT64,\n  follower_id STRING,\n  follow_at INT64,\n  unfollow_at INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  phone_number STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_tag",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_tag`\n(\n  id INT64,\n  name STRING,\n  translate STRING,\n  visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ai_started_media",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_started_media`\n(\n  id INT64,\n  title STRING,\n  video_link STRING,\n  thumbnail_link STRING,\n  country_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_student",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student`\n(\n  user_id INT64,\n  start_level_id INT64,\n  total_lesson INT64,\n  total_extra_lesson INT64,\n  total_gift_lesson INT64,\n  remain_lesson INT64,\n  start_at INT64,\n  expired_at INT64,\n  teacher_priority_id STRING,\n  country_id INT64,\n  currency_code STRING,\n  user_type_id INT64,\n  year_of_birth INT64,\n  priority_status INT64,\n  student_code STRING,\n  is_user_test INT64,\n  is_access_learning INT64,\n  learning_type INT64,\n  quality_training INT64,\n  quality_refund INT64,\n  quality_private_session INT64,\n  student_status INT64,\n  is_complete INT64,\n  curriculum_type INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  remain_extra_lesson INT64,\n  date_of_reservation INT64,\n  manager_id INT64,\n  current_level_id INT64,\n  current_lesson_id INT64,\n  migrate_remain_lesson INT64,\n  migrate_remain_extra_lesson INT64,\n  apply_priority_date_at INT64,\n  sale_in_charge_id INT64,\n  ops_id INT64,\n  is_build_record INT64,\n  email_contact STRING,\n  has_unmap_order INT64,\n  center_id INT64,\n  contact_phone_numbers STRING,\n  is_accept_notification INT64,\n  no_camera INT64,\n  label_id STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (user_id) NOT ENFORCED\n)\nCLUSTER BY user_id;"
}, {
  "table_name": "ai_picture_mode_vocab_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_picture_mode_vocab_config`\n(\n  id INT64,\n  ai_topic_picture_mode_id INT64,\n  content STRING,\n  type STRING,\n  ipa STRING,\n  translate STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "bbb_location",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.bbb_location`\n(\n  id INT64,\n  bbb_server_point INT64,\n  location INT64,\n  status INT64,\n  user_selectable INT64,\n  auto_select INT64,\n  name STRING,\n  bbb_url STRING,\n  bbb_secret STRING,\n  bbb_version STRING,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "invoice_detail",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.invoice_detail`\n(\n  order_id INT64,\n  req_export INT64,\n  invoice_name STRING,\n  invoice_company STRING,\n  invoice_tax_number STRING,\n  invoice_address STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (order_id) NOT ENFORCED\n)\nCLUSTER BY order_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_picture_mode_media",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_picture_mode_media`\n(\n  id INT64,\n  ai_picture_mode_question_type_id INT64,\n  ai_picture_mode_topic_id INT64,\n  banner STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  visible INT64,\n  type INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_lesson_comment_end_level_template",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_lesson_comment_end_level_template`\n(\n  id INT64,\n  lesson_id INT64,\n  comment_template STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "summer_camp_student_award",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.summer_camp_student_award`\n(\n  id INT64,\n  student_id INT64,\n  award_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_single_new_students_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.ai_single_new_students_view`\nAS -- CTE 1: Thu thập đơn hàng AI Tutor với lọc sớm\r\nWITH order_ai_tutor AS (\r\n    SELECT \r\n        ord.id AS order_id,\r\n        COALESCE(\r\n            DATE(TIMESTAMP_SECONDS(ord.completed_at)), \r\n            DATE(TIMESTAMP_SECONDS(ord.created_at))\r\n        ) AS accounting_date\r\n    FROM `kynaforkids-server-production.kynaforkids.order` ord\r\n    JOIN `kynaforkids-server-production.kynaforkids.order_detail` ordd \r\n        ON ord.id \u003d ordd.order_id\r\n    LEFT JOIN `kynaforkids.package_combo_subscription_item` pcs \r\n        ON ordd.package_subscription_id \u003d pcs.id AND ordd.package_combo_id IS NOT NULL\r\n    JOIN `kynaforkids-server-production.kynaforkids.package_subscriptions` pks \r\n        ON COALESCE(pcs.package_subscription_id, ordd.package_subscription_id) \u003d pks.id\r\n    JOIN `kynaforkids-server-production.kynaforkids.package` pk \r\n        ON COALESCE(pcs.package_id, ordd.package_id) \u003d pk.id\r\n    WHERE \r\n        ord.payment_method_status \u003d 2\r\n        AND ord.status \u003d 3\r\n        AND (ord.invoice_code LIKE \u0027KYNA%\u0027 OR ord.invoice_code LIKE \u0027GRAI%\u0027)\r\n        AND (\r\n            (ordd.package_combo_id IS NULL AND pk.name LIKE \u0027%AI Tutor%\u0027)\r\n            OR\r\n            (ordd.package_combo_id IS NOT NULL AND pk.name LIKE \u0027%AI%\u0027)\r\n        )\r\n),\r\n\r\n-- CTE 2: Xác định khách hàng mới\r\nnew_customers AS (\r\n    SELECT\r\n        oat.order_id,\r\n        oat.accounting_date,\r\n        CASE\r\n            WHEN oat.accounting_date \u003d DATE(TIMESTAMP_SECONDS(aov.first_time_purchase_phone)) \r\n             AND oat.accounting_date \u003d DATE(TIMESTAMP_SECONDS(aov.first_time_purchase_email))\r\n            THEN \u0027New Customer\u0027\r\n            ELSE \u0027Returning Customer\u0027\r\n        END AS customer_type\r\n    FROM order_ai_tutor oat\r\n    LEFT JOIN `kynaforkids.Acc_order_video` aov \r\n        ON oat.order_id \u003d aov.id\r\n    WHERE \r\n        oat.accounting_date \u003e\u003d \u00272024-01-01\u0027\r\n)\r\n\r\n-- Truy vấn cuối: Đếm học sinh mới theo ngày\r\nSELECT \r\n    accounting_date AS ngay_hach_toan,\r\n    COUNT(distinct order_id) AS num_new_students_AI_single\r\nFROM new_customers\r\nWHERE customer_type \u003d \u0027New Customer\u0027\r\nGROUP BY accounting_date\r\nORDER BY accounting_date DESC;;"
}, {
  "table_name": "mkt_table_temp_fanpage",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.kynaforkids.mkt_table_temp_fanpage`\nOPTIONS(\n  sheet_range\u003d\"\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/17HjEwX_6lnjOa1hqy0cPMH131Xxp6nlPYJuwWY5FZpo/edit?gid\u003d0#gid\u003d0\"]\n);"
}, {
  "table_name": "currency_exchange_config_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.currency_exchange_config_view`\nAS SELECT * except(date_start,date_end,created_at,updated_at),\r\n      timestamp_seconds(date_start) as date_start,\r\n      timestamp_seconds(date_end) as date_end,\r\n      timestamp_seconds(created_at) as created_at,\r\n      timestamp_seconds(updated_at) as updated_at\r\nFROM `kynaforkids-server-production.kynaforkids.currency_exchange_config`;"
}, {
  "table_name": "contest_round_info",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.contest_round_info`\n(\n  id INT64,\n  name STRING,\n  begin_at INT64,\n  end_at INT64,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  contest_campaign_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_student_duo_request",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_duo_request`\n(\n  id INT64,\n  request_id INT64,\n  student_id INT64,\n  program_id INT64,\n  status_id INT64,\n  completed_at INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  source_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_leadgen",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_leadgen`\n(\n  id INT64,\n  booking_lead_id INT64,\n  leadgen_id STRING,\n  form_id STRING,\n  ad_id STRING,\n  page_id STRING,\n  full_name STRING,\n  email STRING,\n  phone STRING,\n  created_time INT64,\n  raw_data JSON,\n  created_at INT64,\n  updated_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_test_online_request_item",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_test_online_request_item`\n(\n  id INT64,\n  booking_request_id INT64,\n  booking_session_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "quiz_final_test_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.quiz_final_test_config`\n(\n  id INT64,\n  level_id INT64,\n  quiz_id INT64,\n  freetalk_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "outline_report_template",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.outline_report_template`\n(\n  id INT64,\n  program_id INT64,\n  booking_level_id INT64,\n  lesson_id INT64,\n  skill_type INT64,\n  description STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_document",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_document`\n(\n  id INT64,\n  document_name STRING,\n  path STRING,\n  type STRING,\n  extension STRING,\n  program_id INT64,\n  `order` INT64,\n  visible INT64,\n  is_show_teacher INT64,\n  is_show_learning INT64,\n  document_type INT64,\n  pdf_total_page INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "import_data",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.import_data`\n(\n  id INT64,\n  name STRING,\n  status INT64,\n  data STRING,\n  type INT64,\n  date_import INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  excel_path STRING,\n  error_log STRING,\n  import_log STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_session_student_lesson_homework",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_session_student_lesson_homework`\n(\n  id INT64,\n  booking_session_id INT64,\n  student_id INT64,\n  lesson_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  type INT64,\n  is_completed INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "offline_event_student_result_history",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.offline_event_student_result_history`\n(\n  id INT64,\n  offline_event_student_result_id INT64,\n  program_type INT64,\n  test_program_id INT64,\n  test_level_id INT64,\n  pronunciation INT64,\n  vocabulary INT64,\n  writing INT64,\n  reading INT64,\n  speaking INT64,\n  listening INT64,\n  achieved STRING,\n  improve STRING,\n  summary STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_center_country",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_center_country`\n(\n  center_id INT64,\n  country_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (center_id, country_id) NOT ENFORCED\n)\nCLUSTER BY center_id, country_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "customer_kynavn_data_table",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.customer_kynavn_data_table`\n(\n  phone_login STRING,\n  email STRING,\n  courses STRING\n);"
}, {
  "table_name": "bank_info",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.bank_info`\n(\n  id INT64,\n  display_name STRING,\n  export_name STRING,\n  branch_name STRING,\n  province_name STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "sale_bonus",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.sale_bonus`\n(\n  id INT64,\n  order_id INT64,\n  order_status INT64,\n  payment_method_status INT64,\n  payment_method_id INT64,\n  sale_id INT64,\n  country_id INT64,\n  lasted_sale_id INT64,\n  total NUMERIC(15, 2),\n  percent FLOAT64,\n  amount NUMERIC(15, 2),\n  completed_at INT64,\n  activated_at INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  is_activated INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_session_sample_record",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_session_sample_record`\n(\n  id INT64,\n  booking_id INT64,\n  record_url STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  is_hide_student_face INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_order_gift",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_order_gift`\n(\n  id INT64,\n  invoice_code STRING,\n  full_name STRING,\n  phone_number STRING,\n  address STRING,\n  hamlet STRING,\n  location_id INT64,\n  notes STRING,\n  status INT64,\n  transfer_to_admin_at INT64,\n  sent_to_shipping_at INT64,\n  shipping_method_id INT64,\n  pickup_location_id INT64,\n  shipping_service_code STRING,\n  payment_method_status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  is_priority INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "ai_study_mode_lesson_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_study_mode_lesson_log`\n(\n  id INT64,\n  ai_study_mode_lesson_id INT64,\n  student_id INT64,\n  status INT64,\n  history_data STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "report",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.report`\n(\n  id INT64,\n  name STRING,\n  upload_path STRING,\n  export_path STRING,\n  report_category_id INT64,\n  date INT64,\n  visible INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "affiliate_user_post_tracking",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.affiliate_user_post_tracking`\n(\n  id INT64,\n  user_id INT64,\n  affiliate_id INT64,\n  student_id INT64,\n  parent_name STRING,\n  children_name STRING,\n  post_link STRING,\n  status INT64,\n  register_at INT64,\n  count_status_update INT64,\n  is_remind INT64,\n  remind_date INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  program_name STRING,\n  priority_status_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  type_post INT64,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_lead_action_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.kynaforkids.booking_lead_action_view`\nAS SELECT         \r\n* EXCEPT(created_at,updated_at),       \r\nTIMESTAMP_SECONDS(created_at) as created_at,       \r\nTIMESTAMP_SECONDS(updated_at) as updated_at,\r\nFROM `kynaforkids-server-production.kynaforkids.booking_lead_action`;"
}, {
  "table_name": "profile",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.profile`\n(\n  user_id INT64,\n  name STRING,\n  public_email STRING,\n  gravatar_email STRING,\n  gravatar_id STRING,\n  location STRING,\n  website STRING,\n  bio STRING,\n  timezone STRING,\n  gender INT64,\n  birthday INT64,\n  avatar STRING,\n  facebook_id STRING,\n  has_children INT64,\n  title STRING,\n  salary FLOAT64,\n  country_id INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  city_id INT64,\n  name_dup_count INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (user_id) NOT ENFORCED\n)\nCLUSTER BY user_id;"
}, {
  "table_name": "quiz_toeic_content_review",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.quiz_toeic_content_review`\n(\n  id INT64,\n  object_id INT64,\n  type INT64,\n  content_review STRING,\n  tag INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "mkt_table_temp_my_kingdom",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.kynaforkids.mkt_table_temp_my_kingdom`\n(\n  Name STRING,\n  Gender STRING,\n  FirstChildName STRING,\n  FirstChildBirthDate STRING,\n  FirstChildGender STRING,\n  SecondChildName STRING,\n  SecondChildBirthDate STRING,\n  SecondChildGender STRING,\n  Phone STRING,\n  Email STRING,\n  RegionOfStoreId STRING,\n  ProvinceOfStoreId STRING,\n  DistrictOfStoreId STRING\n)\nOPTIONS(\n  sheet_range\u003d\"A:M\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/1k_E4sNep_ZDLESjEkFyO_r31NLmLApCOYCx5gw8a05k/edit?gid\u003d12702054#gid\u003d12702054\"]\n);"
}, {
  "table_name": "booking_student_periodic_report",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_student_periodic_report`\n(\n  id INT64,\n  user_id INT64,\n  program_id INT64,\n  current_level_id INT64,\n  comment STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "payment_transaction",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.payment_transaction`\n(\n  id INT64,\n  order_id INT64,\n  is_booking_order_gift INT64,\n  payment_method_id INT64,\n  payment_gateway_id INT64,\n  payment_gateway_status STRING,\n  transaction_code STRING,\n  amount NUMERIC(13, 2),\n  request_data STRING,\n  response_data STRING,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "affiliate_contract",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.affiliate_contract`\n(\n  id INT64,\n  affiliate_id INT64,\n  contract_code STRING,\n  position STRING,\n  name STRING,\n  phone STRING,\n  email STRING,\n  address STRING,\n  tax_code STRING,\n  card_number STRING,\n  card_date INT64,\n  card_place STRING,\n  account_no STRING,\n  account_name STRING,\n  account_bank STRING,\n  account_branch STRING,\n  account_place STRING,\n  front_id_img STRING,\n  back_id_img STRING,\n  status INT64,\n  award_date STRING,\n  contract_pdf_url STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  bank_export_name STRING,\n  date_deactive_contract INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  visible INT64,\n  signature_url STRING,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "inbox_action",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.inbox_action`\n(\n  id INT64,\n  type STRING,\n  name STRING,\n  content STRING,\n  is_send_to_dashboard_inbox INT64,\n  is_send_to_email INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "wh_product",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.wh_product`\n(\n  id INT64,\n  unit_id INT64,\n  name STRING,\n  code STRING,\n  is_gift INT64,\n  description STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  is_fragile INT64,\n  old_student_visible INT64,\n  new_student_visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "box_cards",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.box_cards`\n(\n  id INT64,\n  name STRING,\n  type INT64,\n  is_package_for_parent INT64,\n  affiliate_id INT64,\n  payment_type INT64,\n  period INT64,\n  is_gift_box_card INT64,\n  days INT64,\n  quantity INT64,\n  status INT64,\n  note STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  record_number INT64,\n  user_password STRING,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "partner_code",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.partner_code`\n(\n  id INT64,\n  code STRING,\n  partner_id INT64,\n  order_id INT64,\n  package_id INT64,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  partner_product_id INT64,\n  subscription_id INT64,\n  num_used INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "b2b_student_program",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.b2b_student_program`\n(\n  student_id INT64,\n  program_id INT64,\n  status INT64,\n  start_at INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (program_id, student_id) NOT ENFORCED\n)\nCLUSTER BY program_id, student_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "telesales_supervisor_mgr",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr`\n(\n  telesales_supervisor_id INT64,\n  telesales_id INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (telesales_id, telesales_supervisor_id) NOT ENFORCED\n)\nCLUSTER BY telesales_id, telesales_supervisor_id;"
}, {
  "table_name": "auth_assignment",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.auth_assignment`\n(\n  item_name STRING,\n  user_id INT64,\n  created_at INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (user_id, item_name) NOT ENFORCED\n)\nCLUSTER BY user_id, item_name;"
}, {
  "table_name": "booking_lead_conversation_pancake",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_lead_conversation_pancake`\n(\n  id INT64,\n  conversation_id STRING,\n  name STRING,\n  customer_id STRING,\n  phone_number STRING,\n  ad_id STRING,\n  page_id STRING,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  log STRING,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_bbb_guest_link",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_bbb_guest_link`\n(\n  booking_id INT64,\n  role STRING,\n  name STRING,\n  link STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64, is_deleted BOOL\u003e\n)\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "detect_face_teacher_config",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.detect_face_teacher_config`\n(\n  teacher_id INT64,\n  rule INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (teacher_id) NOT ENFORCED\n)\nCLUSTER BY teacher_id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_session_duo_data",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_session_duo_data`\n(\n  id INT64,\n  booking_session_id INT64,\n  student_id INT64,\n  previous_booking_id INT64,\n  exercise_link STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  learning_data STRING,\n  start_learning_time INT64,\n  end_learning_time INT64,\n  total_teacher_talk_time INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "ai_tutor_access_log_detail",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_tutor_access_log_detail`\n(\n  id INT64,\n  children_id INT64,\n  mode INT64,\n  topic_id INT64,\n  session_id STRING,\n  begin_at INT64,\n  end_at INT64,\n  total_time INT64,\n  created_at INT64,\n  created_by INT64,\n  updated_at INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "action_log",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.action_log`\n(\n  id INT64,\n  action STRING,\n  params STRING,\n  result STRING,\n  status INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_country_group",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_country_group`\n(\n  id INT64,\n  country_id INT64,\n  name STRING,\n  visible INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "dev_query",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.dev_query`\n(\n  id INT64,\n  `select` STRING,\n  `from` STRING,\n  `where` STRING,\n  query STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_complain",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_complain`\n(\n  booking_teacher_complain_id INT64,\n  type INT64,\n  adjustment_income NUMERIC(15, 2),\n  action_value INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (booking_teacher_complain_id, type) NOT ENFORCED\n)\nCLUSTER BY booking_teacher_complain_id, type;"
}, {
  "table_name": "ai_picture_mode_level",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.ai_picture_mode_level`\n(\n  id INT64,\n  name STRING,\n  user_type_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  visible INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_teacher_lead",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_teacher_lead`\n(\n  id INT64,\n  name STRING,\n  email STRING,\n  phone_number STRING,\n  link_cv STRING,\n  status INT64,\n  type INT64,\n  source INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  interview_id INT64,\n  tc_in_charge INT64,\n  country_id INT64,\n  recruit_source_id INT64,\n  introduced_by INT64,\n  `order` INT64,\n  subject INT64,\n  recall_date INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  note STRING,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "booking_level_student_category",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_level_student_category`\n(\n  id INT64,\n  level_id INT64,\n  category_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}, {
  "table_name": "booking_session_student_action",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.booking_session_student_action`\n(\n  id INT64,\n  booking_id INT64,\n  student_id INT64,\n  action INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id;"
}, {
  "table_name": "final_report_template",
  "ddl": "CREATE TABLE `kynaforkids-server-production.kynaforkids.final_report_template`\n(\n  id INT64,\n  program_id INT64,\n  booking_level_id INT64,\n  lesson_id INT64,\n  skill_type INT64,\n  description STRING,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  PRIMARY KEY (id) NOT ENFORCED\n)\nCLUSTER BY id\nOPTIONS(\n  max_staleness\u003dINTERVAL \u00270-0 0 0:5:0\u0027 YEAR TO SECOND\n);"
}]