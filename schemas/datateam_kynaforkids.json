[{
  "table_name": "report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_yo484bsbtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_yo484bsbtd`\n(\n  teacher_income_vnd NUMERIC,\n  tc_email STRING,\n  booking_id INT64,\n  booking_name STRING,\n  booking_time TIMESTAMP,\n  teacher_name STRING,\n  teacher_email STRING,\n  teacher_country STRING,\n  teacher_country_id INT64,\n  country STRING,\n  student_name STRING,\n  student_email STRING,\n  student_code STRING,\n  booking_status STRING,\n  revenue NUMERIC,\n  teacher_source STRING,\n  program STRING,\n  program_group INT64,\n  num_shift INT64,\n  student_country STRING,\n  total_income NUMERIC,\n  teacher_id INT64,\n  revenue_vnd FLOAT64,\n  booking_rating STRING,\n  tc_incharge_id INT64\n);"
}, {
  "table_name": "student_care_f830905a-5fc7-4471-87c2-d28f87f105be",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.student_care_f830905a-5fc7-4471-87c2-d28f87f105be`\n(\n  student_code STRING,\n  user_id INT64,\n  student_name STRING,\n  program_name STRING,\n  program_subject INT64,\n  student_status STRING,\n  start_leve STRING,\n  current_level STRING,\n  student_type STRING,\n  country STRING,\n  manager_name STRING,\n  manager_math_name STRING,\n  parent_email STRING,\n  first_time_learning TIMESTAMP,\n  last_time_learning TIMESTAMP,\n  total_lesson INT64,\n  remain_lesson INT64,\n  teacher_type STRING\n);"
}, {
  "table_name": "kbc_thang10_phase2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.kbc_thang10_phase2`\n(\n  student_id INT64,\n  student_code STRING,\n  num_bookings_to_map INT64\n);"
}, {
  "table_name": "tong_gia_tri_theo_sdt_eeb32fba-f0cb-4b1d-ad9f-d6083e68fe11",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.tong_gia_tri_theo_sdt_eeb32fba-f0cb-4b1d-ad9f-d6083e68fe11`\n(\n  phone_number STRING,\n  cohort STRING,\n  Market STRING,\n  student_codes STRING,\n  student_names STRING,\n  sale_emails STRING,\n  sup_emails STRING,\n  order_values STRING,\n  total_order_values FLOAT64,\n  category_total_order_value STRING,\n  remaining_lesson_filter STRING\n);"
}, {
  "table_name": "booking_lead_15h",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.booking_lead_15h`\n(\n  id INT64,\n  created_at INT64,\n  updated_at INT64,\n  status INT64,\n  considerating_date DATE\n)\nPARTITION BY considerating_date\nOPTIONS(\n  description\u003d\"Bảng lưu booking lead snapshot vào 15h hàng ngày\"\n);"
}, {
  "table_name": "report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_yo484bsbtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_yo484bsbtd`\n(\n  teacher_income_vnd NUMERIC,\n  tc_email STRING,\n  booking_id INT64,\n  booking_name STRING,\n  booking_time TIMESTAMP,\n  teacher_name STRING,\n  teacher_email STRING,\n  teacher_country STRING,\n  teacher_country_id INT64,\n  country STRING,\n  student_name STRING,\n  student_email STRING,\n  student_code STRING,\n  booking_status STRING,\n  revenue NUMERIC,\n  teacher_source STRING,\n  program STRING,\n  program_group INT64,\n  num_shift INT64,\n  student_country STRING,\n  total_income NUMERIC,\n  teacher_id INT64,\n  revenue_vnd FLOAT64,\n  booking_rating STRING,\n  tc_incharge_id INT64\n);"
}, {
  "table_name": "hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_8hlwjcnatd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_8hlwjcnatd`\n(\n  month STRING,\n  email STRING,\n  kpi INT64,\n  so_bai_dang INT64\n);"
}, {
  "table_name": "report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_oriccq0atd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_oriccq0atd`\n(\n  booking_id INT64,\n  teacher_id INT64,\n  begin_at TIMESTAMP,\n  ngay_hoc DATE,\n  gio_bat_dau STRING,\n  gio_ket_thuc STRING,\n  ngay_ket_thuc STRING,\n  ops_teacher_email STRING,\n  teacher_name STRING,\n  country_id INT64,\n  country_id_hv INT64,\n  program STRING,\n  mon_hoc STRING,\n  loai_hoc_vien STRING,\n  completed INT64,\n  dat INT64,\n  khong_dat INT64,\n  duoi_chuan INT64,\n  no_pay INT64,\n  no_pay_base_rate INT64,\n  teacher_open_webcam_time_less_70 INT64,\n  percent_time_teacher_full_face_less_70 INT64,\n  percent_time_teacher_taking_less_20 INT64,\n  access_time_gv INT64,\n  GV_vao_lop_tre INT64,\n  teacher_note_tre INT64,\n  teacher_khong_note INT64,\n  access_time_hv INT64,\n  warning INT64,\n  warning_details STRING,\n  teacher_status INT64,\n  teacher_email STRING,\n  country_gv STRING,\n  teacher_source STRING\n);"
}, {
  "table_name": "temp_hoc_vien_kbc_thang_11_phase_1",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_hoc_vien_kbc_thang_11_phase_1`\n(\n  student_id INT64,\n  num_bookings_to_map INT64\n);"
}, {
  "table_name": "bien_dong_so_luong_gv_tieng_anh_tracker_468ec3fd-a8cf-4796-9916-330e4359e503_w95d10pxpd_2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.bien_dong_so_luong_gv_tieng_anh_tracker_468ec3fd-a8cf-4796-9916-330e4359e503_w95d10pxpd_2`\n(\n  teacher_id INT64,\n  booking_id INT64,\n  begin_at TIMESTAMP,\n  check_completed_booking_in_range INT64\n);"
}, {
  "table_name": "vongquay100",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.datateam_kynaforkids.vongquay100`\n(\n  Campaign STRING,\n  phone STRING,\n  code STRING,\n  expired_date DATETIME,\n  status STRING,\n  gift STRING,\n  created_date DATETIME,\n  used_date DATETIME\n)\nOPTIONS(\n  sheet_range\u003d\"VONGQUAY100!A:H\",\n  skip_leading_rows\u003d3,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/1Hh__ebkjFv30y_woekcvpEEhLKGE8I-yEvLtrzpnEiE/edit?gid\u003d683551123#gid\u003d683551123\"]\n);"
}, {
  "table_name": "report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_8hlwjcnatd_2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_8hlwjcnatd_2`\n(\n  month_bd STRING,\n  email_bd STRING,\n  aff_camp_bd STRING,\n  aff_email_bd STRING,\n  aff_type_bd STRING,\n  block_op_bd STRING,\n  dbds_bd STRING,\n  kpi INT64,\n  so_bai_dang INT64\n);"
}, {
  "table_name": "xuat_hoa_don_tutoring_075c3ba4-43f7-49ee-a4a3-ceb36b152f81",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.xuat_hoa_don_tutoring_075c3ba4-43f7-49ee-a4a3-ceb36b152f81`\n(\n  ngay_tao_don DATE,\n  invoice_code STRING,\n  phone_number STRING,\n  name STRING,\n  student_code STRING,\n  accounting_date DATE,\n  ngay_duyet_don DATE,\n  total_video_course NUMERIC,\n  total NUMERIC,\n  noi_dung_thanh_toan STRING,\n  program STRING,\n  order_status STRING,\n  payment_status STRING,\n  price NUMERIC,\n  revenue_calculate_commission NUMERIC,\n  price_raw NUMERIC,\n  note STRING,\n  note_not_processed STRING,\n  So_hoa_don STRING,\n  So_tien FLOAT64,\n  currency_exchange_rate FLOAT64,\n  price_vnd FLOAT64,\n  country STRING,\n  video_course_name STRING,\n  Currency STRING,\n  address STRING\n);"
}, {
  "table_name": "table_bookings_duo_not_duo",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.table_bookings_duo_not_duo`\n(\n  teacher_country STRING,\n  teacher_source STRING,\n  booking_date DATE,\n  program STRING,\n  num_bookings INT64,\n  num_duo_bookings INT64,\n  num_duo_bookings_room2 INT64,\n  num_duo_bookings_room1 INT64\n);"
}, {
  "table_name": "bien_dong_GV_all_0f31635e-4ac7-4312-8772-02ecd3682b01",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.bien_dong_GV_all_0f31635e-4ac7-4312-8772-02ecd3682b01`\n(\n  interview_date DATE,\n  acceptance_date DATE,\n  teacher_id INT64,\n  teacher_name STRING,\n  teacher_country STRING,\n  teacher_source INT64,\n  teaching_training_date DATE,\n  test_training_date DATE,\n  training_status_id INT64,\n  status_id INT64,\n  contract_status_id INT64,\n  contract_completion_date DATE,\n  deactivate_date DATE,\n  is_tester INT64,\n  tc_email STRING,\n  least_training_date DATE,\n  greatest_training_date DATE,\n  reactivated_date DATE,\n  num_reactivate INT64,\n  ready_to_teach_date DATE,\n  first_booking_date_reactivated DATE,\n  reactivate_contract_completion_date DATE,\n  first_booking_date DATE,\n  reactivated_qualified_to_teach_date DATE,\n  final_first_booking_date DATE,\n  final_qualified_to_teach_date DATE,\n  is_slot_openned STRING,\n  num_slots_open_from_qualified_date INT64,\n  first_booking_after_qualifying_date DATE,\n  num_days_from_qualifying_to_first_booking INT64\n);"
}, {
  "table_name": "quan_ly_kho_hang_vat_tu_1b3f328d-3024-44d5-961f-48cd071a5686",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.quan_ly_kho_hang_vat_tu_1b3f328d-3024-44d5-961f-48cd071a5686`\n(\n  ngay DATE,\n  id_vat_tu INT64,\n  ma_vat_tu STRING,\n  ten_vat_tu STRING,\n  noi_dung STRING,\n  kho STRING,\n  ma_nhap_xuat STRING,\n  so_luong INT64,\n  don_gia NUMERIC,\n  thanh_tien NUMERIC\n);"
}, {
  "table_name": "aca_ops_hoc_vien_gvcd_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.aca_ops_hoc_vien_gvcd_view`\nAS --Nhờ bên anh làm thêm 1 cái Datastudio chi tiết danh sách HVCĐ nhé ạ, bao gồm các thông tin:\r\n-- Teacher ID\r\n-- Teacher Name\r\n-- Mã KE HVCĐ\r\n-- Tên học viên\r\n-- Ops In Charge\r\n-- Loại học viên: Trẻ em/người lớn\r\n-- Tên chương trình\r\n-- Số buổi còn lại\r\n\r\nwith \r\n-- HV chương trình số buổi còn lại\r\ntarget_student_1 AS (\r\nSELECT bs.user_id, bs.student_code, \r\n       bsp.program_id,\r\n       count(distinct bsn.id) as num_bookings, \r\nFROM `kynaforkids-server-production.kynaforkids.booking_student` bs\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_session_student` bssn\r\n        ON (bs.user_id \u003d bssn.student_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_student_program` bsp\r\n        ON (bsp.user_id \u003d bs.user_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_session_view` bsn\r\n        ON (bssn.booking_session_id \u003d bsn.id and bsp.program_id \u003d bsn.program_id)\r\n\r\nWHERE bs.is_user_test \u003d 0\r\n      -- and bs.country_id \u003d 3\r\n      AND bsp.program_id not in (select bp.id from `kynaforkids-server-production.kynaforkids.booking_program` bp where bp.program_type \u003d 2 or bp.id \u003d 3 or bp.type in (2,3,4)) \r\n      AND bsn.status_id in (4,5)\r\n      AND bsn.program_id not in (select bp.id from `kynaforkids-server-production.kynaforkids.booking_program` bp where bp.program_type \u003d 2 or bp.id \u003d 3 or bp.type in (2,3,4))\r\n  \t  AND cast(bsn.begin_at as datetime) \u003c current_datetime(\"UTC+7\")     \r\n      --AND (date(bsn.begin_at) \u003e\u003d \u00272024-10-01\u0027 AND date(bsn.begin_at) \u003c\u003d \u00272024-10-31\u0027) \r\nGROUP BY bs.user_id, bs.student_code, bsp.program_id\r\n),\r\n\r\n-- Tính tổng số lesson còn lại của học sinh ở các chương trình mà học sinh đang học với các ràng buộc như trên \r\nremaining_bookings_program AS (\r\nSELECT bs.user_id, bs.student_code, bsp.program_id,\r\n       max(coalesce(bsp.remain_lesson,0)) as bookings_program_remain\r\nFROM `kynaforkids-server-production.kynaforkids.booking_student` bs\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_student_program` bsp ON (bsp.user_id \u003d bs.user_id)\r\nWHERE bs.is_user_test \u003d 0 \r\n      AND bsp.program_id not in (select bp.id from `kynaforkids-server-production.kynaforkids.booking_program` bp where bp.program_type \u003d 2 or bp.id \u003d 3 or bp.type in (2,3,4))\r\nGROUP BY bs.user_id, bs.student_code, bsp.program_id\r\n),\r\n\r\n-- Tính số booking đã được chạy ở các trạng thái draft, new, waiting approve, approved (lấy ở ngày hiện tại trở đi)\r\nremaining_bookings_booked AS (\r\nSELECT \r\n      bs.user_id, \r\n      bs.student_code, \r\n      bsp.program_id, \r\n      count(distinct bsn.id) as bookings_booked\r\nFROM `kynaforkids-server-production.kynaforkids.booking_student` bs\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_student_program` bsp ON (bsp.user_id \u003d bs.user_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_session_student` bssn\r\n        ON (bs.user_id \u003d bssn.student_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_session_view` bsn\r\n        ON (bssn.booking_session_id \u003d bsn.id and bsp.program_id \u003d bsn.program_id)\r\nWHERE bs.is_user_test \u003d 0 \r\n      AND bsn.status_id in (1,2,3,4)\r\n      AND bsn.program_id not in (select bp.id from `kynaforkids-server-production.kynaforkids.booking_program` bp where bp.program_type \u003d 2 or bp.id \u003d 3 or bp.type in (2,3,4))\r\n      AND cast(bsn.begin_at as datetime) \u003e current_datetime(\"UTC+7\")\r\nGROUP BY bs.user_id, bs.student_code, bsp.program_id\r\n),\r\n\r\n-- Tính tổng số booking còn lại của học viên (lấy 2 số trên cộng lại với nhau)\r\nremaining_bookings AS (\r\nSELECT rbp.user_id, rbp.student_code, rbp.program_id,-- rbp.program_name, \r\n       max(coalesce(rbp.bookings_program_remain,0)) + max(coalesce(rbb.bookings_booked,0)) as total_remaining_lessons,\r\n       --`kynaforkids-server-production.kynaforkids.func_get_student_name_from_profile_by_student_id`(rbp.user_id) as student_name \r\nFROM remaining_bookings_program rbp\r\nLEFT JOIN remaining_bookings_booked rbb ON(rbp.user_id \u003d rbb.user_id AND rbp.program_id \u003d rbb.program_id)\r\nWHERE rbp.program_id not in (select bp.id from `kynaforkids-server-production.kynaforkids.booking_program` bp where bp.program_type \u003d 2 or bp.id \u003d 3 or bp.type in (2,3,4))\r\nGROUP BY rbp.user_id, rbp.student_code, rbp.program_id\r\n),\r\n\r\n-- Ghép các bảng trên để có bảng target_students\r\nstudents_with_remain_bookings AS\r\n(\r\nSELECT \r\n      ts1.*,\r\n      -- rb.program_id, \r\n      --rb.program_name, rb.subject, \r\n      rb.total_remaining_lessons,  \r\nFROM target_student_1 ts1\r\nLEFT JOIN remaining_bookings rb ON(ts1.user_id \u003d rb.user_id AND ts1.program_id \u003d rb.program_id)\r\nwhere rb.total_remaining_lessons \u003e 0\r\n),\r\n\r\n-- students_with_remain_bookings as\r\n-- (\r\n-- select \r\n--        ts.student_code,\r\n--        ts.program_id\r\n--        sum(ts.total_remaining_lessons) as total_remaining_lessons,\r\n        \r\n-- from target_students ts\r\n-- group by student_code \r\n-- ),\r\n\r\n-- HV và GVCĐ\r\nhv_gvcd as\r\n(\r\nselect\r\n      bst.student_code,\r\n      (\r\n        SELECT\r\n              max(p.name)\r\n        FROM\r\n              `kynaforkids-server-production.kynaforkids.profile` p\r\n        where p.user_id \u003d bspd.student_id\r\n      ) as student_name,\r\n\r\n      bt.user_id as teacher_id,\r\n      (\r\n        SELECT\r\n              max(p.name)\r\n        FROM\r\n             `kynaforkids-server-production.kynaforkids.profile` p\r\n        WHERE\r\n              p.user_id\u003d bt.user_id) as teacher_name,\r\n      \r\n      bspd.program_id,\r\n      (select bp.name from `kynaforkids.booking_program` bp where bp.id \u003d bspd.program_id) as program,\r\n\r\n\r\n\r\n\r\nfrom `kynaforkids-server-production.kynaforkids.booking_student_priority_date` bspd\r\ninner join `kynaforkids.booking_student` bst on bst.user_id \u003d bspd.student_id\r\ninner join `kynaforkids.booking_teacher` bt on bt.user_id \u003d bspd.fixed_teacher_id\r\nwhere bspd.fixed_teacher_id is not null and bspd.only_map_current_teacher \u003d 1\r\n      -- and student_id \u003d 102\r\n      and bst.student_code like \u0027K%\u0027\r\n      and bspd.program_id in (select bp.id from `kynaforkids.booking_program` bp where bp.program_type \u003d 1 and bp.type not in (2,3,4) and bp.id !\u003d 3)\r\ngroup by student_code, student_id, teacher_id, program_id\r\n)\r\n\r\nselect \r\n        hv_gvcd.*,\r\n        `kynaforkids-server-production.kynaforkids.func_get_country_teacher`((select bt.country_id from `kynaforkids.booking_teacher` bt where bt.user_id \u003d hv_gvcd.teacher_id)) as teacher_country,\r\n        `kynaforkids-server-production.kynaforkids.func_get_booking_student_country`(bst.country_id) as student_country,\r\n        srb.total_remaining_lessons,\r\n        case when bst.user_type_id \u003d 1 then \u0027Trẻ em\u0027\r\n             when bst.user_type_id \u003d 2 then \u0027Người lớn\u0027\r\n             else \"Unknown\"\r\n        end as loai_hv,\r\n        (select `kynaforkids-server-production.kynaforkids.func_get_email_from_kynaforkids_user`(bst.ops_id)) as ops_email,   \r\n\r\n        \r\nfrom hv_gvcd \r\ninner join `kynaforkids.booking_student` bst on bst.student_code \u003d hv_gvcd.student_code\r\nleft join students_with_remain_bookings srb on hv_gvcd.student_code \u003d srb.student_code and hv_gvcd.program_id \u003d srb.program_id\r\nwhere srb.total_remaining_lessons is not null\r\n\r\n;"
}, {
  "table_name": "lead_view_nhan_test",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.lead_view_nhan_test`\nAS select\r\n    *\r\nfrom `kynaforkids.booking_lead_view`;"
}, {
  "table_name": "hv_vip_45_junior_402a2c3b-8dad-442c-95e8-b4cca4d7b64a_omia8ksnvd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.hv_vip_45_junior_402a2c3b-8dad-442c-95e8-b4cca4d7b64a_omia8ksnvd`\n(\n  ngay_hoc DATE,\n  time_hh_mm STRING,\n  num_students INT64,\n  num_3_student_rooms INT64,\n  num_2_student_rooms INT64,\n  num_1_student_rooms INT64,\n  cost_saved_3std_rooms FLOAT64,\n  cost_saved_2std_rooms FLOAT64,\n  cost_saved_1std_rooms INT64,\n  total_cost_saved FLOAT64\n);"
}, {
  "table_name": "performance_bonus_e3f0d061-6f11-4539-8b97-1b8dab74fab8",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.performance_bonus_e3f0d061-6f11-4539-8b97-1b8dab74fab8`\n(\n  tc_email STRING,\n  booking_id INT64,\n  booking_name STRING,\n  booking_time TIMESTAMP,\n  teacher_name STRING,\n  teacher_email STRING,\n  teacher_country STRING,\n  country STRING,\n  student_name STRING,\n  student_email STRING,\n  student_code STRING,\n  booking_status STRING,\n  teacher_source STRING,\n  program STRING,\n  level_name STRING,\n  num_shift INT64,\n  currency_exchange_rate FLOAT64,\n  student_country STRING,\n  teacher_id INT64,\n  total_income NUMERIC,\n  tc_incharge_id INT64\n);"
}, {
  "table_name": "chat_luong_mkt_thai_be16b558-b557-48b0-95c9-752b3d3a824f_u8qh5qxktd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.chat_luong_mkt_thai_be16b558-b557-48b0-95c9-752b3d3a824f_u8qh5qxktd`\n(\n  cal_date DATE,\n  sale_id INT64,\n  trang_thai STRING,\n  affiliate_campaign STRING,\n  affiliate_category STRING,\n  affiliate_email STRING,\n  num_leads INT64,\n  num_leads_status_lien_he INT64,\n  num_leads_status_tu_van_tham_gia_onl_off INT64,\n  num_leads_status_coc_hen_tt INT64,\n  num_leads_status_tu_choi_vi_ly_do_trung INT64,\n  num_leads_status_tu_choi_loai_ly_do_trung INT64,\n  num_leads_status_tu_choi INT64,\n  num_order_ghi_danh_lai_tra_gop INT64,\n  rev_ghi_danh_lai_tra_gop FLOAT64,\n  sale_follow_email STRING,\n  sale_follow_supervisor_email STRING\n);"
}, {
  "table_name": "completed_booking_students_by_program_ee23864e-1fd9-48e7-a778-f43fcf2af1ec_kyyj3f6ctd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.completed_booking_students_by_program_ee23864e-1fd9-48e7-a778-f43fcf2af1ec_kyyj3f6ctd`\n(\n  booking_time TIMESTAMP,\n  booking_end_time TIMESTAMP,\n  country STRING,\n  program STRING,\n  level_name STRING,\n  lesson_name STRING,\n  lesson_id INT64,\n  lesson_code STRING,\n  section_name STRING,\n  num_shift INT64,\n  student_country STRING,\n  student_codes STRING,\n  num_student_codes INT64\n);"
}, {
  "table_name": "bien_dong_so_luong_gv_tieng_anh_tracker_468ec3fd-a8cf-4796-9916-330e4359e503_fp3v6febsd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.bien_dong_so_luong_gv_tieng_anh_tracker_468ec3fd-a8cf-4796-9916-330e4359e503_fp3v6febsd`\n(\n  user_id INT64,\n  name STRING,\n  test_1shift_salary FLOAT64,\n  test_2shift_salary FLOAT64,\n  ngay_bat_dau_hop_dong INT64,\n  teacher_source STRING,\n  Nhom_quoc_gia STRING\n);"
}, {
  "table_name": "booking_sesssion_ops_bonus_since_06_2025_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.booking_sesssion_ops_bonus_since_06_2025_view`\nAS SELECT * except(begin_at,end_at,created_at,updated_at,last_action_at,teacher_note_at),\r\n      timestamp_seconds(begin_at) as begin_at,\r\n      timestamp_seconds(end_at) as end_at,\r\n      timestamp_seconds(created_at) as created_at,\r\n      timestamp_seconds(updated_at) as updated_at,\r\n      timestamp_seconds(last_action_at) as last_action_at,\r\n      timestamp_seconds(teacher_note_at) as teacher_note_at,\r\n\r\n      case when bs.status_id \u003d 5 then \u0027Completed\u0027\r\n           when bs.status_id \u003d 7 and bs.cancel_config_id in (2,5,6,9,12) then \u0027Cancel không bù\u0027\r\n      end as completed_or_ko_bu,\r\n\r\n      case when (bs.total_income is null or bs.total_income \u003d 0) then \u0027income_null_0\u0027\r\n           else \u0027income_occured\u0027\r\n      end as income_type\r\n      \r\nFROM `kynaforkids-server-production.kynaforkids.booking_session` bs\r\nwhere begin_at \u003e\u003d 1746032400;"
}, {
  "table_name": "hv_vip_45_junior_402a2c3b-8dad-442c-95e8-b4cca4d7b64a_9wRVF",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.hv_vip_45_junior_402a2c3b-8dad-442c-95e8-b4cca4d7b64a_9wRVF`\n(\n  user_id INT64,\n  student_code STRING,\n  student_country STRING,\n  programs STRING,\n  levels STRING,\n  remaining_lessons INT64,\n  economy_package_status STRING,\n  teacher_types STRING,\n  programs_teacher_types STRING,\n  lesson_splitted INT64,\n  student_name STRING,\n  phone_number STRING,\n  email_ops STRING,\n  ops_manager_email STRING\n);"
}, {
  "table_name": "table_booking_cr_test_10h15_indo_malaysia_market_4c192a36-077e-45a3-a4c6-a892e8fd2627",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.table_booking_cr_test_10h15_indo_malaysia_market_4c192a36-077e-45a3-a4c6-a892e8fd2627`\n(\n  ngay_tao_lead DATE,\n  sale_email STRING,\n  sale_manager_email STRING,\n  mon_hoc STRING,\n  country STRING,\n  affiliate_email STRING,\n  sale_name STRING,\n  sup_name STRING,\n  num_test_by_sic INT64,\n  num_test_by_sic_t1 INT64,\n  num_lead_t1 INT64,\n  num_lead_t1_1 INT64,\n  num_lead_t1_2 INT64\n);"
}, {
  "table_name": "order_completed_tutoring_accounting_18f8d27f-9ece-4b85-9ca6-5435a6b881c6",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.order_completed_tutoring_accounting_18f8d27f-9ece-4b85-9ca6-5435a6b881c6`\n(\n  ngay_tao_don DATE,\n  ngay_duyet_don DATE,\n  invoice_code STRING,\n  email STRING,\n  name STRING,\n  student_code STRING,\n  phone_number STRING,\n  accounting_date TIMESTAMP,\n  total_video_course NUMERIC,\n  total NUMERIC,\n  noi_dung_thanh_toan STRING,\n  source STRING,\n  program STRING,\n  order_status STRING,\n  payment_status STRING,\n  price NUMERIC,\n  note STRING,\n  affiliate_campaign STRING,\n  landingpage_name STRING,\n  affiliate_id INT64,\n  affiliate_email STRING,\n  affiliate_type STRING,\n  currency_exchange_rate FLOAT64,\n  price_vnd FLOAT64,\n  country STRING,\n  total_lesson INT64,\n  nguoi_duyet STRING,\n  video_course_name STRING,\n  affiliate_emaill STRING,\n  loai_affiliate STRING,\n  Currency STRING,\n  order_type STRING,\n  duration INT64,\n  total_video_vnd FLOAT64,\n  total_vnd FLOAT64,\n  total_nguyen_te NUMERIC\n);"
}, {
  "table_name": "fixed_schedule_bonus_ec36f78c-7afc-400d-8d70-e3efb41afba6_0bhyjpuktd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.fixed_schedule_bonus_ec36f78c-7afc-400d-8d70-e3efb41afba6_0bhyjpuktd`\n(\n  year_begin_at INT64,\n  month_begin_at INT64,\n  teacher_id INT64,\n  student_id INT64,\n  student_code STRING,\n  total_booking INT64,\n  teacher_name STRING,\n  tc_in_charge STRING\n);"
}, {
  "table_name": "order_courses_details_thai",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.order_courses_details_thai`\nAS select \r\n  (select min(timestamp_seconds(order_action.created_at)) from `kynaforkids-server-production.kynaforkids.order_action` order_action \r\n  where order_action.order_id \u003d o.id and not order_action.order_status \u003d 1 ) as ngay_tetesale_len_don,\r\n\to.invoice_code,\r\n\to.id,\r\n  od.package_id as package_id,\r\n\tcase\r\n        when o.`status` \u003d 1 then \u0027Mới tạo\u0027\r\n      \twhen o.`status` \u003d 2 then \u0027Xác nhận\u0027\r\n        when o.`status` \u003d 3 then \u0027Hoàn thành\u0027\r\n        when o.`status` \u003d 4 then \u0027Hủy\u0027\r\n        else \u0027Khác\u0027\r\n\tend as status,\r\n\t(select package.`name` from `kynaforkids-server-production.kynaforkids.package`  package where package.id \u003d od.package_id) as Mon_hoc,\r\n\t(select ori.`name` from `kynaforkids-server-production.kynaforkids.order_register_info` ori where ori.order_id \u003d o.id) as student_name,\r\n\t(select ori.email from `kynaforkids-server-production.kynaforkids.order_register_info` ori where ori.order_id \u003d o.id) as student_email,\r\n\t(select ori.phone_number from `kynaforkids-server-production.kynaforkids.order_register_info` ori where ori.order_id \u003d o.id) as student_phone,\r\n\t(select pm.`name` from `kynaforkids-server-production.kynaforkids.payment_method` pm where pm.id \u003d o.payment_method_id) as payment_method,\r\n\tcase\r\n      when o.payment_method_status \u003d 1 then \u0027Chờ thanh toán\u0027\r\n      when o.payment_method_status \u003d 2 then \u0027Đã thanh toán\u0027\r\n      when o.payment_method_status \u003d 3 then \u0027Thanh toán thất bại\u0027\r\n      when o.payment_method_status \u003d 4 then \u0027Chờ giao hàng\u0027\r\n \t\t  when o.payment_method_status \u003d 5 then \u0027Đang giao hàng\u0027\r\n      when o.payment_method_status \u003d 6 then \u0027Đã giao hàng\u0027\r\n      when o.payment_method_status \u003d 7 then \u0027Đang trả hàng\u0027\r\n      when o.payment_method_status \u003d 8 then \u0027Đã trả hàng\u0027\r\n      else null\r\n\tend as payment_status,\r\n    (select pg.`name` from `kynaforkids-server-production.kynaforkids.payment_gateway` pg where pg.id \u003d o.shipping_method_id) as shipping_company,\r\n    (select max(pt.transaction_code) from `kynaforkids-server-production.kynaforkids.payment_transaction` pt where pt.order_id \u003d o.id) as partner_code,\r\n    o.sub_total,\r\n    od.unit_price,\r\n    if(od.discount_amount is null,0,od.discount_amount) as discount_amount,\r\n    if(od.voucher_discount_amount is null,0,od.voucher_discount_amount) as voucher_discount_amount,\r\n    if(o.shipping_fee is null,0,o.shipping_fee) as shipping_fee,\r\n    timestamp_seconds(o.created_at) as created_at,\r\n    timestamp_seconds(o.updated_at) as updated_at,\r\n    timestamp_seconds(o.completed_at) as completed_at,\r\n    (select u.email from `kynaforkids-server-production.kynaforkids.user` u where u.id \u003d o.created_by) as SIC,\r\n    (select max(p.name) from `kynaforkids-server-production.kynaforkids.profile` p where p.user_id \u003d o.created_by) as SIC_name\r\nfrom `kynaforkids-server-production.kynaforkids.order` o\r\nleft join `kynaforkids-server-production.kynaforkids.order_detail` od on od.order_id \u003d o.id\r\nwhere o.country_id \u003d 1;"
}, {
  "table_name": "test_online_teacher_income_2ea54338-78d4-4b66-b825-0d3c555491d3_9im381kjtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.test_online_teacher_income_2ea54338-78d4-4b66-b825-0d3c555491d3_9im381kjtd`\n(\n  begin_at TIMESTAMP,\n  booking_id INT64,\n  teacher_id INT64,\n  teacher_name STRING,\n  teacher_email STRING,\n  quoc_tich STRING,\n  program STRING,\n  program_id INT64,\n  total_income NUMERIC,\n  income NUMERIC,\n  rate STRING,\n  adjustment_income FLOAT64,\n  apeal_income NUMERIC,\n  program_name STRING,\n  trang_thai_hop_dong STRING\n);"
}, {
  "table_name": "num_calls_to_report_region_asia_east1_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.num_calls_to_report_region_asia_east1_view`\nAS SELECT\r\n    -- Extract the Looker context (report/dashboard name) from job labels\r\n    -- This requires a specific label key to be present and contain the report name.\r\n    -- Common Looker labels: looker-context-history_slug, looker-context-user_id, etc.\r\n    -- You might need to inspect your BigQuery job details to find the exact label your Looker instance uses for report names.\r\n    -- If your Looker instance applies a specific label for report names, replace \u0027your_looker_report_label_key\u0027\r\n    -- with that key (e.g., \u0027looker-context-dashboard\u0027, \u0027looker-context-explore\u0027, or a custom label you set).\r\n    COALESCE(\r\n        (SELECT value FROM UNNEST(labels) WHERE key \u003d \u0027looker_studio_report_id\u0027), -- Looker\u0027s internal query slug, often unique to a report/explore instance\r\n        (SELECT value FROM UNNEST(labels) WHERE key \u003d \u0027requestor\u0027), \r\n        \u0027Unknown Report\u0027 -- Fallback if no specific report label is found\r\n    ) AS report_name,\r\n    COUNT(job_id) AS call_count,\r\n    sum(total_bytes_billed / POW(1024, 4)) AS tb_billed,\r\n\r\nFROM\r\n    -- Specify your project ID and region\r\n    region-asia-east1.INFORMATION_SCHEMA.JOBS_BY_PROJECT\r\nWHERE\r\n    creation_time \u003e\u003d TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 4 DAY) -- Last 30 days\r\n    AND job_type \u003d \u0027QUERY\u0027 -- Only consider query jobs\r\n    AND state \u003d \u0027DONE\u0027 -- Only count successful queries\r\n    AND (\r\n        -- Filter for jobs originating from Looker.\r\n        -- Looker typically adds a \u0027requestor:looker\u0027 or similar label.\r\n        -- You might need to verify the exact label used by your Looker instance.\r\n        EXISTS(SELECT 1 FROM UNNEST(labels) WHERE key \u003d \u0027requestor\u0027 AND value \u003d \u0027looker_studio\u0027)\r\n        OR EXISTS(SELECT 1 FROM UNNEST(labels) WHERE key \u003d \u0027looker_studio_report_id\u0027) -- Another common Looker specific label\r\n        -- Add other Looker-specific labels if you identify them in your BigQuery job details\r\n    )\r\nGROUP BY\r\n    report_name\r\nORDER BY\r\n    tb_billed desc, call_count DESC;;"
}, {
  "table_name": "danhthuphanbo_booking_2022_10_01",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.danhthuphanbo_booking_2022_10_01`\nAS select \r\n  date(t1.booking_time) as begin_at,\r\n  t1.program_id,\r\n  t1.student_id as user_id,\r\n  t1.student_code,\r\n  t1.student_name,\r\n  t1.country,\r\n  (select max(u.email) from `kynaforkids-server-production.kynaforkids.user` u where u.id \u003d t1.parent_id) as email,\r\n  t1.program,\r\n  t1.status_id,\r\n  t1.cancel_config_id,\r\n  if((t1.revenue) is null,0,(t1.revenue * if(t1.currency_exchange_rate is null, 1, t1.currency_exchange_rate))) as revenue,\r\n  if(t1.revenue is null,0,t1.revenue) as revenue_nguyen_te\r\nfrom (\r\nSELECT \r\n  bs.id as booking_id,\r\n  bs.begin_at as booking_time,\r\n  bss.student_id,\r\n  (select booking_student.student_code from `kynaforkids-server-production.kynaforkids.booking_student` booking_student\r\n   where bs.id \u003d bss.booking_session_id and booking_student.user_id \u003d bss.student_id) as student_code,\r\n  case\r\n    when bss.country_id \u003d 1 then \u0027Thailand\u0027\r\n    when bss.country_id \u003d 2 then \u0027Indo\u0027\r\n    when bss.country_id \u003d 3 then \u0027Việt Nam\u0027\r\n    when bss.country_id \u003d 4 then \u0027Khác\u0027\r\n  end as country,\r\n  case \r\n  when status_id \u003d 1 then \u0027Draft\u0027\r\n  when status_id \u003d 2 then \u0027New\u0027\r\n  when status_id \u003d 3 then \u0027WaitingApprove\u0027\r\n  when status_id \u003d 4 then \u0027Approved\u0027\r\n  when status_id \u003d 5 then \u0027Completed\u0027\r\n  when status_id \u003d 6 then \u0027Rejected\u0027\r\n  when status_id \u003d 7 and bs.cancel_config_id \u003d 1 then \u0027Cancelled_by_teacher\u0027\r\n  when status_id \u003d 7 and bs.cancel_config_id \u003d 2 then \u0027Cancelled_by_student_without_compensate\u0027\r\n  when status_id \u003d 7 and bs.cancel_config_id \u003d 3 then \u0027Cancelled_by_kyna\u0027\r\n  when status_id \u003d 7 and bs.cancel_config_id \u003d 4 then \u0027Cancelled_by_student_has_compensate\u0027\r\n  when status_id \u003d 8 then \u0027Deleted\u0027\r\n  end as booking_status,\r\n  bss.revenue ,\r\n  case\r\n\t\t\twhen bs.program_id \u003d 1 then \u0027Kyna English VIP\u0027\r\n\t\t\twhen bs.program_id \u003d 2 then \u0027Kyna English SPEAK\u0027\r\n\t\t\twhen bs.program_id \u003d 3 then \u0027Chương trình Demo\u0027\r\n\t\t\twhen bs.program_id \u003d 4 then \u0027Kyna English Tutorials\u0027\r\n\t\t\twhen bs.program_id \u003d 5 then \u0027Kyna English Class\u0027\r\n      when bs.program_id \u003d 6 then \u0027Kyna English Junior\u0027\r\n      when bs.program_id \u003d 7 then \u0027Kyna English Primary\u0027\r\n      when bs.program_id \u003d 8 then \u0027Chương trình Test Online\u0027\r\n      when bs.program_id \u003d 9 then \u0027Kyna English SPEAK JUNIOR\u0027\r\n      when bs.program_id \u003d 10 then \u0027Kyna English IELTS\u0027\r\n      when bs.program_id \u003d 11 then \u0027Kyna English Business\u0027\r\n      when bs.program_id \u003d 12 then \u0027Toán Tiểu Học\u0027\r\n      when bs.program_id \u003d 13 then \u0027Test Online (2 shifts)\u0027\r\n      when bs.program_id \u003d 14 then \u0027Kyna English Class Vip\u0027\r\n      when bs.program_id \u003d 15 then \u0027Kyna English Class Speak\u0027\r\n      when bs.program_id \u003d 16 then \u0027Kyna English Secondary\u0027\r\n      when bs.program_id \u003d 17 then \u0027Kyna English VIP 45MINS\u0027\r\n      when bs.program_id \u003d 18 then \u0027Kyna English SPEAK 45MINS\u0027\r\n      when bs.program_id \u003d 19 then \u0027Kyna English Tutorials 45MINS\u0027\r\n      when bs.program_id \u003d 20 then \u0027Toán Tiểu Học (Mẫu giáo - Lớp 1 - Lớp 2)\u0027\r\n      when bs.program_id \u003d 21 then \u0027KE Public Speaking I\u0027\r\n      when bs.program_id \u003d 22 then \u0027KE Public Speaking II\u0027\r\n\tend as program,\r\n  bs.program_id,\r\n  bs.status_id,\r\n  bs.cancel_config_id,\r\n\tbss.currency_exchange_rate,\r\n  (select max(p.name) from `kynaforkids-server-production.kynaforkids.profile` p where p.user_id \u003d bss.student_id) as student_name,\r\n  (select max(u.parent_id) from `kynaforkids-server-production.kynaforkids.user` u where u.id \u003d bss.student_id) as parent_id\r\nFROM `kynaforkids-server-production.kynaforkids.booking_session_view` bs\r\ninner join `kynaforkids-server-production.kynaforkids.booking_session_student` bss on bs.id \u003d bss.booking_session_id \r\nwhere (bs.is_compensatory_course \u003d 0 or bs.is_compensatory_course is null)) t1;"
}, {
  "table_name": "report_bang_track_lead_BD_8021b66b-2137-4939-9345-6bc5c5986e7c",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_bang_track_lead_BD_8021b66b-2137-4939-9345-6bc5c5986e7c`\n(\n  id INT64,\n  sale_email STRING,\n  sup_sale_email STRING,\n  parent_name STRING,\n  children_name STRING,\n  email STRING,\n  phone_number_lead STRING,\n  address STRING,\n  tinh_thanh_pho STRING,\n  quiz_score FLOAT64,\n  affiliate_campaign STRING,\n  affiliate_email STRING,\n  bd_incharge_email STRING,\n  landing_page_name STRING,\n  note_id INT64,\n  actual_affiliate_id INT64,\n  source INT64,\n  thai_lead_status STRING,\n  lead_status STRING,\n  country STRING,\n  created_at TIMESTAMP,\n  updated_at TIMESTAMP,\n  created_order_at TIMESTAMP,\n  fanpage_name STRING,\n  reason_cancel STRING,\n  sup_email STRING,\n  Bloked_Open STRING,\n  gclid STRING,\n  nhan_xet_gv STRING,\n  affiliate_id INT64,\n  email_lien_he STRING,\n  quoc_gia STRING,\n  nguon_affiliate STRING,\n  dang_bai_dai_su STRING,\n  user_id INT64,\n  price_vnd FLOAT64,\n  sourse STRING,\n  note STRING,\n  email_he_thong STRING,\n  affiliate_type STRING,\n  country_affiliate STRING\n);"
}, {
  "table_name": "kyna_eng_teacher_management_9a9ea35c-3271-4af4-ac49-61472d1ad616_p_b1t2cgh6sd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.kyna_eng_teacher_management_9a9ea35c-3271-4af4-ac49-61472d1ad616_p_b1t2cgh6sd`\n(\n  booking_date DATE,\n  teacher_id INT64,\n  tc_email STRING,\n  teacher_name STRING,\n  teacher_source STRING,\n  so_reject INT64,\n  so_timeout INT64,\n  so_cancel_less_24h INT64,\n  so_cancel_more_24h INT64,\n  so_no_show INT64,\n  so_booking_thay_the INT64,\n  so_booking_completed INT64\n);"
}, {
  "table_name": "hieu_qua_ghep_lop_economy_0f2ad318-1e72-496a-9a5b-d7ecf36b7c11",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.hieu_qua_ghep_lop_economy_0f2ad318-1e72-496a-9a5b-d7ecf36b7c11`\n(\n  ngay_hoc DATE,\n  khung_gio STRING,\n  program STRING,\n  lesson STRING,\n  booking_name STRING,\n  extracted_program_level_lesson STRING,\n  teacher_id INT64,\n  teacher_name STRING,\n  booking_status STRING,\n  bonus_status STRING,\n  economy_status STRING,\n  money_saved_dk NUMERIC,\n  money_to_pay_dk NUMERIC,\n  first_booking_id INT64,\n  secondary_booking_id INT64,\n  first_student_code STRING,\n  secondary_student_code STRING,\n  student_type_id INT64,\n  first_student_access_time DATETIME,\n  second_student_access_time DATETIME,\n  is_successful INT64,\n  student_type STRING,\n  estimated_money_saved NUMERIC,\n  estimated_money_to_pay NUMERIC,\n  final_money_saved NUMERIC,\n  final_money_to_pay NUMERIC,\n  teacher_country STRING,\n  estimated_money_saved_vnd FLOAT64,\n  estimated_money_to_pay_vnd FLOAT64,\n  final_money_saved_vnd FLOAT64,\n  final_money_to_pay_vnd FLOAT64,\n  first_booking_teacher_income FLOAT64,\n  secondary_booking_teacher_income FLOAT64,\n  booking_economy_teacher_income FLOAT64\n);"
}, {
  "table_name": "temp_hoc_vien_kbc_thang_10_phase_1",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_hoc_vien_kbc_thang_10_phase_1`\n(\n  student_id INT64,\n  student_code STRING,\n  num_bookings_to_map INT64\n);"
}, {
  "table_name": "ltv_report_cash_revenue_505d4446-6e70-418c-ad7e-844a6bec083e_848b5wcivd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.ltv_report_cash_revenue_505d4446-6e70-418c-ad7e-844a6bec083e_848b5wcivd`\n(\n  student_code STRING,\n  student_name STRING,\n  order_code STRING,\n  tong_thu FLOAT64,\n  accounting_date TIMESTAMP\n);"
}, {
  "table_name": "theo_doi_hieu_qua_goi_cr2_a3419851-b955-4050-9066-5ce8e2b0d125_x6fvhphegd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.theo_doi_hieu_qua_goi_cr2_a3419851-b955-4050-9066-5ce8e2b0d125_x6fvhphegd`\n(\n  bd_incharge_id INT64,\n  email_bd STRING,\n  ngay DATE,\n  total INT64,\n  moi_tao INT64,\n  chua_lien_he INT64,\n  hen_goi_lai INT64,\n  dang_trao_doi INT64,\n  gui_the_le INT64,\n  hen_dang_bai INT64,\n  dang_bai INT64,\n  seeding_bai INT64,\n  tu_choi INT64,\n  id INT64\n);"
}, {
  "table_name": "booking_lead_10h",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.booking_lead_10h`\n(\n  id INT64,\n  created_at INT64,\n  updated_at INT64,\n  status INT64,\n  considerating_date DATE\n)\nPARTITION BY considerating_date\nOPTIONS(\n  description\u003d\"Bảng lưu booking lead snapshot vào 15h hàng ngày\"\n);"
}, {
  "table_name": "duo_program_management_76067fbe-e59d-4989-a4d9-638012afe5bb_01mgcmz2vd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.duo_program_management_76067fbe-e59d-4989-a4d9-638012afe5bb_01mgcmz2vd`\n(\n  student_id INT64,\n  student_code STRING,\n  program_id INT64,\n  program STRING,\n  total_remaining_lessons INT64,\n  to_duo_type STRING,\n  order_type STRING,\n  register_unregister_duo STRING,\n  level STRING,\n  program_profile_status STRING,\n  program_student_status STRING,\n  reserve_at INT64\n);"
}, {
  "table_name": "ai_new_students_day_D",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.ai_new_students_day_D`\n(\n  year_month STRING,\n  num_new_students_AI_single INT64,\n  num_all_students_AI_single INT64\n);"
}, {
  "table_name": "buoitang_khuyenmai_haumai_8b5196e5-5379-4017-be1e-5409aa35c458",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.buoitang_khuyenmai_haumai_8b5196e5-5379-4017-be1e-5409aa35c458`\n(\n  booking_id INT64,\n  revenue NUMERIC,\n  booking_time TIMESTAMP,\n  booking_type STRING,\n  teacher_country STRING,\n  teacher_source INT64,\n  student_code STRING,\n  booking_status STRING,\n  teacher_income NUMERIC,\n  teacher_income_vnd NUMERIC,\n  teacher_income_ex FLOAT64,\n  program STRING,\n  student_country STRING,\n  total_income NUMERIC,\n  payment_content STRING\n);"
}, {
  "table_name": "murpher_instructor_1-1_5e46753b-94ad-431c-b1c1-c4ca786e753b_vzbrk6nktd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.murpher_instructor_1-1_5e46753b-94ad-431c-b1c1-c4ca786e753b_vzbrk6nktd`\n(\n  teacher_country STRING,\n  teacher_status STRING,\n  teacher_day DATE,\n  teacher_month STRING,\n  teacher_id INT64,\n  teacher_name STRING,\n  teacher_email STRING,\n  country_id INT64,\n  status INT64,\n  total_bookings INT64,\n  booking_booked INT64,\n  taught_test_1ca INT64,\n  taught_test_2ca INT64,\n  taught_25p INT64,\n  taught_45p INT64,\n  taught_60p INT64,\n  reject_bookings INT64,\n  bellow_standard_bookings INT64,\n  no_pay_bookings INT64,\n  approved_cancel_bookings INT64,\n  penalty_cancel_bookings INT64,\n  penalty_cancel_bookings_25m INT64,\n  penalty_cancel_bookings_45m INT64,\n  penalty_cancel_bookings_60m INT64,\n  Cancellations_with_50_compensation INT64,\n  Cancellations_with_100_compensation INT64,\n  lop_50_compensation_25p INT64,\n  lop_50_compensation_45_50p INT64,\n  lop_100_compensation_25p INT64,\n  lop_100_compensation_45_50p INT64,\n  Nopay_25p INT64,\n  Nopay_45_50p INT64,\n  Nopay_60p INT64,\n  Nopay_test_25p INT64,\n  Nopay_test_45_50p INT64,\n  teacher_care_name STRING,\n  free_slots INT64,\n  booked_slots INT64,\n  total_open_slots INT64,\n  total_ajust NUMERIC\n);"
}, {
  "table_name": "order_tutoring_ad1672df-11fe-42f2-a5f8-a2e75d904708_6mqvzvgjtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.order_tutoring_ad1672df-11fe-42f2-a5f8-a2e75d904708_6mqvzvgjtd`\n(\n  Date STRING,\n  Order_Code STRING,\n  student_code STRING,\n  phone_number STRING,\n  Payment_Content STRING,\n  Market STRING,\n  Original_Price FLOAT64,\n  Ex FLOAT64,\n  source STRING,\n  program STRING,\n  Code_Contract STRING,\n  company_name STRING,\n  loai_affiliate STRING\n);"
}, {
  "table_name": "students_with_3_level_address_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.students_with_3_level_address_view`\nAS select \r\n        -- bo.student_code,\r\n        right(bog.phone_number,9) as phone_number, \r\n        ward.name as ward,\r\n        ward.district_name as district,\r\n        case when ward.province_name \u003d \u0027Thành phố Hồ Chí Mi\u0027 then \u0027Thành phố Hồ Chí Minh\u0027 \r\n             when ward.province_name like \u0027%Vũng%\u0027 then \u0027Tỉnh Bà Rịa - Vũng Tàu\u0027\r\n             else ward.province_name\r\n        end as province,\r\n        -- count(distinct bo.student_code) as num_students\r\n\r\n\r\nfrom `kynaforkids.booking_order_gift` bog\r\nleft join `kynaforkids.location` loc on bog.location_id \u003d loc.id \r\nleft join `kynaforkids.gso_commune` ward on ward.gso_id \u003d loc.gov_id\r\nleft join `kynaforkids.booking_order` bo on left(bog.invoice_code,13) \u003d bo.invoice_code\r\nwhere bo.international_country_id \u003d 3 and ward.name is not null\r\ngroup by phone_number, location_id, ward, district, province,  bo.student_code;"
}, {
  "table_name": "report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_83pq8poatd_2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_83pq8poatd_2`\n(\n  email_rev STRING,\n  month_rev STRING,\n  aff_type_rev STRING,\n  aff_email_rev STRING,\n  aff_camp_rev STRING,\n  oder_status_rev STRING,\n  order_payment_rev STRING,\n  revenue_ghi_danh_lan_dau NUMERIC,\n  revenue_ghi_danh_lai NUMERIC,\n  sum_revenue NUMERIC\n);"
}, {
  "table_name": "booking_teacher_daily_native",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.booking_teacher_daily_native`\n(\n  user_id INT64,\n  slug STRING,\n  country_id INT64,\n  ops_teacher_id INT64,\n  country_group_id INT64,\n  region_id INT64,\n  salary FLOAT64,\n  time_zone STRING,\n  bonus NUMERIC,\n  contract_begin_at INT64,\n  contract_end_at INT64,\n  bio STRING,\n  status INT64,\n  interview_id INT64,\n  created_at INT64,\n  updated_at INT64,\n  created_by INT64,\n  updated_by INT64,\n  is_auto_repeat_calendar INT64,\n  ranking INT64,\n  birthday INT64,\n  education_background STRING,\n  teaching_experience STRING,\n  other_working_experience STRING,\n  title STRING,\n  contract_no STRING,\n  contract_status INT64,\n  contract_no_bk STRING,\n  id_card STRING,\n  card_holder_name STRING,\n  payment_method INT64,\n  card_type INT64,\n  expiration_date INT64,\n  place_of_issue_en STRING,\n  place_of_issue_vi STRING,\n  address STRING,\n  phone_number STRING,\n  email_offer_picture STRING,\n  teacher_confirmation_pic STRING,\n  pp_picture_front STRING,\n  pp_picture_back STRING,\n  bank_no STRING,\n  bank_name STRING,\n  bank_branch STRING,\n  bank_address STRING,\n  bank_picture STRING,\n  additional_contact STRING,\n  teacher_source INT64,\n  tags STRING,\n  is_tester INT64,\n  is_not_map_new_student INT64,\n  only_test_weekend INT64,\n  enable_mapping INT64,\n  swift_code STRING,\n  apply_appendix_date INT64,\n  promise_month INT64,\n  view_contract_url STRING,\n  is_submitted_form INT64,\n  is_sent_sign INT64,\n  is_show_profile INT64,\n  qualification_photos STRING,\n  contract_note STRING,\n  iban_number STRING,\n  major INT64,\n  certification INT64,\n  certification_other STRING,\n  ielts_score FLOAT64,\n  level_of_education INT64,\n  undergraduate_year INT64,\n  total_completed_booking INT64,\n  only_automap_priority_student INT64,\n  contract_send_status INT64,\n  contract_sign_status INT64,\n  training_status INT64,\n  deactivate_date INT64,\n  is_accept_base_rate INT64,\n  accept_base_rate_at INT64,\n  ignore_full_face_camera INT64,\n  tax_code STRING,\n  issue_date INT64,\n  reactivate_date INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  difficulty_level STRING,\n  is_teacher_summer_camp INT64\n);"
}, {
  "table_name": "table_of_active_students_and_their_bookings",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.table_of_active_students_and_their_bookings`\n(\n  student_id INT64,\n  student_country STRING,\n  teacher_country STRING,\n  teacher_source STRING,\n  booking_date DATE,\n  num_bookings INT64,\n  num_duo_bookings INT64\n);"
}, {
  "table_name": "duo_program_management_76067fbe-e59d-4989-a4d9-638012afe5bb_uqul5e12vd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.duo_program_management_76067fbe-e59d-4989-a4d9-638012afe5bb_uqul5e12vd`\n(\n  booking_session_id INT64,\n  teacher_id INT64,\n  program_id INT64,\n  booking_time TIMESTAMP,\n  booking_status_id INT64,\n  num_students INT64,\n  student_ids STRING,\n  teacher_booking_income_oc NUMERIC,\n  room_type STRING,\n  booking_cost_saved_estimated FLOAT64,\n  booking_cost_saved FLOAT64\n);"
}, {
  "table_name": "report_thu_nhap_aff_2a64b5ec-73da-4dce-8f02-eeb1a343b30c",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_thu_nhap_aff_2a64b5ec-73da-4dce-8f02-eeb1a343b30c`\n(\n  id INT64,\n  affiliate_id INT64,\n  affiliate_email STRING,\n  loai_affiliate STRING,\n  ngay_thu_nhap TIMESTAMP,\n  ngay_hoan_thanh_1 TIMESTAMP,\n  ngay_hach_toan TIMESTAMP,\n  program_name STRING,\n  student_email STRING,\n  thuc_nhan_hoc_phi NUMERIC,\n  phan_tram_hoa_hong FLOAT64,\n  affiliate_commission_amount FLOAT64,\n  order_invoice_code STRING,\n  lead_id INT64,\n  note STRING,\n  commission_status STRING,\n  payment_content STRING,\n  total_video NUMERIC,\n  test_online_bonus FLOAT64,\n  bd_incharge_id INT64,\n  bd_incharge_email STRING,\n  country_id INT64,\n  student_type STRING,\n  affiliate_commission_percent_bonus FLOAT64,\n  affiliate_commission_amount_bonus FLOAT64,\n  Nguon STRING,\n  Quoc_gia STRING,\n  total_new FLOAT64,\n  program_type STRING\n);"
}, {
  "table_name": "report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_lv6rkuv9sd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_lv6rkuv9sd`\n(\n  calc_date DATE,\n  ngay_tao_don DATE,\n  ngay_tao_lead DATE,\n  ngay_doi_status DATE,\n  country STRING,\n  bd_email STRING,\n  so_bai_thanh_cong INT64,\n  num_lead_after_post INT64,\n  num_order_after_post INT64,\n  revenue FLOAT64,\n  hoa_hong_vnd FLOAT64\n);"
}, {
  "table_name": "thu_nhap_ops_5c194737-88de-48ca-93f4-552714c5f803_mz2a4fchtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.thu_nhap_ops_5c194737-88de-48ca-93f4-552714c5f803_mz2a4fchtd`\n(\n  year_month STRING,\n  email_ops STRING,\n  name_ops STRING,\n  ops_manager_email STRING,\n  country STRING,\n  completed_booking_number INT64,\n  booking_number_filter STRING,\n  student_number_1_to_6_booking INT64,\n  student_number_7_to_12_booking INT64,\n  student_number_13_to_18_booking INT64,\n  student_number_over_19 INT64,\n  ops_id INT64,\n  num_order_ghi_danh_lai_tra_gop INT64,\n  rev_ghi_danh_lai_tra_gop FLOAT64\n);"
}, {
  "table_name": "accouting_theo_doi_xuat_hoa_don_hang_ceb36b152f81",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.accouting_theo_doi_xuat_hoa_don_hang_ceb36b152f81`\n(\n  ngay_tao_don DATE,\n  invoice_code STRING,\n  phone_number STRING,\n  name STRING,\n  student_code STRING,\n  accounting_date DATE,\n  ngay_duyet_don DATE,\n  total_video_course NUMERIC,\n  total NUMERIC,\n  noi_dung_thanh_toan STRING,\n  program STRING,\n  order_status STRING,\n  payment_status STRING,\n  price NUMERIC,\n  note STRING,\n  note_not_processed STRING,\n  So_hoa_don STRING,\n  So_tien FLOAT64,\n  currency_exchange_rate FLOAT64,\n  price_vnd FLOAT64,\n  country STRING,\n  video_course_name STRING,\n  Currency STRING,\n  address STRING\n);"
}, {
  "table_name": "booking_order_check_history",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.booking_order_check_history`\n(\n  snapshot_date DATE,\n  table_name STRING,\n  historical_date DATE,\n  week_day_abbr STRING,\n  row_count INT64,\n  completed_order INT64,\n  other INT64,\n  completed_order_1days_before_count INT64,\n  difference INT64,\n  percentage_difference FLOAT64\n);"
}, {
  "table_name": "report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_190bttw9sd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_190bttw9sd`\n(\n  created_at DATE,\n  student_code STRING,\n  student_id INT64,\n  noi_dung_thanh_toan STRING,\n  invoice_code STRING,\n  country_id INT64,\n  student_country STRING,\n  affiliate_id INT64,\n  affiliate_type STRING,\n  bd_email STRING,\n  dang_bai_dai_su STRING,\n  revenue FLOAT64\n);"
}, {
  "table_name": "temp_students_accept_convert_to_duo",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_students_accept_convert_to_duo`\nOPTIONS(\n  sheet_range\u003d\"accept_Duo_brief!A:E\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/1VWz962K3oE7cyZQTbbjOgQMLXdbw0Ko4OEvIYjdgd4g/\"]\n);"
}, {
  "table_name": "gge_instructor_e130188b-2ff9-4aa5-9525-9461e848ebfb_inw8vdgitd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.gge_instructor_e130188b-2ff9-4aa5-9525-9461e848ebfb_inw8vdgitd`\n(\n  teacher_country STRING,\n  teacher_status STRING,\n  teacher_day DATE,\n  teacher_month STRING,\n  teacher_id INT64,\n  teacher_name STRING,\n  teacher_email STRING,\n  country_id INT64,\n  status INT64,\n  total_bookings INT64,\n  booking_booked INT64,\n  taught_test_1ca INT64,\n  taught_test_2ca INT64,\n  taught_25p INT64,\n  taught_45p INT64,\n  taught_60p INT64,\n  taught_extra INT64,\n  reject_bookings INT64,\n  bellow_standard_bookings INT64,\n  no_pay_bookings INT64,\n  approved_cancel_bookings INT64,\n  penalty_cancel_bookings INT64,\n  Cancellations_with_50_compensation INT64,\n  Cancellations_with_100_compensation INT64,\n  lop_50_compensation_25p INT64,\n  lop_50_compensation_45_50p INT64,\n  lop_100_compensation_25p INT64,\n  lop_100_compensation_45_50p INT64,\n  Nopay_25p INT64,\n  Nopay_45_50p INT64,\n  Nopay_60p INT64,\n  Nopay_extra INT64,\n  Nopay_test_25p INT64,\n  Nopay_test_45_50p INT64,\n  teacher_care_name STRING,\n  free_slots INT64,\n  booked_slots INT64,\n  total_open_slots INT64,\n  total_plus INT64,\n  amount_hour_bonus INT64\n);"
}, {
  "table_name": "temp_adhoc_ceo_20250812",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_adhoc_ceo_20250812`\n(\n  invoice_code STRING,\n  student_code STRING,\n  num_gift_lessons INT64\n);"
}, {
  "table_name": "math_ambassador",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.datateam_kynaforkids.math_ambassador`\n(\n  datetime TIMESTAMP,\n  ambassador_name STRING,\n  ambassador_email STRING,\n  phone_number STRING,\n  is_agreed STRING,\n  birthday DATE,\n  identity_number STRING,\n  date_of_issue_place_of_issue STRING,\n  permanent_address STRING,\n  contact_address STRING,\n  bank_acc_number STRING,\n  bank_name STRING,\n  bank_branch STRING,\n  question_1 STRING,\n  question_2 STRING,\n  question_3 STRING\n)\nOPTIONS(\n  sheet_range\u003d\"Danh sách Đại sứ Giáo Viên!A:P\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/1a7TmiVql6gvDYq1ZQZqjcGLxO8AefwSGTFT3Q8HAFo0/edit?gid\u003d10716132#gid\u003d10716132\"]\n);"
}, {
  "table_name": "task_control_lien_quan_team_sales_fc233916-82e4-4d10-a7e5-3ee67b5513f5_td0bnj3pyd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.task_control_lien_quan_team_sales_fc233916-82e4-4d10-a7e5-3ee67b5513f5_td0bnj3pyd`\n(\n  task_id INT64,\n  subject STRING,\n  start_date DATE,\n  due_date DATE,\n  created_on TIMESTAMP,\n  closed_on DATETIME,\n  status STRING,\n  watcher_id INT64,\n  watcher_email STRING,\n  assigned_to_id INT64,\n  assigned_to_email STRING,\n  role_name STRING,\n  watcher_role_name STRING,\n  author_role_name STRING,\n  category STRING,\n  student_code STRING,\n  sub_category STRING,\n  lich_hen STRING,\n  tag STRING,\n  ly_do_close_task STRING,\n  estimated_hours FLOAT64,\n  first_change_status_at DATETIME,\n  student_country_id INT64,\n  sale_name STRING,\n  sup_name STRING,\n  watcher_name STRING,\n  sup_watcher_name STRING,\n  student_country STRING\n);"
}, {
  "table_name": "temp_join_economy",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_join_economy`\n(\n  student_id INT64\n);"
}, {
  "table_name": "buoitang_khuyenmai_haumai_8b5196e5-5379-4017-be1e-5409aa35c458_syqztxmhtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.buoitang_khuyenmai_haumai_8b5196e5-5379-4017-be1e-5409aa35c458_syqztxmhtd`\n(\n  id INT64,\n  student_code STRING,\n  student_id INT64,\n  student_country STRING,\n  minDate DATE,\n  learning_month STRING,\n  learning_year STRING,\n  begin_at TIMESTAMP,\n  revenue NUMERIC,\n  revenue_vnd FLOAT64,\n  booking_status STRING,\n  payment_content STRING,\n  program STRING,\n  order_date TIMESTAMP\n);"
}, {
  "table_name": "temp_hoc_vien_kbc_thang_11_phase_2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_hoc_vien_kbc_thang_11_phase_2`\n(\n  student_id INT64,\n  student_code STRING,\n  num_booking_to_map INT64\n);"
}, {
  "table_name": "thu_nhap_ops_5c194737-88de-48ca-93f4-552714c5f803_gz5y7fchtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.thu_nhap_ops_5c194737-88de-48ca-93f4-552714c5f803_gz5y7fchtd`\n(\n  year_month STRING,\n  ops_id INT64,\n  num_order_ghi_danh_lai_tra_gop INT64,\n  rev_ghi_danh_lai_tra_gop FLOAT64,\n  country_id INT64,\n  country STRING,\n  email_ops STRING,\n  name_ops STRING,\n  ops_manager_email STRING\n);"
}, {
  "table_name": "ceo_ghi_danh_lan_dau_INDO_view_temp",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.ceo_ghi_danh_lan_dau_INDO_view_temp`\nAS with general_table as (\r\nSELECT\r\n    bl.id\r\n  , bl.status\r\n  , bl.actual_utm_campaign as affiliate_campaign\r\n  , bl.reason_cancel_id\r\n  , bl.created_at\r\n  , bo.invoice_code\r\n  , bo.payment_content\r\n  , bo.total\r\n  , bo.payment_status\r\n  , bo.status as booking_order_status\r\n  , bo.discount_money\r\n  , bo.currency_exchange_rate\r\n  , date(bo.created_at) as order_date\r\n \r\n  , `kynaforkids-server-production.kynaforkids.func_get_booking_lead_status`(bl.status) as lead_status\r\n  , (select ac.name from `kynaforkids-server-production.kynaforkids.affiliate_category` ac,\r\n    `kynaforkids-server-production.kynaforkids.affiliate_user` au where au.affiliate_id \u003d bl.affiliate_id and au.affiliate_category_id \u003d ac.id) as affiliate_category\r\n  , (select u.email from `kynaforkids-server-production.kynaforkids.affiliate_user` au,\r\n    `kynaforkids-server-production.kynaforkids.user` u where au.affiliate_id \u003d bl.affiliate_id and u.id \u003d au.user_id ) as affiliate_email\r\n  , (SELECT max(p.name) FROM `kynaforkids-server-production.kynaforkids.profile` p WHERE p.user_id \u003d bl.sale_id) AS sale_follow\r\n    , (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d bl.sale_id) AS sale_follow_email\r\n    ,(SELECT max(p.name) FROM `kynaforkids-server-production.kynaforkids.profile` p WHERE p.user_id \u003d tsm.telesales_supervisor_id) AS sale_follow_supervisor\r\n  , (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d tsm.telesales_supervisor_id) AS sale_follow_supervisor_email,\r\n  \r\n    -- (select date(bsn.begin_at)\r\n    -- from `kynaforkids-server-production.kynaforkids.booking_session_new` bsn\r\n    -- where bsn.id \u003d bl.booking_test_id) as test_date,\r\n\r\n\r\n    bl.booking_test_id,\r\n    bl.sale_id,\r\n\r\n    -- (select bsn.status_id,\r\n    -- from `kynaforkids-server-production.kynaforkids.booking_session_new` bsn\r\n    -- where bsn.id \u003d bl.booking_test_id) as booking_test_status\r\n\r\n\r\n\r\n\r\n  `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(bo.payment_content) AS loai_don_hang\r\n, IF(bo.payment_content \u003d 1, 1, 0) as hoc_thu\r\n, IF(bo.payment_content \u003d 2, 1, 0) as ghi_danh_lan_dau\r\n, IF(bo.payment_content \u003d 3, 1, 0) as tra_gop_lan_sau\r\n, IF(bo.payment_content \u003d 4, 1, 0) as ghi_danh_lai\r\n, (CASE WHEN bl.upsell \u003d 1 THEN \u0027Upsell\u0027 ELSE \u0027Lead\u0027 END) AS loai_lead\r\n, (CASE WHEN bl.is_blocked \u003d 0 THEN \u0027Open\u0027  ELSE \u0027Blocked\u0027 END) AS trang_thai\r\n    -- ngaltt end\r\n, if((select max(u.id) from `kynaforkids-server-production.kynaforkids.user` u,\r\n  (select parent_id from `kynaforkids-server-production.kynaforkids.booking_student` bst, `kynaforkids-server-production.kynaforkids.user` u where u.id \u003d bst.user_id and bst.is_user_test !\u003d 1) t1\r\n  where u.id \u003d t1.parent_id and u.phone_number \u003d bl.intl_phone_number) is null, \u0027Chưa là HV\u0027, \u0027Đã là HV\u0027) as HV_Yes_No\r\n, case\r\n    when bl.subject_code \u003d \u0027EK\u0027 then \u0027Tiếng Anh trẻ em\u0027\r\n    when bl.subject_code \u003d \u0027EA\u0027 then \u0027Tiếng Anh người lớn\u0027\r\n    when bl.subject_code \u003d \u0027M\u0027 then \u0027Toán\u0027\r\n    when bl.subject_code \u003d \u0027C\u0027 then \u0027Group Class\u0027\r\n    when bl.subject_code \u003d \u0027AI\u0027 then \u0027AI Tutor\u0027\r\n    when bl.subject_code \u003d \u0027AI-PRE\u0027 then \u0027AI Tutor Premium\u0027\r\n  end as subject_code\r\nFROM `kynaforkids-server-production.kynaforkids.booking_lead_view` bl\r\n-- ngaltt start\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr` tsm on tsm.telesales_id \u003d bl.sale_id\r\n-- ngaltt end\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_order_view` bo ON bl.id \u003d bo.lead_id\r\n-- LEFT JOIN `kynaforkids-server-production.kynaforkids.auth_assignment` aa ON aa.user_id \u003d bl.sale_id\r\nWHERE bl.country_id \u003d 2\r\n-- AND aa.item_name IN(\u0027Telesales\u0027, \u0027Lead Telesales\u0027,\u0027SALE - Manager\u0027,\u0027SALE - Telesales - Staff\u0027,\u0027SALE - Telesales Supervisor\u0027)\r\nAND bl.Upsell !\u003d 1\r\n),\r\n\r\nlead_table as\r\n(\r\nselect \r\n        date(created_at) as lead_date, \r\n        sale_id,\r\n        -- sale_follow_email,\r\n        trang_thai,\r\n        affiliate_category,\r\n        affiliate_email,\r\n        affiliate_campaign,\r\n        subject_code,\r\n        count(distinct id) as num_leads,   \r\n\r\n      SUM(\r\n            if(status in (6,12),1,0)\r\n        ) as num_leads_status_lien_he,\r\n      \r\n      SUM(\r\n          if(reason_cancel_id in (\u00278\u0027) and status in (9),1,0)\r\n      ) as num_leads_status_tu_choi_vi_ly_do_trung,\r\n\r\n      SUM(\r\n            if(status in (3,4,5),1,0)\r\n        ) as num_leads_status_tu_van_tham_gia_onl_off,\r\n      SUM(\r\n            if(status in (21,22),1,0)\r\n        ) as num_leads_status_coc_hen_tt,\r\n      SUM(\r\n          if(reason_cancel_id not in (\u00278\u0027) and status in (9),1,0)\r\n      ) as num_leads_status_tu_choi_loai_ly_do_trung,\r\n      SUM(\r\n            if(status in (9),1,0)\r\n        ) as num_leads_status_tu_choi\r\nfrom general_table\r\nwhere \r\n      date(created_at) \u003e\u003d \u00272024-01-01\u0027\r\n      -- date(created_at) \u003e\u003d \u00272025-01-01\u0027\r\n  -- and date(created_at) \u003c\u003d \u00272025-01-31\u0027\r\n  group by lead_date, sale_id,trang_thai,affiliate_category,affiliate_email,affiliate_campaign,subject_code\r\n  order by lead_date desc\r\n),\r\n\r\nbooking_test_data as (\r\nselect\r\n\r\n      bsn.id as booking_test_id,\r\n      date(bsn.begin_at) as test_date,\r\n      min(bsn.status_id) as booking_test_status,\r\n      min(gt.affiliate_campaign) as affiliate_campaign,\r\n      min(gt.affiliate_email) as affiliate_email,\r\n      min(gt.affiliate_category) as affiliate_category,\r\n      min(bs.sale_in_charge_id) as sale_id,\r\n      -- `kynaforkids-server-production.kynaforkids.func_get_telesale_email`(min(bs.sale_in_charge_id)) as sale_follow_email,\r\n      -- min(tsm.telesales_id) as sale_sup_id,\r\n      -- min(gt.sale_follow_supervisor_email) as sale_follow_supervisor_email,\r\n      min(gt.trang_thai) as trang_thai,\r\n      min(gt.subject_code) as subject_code,\r\n      min(gt.status) as status,\r\n      \r\n\r\n      \r\n\r\nfrom `kynaforkids.booking_session_view` bsn\r\nleft join `kynaforkids.booking_session_student` bssn on bssn.booking_session_id \u003d bsn.id\r\nleft join `kynaforkids.booking_student` bs on bssn.student_id \u003d bs.user_id\r\n-- LEFT JOIN `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr` tsm on tsm.telesales_id \u003d bs.sale_in_charge_id\r\n\r\nleft join general_table gt on bsn.id \u003d gt.booking_test_id\r\nwhere \r\n      --date(bsn.begin_at) \u003c\u003d \u00272025-01-31\u0027 and date(bsn.begin_at) \u003e\u003d \u00272025-01-01\u0027\r\n      bsn.program_id IN (8,13,47,48,53,54,55,56,89,90)\r\n      and bssn.country_id \u003d 2\r\ngroup by bsn.id, test_date\r\n),\r\n\r\ntest_table as\r\n(\r\nselect \r\n        test_date, \r\n        sale_id,\r\n        -- sale_follow_email,\r\n        -- sale_follow_supervisor_email,\r\n        trang_thai,\r\n        affiliate_category, \r\n        affiliate_email,\r\n        affiliate_campaign,\r\n        subject_code,\r\n        SUM(\r\n            if(booking_test_status in (5), 1,0)\r\n        ) as num_test_completed,\r\n\r\n        SUM(\r\n            if(status in (7),1,0)\r\n        ) as num_test_completed_alt,\r\n\r\n        SUM(\r\n            if(booking_test_id is not null, 1,0)\r\n        ) as num_test_booked,\r\nfrom booking_test_data\r\nwhere \r\n      test_date \u003e\u003d \u00272024-01-01\u0027\r\n      -- test_date \u003e\u003d \u00272025-01-01\u0027\r\n  -- and test_date \u003c\u003d \u00272025-01-31\u0027\r\n  group by test_date, sale_id, trang_thai, affiliate_category, affiliate_email, affiliate_campaign, subject_code\r\n  order by test_date desc\r\n),\r\n\r\norder_info as (\r\nselect \r\n         bo.invoice_code,\r\n        --  (select bl.sale_id from `kynaforkids.booking_lead` bl where bl.id \u003d bo.lead_id) as sale_id,\r\n         bo.created_by as sale_id,\r\n         bo.payment_content,\r\n         bo.total,\r\n         bo.total_video_course,\r\n         bo.payment_status,\r\n         bo.status,\r\n         bo.discount_money,\r\n         bo.currency_exchange_rate,\r\n         date(bo.created_at) as order_date,\r\n         bl.actual_utm_campaign as affiliate_campaign,\r\n         (select ac.name from `kynaforkids-server-production.kynaforkids.affiliate_category` ac,\r\n          `kynaforkids-server-production.kynaforkids.affiliate_user` au where au.affiliate_id \u003d bl.affiliate_id and au.affiliate_category_id \u003d ac.id) as affiliate_category,\r\n         (select u.email from `kynaforkids-server-production.kynaforkids.affiliate_user` au,\r\n           `kynaforkids-server-production.kynaforkids.user` u where au.affiliate_id \u003d bl.affiliate_id and u.id \u003d au.user_id ) as affiliate_email,\r\n        case\r\n          when bl.subject_code \u003d \u0027EK\u0027 then \u0027Tiếng Anh trẻ em\u0027\r\n          when bl.subject_code \u003d \u0027EA\u0027 then \u0027Tiếng Anh người lớn\u0027\r\n          when bl.subject_code \u003d \u0027M\u0027 then \u0027Toán\u0027\r\n          when bl.subject_code \u003d \u0027C\u0027 then \u0027Group Class\u0027\r\n          when bl.subject_code \u003d \u0027AI\u0027 then \u0027AI Tutor\u0027\r\n          when bl.subject_code \u003d \u0027AI-PRE\u0027 then \u0027AI Tutor Premium\u0027\r\n        end as subject_code,\r\n        bo.lead_id,\r\n\r\nfrom `kynaforkids.booking_order_view` bo\r\nleft join `kynaforkids.booking_lead` bl on bl.id \u003d bo.lead_id\r\nwhere bo.status in (4) and bo.payment_status in (0,1,3,4)\r\n      and bo.international_country_id \u003d 2\r\n),\r\n\r\norder_table as\r\n(\r\nselect\r\n        order_date,\r\n        order_info.sale_id,\r\n        -- (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d order_info.sale_id) AS sale_follow_email,\r\n        -- (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d tsm.telesales_supervisor_id) AS sale_follow_supervisor_email,\r\n        \u0027Open\u0027 as trang_thai,\r\n        affiliate_category,\r\n        affiliate_email,\r\n        subject_code,\r\n        affiliate_campaign,\r\n        string_agg(CAST(lead_id AS STRING)) as lead_ids,\r\n        string_agg(invoice_code) as invoices,      \r\n\r\n        SUM(\r\n            if(payment_content in (1), 1,0)\r\n        ) as num_order_hoc_thu,\r\n\r\n\r\n       SUM(\r\n            if(payment_content in (2), 1,0)\r\n        ) as num_order_ghi_danh_lan_dau,\r\n\r\n\r\n          SUM(\r\n            if(payment_content in (2), round((coalesce(total,0) + coalesce(total_video_course,0) - coalesce(discount_money,0))*currency_exchange_rate),0)\r\n        ) as rev_ghi_danh_lan_dau,\r\n\r\n\r\nfrom order_info\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr` tsm on tsm.telesales_id \u003d order_info.sale_id\r\nwhere order_date \u003e\u003d \u00272024-01-01\u0027\r\n      -- order_date \u003e\u003d \u00272025-01-01\u0027\r\n  -- and order_date \u003c\u003d \u00272025-01-31\u0027\r\n  group by order_date, sale_id, affiliate_category,affiliate_email,affiliate_campaign,subject_code\r\n  order by order_date desc\r\n),\r\n\r\n\r\nresult as (\r\nselect\r\n      coalesce(ot.order_date,tt.test_date,lt.lead_date) as cal_date,\r\n      coalesce(ot.sale_id,tt.sale_id,lt.sale_id) as sale_id,\r\n      -- coalesce(ot.sale_follow_email,tt.sale_follow_email,lt.sale_follow_email) as sale_follow_email,\r\n      -- coalesce(ot.sale_follow_supervisor_email,tt.sale_follow_supervisor_email,lt.sale_follow_supervisor_email) as sale_follow_supervisor_email,\r\n      coalesce(ot.trang_thai,tt.trang_thai,lt.trang_thai) as trang_thai,\r\n      \r\n      coalesce(ot.affiliate_category,tt.affiliate_category,lt.affiliate_category) as affiliate_category,\r\n      coalesce(ot.affiliate_email,tt.affiliate_email,lt.affiliate_email) as affiliate_email,\r\n      coalesce(ot.affiliate_campaign,tt.affiliate_campaign,lt.affiliate_campaign) as affiliate_campaign,\r\n      coalesce(ot.subject_code,tt.subject_code,lt.subject_code) as subject,\r\n      SUM(coalesce(lt.num_leads,0)) as num_leads,\r\n      SUM(coalesce(lt.num_leads_status_lien_he,0)) as num_leads_status_lien_he,\r\n      SUM(coalesce(lt.num_leads_status_tu_van_tham_gia_onl_off,0)) as num_leads_status_tu_van_tham_gia_onl_off,\r\n      SUM(coalesce(lt.num_leads_status_coc_hen_tt,0)) as num_leads_status_coc_hen_tt,\r\n      SUM(coalesce(lt.num_leads_status_tu_choi_vi_ly_do_trung,0)) as num_leads_status_tu_choi_vi_ly_do_trung,\r\n \r\n      SUM(coalesce(lt.num_leads_status_tu_choi_loai_ly_do_trung,0)) as num_leads_status_tu_choi_loai_ly_do_trung,\r\n      SUM(coalesce(lt.num_leads_status_tu_choi,0)) as num_leads_status_tu_choi,\r\n\r\n      SUM(coalesce(tt.num_test_booked,0)) as num_test_booked,\r\n      SUM(coalesce(tt.num_test_completed,0)) as num_test_completed,\r\n\r\n      SUM(coalesce(ot.num_order_hoc_thu,0)) as num_order_hoc_thu,\r\n      SUM(coalesce(ot.num_order_ghi_danh_lan_dau,0)) as num_order_ghi_danh_lan_dau,      \r\n      SUM(coalesce(ot.rev_ghi_danh_lan_dau,0)) as rev_ghi_danh_lan_dau,   \r\n      \r\n\r\n\r\n       \r\nfrom lead_table lt\r\nfull join test_table tt on (lt.lead_date \u003d tt.test_date and lt.sale_id \u003d tt.sale_id and lt.trang_thai\u003dtt.trang_thai and lt.affiliate_campaign\u003dtt.affiliate_campaign and lt.affiliate_category\u003dtt.affiliate_category and lt.affiliate_email\u003dtt.affiliate_email and lt.subject_code\u003dtt.subject_code)  \r\nfull join order_table ot on (ot.order_date \u003d lt.lead_date and lt.sale_id \u003d ot.sale_id and lt.affiliate_campaign\u003dot.affiliate_campaign and lt.affiliate_category\u003dot.affiliate_category and lt.affiliate_email\u003dot.affiliate_email and lt.subject_code\u003dot.subject_code and lt.trang_thai\u003dot.trang_thai)\r\n-- where lt.lead_date \u003d \u00272025-02-02\u0027 or tt.test_date \u003d \u00272025-02-02\u0027 or ot.order_date \u003d \u00272025-02-02\u0027\r\ngroup by cal_date, sale_id, trang_thai ,affiliate_category,affiliate_email,affiliate_campaign,subject\r\norder by cal_date desc, trang_thai\r\n)\r\n\r\nselect r.*,\r\n      (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d r.sale_id) AS sale_follow_email,\r\n      (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d tsm.telesales_supervisor_id) AS sale_follow_supervisor_email,\r\nfrom result r\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr` tsm on tsm.telesales_id \u003d r.sale_id\r\n;"
}, {
  "table_name": "chat_luong_mkt_vn_cb09a9e7-3575-474f-b88e-6fb58512f931_9k956ks9sd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.chat_luong_mkt_vn_cb09a9e7-3575-474f-b88e-6fb58512f931_9k956ks9sd`\n(\n  cal_date DATE,\n  sale_id INT64,\n  trang_thai STRING,\n  affiliate_campaign STRING,\n  affiliate_category STRING,\n  affiliate_email STRING,\n  num_leads INT64,\n  num_leads_status_lien_he INT64,\n  num_leads_status_tu_van_tham_gia_onl_off INT64,\n  num_leads_status_coc_hen_tt INT64,\n  num_leads_status_tu_choi_vi_ly_do_trung INT64,\n  num_leads_status_tu_choi_loai_ly_do_trung INT64,\n  num_leads_status_tu_choi INT64,\n  num_order_ghi_danh_lai_tra_gop INT64,\n  rev_ghi_danh_lai_tra_gop NUMERIC,\n  sale_follow_email STRING,\n  sale_follow_supervisor_email STRING\n);"
}, {
  "table_name": "table_booking_test_vn_market_618d3829-32d9-4f94-a171-9e0c92a7b1bd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.table_booking_test_vn_market_618d3829-32d9-4f94-a171-9e0c92a7b1bd`\n(\n  booking_id INT64,\n  booking_name STRING,\n  booking_time TIMESTAMP,\n  is_virtual_booking INT64,\n  booking_status STRING,\n  student_code STRING,\n  student_country_id INT64,\n  student_country STRING,\n  sic_id INT64,\n  sic_email STRING,\n  sales_manager_id INT64,\n  sales_manager_email STRING,\n  is_student_join_meeeting INT64,\n  teacher_id INT64,\n  is_teacher_join_meeeting INT64,\n  teacher_note_at TIMESTAMP,\n  program STRING,\n  subject INT64,\n  num_shift INT64\n);"
}, {
  "table_name": "doanh_thu_con_lai_6d83bdcf-2440-4b25-9e60-4fbd31603baa",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.doanh_thu_con_lai_6d83bdcf-2440-4b25-9e60-4fbd31603baa`\n(\n  ma_hoc_vien STRING,\n  accounting_date DATE,\n  student_name STRING,\n  email STRING,\n  phone_number STRING,\n  country STRING,\n  currency_code STRING,\n  contract_code STRING,\n  currency_exchange_rate FLOAT64,\n  program STRING,\n  tong_thu FLOAT64,\n  tong_thu_nguyen_te NUMERIC,\n  tong_thu_has_video_course FLOAT64,\n  revenue FLOAT64,\n  revenue_nguyen_te NUMERIC,\n  refund_order FLOAT64,\n  refund_order_NT NUMERIC,\n  difference_amount FLOAT64,\n  difference_amount_NT NUMERIC,\n  difference_amount_deactive FLOAT64,\n  difference_amount_deactive_NT NUMERIC,\n  chenh_lech_khac FLOAT64,\n  chenh_lech_khac_NT FLOAT64,\n  invoice_code STRING\n);"
}, {
  "table_name": "report_booking_lead_5b512d0e-28a6-48c6-bdd7-c3387f9b836a",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_booking_lead_5b512d0e-28a6-48c6-bdd7-c3387f9b836a`\n(\n  id INT64,\n  sale_email STRING,\n  sup_sale_email STRING,\n  parent_name STRING,\n  children_name STRING,\n  email STRING,\n  phone_number STRING,\n  address STRING,\n  tinh_thanh_pho STRING,\n  quiz_score FLOAT64,\n  affiliate_campaign STRING,\n  affiliate_email STRING,\n  affiliate_email_dang_ky STRING,\n  bd_incharge_email STRING,\n  affiliate_type STRING,\n  landing_page_name STRING,\n  note_id INT64,\n  source_id INT64,\n  actual_affiliate_id INT64,\n  source INT64,\n  thai_lead_status STRING,\n  lead_status STRING,\n  country STRING,\n  created_at TIMESTAMP,\n  updated_at TIMESTAMP,\n  created_order_at TIMESTAMP,\n  fanpage_name STRING,\n  reason_cancel STRING,\n  sup_email STRING,\n  Bloked_Open STRING,\n  gclid STRING,\n  nhan_xet_gv STRING,\n  ip_address STRING,\n  mon_hoc STRING,\n  is_student STRING,\n  sourse STRING,\n  note STRING\n);"
}, {
  "table_name": "report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3`\n(\n  calc_date DATE,\n  aup_id INT64,\n  bd_incharge_id INT64,\n  email_bd STRING,\n  country STRING,\n  ngay_tao DATE,\n  ngay_doi_status DATE,\n  total INT64,\n  gui_the_le INT64,\n  hen_dang_bai INT64,\n  tu_choi INT64,\n  dang_bai INT64,\n  seeding_bai INT64\n);"
}, {
  "table_name": "report_booking_lead_b5f96d41-fab7-485d-b54e-8e8d3473a4f2_qpbyv3l2ud",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_booking_lead_b5f96d41-fab7-485d-b54e-8e8d3473a4f2_qpbyv3l2ud`\n(\n  invoice_code STRING,\n  student_code STRING,\n  accounting_date TIMESTAMP,\n  noi_dung_thanh_toan STRING,\n  price_vnd FLOAT64,\n  so_buoi_chinh_thuc INT64,\n  so_buoi_tang INT64,\n  teacher_type STRING,\n  gift_status STRING,\n  transport_status STRING,\n  notes STRING,\n  san_pham_tang STRING,\n  sale_email STRING,\n  sup_sale_email STRING,\n  phone_number STRING,\n  short_phone_number STRING\n);"
}, {
  "table_name": "report_math_SC_num_orders_by_students_e2ce689f-2387-460e-85ea-4ec88382f26d_qgbhjotbtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_math_SC_num_orders_by_students_e2ce689f-2387-460e-85ea-4ec88382f26d_qgbhjotbtd`\n(\n  year_month STRING,\n  teacher_name STRING,\n  program STRING,\n  student_codes STRING,\n  phone_numbers STRING,\n  booking_ids STRING,\n  num_new_students INT64,\n  bonus INT64\n);"
}, {
  "table_name": "mkt_line_performance_a288a4f1-6045-4d6a-b5bf-b0856b204c95_fq8af5ahtd_3",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.mkt_line_performance_a288a4f1-6045-4d6a-b5bf-b0856b204c95_fq8af5ahtd_3`\n(\n  order_date DATE,\n  line_id INT64,\n  utm_campaign STRING,\n  country_id INT64,\n  order_value FLOAT64,\n  num_orders INT64,\n  line_mkt STRING,\n  country STRING\n);"
}, {
  "table_name": "booking_group_talk_summer_camp_giai_bai_tap_bb2f6733-fcc9-4708-9d0a-d55477e7d904_pstSF",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.booking_group_talk_summer_camp_giai_bai_tap_bb2f6733-fcc9-4708-9d0a-d55477e7d904_pstSF`\n(\n  booking_id INT64,\n  status_id INT64,\n  cancel_config_id INT64,\n  level STRING,\n  lesson_name STRING,\n  ngay_hoc DATE,\n  begin_at TIMESTAMP,\n  khung_gio STRING,\n  teacher_id INT64,\n  teacher_name STRING,\n  teacher_email STRING,\n  tc_email STRING,\n  booking_status STRING,\n  bonus_status STRING,\n  teaching_time INT64,\n  thoi_gian_day STRING,\n  cancel_time_by_kyna STRING,\n  program STRING,\n  action INT64,\n  cancel_time STRING,\n  canceled_by STRING,\n  num_student_registered INT64,\n  num_student_learned INT64,\n  learned_rate FLOAT64\n);"
}, {
  "table_name": "duo_program_management_76067fbe-e59d-4989-a4d9-638012afe5bb_ff2svs22vd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.duo_program_management_76067fbe-e59d-4989-a4d9-638012afe5bb_ff2svs22vd`\n(\n  ngay_hoc DATE,\n  time_hh_mm STRING,\n  num_students INT64,\n  num_3_student_rooms INT64,\n  num_2_student_rooms INT64,\n  num_1_student_rooms INT64,\n  cost_saved_3std_rooms FLOAT64,\n  cost_saved_2std_rooms FLOAT64,\n  cost_saved_1std_rooms INT64,\n  total_cost_saved FLOAT64\n);"
}, {
  "table_name": "order_courses_details",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.order_courses_details`\nAS select \r\n  (select min(timestamp_seconds(order_action.created_at)) from `kynaforkids-server-production.kynaforkids.order_action` order_action \r\n  where order_action.order_id \u003d o.id and not order_action.order_status \u003d 1 ) as ngay_tetesale_len_don,\r\n\to.invoice_code,\r\n\to.id,\r\n  od.package_id as package_id,\r\n\tcase\r\n        when o.`status` \u003d 1 then \u0027Mới tạo\u0027\r\n      \twhen o.`status` \u003d 2 then \u0027Xác nhận\u0027\r\n        when o.`status` \u003d 3 then \u0027Hoàn thành\u0027\r\n        when o.`status` \u003d 4 then \u0027Hủy\u0027\r\n        else \u0027Khác\u0027\r\n\tend as status,\r\n  -- ngaltt start 21/11/2024\r\n  -- đối với video cũ giữ nguyên vẫn lấy package name, đơn GRAI thì lấy combo name (chốt với chị Tuyết)\r\n  -- (select package.`name` from `kynaforkids-server-production.kynaforkids.package`  package where package.id \u003d od.package_id) as Mon_hoc,\r\n  if(SUBSTR(o.invoice_code, 1,4) \u003d \u0027GRAI\u0027, \r\n  (\r\n    select p_combo.name from `kynaforkids-server-production.kynaforkids.package`  p\r\n      inner join `kynaforkids-server-production.kynaforkids.package` p_combo ON p_combo.id \u003d od.package_combo_id\r\n      inner join `kynaforkids-server-production.kynaforkids.package_category` pc ON pc.id \u003d p.category_id\r\n      inner join `kynaforkids-server-production.kynaforkids.package_combo_subscription_item` item ON item.id \u003d od.package_subscription_id \r\n      inner join `kynaforkids-server-production.kynaforkids.package_subscriptions` combo ON combo.id \u003d item.package_subscription_id\r\n    where p.id \u003d od.package_id),\r\n    (select package.`name` from `kynaforkids-server-production.kynaforkids.package`  package where package.id \u003d od.package_id)\r\n  ) as Mon_hoc,\r\n\r\n  if(SUBSTR(o.invoice_code, 1,4) \u003d \u0027GRAI\u0027, \r\n  (\r\n    select \r\n    if(combo.subscription_month \u003d -1,\r\n    \u0027Mãi Mãi\u0027,\r\n    concat(combo.subscription_month, \u0027 tháng\u0027) ) from `kynaforkids-server-production.kynaforkids.package`  p\r\n      inner join `kynaforkids-server-production.kynaforkids.package` p_combo ON p_combo.id \u003d od.package_combo_id\r\n      inner join `kynaforkids-server-production.kynaforkids.package_category` pc ON pc.id \u003d p.category_id\r\n      inner join `kynaforkids-server-production.kynaforkids.package_combo_subscription_item` item ON item.id \u003d od.package_subscription_id \r\n      inner join `kynaforkids-server-production.kynaforkids.package_subscriptions` combo ON combo.id \u003d item.package_subscription_id\r\n    where p.id \u003d od.package_id),\r\n    (select ps.name from `kynaforkids-server-production.kynaforkids.package_subscriptions` ps where ps.id \u003d od.package_subscription_id) \r\n   ) as subscription_thang,\r\n\r\n  -- ngaltt end 21/11/2024\r\n\t(select ori.`name` from `kynaforkids-server-production.kynaforkids.order_register_info` ori where ori.order_id \u003d o.id) as student_name,\r\n\t(select ori.email from `kynaforkids-server-production.kynaforkids.order_register_info` ori where ori.order_id \u003d o.id) as student_email,\r\n\t(select ori.phone_number from `kynaforkids-server-production.kynaforkids.order_register_info` ori where ori.order_id \u003d o.id) as student_phone,\r\n\t(select pm.`name` from `kynaforkids-server-production.kynaforkids.payment_method` pm where pm.id \u003d o.payment_method_id) as payment_method,\r\n\tcase\r\n      when o.payment_method_status \u003d 1 then \u0027Chờ thanh toán\u0027\r\n      when o.payment_method_status \u003d 2 then \u0027Đã thanh toán\u0027\r\n      when o.payment_method_status \u003d 3 then \u0027Thanh toán thất bại\u0027\r\n      when o.payment_method_status \u003d 4 then \u0027Chờ giao hàng\u0027\r\n \t\t  when o.payment_method_status \u003d 5 then \u0027Đang giao hàng\u0027\r\n      when o.payment_method_status \u003d 6 then \u0027Đã giao hàng\u0027\r\n      when o.payment_method_status \u003d 7 then \u0027Đang trả hàng\u0027\r\n      when o.payment_method_status \u003d 8 then \u0027Đã trả hàng\u0027\r\n      else null\r\n\tend as payment_status,\r\n    (select pg.`name` from `kynaforkids-server-production.kynaforkids.payment_gateway` pg where pg.id \u003d o.shipping_method_id) as shipping_company,\r\n    (select max(pt.transaction_code) from `kynaforkids-server-production.kynaforkids.payment_transaction` pt where pt.order_id \u003d o.id) as partner_code,\r\n    o.sub_total,\r\n    od.unit_price,\r\n    if(od.discount_amount is null,0,od.discount_amount) as discount_amount,\r\n    if(od.voucher_discount_amount is null,0,od.voucher_discount_amount) as voucher_discount_amount,\r\n    if(o.shipping_fee is null,0,o.shipping_fee) as shipping_fee,\r\n    o.created_at as created_at,\r\n    o.updated_at as updated_at,\r\n    timestamp_seconds(o.completed_at) as completed_at, \r\n    (select u.email from `kynaforkids-server-production.kynaforkids.user` u where u.id \u003d o.created_by) as SIC,\r\n    (select max(p.name) from `kynaforkids-server-production.kynaforkids.profile` p where p.user_id \u003d o.created_by) as SIC_name\r\nfrom `kynaforkids-server-production.kynaforkids.order` o\r\nleft join `kynaforkids-server-production.kynaforkids.order_detail` od on od.order_id \u003d o.id\r\nwhere o.country_id \u003d3;"
}, {
  "table_name": "booking_program_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.booking_program_view`\nAS select *,\r\n       case when program_type \u003d 1 then  \r\n                                        (case when id in (14,41,6,15,21,22,23,16,9,42,73,74,77,78) then 50\r\n                                              when id in (46,64,65,102) then 60\r\n                                              when name like \u0027%25%\u0027 then 25\r\n                                              when name like \u0027%45%\u0027 then 45\r\n                                              when name like \u0027%90%\u0027 then 90\r\n                                              when name like \u0027%50%\u0027 then 50\r\n                                              when number_of_shift \u003d 1 then 25\r\n                                              when number_of_shift \u003d 2 then 45\r\n                                              when number_of_shift \u003d 3 then 90  \r\n                                         end    \r\n                                        )\r\n            when program_type \u003d 2 then  (case when number_of_shift \u003d 1 then 25\r\n                                              when name like \"%Toán_Test%\" and number_of_shift \u003d 2 then 45\r\n                                              when number_of_shift \u003d 2 then 50\r\n                                              when number_of_shift \u003d 3 then 90\r\n\r\n                                         end\r\n                                        )\r\n        end as num_minutes\r\nfrom `kynaforkids.booking_program` bp\r\nwhere bp.id not in (3,88)\r\norder by program_type desc;"
}, {
  "table_name": "daily_sales_tracking_f0e49640-59a8-4ea5-b80e-f4301679fa1e_yphoodk1xd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.daily_sales_tracking_f0e49640-59a8-4ea5-b80e-f4301679fa1e_yphoodk1xd`\n(\n  t_date DATE,\n  sale_follow_name STRING,\n  sale_follow_email STRING,\n  sale_follow_supervisor_email STRING,\n  affiliate_category STRING,\n  affiliate_email STRING,\n  subject STRING,\n  num_booking_test_T_1 INT64,\n  num_booking_test_T_2 INT64,\n  num_order_T_1 INT64,\n  num_order_T_2 INT64,\n  num_lead_reject INT64\n);"
}, {
  "table_name": "kyna_eng_teacher_management_9a9ea35c-3271-4af4-ac49-61472d1ad616",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.kyna_eng_teacher_management_9a9ea35c-3271-4af4-ac49-61472d1ad616`\n(\n  tc_email STRING,\n  booking_id INT64,\n  booking_name STRING,\n  booking_time TIMESTAMP,\n  booking_rating_id INT64,\n  teacher_name STRING,\n  teacher_email STRING,\n  teacher_country STRING,\n  teacher_country_id INT64,\n  country STRING,\n  student_name STRING,\n  student_email STRING,\n  student_code STRING,\n  booking_status STRING,\n  lesson_id INT64,\n  lesson_name STRING,\n  teacher_source STRING,\n  program STRING,\n  level_name STRING,\n  num_shift INT64,\n  student_country STRING,\n  teacher_id INT64,\n  tc_incharge_id INT64,\n  student_type STRING\n);"
}, {
  "table_name": "booking_GV_summer_camp_1b2eca6b-2df4-4edd-a420-7233a113c6ec",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.booking_GV_summer_camp_1b2eca6b-2df4-4edd-a420-7233a113c6ec`\n(\n  booking_id INT64,\n  status_id INT64,\n  level STRING,\n  lesson_name STRING,\n  ngay_hoc DATE,\n  khung_gio STRING,\n  teacher_id INT64,\n  teacher_name STRING,\n  teacher_email STRING,\n  tc_email STRING,\n  base_rate FLOAT64,\n  booking_status STRING,\n  bonus_status STRING,\n  canceled_by STRING,\n  cancel_time STRING,\n  teaching_time INT64,\n  thoi_gian_day STRING\n);"
}, {
  "table_name": "track_lead_chua_lien_he_test_10h_618d3829-32d9-4f94-a171-9e0c92a7b1bd_82p5asg9xd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.track_lead_chua_lien_he_test_10h_618d3829-32d9-4f94-a171-9e0c92a7b1bd_82p5asg9xd`\n(\n  target_date DATE,\n  sale_id INT64,\n  num_status_chua_lien_he_bf_10h INT64,\n  num_status_chua_lien_he_up_to_target_date INT64,\n  num_status_dang_tu_van_up_to_target_date INT64,\n  num_status_moi_test_up_to_target_date INT64,\n  num_status_tu_choi_up_to_target_date INT64,\n  num_status_khac_up_to_target_date INT64,\n  sale_follow STRING,\n  sale_follow_email STRING,\n  sale_follow_supervisor STRING,\n  sale_follow_supervisor_email STRING,\n  affiliate_category STRING,\n  affiliate_email STRING\n);"
}, {
  "table_name": "temp_monkey_junior_nhieu_ngon_ngu",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_monkey_junior_nhieu_ngon_ngu`\n(\n  string_field_0 STRING,\n  string_field_1 STRING\n);"
}, {
  "table_name": "report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_8l1rw3xatd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_8l1rw3xatd`\n(\n  interview_date DATE,\n  acceptance_date DATE,\n  teacher_id INT64,\n  teacher_name STRING,\n  teacher_country STRING,\n  teacher_source INT64,\n  teaching_training_date DATE,\n  test_training_date DATE,\n  training_status_id INT64,\n  status_id INT64,\n  contract_status_id INT64,\n  contract_completion_date DATE,\n  deactivate_date DATE,\n  is_tester INT64,\n  tc_email STRING,\n  training_status STRING,\n  contract_status STRING,\n  source STRING,\n  status STRING,\n  least_training_date DATE,\n  greatest_training_date DATE,\n  first_month_completed_bookings INT64,\n  reactivated_date DATE,\n  num_reactivate INT64,\n  ready_to_teach_date DATE,\n  first_booking_date_reactivated DATE,\n  reactivate_contract_completion_date DATE,\n  first_booking_date DATE,\n  normal_or_reactivated STRING,\n  reactivated_qualified_to_teach_date DATE,\n  final_first_booking_date DATE,\n  final_qualified_to_teach_date DATE,\n  is_slot_openned STRING,\n  num_slots_open_from_qualified_date INT64,\n  first_booking_after_qualifying_date DATE,\n  num_days_from_qualifying_to_first_booking INT64\n);"
}, {
  "table_name": "buoitang_khuyenmai_haumai_8b5196e5-5379-4017-be1e-5409aa35c458_p2ie7dmhtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.buoitang_khuyenmai_haumai_8b5196e5-5379-4017-be1e-5409aa35c458_p2ie7dmhtd`\n(\n  id INT64,\n  program_name STRING,\n  booking_status STRING,\n  teacher_type STRING,\n  teacher_country STRING,\n  teacher_income NUMERIC,\n  teacher_income_vnd NUMERIC,\n  begin_at TIMESTAMP,\n  payment_content STRING,\n  student_country_id INT64,\n  teacher_income_ex FLOAT64,\n  student_country STRING\n);"
}, {
  "table_name": "hv_vip_45_junior_402a2c3b-8dad-442c-95e8-b4cca4d7b64a",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.hv_vip_45_junior_402a2c3b-8dad-442c-95e8-b4cca4d7b64a`\n(\n  ngay_hoc DATE,\n  time_hh_mm STRING,\n  student_id INT64,\n  rn INT64\n);"
}, {
  "table_name": "table_of_teacher_cost_duo_not_duo",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.table_of_teacher_cost_duo_not_duo`\n(\n  booking_id INT64,\n  teacher_country STRING,\n  teacher_source STRING,\n  booking_date DATE,\n  student_country STRING,\n  program STRING,\n  teacher_cost FLOAT64,\n  duo_teacher_cost FLOAT64,\n  not_duo_teacher_cost FLOAT64,\n  duo_teacher_cost_room_1 FLOAT64,\n  duo_teacher_cost_room_2 FLOAT64,\n  num_students_room_2 INT64,\n  duo_teacher_cost_room_2_per_student FLOAT64\n);"
}, {
  "table_name": "report_hv_kbc_thang7_analysis_ab994045-2cd0-4f6e-aeeb-82728bf14f1d",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hv_kbc_thang7_analysis_ab994045-2cd0-4f6e-aeeb-82728bf14f1d`\n(\n  student_id INT64,\n  student_code STRING,\n  country STRING,\n  num_bookings_t7 INT64,\n  hv_new_t6 INT64,\n  num_cancel_kbc_t6 INT64,\n  programs STRING,\n  num_remaining_lessons INT64,\n  chi_map_gvcd INT64\n);"
}, {
  "table_name": "booking_student_ty_le_tham_gia_b18441f6-f454-46bf-8ba4-fad9a799c994",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.booking_student_ty_le_tham_gia_b18441f6-f454-46bf-8ba4-fad9a799c994`\n(\n  student_code STRING,\n  student_name STRING,\n  phone_number STRING,\n  program_name STRING,\n  program_subject INT64,\n  student_status STRING,\n  start_leve STRING,\n  current_level STRING,\n  student_type STRING,\n  country STRING,\n  manager_name STRING,\n  manager_math_name STRING,\n  parent_email STRING,\n  total_completed INT64,\n  total_cancel INT64,\n  total_lesson INT64,\n  remain_lesson INT64,\n  teacher_priority STRING,\n  certificate_commitment STRING\n);"
}, {
  "table_name": "thu_nhap_ops_5c194737-88de-48ca-93f4-552714c5f803_ozbga89rtd_2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.thu_nhap_ops_5c194737-88de-48ca-93f4-552714c5f803_ozbga89rtd_2`\n(\n  year_month STRING,\n  ops_manager_email STRING,\n  sup_bonus_all FLOAT64\n);"
}, {
  "table_name": "mkt_dieu_chinh_organic_fblines_93931ef4-def7-4955-99c7-ffeda394-03f3-4419-a5ae-36461591f7f9_je4szv1ltd_3",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.mkt_dieu_chinh_organic_fblines_93931ef4-def7-4955-99c7-ffeda394-03f3-4419-a5ae-36461591f7f9_je4szv1ltd_3`\n(\n  order_date DATE,\n  line_id INT64,\n  utm_campaign STRING,\n  country_id INT64,\n  order_value FLOAT64,\n  num_orders INT64,\n  line_mkt STRING,\n  country STRING\n);"
}, {
  "table_name": "track_lead_chua_lien_he_test_15h_618d3829-32d9-4f94-a171-9e0c92a7b1bd_82p5asg9xd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.track_lead_chua_lien_he_test_15h_618d3829-32d9-4f94-a171-9e0c92a7b1bd_82p5asg9xd`\n(\n  target_date DATE,\n  sale_id INT64,\n  num_status_chua_lien_he_bf_15h INT64,\n  num_status_chua_lien_he_up_to_target_date INT64,\n  num_status_dang_tu_van_up_to_target_date INT64,\n  num_status_moi_test_up_to_target_date INT64,\n  num_status_tu_choi_up_to_target_date INT64,\n  num_status_khac_up_to_target_date INT64,\n  sale_follow STRING,\n  sale_follow_email STRING,\n  sale_follow_supervisor STRING,\n  sale_follow_supervisor_email STRING,\n  affiliate_category STRING,\n  affiliate_email STRING\n);"
}, {
  "table_name": "chat_luong_mkt_cb09a9e7-3575-474f-b88e-6fb58512f931",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.chat_luong_mkt_cb09a9e7-3575-474f-b88e-6fb58512f931`\n(\n  cal_date DATE,\n  sale_id INT64,\n  trang_thai STRING,\n  affiliate_category STRING,\n  affiliate_email STRING,\n  affiliate_campaign STRING,\n  subject STRING,\n  num_leads INT64,\n  num_leads_status_lien_he INT64,\n  num_leads_status_tu_van_tham_gia_onl_off INT64,\n  num_leads_status_coc_hen_tt INT64,\n  num_leads_status_tu_choi_vi_ly_do_trung INT64,\n  num_leads_status_tu_choi_loai_ly_do_trung INT64,\n  num_leads_status_tu_choi INT64,\n  num_test_booked INT64,\n  num_test_completed INT64,\n  num_order_hoc_thu INT64,\n  num_order_ghi_danh_lan_dau INT64,\n  rev_ghi_danh_lan_dau NUMERIC,\n  sale_follow_email STRING,\n  sale_follow_supervisor_email STRING\n);"
}, {
  "table_name": "teacher_cost_tracker_4a393d9b-a1e8-4574-8af2-848a48e46a9b_66f6rf7dtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.teacher_cost_tracker_4a393d9b-a1e8-4574-8af2-848a48e46a9b_66f6rf7dtd`\n(\n  booking_id INT64,\n  booking_time TIMESTAMP,\n  teacher_country STRING,\n  booking_status STRING,\n  revenue NUMERIC,\n  teacher_source STRING,\n  program STRING,\n  num_shift INT64,\n  total_income NUMERIC,\n  sellingEX FLOAT64,\n  revenue_vnd FLOAT64,\n  teacher_income_vnd FLOAT64\n);"
}, {
  "table_name": "temp_hoc_vien_kbc_thang_9_phase_1",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_hoc_vien_kbc_thang_9_phase_1`\n(\n  student_id INT64,\n  student_code STRING,\n  num_bookings_to_map INT64\n);"
}, {
  "table_name": "temp_hoc_vien_kbc_thang_8_nhom_chua_tung_bi_map",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_hoc_vien_kbc_thang_8_nhom_chua_tung_bi_map`\n(\n  student_id INT64,\n  student_code STRING\n);"
}, {
  "table_name": "thu_nhap_ops_5c194737-88de-48ca-93f4-552714c5f803_8w9dsobhtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.thu_nhap_ops_5c194737-88de-48ca-93f4-552714c5f803_8w9dsobhtd`\n(\n  month_year STRING,\n  email_ops STRING,\n  name_ops STRING,\n  student_number INT64\n);"
}, {
  "table_name": "fixed_schedule_bonus_ec36f78c-7afc-400d-8d70-e3efb41afba6_6u5rrgwktd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.fixed_schedule_bonus_ec36f78c-7afc-400d-8d70-e3efb41afba6_6u5rrgwktd`\n(\n  year INT64,\n  quarter INT64,\n  teacher_id INT64,\n  student_id INT64,\n  student_code STRING,\n  total_booking INT64,\n  teacher_name STRING,\n  tc_in_charge STRING\n);"
}, {
  "table_name": "report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_jnwo5knatd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_jnwo5knatd`\n(\n  month STRING,\n  Email STRING,\n  affiliate_campaign STRING,\n  affiliate_email STRING,\n  affiliate_type STRING,\n  Blocked_Open STRING,\n  kpi FLOAT64,\n  num_lead INT64\n);"
}, {
  "table_name": "giao_vien_chi_map_hv_co_dinh_804b2733-367c-4644-bee1-b046edcf6561",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.giao_vien_chi_map_hv_co_dinh_804b2733-367c-4644-bee1-b046edcf6561`\n(\n  teacher_id INT64,\n  teacher_email STRING,\n  name STRING,\n  tc_email STRING,\n  teacher_country STRING,\n  teacher_source STRING,\n  program_name STRING,\n  salary FLOAT64,\n  is_salary_over_threshold STRING,\n  salary_threshold NUMERIC,\n  salary_vs_threshold FLOAT64,\n  only_automap_priority_student STRING,\n  teacher_status STRING\n);"
}, {
  "table_name": "accounting_management_metrics_5fe2d545-1c6c-4402-aa06-b5f45cb5d912_qkrcl27ctd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.accounting_management_metrics_5fe2d545-1c6c-4402-aa06-b5f45cb5d912_qkrcl27ctd`\n(\n  Student_Code STRING,\n  Market STRING,\n  purchase_date STRING,\n  first_time_purchase TIMESTAMP,\n  trial_date TIMESTAMP,\n  Original_Price FLOAT64,\n  VND_Price FLOAT64,\n  total_lesson INT64,\n  type_order STRING,\n  Source STRING,\n  order_code STRING,\n  program STRING,\n  no_shifts INT64,\n  user_type_id INT64,\n  phone_number STRING,\n  email STRING,\n  payment_content STRING,\n  accounting_date TIMESTAMP,\n  client_classify STRING,\n  company_name STRING\n);"
}, {
  "table_name": "report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_5fg4lyw9sd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_5fg4lyw9sd`\n(\n  bd_email STRING,\n  created_at DATE,\n  affiliate_type STRING,\n  affiliate_email STRING,\n  affiliate_campaign STRING,\n  dang_bai_dai_su STRING,\n  Blocked_Open STRING,\n  num_lead INT64,\n  num_order INT64,\n  num_order_ghi_danh_lan_dau_hv_moi_hoan_thanh_ko_duyet_chua_duyet INT64,\n  num_order_ghi_danh_lai_hv_cu_hoan_thanh_ko_duyet_chua_duyet INT64,\n  doanh_thu_ghi_danh_lan_dau NUMERIC,\n  doanh_thu_ghi_danh_lai NUMERIC,\n  hoa_hong_vnd FLOAT64\n);"
}, {
  "table_name": "temp_hoc_vien_kbc_thang_11_phase_2_v2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_hoc_vien_kbc_thang_11_phase_2_v2`\n(\n  student_id INT64,\n  student_code STRING,\n  num_bookings_to_map INT64\n);"
}, {
  "table_name": "table_active_students_by_quarter_province_long",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.table_active_students_by_quarter_province_long`\n(\n  user_id INT64,\n  student_code STRING,\n  province STRING,\n  year_quarter STRING,\n  total_remaining_lessons INT64,\n  num_completed_bookings INT64,\n  is_active INT64\n);"
}, {
  "table_name": "kyna_task_stats_07aad757-b6ac-4ec0-b064-940e5b6a0a39",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.kyna_task_stats_07aad757-b6ac-4ec0-b064-940e5b6a0a39`\n(\n  task_id INT64,\n  subject STRING,\n  start_date DATE,\n  due_date DATE,\n  created_on TIMESTAMP,\n  closed_on DATETIME,\n  status STRING,\n  author_id INT64,\n  author_email STRING,\n  assigned_to_id INT64,\n  assigned_to_email STRING,\n  role_name STRING,\n  category STRING,\n  student_code_from_db STRING,\n  parent_phone STRING,\n  sub_category STRING,\n  lich_hen STRING,\n  tag STRING,\n  estimated_hours FLOAT64,\n  student_id INT64,\n  parent_id INT64,\n  ltv NUMERIC,\n  num_purchase INT64\n);"
}, {
  "table_name": "kyna_duo_math1",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.kyna_duo_math1`\n(\n  teacher_id STRING,\n  program STRING\n);"
}, {
  "table_name": "students_join_economy_bf_20250727",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.students_join_economy_bf_20250727`\n(\n  student_id INT64,\n  student_code STRING,\n  action_date DATE,\n  action INT64\n);"
}, {
  "table_name": "aca_tim_clip_mau_cho_sales_f879e3d0-90b4-4ec5-9f0b-24a26844a438_2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.aca_tim_clip_mau_cho_sales_f879e3d0-90b4-4ec5-9f0b-24a26844a438_2`\n(\n  id INT64,\n  booking_id INT64,\n  teacher_id INT64,\n  tc_id INT64,\n  created_by INT64,\n  created_at INT64,\n  type_warning STRING\n);"
}, {
  "table_name": "duo_program_management_76067fbe-e59d-4989-a4d9-638012afe5bb_hc2h5kb3vd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.duo_program_management_76067fbe-e59d-4989-a4d9-638012afe5bb_hc2h5kb3vd`\n(\n  fixed_teacher_id INT64,\n  teacher_country STRING,\n  teacher_source STRING,\n  student_id INT64,\n  duo_program STRING,\n  max_of_only_map_current_teacher INT64,\n  duo_programs_teacher_has STRING\n);"
}, {
  "table_name": "temp_hv_huy_economy",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_hv_huy_economy`\n(\n  student_id INT64,\n  profile_link STRING,\n  cancel_time TIMESTAMP,\n  cancel_date DATE\n);"
}, {
  "table_name": "table_booking_cr_test_15h15_indo_malaysia_market_4c192a36-077e-45a3-a4c6-a892e8fd2627",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.table_booking_cr_test_15h15_indo_malaysia_market_4c192a36-077e-45a3-a4c6-a892e8fd2627`\n(\n  ngay_tao_lead DATE,\n  sale_email STRING,\n  sale_manager_email STRING,\n  mon_hoc STRING,\n  country STRING,\n  affiliate_email STRING,\n  sale_name STRING,\n  sup_name STRING,\n  num_test_by_sic INT64,\n  num_test_by_sic_t1 INT64,\n  num_lead_t1 INT64,\n  num_lead_t1_1 INT64,\n  num_lead_t1_2 INT64\n);"
}, {
  "table_name": "report_hieu_qua_partnership_312a51c8-b964-4328-b959-d027909dd30f_p_onmlnmsbtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hieu_qua_partnership_312a51c8-b964-4328-b959-d027909dd30f_p_onmlnmsbtd`\n(\n  bd_email STRING,\n  created_at DATE,\n  affiliate_type STRING,\n  affiliate_email STRING,\n  affiliate_campaign STRING,\n  dang_bai_dai_su STRING,\n  Blocked_Open STRING,\n  num_lead INT64,\n  num_order INT64,\n  num_order_ghi_danh_lan_dau_hv_moi_hoan_thanh_ko_duyet_chua_duyet INT64,\n  num_order_ghi_danh_lai_hv_cu_hoan_thanh_ko_duyet_chua_duyet INT64,\n  doanh_thu_ghi_danh_lan_dau NUMERIC,\n  doanh_thu_ghi_danh_lai NUMERIC,\n  hoa_hong_vnd FLOAT64\n);"
}, {
  "table_name": "students_economy_package_join_left_all_time",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.students_economy_package_join_left_all_time`\nAS with\r\neconomy_all_temp as\r\n(\r\n    (\r\n    select \r\n          user_id,\r\n          date(timestamp_seconds(created_at)) as action_date,\r\n          action \r\n    from `kynaforkids-server-production.datateam_kynaforkids.booking_student_program_action_economy_view` \r\n    )\r\n\r\n    union all\r\n\r\n    (\r\n    select \r\n          student_id as user_id,\r\n          action_date,\r\n          action\r\n    from `datateam_kynaforkids.students_join_economy_bf_20250727`\r\n    )\r\n\r\n    union all\r\n\r\n    (\r\n    select \r\n          student_id as user_id,\r\n          action_date,\r\n          action\r\n    from `datateam_kynaforkids.students_left_economy_bf_20250727`\r\n    )\r\n),\r\n\r\neconomy_all as\r\n(\r\nselect \r\n      user_id,\r\n      action_date,\r\n      action \r\nfrom \r\n(\r\n    SELECT *,\r\n          row_number() over (partition by user_id, action order by action_date desc) as rn\r\n    FROM economy_all_temp\r\n)\r\nwhere rn \u003d 1\r\norder by action_date desc\r\n)\r\n\r\n\r\nselect \r\n      ea.*,\r\n      bst.student_code,\r\n      `kynaforkids-server-production.kynaforkids.func_get_student_name_from_profile_by_student_id`(bst.user_id) as student_name,\r\n      case when action \u003d 9 then \"Đăng ký\"\r\n           when action \u003d 10 then \"Hủy\"\r\n      end as action_description,    \r\n      case when bst.user_type_id \u003d 1 then \u0027Trẻ em\u0027\r\n           when bst.user_type_id \u003d 2 then \u0027Người lớn\u0027\r\n           else \u0027Chưa rõ\u0027\r\n      end as student_type\r\n\r\nfrom economy_all ea\r\nleft join `kynaforkids.booking_student` bst using(user_id)\r\n\r\n\r\n;"
}, {
  "table_name": "report_team_ops_9ae866b8-a7f7-4eea-9c70-9ed002c536fb_jgmopeyctd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_team_ops_9ae866b8-a7f7-4eea-9c70-9ed002c536fb_jgmopeyctd`\n(\n  id INT64,\n  ops_email STRING,\n  event_type_id INT64,\n  event_type STRING,\n  event_start_at TIMESTAMP,\n  event_end_at TIMESTAMP,\n  event_handler STRING,\n  event_handle_time TIMESTAMP\n);"
}, {
  "table_name": "murpher_instructor_1-1_5e46753b-94ad-431c-b1c1-c4ca786e753b_7w1lao2ipd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.murpher_instructor_1-1_5e46753b-94ad-431c-b1c1-c4ca786e753b_7w1lao2ipd`\n(\n  teacher_month STRING,\n  teacher_name STRING,\n  teacher_email STRING,\n  taught_test_1ca INT64,\n  taught_test_2ca INT64,\n  taught_25p INT64,\n  taught_45p INT64,\n  taught_60p INT64,\n  taught_60p_new INT64,\n  taught_90p INT64,\n  income_25 NUMERIC,\n  income_45_50_min_sesions NUMERIC,\n  income_60 NUMERIC,\n  income_60_new NUMERIC,\n  income_90 NUMERIC,\n  adjustment_by_booking_claim NUMERIC,\n  other_ajust NUMERIC\n);"
}, {
  "table_name": "aca_tim_clip_mau_cho_sales_f879e3d0-90b4-4ec5-9f0b-24a26844a438",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.aca_tim_clip_mau_cho_sales_f879e3d0-90b4-4ec5-9f0b-24a26844a438`\n(\n  booking_id INT64,\n  ngay_hoc DATE,\n  khung_gio STRING,\n  program STRING,\n  level STRING,\n  lesson_name STRING,\n  booking_bonus STRING,\n  teacher_country STRING,\n  Nhom_quoc_gia STRING,\n  Khu_vuc STRING,\n  teacher_source STRING,\n  video_link STRING,\n  teacher_id INT64,\n  teacher_name STRING,\n  tc_email STRING,\n  academic_score INT64,\n  tc_warning INT64,\n  percent_time_teacher_full_face INT64,\n  full_face_camera_gv_filter STRING,\n  percent_teacher_open_webcam_time INT64,\n  open_camera_gv_filter STRING,\n  percent_teacher_talk_time INT64,\n  talking_time_gv_filter STRING,\n  percent_student_open_webcam_time INT64,\n  open_camera_hv_filter STRING,\n  percent_student_talk_time INT64,\n  talking_time_hv_filter STRING,\n  teacher_rating_by_student INT64,\n  student_rating_comment STRING,\n  gender STRING\n);"
}, {
  "table_name": "teacher_income_1-1_8b7cebb7-2377-43de-b4c7-30f363857402_6t6mn52btd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.teacher_income_1-1_8b7cebb7-2377-43de-b4c7-30f363857402_6t6mn52btd`\n(\n  id INT64,\n  teacher_id INT64,\n  teacher_email STRING,\n  name STRING,\n  quoc_tich STRING,\n  trang_thai_hop_dong STRING,\n  status STRING,\n  TC_in_charge STRING,\n  teacher_source STRING,\n  contract_end_at DATE,\n  terminate_date STRING,\n  ngay_thu_nhap DATE,\n  num_of_real_class INT64,\n  num_of_teacher_wrong_cancel INT64,\n  num_of_kyna_50_percent_cancel INT64,\n  num_of_kyna_100_percent_cancel INT64,\n  num_of_rating_below_standard INT64,\n  no_pay_class INT64,\n  num_of_open_webcam_below_standard INT64,\n  number_of_etiquette_violation INT64,\n  income_basic_salary NUMERIC,\n  income_of_qualified_class NUMERIC,\n  income_of_replacement_bonus NUMERIC,\n  penalty_kyna_50_percent_cancel NUMERIC,\n  penalty_kyna_100_percent_cancel NUMERIC,\n  income_base_salary NUMERIC,\n  bonus_qualified_class NUMERIC,\n  bonus_replacement NUMERIC,\n  hot_bonus FLOAT64,\n  kyna_compensation_50 NUMERIC,\n  kyna_compensation_100 NUMERIC,\n  total_money_rating_below_standard NUMERIC,\n  penalty_teacher_wrong_cancel NUMERIC,\n  open_webcam_below_standard_penalty NUMERIC,\n  etiquette_violation_penalty NUMERIC,\n  penalty_rating_below_standard NUMERIC,\n  penalty_wrong_cancel NUMERIC,\n  penalty_open_webcam NUMERIC,\n  penalty_code_of_conduct NUMERIC,\n  penalty_over_cancel NUMERIC,\n  golden_hour_bonus NUMERIC,\n  golden_hour_bonus_plus NUMERIC,\n  Fsb_Level_1_Bonus NUMERIC,\n  Fsb_Level_2_Bonus NUMERIC,\n  fsb_quarter_bonus NUMERIC,\n  adjustment_income FLOAT64,\n  other_adjustment NUMERIC,\n  referral_income NUMERIC,\n  intro_income NUMERIC,\n  other_income NUMERIC,\n  last_month_adjustment_income NUMERIC,\n  gross_income NUMERIC,\n  sellingEx FLOAT64\n);"
}, {
  "table_name": "report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_9173uprbtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_9173uprbtd`\n(\n  booking_id INT64,\n  teacher_id INT64,\n  begin_at TIMESTAMP,\n  duyet_booking INT64,\n  ops_teacher_email STRING,\n  teacher_name STRING,\n  country_id INT64,\n  country_id_hv INT64,\n  t_source INT64,\n  program STRING,\n  mon_hoc STRING,\n  loai_hoc_vien STRING,\n  danh_gia STRING,\n  khong_dat INT64,\n  duoi_chuan INT64,\n  no_pay INT64,\n  no_pay_base_rate INT64,\n  no_show INT64,\n  teacher_open_webcam_time_less_70 STRING,\n  percent_open_camera_time INT64,\n  percent_time_teacher_full_face_less_70 STRING,\n  percent_full_face_time INT64,\n  teacher_taking_less_20 STRING,\n  percent_teacher_talking_time INT64,\n  access_time_gv INT64,\n  teacher_vao_lop_tre STRING,\n  teacher_note_tre STRING,\n  teacher_khong_note STRING,\n  access_time_hv INT64,\n  warning INT64,\n  warning_details STRING,\n  teacher_email STRING,\n  teacher_country STRING,\n  teacher_source STRING,\n  student_country STRING\n);"
}, {
  "table_name": "report_performance_bonus_test_e3f0d061-6f11-4539-8b97-1b8dab74fab8_iyivtrratd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_performance_bonus_test_e3f0d061-6f11-4539-8b97-1b8dab74fab8_iyivtrratd`\n(\n  booking_id INT64,\n  booking_name STRING,\n  booking_time TIMESTAMP,\n  booking_end_time TIMESTAMP,\n  teacher_name STRING,\n  teacher_email STRING,\n  teacher_country STRING,\n  teacher_country_id INT64,\n  country STRING,\n  student_name STRING,\n  student_code STRING,\n  booking_status STRING,\n  teacher_source STRING,\n  program STRING,\n  level_name STRING,\n  lesson_name STRING,\n  lesson_id INT64,\n  lesson_code STRING,\n  section_name STRING,\n  num_shift INT64,\n  student_country STRING,\n  teacher_id INT64\n);"
}, {
  "table_name": "schedule_create_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_ik5eijv9sd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.schedule_create_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_ik5eijv9sd`\n(\n  ngay_dang_bai DATE,\n  bd_incharge_id INT64,\n  country_id INT64,\n  student_id INT64,\n  parent_name STRING,\n  children_name STRING,\n  post_link STRING,\n  phone_number STRING,\n  affiliate_id INT64,\n  affiliate_email STRING,\n  aff_country STRING,\n  student_code STRING,\n  email_bd STRING,\n  hoa_hong INT64,\n  so_bai_dang INT64,\n  hoa_hong_ngay INT64\n);"
}, {
  "table_name": "fixed_schedule_bonus_ec36f78c-7afc-400d-8d70-e3efb41afba6_7e8e33vktd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.fixed_schedule_bonus_ec36f78c-7afc-400d-8d70-e3efb41afba6_7e8e33vktd`\n(\n  teacher_id INT64,\n  year_begin_at INT64,\n  month_begin_at INT64,\n  teacher_name STRING,\n  tc_in_charge STRING,\n  total_hv_fs2 INT64,\n  total_fs2 INT64\n);"
}, {
  "table_name": "sale_ai_bonus_day_D",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.sale_ai_bonus_day_D`\n(\n  year_month STRING,\n  sale_ai_tutor_commission_vnd FLOAT64\n);"
}, {
  "table_name": "table_booking_test_lao_thai_market_a42d42d1-9892-4fa3-8dcb-a414a4afda63",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.table_booking_test_lao_thai_market_a42d42d1-9892-4fa3-8dcb-a414a4afda63`\n(\n  booking_id INT64,\n  booking_name STRING,\n  booking_time TIMESTAMP,\n  is_virtual_booking INT64,\n  booking_status STRING,\n  student_code STRING,\n  student_country_id INT64,\n  student_country STRING,\n  sic_id INT64,\n  sic_email STRING,\n  sales_manager_id INT64,\n  sales_manager_email STRING,\n  is_student_join_meeeting INT64,\n  teacher_id INT64,\n  is_teacher_join_meeeting INT64,\n  teacher_note_at TIMESTAMP,\n  program STRING,\n  subject INT64,\n  num_shift INT64\n);"
}, {
  "table_name": "order_package_combo_single_info_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.order_package_combo_single_info_view`\nAS WITH \r\norder_single AS\r\n(SELECT \r\n        --ord.*,\r\n        ord.id as order_id,\r\n        date(timestamp_seconds(ord.created_at)) as created_at,\r\n        ord.is_activated,\r\n      --   date(ord.updated_at) as updated_at,\r\n      --   date(ord.completed_at) as completed_at,\r\n        ori.name,\r\n        ori.phone_number,\r\n        ord.created_by,\r\n        -- ord.telesale_id,\r\n\r\n        -- ord.register_source,        \r\n        -- ord.country_id,\r\n        -- `kynaforkids-server-production.kynaforkids.func_get_country`(ord.country_id) as country,\r\n        -- ord.currency_exchange_rate,\r\n        -- ord.total as total_oc,\r\n        \r\n        \r\n       -- ord.user_id,\r\n        -- ori.phone_number as order_phone_number,\r\n        -- ori.email as order_email,\r\n        ori.lead_id,\r\n      --   if((ori.phone_number) in (SELECT * FROM users_1_1_phone_number),\"Đã học 1-1\",\"Chưa học 1-1\") as check_1_1, \r\n\r\n        \r\n\r\n        ord.invoice_code as order_code,\r\n        ord.status as order_status_id,\r\n        -- ord.payment_method_id,\r\n        ord.payment_method_status as payment_status_id,\r\n        -- ord.affiliate_id,\r\n        -- (SELECT email FROM kynaforkids-server-production.kynaforkids.user us WHERE ord.affiliate_id \u003d us.id) as affiliate_email,\r\n        -- (SELECT au.affiliate_category_id FROM kynaforkids-server-production.kynaforkids.affiliate_user au WHERE au.user_id \u003d ord.affiliate_id) as affiliate_category_id,\r\n        -- ord.utm_campaign,\r\n\r\n\r\n        ordd.package_id,\r\n        ordd.package_subscription_id,\r\n        ordd.package_combo_id,\r\n        pks.subscription_month,\r\n        pks.name as subscription_name,\r\n        pks.price as subscription_price,\r\n        pk.name as package_name,\r\n\r\n        \r\n       \r\nFROM `kynaforkids-server-production.kynaforkids.order` ord\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.order_detail` ordd ON (ord.id \u003d ordd.order_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.order_register_info` ori ON (ord.id \u003d ori.order_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.package_subscriptions` pks ON (ordd.package_subscription_id \u003d pks.id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.package` pk ON (pk.id \u003d ordd.package_id)\r\n\r\n\r\n\r\nWHERE   ordd.package_combo_id is null\r\n     -- AND ord.invoice_code like \u0027KYNA%\u0027 or ord.invoice_code like \u0027GRAI%\u0027\r\n     -- AND pk.name like \u0027%AI Tutor%\u0027    \r\n),\r\n\r\norder_combo AS\r\n(SELECT \r\n        --ord.*,\r\n        ord.id as order_id,\r\n        date(timestamp_seconds(ord.created_at)) as created_at,\r\n        ord.is_activated,\r\n      --   date(ord.updated_at) as updated_at,\r\n      --   date(ord.completed_at) as completed_at,\r\n        ori.name,\r\n        ori.phone_number,\r\n\r\n        ord.created_by,\r\n        -- ord.telesale_id,\r\n        -- ord.register_source,        \r\n        -- ord.country_id,\r\n        -- `kynaforkids-server-production.kynaforkids.func_get_country`(ord.country_id) as country,\r\n        -- ord.currency_exchange_rate,\r\n        -- ord.total as total_oc,\r\n        \r\n        \r\n       -- ord.user_id,\r\n        -- ori.phone_number as order_phone_number,\r\n        -- ori.email as order_email,\r\n        ori.lead_id,\r\n      --   if((ori.phone_number) in (SELECT * FROM users_1_1_phone_number),\"Đã học 1-1\",\"Chưa học 1-1\") as check_1_1, \r\n\r\n\r\n        ord.invoice_code as order_code,\r\n        ord.status as order_status_id,\r\n        -- case when ord.status \u003d 1 then \u0027Mới tạo\u0027\r\n        --      when ord.status \u003d 2 then \u0027Đã xác nhận\u0027\r\n        --      when ord.status \u003d 3 then \u0027Hoàn thành\u0027\r\n        --      when ord.status \u003d 4 then \u0027Hủy\u0027\r\n        --      when ord.status \u003d 5 then \u0027Đã hoàn tiền\u0027   \r\n        -- end as order_status,\r\n\r\n        -- ord.payment_method_id,\r\n        ord.payment_method_status,\r\n        \r\n        -- ord.affiliate_id,  \r\n        -- ord.affiliate_email,\r\n        -- ord.affiliate_category_name,\r\n        \r\n\r\n        -- ord.invoice_code as order_code,\r\n        -- ord.status as order_status_id,\r\n        -- ord.payment_method_id,\r\n        -- ord.payment_method_status as payment_status_id,\r\n        -- ord.affiliate_id,\r\n        -- (SELECT email FROM kynaforkids-server-production.kynaforkids.user us WHERE ord.affiliate_id \u003d us.id) as affiliate_email,\r\n        -- (SELECT au.affiliate_category_id FROM kynaforkids-server-production.kynaforkids.affiliate_user au WHERE au.user_id \u003d ord.affiliate_id) as affiliate_category_id,\r\n        -- ord.utm_campaign,\r\n\r\n\r\n        ordd.package_id,\r\n        ordd.package_subscription_id,\r\n        ordd.package_combo_id,\r\n        pks.subscription_month,\r\n        pks.name as subscription_name,\r\n        pks.price as subscription_price,\r\n        pk.name as package_name,\r\n\r\n\r\n        \r\n       \r\nFROM `kynaforkids-server-production.kynaforkids.order` ord\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.order_detail` ordd ON (ord.id \u003d ordd.order_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.order_register_info` ori ON (ord.id \u003d ori.order_id)\r\nLEFT JOIN `kynaforkids.package_combo_subscription_item` pcs ON (ordd.package_subscription_id \u003d pcs.id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.package_subscriptions` pks ON (pcs.package_subscription_id \u003d pks.id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.package` pk ON (pk.id \u003d pcs.package_id)\r\n-- LEFT JOIN `kynaforkids-server-production.kynaforkids.package` pk ON (pk.id \u003d ordd.package_combo_id)\r\n\r\n\r\nWHERE \r\n        ordd.package_combo_id is not null\r\n     -- AND ord.invoice_code like \u0027KYNA%\u0027 or ord.invoice_code like \u0027GRAI%\u0027\r\n     -- AND pk.name like \u0027%AI%\u0027\r\n),\r\n\r\norder_all AS\r\n(\r\nSELECT * FROM order_single\r\n\r\nUNION ALL\r\n\r\nSELECT * FROM order_combo\r\n\r\n)\r\n\r\nselect * from order_all\r\n\r\n;"
}, {
  "table_name": "report_math_SC_num_orders_by_students_e2ce689f-2387-460e-85ea-4ec88382f26d_fzswmvtbtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_math_SC_num_orders_by_students_e2ce689f-2387-460e-85ea-4ec88382f26d_fzswmvtbtd`\n(\n  booking_id INT64,\n  booking_name STRING,\n  booking_time DATE,\n  program_id INT64,\n  teacher_id INT64,\n  teacher_name STRING,\n  teacher_country STRING,\n  tc_in_charge_id INT64,\n  video_link STRING,\n  student_name STRING,\n  student_code STRING,\n  student_id INT64,\n  vocabulary INT64,\n  use_of_english INT64,\n  pronunciation INT64,\n  listening INT64,\n  speaking INT64,\n  reading_and_writing INT64,\n  student_level STRING,\n  student_attitude STRING,\n  tc_email STRING,\n  subject_id INT64,\n  subject_name STRING,\n  sc_in_charge_id INT64,\n  sc_email STRING\n);"
}, {
  "table_name": "ceo_ghi_danh_lan_dau_LAO_view_temp",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.ceo_ghi_danh_lan_dau_LAO_view_temp`\nAS with general_table as (\r\nSELECT\r\n    bl.id\r\n  , bl.status\r\n  , bl.actual_utm_campaign as affiliate_campaign\r\n  , bl.reason_cancel_id\r\n  , bl.created_at\r\n  , bo.invoice_code\r\n  , bo.payment_content\r\n  , bo.total\r\n  , bo.payment_status\r\n  , bo.status as booking_order_status\r\n  , bo.discount_money\r\n  , bo.currency_exchange_rate\r\n  , date(bo.created_at) as order_date\r\n \r\n  , `kynaforkids-server-production.kynaforkids.func_get_booking_lead_status`(bl.status) as lead_status\r\n  , (select ac.name from `kynaforkids-server-production.kynaforkids.affiliate_category` ac,\r\n    `kynaforkids-server-production.kynaforkids.affiliate_user` au where au.affiliate_id \u003d bl.affiliate_id and au.affiliate_category_id \u003d ac.id) as affiliate_category\r\n  , (select u.email from `kynaforkids-server-production.kynaforkids.affiliate_user` au,\r\n    `kynaforkids-server-production.kynaforkids.user` u where au.affiliate_id \u003d bl.affiliate_id and u.id \u003d au.user_id ) as affiliate_email\r\n  , (SELECT max(p.name) FROM `kynaforkids-server-production.kynaforkids.profile` p WHERE p.user_id \u003d bl.sale_id) AS sale_follow\r\n    , (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d bl.sale_id) AS sale_follow_email\r\n    ,(SELECT max(p.name) FROM `kynaforkids-server-production.kynaforkids.profile` p WHERE p.user_id \u003d tsm.telesales_supervisor_id) AS sale_follow_supervisor\r\n  , (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d tsm.telesales_supervisor_id) AS sale_follow_supervisor_email,\r\n  \r\n    -- (select date(bsn.begin_at)\r\n    -- from `kynaforkids-server-production.kynaforkids.booking_session_new` bsn\r\n    -- where bsn.id \u003d bl.booking_test_id) as test_date,\r\n\r\n\r\n    bl.booking_test_id,\r\n    bl.sale_id,\r\n\r\n    -- (select bsn.status_id,\r\n    -- from `kynaforkids-server-production.kynaforkids.booking_session_new` bsn\r\n    -- where bsn.id \u003d bl.booking_test_id) as booking_test_status\r\n\r\n\r\n\r\n\r\n  `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(bo.payment_content) AS loai_don_hang\r\n, IF(bo.payment_content \u003d 1, 1, 0) as hoc_thu\r\n, IF(bo.payment_content \u003d 2, 1, 0) as ghi_danh_lan_dau\r\n, IF(bo.payment_content \u003d 3, 1, 0) as tra_gop_lan_sau\r\n, IF(bo.payment_content \u003d 4, 1, 0) as ghi_danh_lai\r\n, (CASE WHEN bl.upsell \u003d 1 THEN \u0027Upsell\u0027 ELSE \u0027Lead\u0027 END) AS loai_lead\r\n, (CASE WHEN bl.is_blocked \u003d 0 THEN \u0027Open\u0027  ELSE \u0027Blocked\u0027 END) AS trang_thai\r\n    -- ngaltt end\r\n, if((select max(u.id) from `kynaforkids-server-production.kynaforkids.user` u,\r\n  (select parent_id from `kynaforkids-server-production.kynaforkids.booking_student` bst, `kynaforkids-server-production.kynaforkids.user` u where u.id \u003d bst.user_id and bst.is_user_test !\u003d 1) t1\r\n  where u.id \u003d t1.parent_id and u.phone_number \u003d bl.intl_phone_number) is null, \u0027Chưa là HV\u0027, \u0027Đã là HV\u0027) as HV_Yes_No\r\n, case\r\n    when bl.subject_code \u003d \u0027EK\u0027 then \u0027Tiếng Anh trẻ em\u0027\r\n    when bl.subject_code \u003d \u0027EA\u0027 then \u0027Tiếng Anh người lớn\u0027\r\n    when bl.subject_code \u003d \u0027M\u0027 then \u0027Toán\u0027\r\n    when bl.subject_code \u003d \u0027C\u0027 then \u0027Group Class\u0027\r\n    when bl.subject_code \u003d \u0027AI\u0027 then \u0027AI Tutor\u0027\r\n    when bl.subject_code \u003d \u0027AI-PRE\u0027 then \u0027AI Tutor Premium\u0027\r\n  end as subject_code\r\nFROM `kynaforkids-server-production.kynaforkids.booking_lead_view` bl\r\n-- ngaltt start\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr` tsm on tsm.telesales_id \u003d bl.sale_id\r\n-- ngaltt end\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_order_view` bo ON bl.id \u003d bo.lead_id\r\n-- LEFT JOIN `kynaforkids-server-production.kynaforkids.auth_assignment` aa ON aa.user_id \u003d bl.sale_id\r\nWHERE bl.country_id \u003d 5\r\n-- AND aa.item_name IN(\u0027Telesales\u0027, \u0027Lead Telesales\u0027,\u0027SALE - Manager\u0027,\u0027SALE - Telesales - Staff\u0027,\u0027SALE - Telesales Supervisor\u0027)\r\nAND bl.Upsell !\u003d 1\r\n),\r\n\r\nlead_table as\r\n(\r\nselect \r\n        date(created_at) as lead_date, \r\n        sale_id,\r\n        -- sale_follow_email,\r\n        trang_thai,\r\n        affiliate_category,\r\n        affiliate_email,\r\n        affiliate_campaign,\r\n        subject_code,\r\n        count(distinct id) as num_leads,   \r\n\r\n      SUM(\r\n            if(status in (6,12),1,0)\r\n        ) as num_leads_status_lien_he,\r\n      \r\n      SUM(\r\n          if(reason_cancel_id in (\u00278\u0027) and status in (9),1,0)\r\n      ) as num_leads_status_tu_choi_vi_ly_do_trung,\r\n\r\n      SUM(\r\n            if(status in (3,4,5),1,0)\r\n        ) as num_leads_status_tu_van_tham_gia_onl_off,\r\n      SUM(\r\n            if(status in (21,22),1,0)\r\n        ) as num_leads_status_coc_hen_tt,\r\n      SUM(\r\n          if(reason_cancel_id not in (\u00278\u0027) and status in (9),1,0)\r\n      ) as num_leads_status_tu_choi_loai_ly_do_trung,\r\n      SUM(\r\n            if(status in (9),1,0)\r\n        ) as num_leads_status_tu_choi\r\nfrom general_table\r\nwhere \r\n      date(created_at) \u003e\u003d \u00272024-01-01\u0027\r\n      -- date(created_at) \u003e\u003d \u00272025-01-01\u0027\r\n  -- and date(created_at) \u003c\u003d \u00272025-01-31\u0027\r\n  group by lead_date, sale_id,trang_thai,affiliate_category,affiliate_email,affiliate_campaign,subject_code\r\n  order by lead_date desc\r\n),\r\n\r\nbooking_test_data as (\r\nselect\r\n\r\n      bsn.id as booking_test_id,\r\n      date(bsn.begin_at) as test_date,\r\n      min(bsn.status_id) as booking_test_status,\r\n      min(gt.affiliate_campaign) as affiliate_campaign,\r\n      min(gt.affiliate_email) as affiliate_email,\r\n      min(gt.affiliate_category) as affiliate_category,\r\n      min(bs.sale_in_charge_id) as sale_id,\r\n      -- `kynaforkids-server-production.kynaforkids.func_get_telesale_email`(min(bs.sale_in_charge_id)) as sale_follow_email,\r\n      -- min(tsm.telesales_id) as sale_sup_id,\r\n      -- min(gt.sale_follow_supervisor_email) as sale_follow_supervisor_email,\r\n      min(gt.trang_thai) as trang_thai,\r\n      min(gt.subject_code) as subject_code,\r\n      min(gt.status) as status,\r\n      \r\n\r\n      \r\n\r\nfrom `kynaforkids.booking_session_view` bsn\r\nleft join `kynaforkids.booking_session_student` bssn on bssn.booking_session_id \u003d bsn.id\r\nleft join `kynaforkids.booking_student` bs on bssn.student_id \u003d bs.user_id\r\n-- LEFT JOIN `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr` tsm on tsm.telesales_id \u003d bs.sale_in_charge_id\r\n\r\nleft join general_table gt on bsn.id \u003d gt.booking_test_id\r\nwhere \r\n      --date(bsn.begin_at) \u003c\u003d \u00272025-01-31\u0027 and date(bsn.begin_at) \u003e\u003d \u00272025-01-01\u0027\r\n      bsn.program_id IN (8,13,47,48,53,54,55,56,89,90)\r\n      and bssn.country_id \u003d 5\r\ngroup by bsn.id, test_date\r\n),\r\n\r\ntest_table as\r\n(\r\nselect \r\n        test_date, \r\n        sale_id,\r\n        -- sale_follow_email,\r\n        -- sale_follow_supervisor_email,\r\n        trang_thai,\r\n        affiliate_category, \r\n        affiliate_email,\r\n        affiliate_campaign,\r\n        subject_code,\r\n        SUM(\r\n            if(booking_test_status in (5), 1,0)\r\n        ) as num_test_completed,\r\n\r\n        SUM(\r\n            if(status in (7),1,0)\r\n        ) as num_test_completed_alt,\r\n\r\n        SUM(\r\n            if(booking_test_id is not null, 1,0)\r\n        ) as num_test_booked,\r\nfrom booking_test_data\r\nwhere \r\n      test_date \u003e\u003d \u00272024-01-01\u0027\r\n      -- test_date \u003e\u003d \u00272025-01-01\u0027\r\n  -- and test_date \u003c\u003d \u00272025-01-31\u0027\r\n  group by test_date, sale_id, trang_thai, affiliate_category, affiliate_email, affiliate_campaign, subject_code\r\n  order by test_date desc\r\n),\r\n\r\norder_info as (\r\nselect \r\n         bo.invoice_code,\r\n        --  (select bl.sale_id from `kynaforkids.booking_lead` bl where bl.id \u003d bo.lead_id) as sale_id,\r\n         bo.created_by as sale_id,\r\n         bo.payment_content,\r\n         bo.total,\r\n         bo.total_video_course,\r\n         bo.payment_status,\r\n         bo.status,\r\n         bo.discount_money,\r\n         bo.currency_exchange_rate,\r\n         date(bo.created_at) as order_date,\r\n         bl.actual_utm_campaign as affiliate_campaign,\r\n         (select ac.name from `kynaforkids-server-production.kynaforkids.affiliate_category` ac,\r\n          `kynaforkids-server-production.kynaforkids.affiliate_user` au where au.affiliate_id \u003d bl.affiliate_id and au.affiliate_category_id \u003d ac.id) as affiliate_category,\r\n         (select u.email from `kynaforkids-server-production.kynaforkids.affiliate_user` au,\r\n           `kynaforkids-server-production.kynaforkids.user` u where au.affiliate_id \u003d bl.affiliate_id and u.id \u003d au.user_id ) as affiliate_email,\r\n        case\r\n          when bl.subject_code \u003d \u0027EK\u0027 then \u0027Tiếng Anh trẻ em\u0027\r\n          when bl.subject_code \u003d \u0027EA\u0027 then \u0027Tiếng Anh người lớn\u0027\r\n          when bl.subject_code \u003d \u0027M\u0027 then \u0027Toán\u0027\r\n          when bl.subject_code \u003d \u0027C\u0027 then \u0027Group Class\u0027\r\n          when bl.subject_code \u003d \u0027AI\u0027 then \u0027AI Tutor\u0027\r\n          when bl.subject_code \u003d \u0027AI-PRE\u0027 then \u0027AI Tutor Premium\u0027\r\n        end as subject_code,\r\n        bo.lead_id,\r\n\r\nfrom `kynaforkids.booking_order_view` bo\r\nleft join `kynaforkids.booking_lead` bl on bl.id \u003d bo.lead_id\r\nwhere bo.status in (4) and bo.payment_status in (0,1,3,4)\r\n      and bo.international_country_id \u003d 5\r\n),\r\n\r\norder_table as\r\n(\r\nselect\r\n        order_date,\r\n        order_info.sale_id,\r\n        -- (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d order_info.sale_id) AS sale_follow_email,\r\n        -- (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d tsm.telesales_supervisor_id) AS sale_follow_supervisor_email,\r\n        \u0027Open\u0027 as trang_thai,\r\n        affiliate_category,\r\n        affiliate_email,\r\n        subject_code,\r\n        affiliate_campaign,\r\n        string_agg(CAST(lead_id AS STRING)) as lead_ids,\r\n        string_agg(invoice_code) as invoices,      \r\n\r\n        SUM(\r\n            if(payment_content in (1), 1,0)\r\n        ) as num_order_hoc_thu,\r\n\r\n\r\n       SUM(\r\n            if(payment_content in (2), 1,0)\r\n        ) as num_order_ghi_danh_lan_dau,\r\n\r\n\r\n          SUM(\r\n            if(payment_content in (2), round((coalesce(total,0) + coalesce(total_video_course,0) - coalesce(discount_money,0))*currency_exchange_rate),0)\r\n        ) as rev_ghi_danh_lan_dau,\r\n\r\n\r\nfrom order_info\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr` tsm on tsm.telesales_id \u003d order_info.sale_id\r\nwhere order_date \u003e\u003d \u00272024-01-01\u0027\r\n      -- order_date \u003e\u003d \u00272025-01-01\u0027\r\n  -- and order_date \u003c\u003d \u00272025-01-31\u0027\r\n  group by order_date, sale_id, affiliate_category,affiliate_email,affiliate_campaign,subject_code\r\n  order by order_date desc\r\n),\r\n\r\n\r\nresult as (\r\nselect\r\n      coalesce(ot.order_date,tt.test_date,lt.lead_date) as cal_date,\r\n      coalesce(ot.sale_id,tt.sale_id,lt.sale_id) as sale_id,\r\n      -- coalesce(ot.sale_follow_email,tt.sale_follow_email,lt.sale_follow_email) as sale_follow_email,\r\n      -- coalesce(ot.sale_follow_supervisor_email,tt.sale_follow_supervisor_email,lt.sale_follow_supervisor_email) as sale_follow_supervisor_email,\r\n      coalesce(ot.trang_thai,tt.trang_thai,lt.trang_thai) as trang_thai,\r\n      \r\n      coalesce(ot.affiliate_category,tt.affiliate_category,lt.affiliate_category) as affiliate_category,\r\n      coalesce(ot.affiliate_email,tt.affiliate_email,lt.affiliate_email) as affiliate_email,\r\n      coalesce(ot.affiliate_campaign,tt.affiliate_campaign,lt.affiliate_campaign) as affiliate_campaign,\r\n      coalesce(ot.subject_code,tt.subject_code,lt.subject_code) as subject,\r\n      SUM(coalesce(lt.num_leads,0)) as num_leads,\r\n      SUM(coalesce(lt.num_leads_status_lien_he,0)) as num_leads_status_lien_he,\r\n      SUM(coalesce(lt.num_leads_status_tu_van_tham_gia_onl_off,0)) as num_leads_status_tu_van_tham_gia_onl_off,\r\n      SUM(coalesce(lt.num_leads_status_coc_hen_tt,0)) as num_leads_status_coc_hen_tt,\r\n      SUM(coalesce(lt.num_leads_status_tu_choi_vi_ly_do_trung,0)) as num_leads_status_tu_choi_vi_ly_do_trung,\r\n \r\n      SUM(coalesce(lt.num_leads_status_tu_choi_loai_ly_do_trung,0)) as num_leads_status_tu_choi_loai_ly_do_trung,\r\n      SUM(coalesce(lt.num_leads_status_tu_choi,0)) as num_leads_status_tu_choi,\r\n\r\n      SUM(coalesce(tt.num_test_booked,0)) as num_test_booked,\r\n      SUM(coalesce(tt.num_test_completed,0)) as num_test_completed,\r\n\r\n      SUM(coalesce(ot.num_order_hoc_thu,0)) as num_order_hoc_thu,\r\n      SUM(coalesce(ot.num_order_ghi_danh_lan_dau,0)) as num_order_ghi_danh_lan_dau,      \r\n      SUM(coalesce(ot.rev_ghi_danh_lan_dau,0)) as rev_ghi_danh_lan_dau,   \r\n      \r\n\r\n\r\n       \r\nfrom lead_table lt\r\nfull join test_table tt on (lt.lead_date \u003d tt.test_date and lt.sale_id \u003d tt.sale_id and lt.trang_thai\u003dtt.trang_thai and lt.affiliate_campaign\u003dtt.affiliate_campaign and lt.affiliate_category\u003dtt.affiliate_category and lt.affiliate_email\u003dtt.affiliate_email and lt.subject_code\u003dtt.subject_code)  \r\nfull join order_table ot on (ot.order_date \u003d lt.lead_date and lt.sale_id \u003d ot.sale_id and lt.affiliate_campaign\u003dot.affiliate_campaign and lt.affiliate_category\u003dot.affiliate_category and lt.affiliate_email\u003dot.affiliate_email and lt.subject_code\u003dot.subject_code and lt.trang_thai\u003dot.trang_thai)\r\n-- where lt.lead_date \u003d \u00272025-02-02\u0027 or tt.test_date \u003d \u00272025-02-02\u0027 or ot.order_date \u003d \u00272025-02-02\u0027\r\ngroup by cal_date, sale_id, trang_thai ,affiliate_category,affiliate_email,affiliate_campaign,subject\r\norder by cal_date desc, trang_thai\r\n)\r\n\r\nselect r.*,\r\n      (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d r.sale_id) AS sale_follow_email,\r\n      (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d tsm.telesales_supervisor_id) AS sale_follow_supervisor_email,\r\nfrom result r\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr` tsm on tsm.telesales_id \u003d r.sale_id\r\n;"
}, {
  "table_name": "chat_luong_mkt_indo_ddec9cf4-aaf9-4327-adca-fee17318ca5e_fnbbjytktd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.chat_luong_mkt_indo_ddec9cf4-aaf9-4327-adca-fee17318ca5e_fnbbjytktd`\n(\n  cal_date DATE,\n  sale_id INT64,\n  trang_thai STRING,\n  affiliate_campaign STRING,\n  affiliate_category STRING,\n  affiliate_email STRING,\n  num_leads INT64,\n  num_leads_status_lien_he INT64,\n  num_leads_status_tu_van_tham_gia_onl_off INT64,\n  num_leads_status_coc_hen_tt INT64,\n  num_leads_status_tu_choi_vi_ly_do_trung INT64,\n  num_leads_status_tu_choi_loai_ly_do_trung INT64,\n  num_leads_status_tu_choi INT64,\n  num_order_ghi_danh_lai_tra_gop INT64,\n  rev_ghi_danh_lai_tra_gop FLOAT64,\n  sale_follow_email STRING,\n  sale_follow_supervisor_email STRING\n);"
}, {
  "table_name": "report_hoc_vien_kyna_55c3f5c6-1019-4863-9a9e-5f8da380b961",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hoc_vien_kyna_55c3f5c6-1019-4863-9a9e-5f8da380b961`\n(\n  courses STRING,\n  types STRING,\n  phone_number STRING,\n  international_phone_number STRING,\n  location_id INT64,\n  province STRING,\n  district STRING,\n  part_number INT64,\n  me_be_bought STRING\n);"
}, {
  "table_name": "tutoring_orders_old_new_classification",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.tutoring_orders_old_new_classification`\n(\n  order_id INT64,\n  invoice_code STRING,\n  order_type INT64,\n  order_type_sub INT64,\n  accounting_date TIMESTAMP,\n  phone_number STRING,\n  country_id INT64,\n  total_video_course NUMERIC,\n  total NUMERIC,\n  noi_dung_thanh_toan STRING,\n  source STRING,\n  program STRING,\n  program_type INT64,\n  order_status STRING,\n  payment_status STRING,\n  country STRING,\n  student_id INT64,\n  student_code STRING,\n  num_completed_orders_same_student INT64,\n  num_completed_orders_same_phone INT64,\n  is_current_month BOOL,\n  old_new_student STRING\n);"
}, {
  "table_name": "table_booking_cr_test_vn_market_618d3829-32d9-4f94-a171-9e0c92a7b1bd_2xm2rwe7xd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.table_booking_cr_test_vn_market_618d3829-32d9-4f94-a171-9e0c92a7b1bd_2xm2rwe7xd`\n(\n  lead_date DATE,\n  sale_follow STRING,\n  sale_follow_email STRING,\n  sale_follow_supervisor_email STRING,\n  affiliate_category STRING,\n  affiliate_email STRING,\n  num_chua_lien_he INT64,\n  num_dang_tu_van INT64,\n  num_moi_test INT64,\n  num_tu_choi INT64,\n  num_chua_lien_he_10h INT64,\n  num_dang_tu_van_10h INT64,\n  num_moi_test_10h INT64,\n  num_tu_choi_10h INT64,\n  num_chua_lien_he_15h INT64,\n  num_dang_tu_van_15h INT64,\n  num_moi_test_15h INT64,\n  num_tu_choi_15h INT64\n);"
}, {
  "table_name": "telemarketing_52312e63-9f7a-4948-9fdf-8ccf1e9bbe1_3mkqifaftd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.telemarketing_52312e63-9f7a-4948-9fdf-8ccf1e9bbe1_3mkqifaftd`\n(\n  utm_campaign STRING,\n  phone_number STRING,\n  order_id INT64,\n  invoice_code STRING,\n  affiliate_email STRING,\n  ngay_tao_gan_nhat DATE,\n  bonus INT64,\n  revenue FLOAT64\n);"
}, {
  "table_name": "temp_sales_bosungthongtin",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_sales_bosungthongtin`\n(\n  invoice_code STRING,\n  student_code STRING\n);"
}, {
  "table_name": "last_month_adjustment_2862ec0a-fad6-4df4-bc51-ae0f9312f33e",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.last_month_adjustment_2862ec0a-fad6-4df4-bc51-ae0f9312f33e`\n(\n  year_month STRING,\n  teacher_id INT64,\n  adjustment_booking_income NUMERIC,\n  num_fs2 INT64,\n  num_fs2_after INT64,\n  adjustment_total_hv_fs2 INT64,\n  adjustment_total_fs2 INT64,\n  total_cancel_booking INT64,\n  total_cancel_booking_after INT64,\n  adjustment_total_cancel_booking INT64,\n  adjustment_cancel_income INT64,\n  country STRING,\n  num_days_ghb_plus INT64,\n  ghb_plus INT64,\n  num_days_ghb_plus_after INT64,\n  ghb_plus_after INT64,\n  adjustment_num_days_ghb_plus INT64,\n  num_days_ghb INT64,\n  ghb INT64,\n  num_days_ghb_after INT64,\n  ghb_after INT64,\n  adjustment_num_days_ghb INT64,\n  adjustment_ghb_final INT64,\n  year INT64,\n  quarter INT64,\n  month INT64,\n  total_hv_fsq INT64,\n  total_fsq INT64,\n  total_hv_fsq_after INT64,\n  total_fsq_after INT64,\n  adjustment_total_hv_fsq INT64,\n  adjustment_total_fsq_income INT64,\n  last_month_adjustment_calculated NUMERIC,\n  teacher_name STRING,\n  teacher_email STRING,\n  tc_in_charge STRING,\n  quoc_tich STRING,\n  teacher_source STRING,\n  status STRING\n);"
}, {
  "table_name": "db_commission_0500ce26-e8b0-44c9-a20b-615c5c76b500_qs9gp2wktd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.db_commission_0500ce26-e8b0-44c9-a20b-615c5c76b500_qs9gp2wktd`\n(\n  ngay_hach_toan TIMESTAMP,\n  invoice_code STRING,\n  currency_exchange_rate FLOAT64,\n  total NUMERIC,\n  total_amount FLOAT64,\n  total_amount_vnd FLOAT64,\n  price_vnd FLOAT64,\n  loai_don STRING,\n  loai_hoc_vien STRING,\n  student_type STRING,\n  payment_content STRING,\n  payment_content_id INT64,\n  affiliate_id INT64,\n  country_id INT64,\n  affiliate_email STRING,\n  loai_affiliate STRING,\n  affiliate_category_id INT64,\n  nguon_affiliate STRING,\n  source_id INT64,\n  bd_incharge STRING,\n  lan_thanh_toan STRING,\n  aff_commission_status STRING,\n  affiliate_commission_percent_bonus FLOAT64,\n  hoa_hong_vnd FLOAT64,\n  quoc_gia STRING,\n  percent FLOAT64\n);"
}, {
  "table_name": "duo_program_management_76067fbe-e59d-4989-a4d9-638012afe5bb_tudtsfg4vd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.duo_program_management_76067fbe-e59d-4989-a4d9-638012afe5bb_tudtsfg4vd`\n(\n  room_1_booking_id INT64,\n  booking_date DATE,\n  student_id INT64,\n  student_code STRING,\n  student_country_id INT64,\n  room_1_teacher_id INT64,\n  teacher_room_1_country_id INT64,\n  teacher_cost_oc_room_1 NUMERIC,\n  teacher_cost_vnd_room_1 FLOAT64,\n  revenue_vnd FLOAT64,\n  room_2_booking_id INT64,\n  teacher_cost_vnd_room_2 FLOAT64,\n  teacher_cost_vnd_room_2_revised FLOAT64,\n  num_students_room_2 INT64,\n  teacher_cost_vnd_room_2_all_students FLOAT64,\n  room_2_teacher_id INT64,\n  teacher_cost_vnd_2_rooms FLOAT64,\n  teacher_cost_vnd_2_rooms_revised FLOAT64,\n  teacher_room_2_country_id INT64\n);"
}, {
  "table_name": "affiliates_a6831258-06fb-4882-ac94-882ec995c543",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.affiliates_a6831258-06fb-4882-ac94-882ec995c543`\n(\n  affiliate_id INT64,\n  affiliate_email STRING,\n  phone_number STRING,\n  country STRING,\n  source STRING,\n  db_incharge_email STRING,\n  ngay_hoach_toan INT64,\n  ngay_tham_gia DATE,\n  so_don_ghi_danh_lan_dau INT64,\n  so_don_ghi_danh_lai INT64,\n  doanh_thu FLOAT64,\n  hoa_hong FLOAT64,\n  ngay_affiliate_dem_du_lieu_dau_tien DATE,\n  ngay_affiliate_dem_lai_don_hang_dau_tien DATE,\n  ngay_co_lead_gan_nhat DATE,\n  loai_affiliate STRING\n);"
}, {
  "table_name": "report_so_luong_gv_tieng_anh_468ec3fd-a8cf-4796-9916-330e4359e503",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_so_luong_gv_tieng_anh_468ec3fd-a8cf-4796-9916-330e4359e503`\n(\n  interview_date DATE,\n  acceptance_date DATE,\n  teacher_id INT64,\n  teacher_name STRING,\n  teacher_country STRING,\n  teacher_source INT64,\n  teaching_training_date DATE,\n  test_training_date DATE,\n  training_status_id INT64,\n  status_id INT64,\n  contract_status_id INT64,\n  contract_completion_date DATE,\n  deactivate_date DATE,\n  is_tester INT64,\n  is_math_teacher_or_tester INT64,\n  tc_email STRING,\n  check_completed_booking_in_range INT64,\n  num_completed_booking_in_range INT64,\n  is_auto_repeat_calendar INT64,\n  training_status STRING,\n  contract_status STRING,\n  source STRING,\n  status STRING,\n  least_training_date DATE,\n  greatest_training_date DATE,\n  first_month_completed_bookings INT64,\n  reactivated_date DATE,\n  num_reactivate INT64,\n  ready_to_teach_date DATE,\n  reactivate_contract_completion_date DATE,\n  booked_training_date DATE,\n  num_contracts INT64,\n  max_contract_send_date INT64,\n  num_reactivated_contracts INT64,\n  max_reactivated_contract_send_date INT64,\n  acceptance_or_reactivated_date DATE,\n  contract_sign_status_id INT64,\n  reactivated_contract_sign_status_id INT64,\n  is_trained STRING,\n  is_contract_sign STRING,\n  is_reactivated_contract_sign STRING,\n  normal_or_reactivated STRING,\n  reactivated_qualified_to_teach_date DATE,\n  final_contract_completion_date DATE,\n  num_days_to_be_qualified_to_teach INT64,\n  status_contract_sign STRING,\n  status_reactivated_contract_sign STRING,\n  num_days_to_be_qualified_to_teach_reactivated INT64,\n  final_num_days_to_be_qualified_to_teach INT64,\n  final_is_contract_sign STRING,\n  final_qualified_to_teach_date DATE,\n  first_booking_date DATE,\n  final_status_contract_sign STRING,\n  num_days_to_first_booking_date INT64,\n  first_booking_in_range_date DATE,\n  num_completed_bookings_first_30_days_after_qualifying INT64\n);"
}, {
  "table_name": "report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_9173uprbtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_9173uprbtd`\n(\n  booking_id INT64,\n  teacher_id INT64,\n  begin_at TIMESTAMP,\n  duyet_booking INT64,\n  ops_teacher_email STRING,\n  teacher_name STRING,\n  country_id INT64,\n  country_id_hv INT64,\n  t_source INT64,\n  program STRING,\n  mon_hoc STRING,\n  loai_hoc_vien STRING,\n  danh_gia STRING,\n  khong_dat INT64,\n  duoi_chuan INT64,\n  no_pay INT64,\n  no_pay_base_rate INT64,\n  no_show INT64,\n  teacher_open_webcam_time_less_70 STRING,\n  percent_open_camera_time INT64,\n  percent_time_teacher_full_face_less_70 STRING,\n  percent_full_face_time INT64,\n  teacher_taking_less_20 STRING,\n  percent_teacher_talking_time INT64,\n  access_time_gv INT64,\n  teacher_vao_lop_tre STRING,\n  teacher_note_tre STRING,\n  teacher_khong_note STRING,\n  access_time_hv INT64,\n  warning INT64,\n  warning_details STRING,\n  teacher_email STRING,\n  teacher_country STRING,\n  teacher_source STRING,\n  student_country STRING\n);"
}, {
  "table_name": "fixed_schedule_bonus_ec36f78c-7afc-400d-8d70-e3efb41afba6_3l8pyxvktd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.fixed_schedule_bonus_ec36f78c-7afc-400d-8d70-e3efb41afba6_3l8pyxvktd`\n(\n  year_begin_at INT64,\n  month_begin_at INT64,\n  teacher_id INT64,\n  student_id INT64,\n  student_code STRING,\n  total_booking INT64,\n  teacher_name STRING,\n  tc_in_charge STRING\n);"
}, {
  "table_name": "telemarketing_52312e63-9f7a-4948-9fdf-8ccf1e9bbe11_4tekt0t9sd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.telemarketing_52312e63-9f7a-4948-9fdf-8ccf1e9bbe11_4tekt0t9sd`\n(\n  ngay_tao DATE,\n  ho_va_ten STRING,\n  phone_number STRING,\n  sale_email STRING,\n  affiliate_email STRING,\n  affiliate_campaign STRING,\n  is_blocked STRING,\n  status STRING,\n  reason_cancel STRING\n);"
}, {
  "table_name": "thu_nhap_ops_5c194737-88de-48ca-93f4-552714c5f803_qvcc8i5ptd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.thu_nhap_ops_5c194737-88de-48ca-93f4-552714c5f803_qvcc8i5ptd`\n(\n  year_month STRING,\n  ops_manager_email STRING,\n  email_ops STRING,\n  name_ops STRING,\n  completed_booking_number INT64,\n  booking_number_filter STRING,\n  student_number_1_to_6_booking INT64,\n  student_number_7_to_12_booking INT64,\n  student_number_13_to_18_booking INT64,\n  student_number_over_19 INT64\n);"
}, {
  "table_name": "gge_instructor_e130188b-2ff9-4aa5-9525-9461e848ebfb_1uwez9gitd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.gge_instructor_e130188b-2ff9-4aa5-9525-9461e848ebfb_1uwez9gitd`\n(\n  teacher_month STRING,\n  teacher_name STRING,\n  teacher_email STRING,\n  taught_25p INT64,\n  income_taught_25p NUMERIC,\n  income_taught_test_1ca NUMERIC,\n  taught_test_1ca INT64,\n  income_taught_45p NUMERIC,\n  taught_45p INT64,\n  income_taught_60p NUMERIC,\n  taught_60p INT64,\n  income_taught_extra NUMERIC,\n  taught_extra INT64,\n  income_taught_test_2ca NUMERIC,\n  taught_test_2ca INT64,\n  class_income NUMERIC,\n  adjust_by_booking_claim NUMERIC,\n  total_plus INT64,\n  is_hour STRING,\n  hour_bonus INT64,\n  other_adjust NUMERIC\n);"
}, {
  "table_name": "booking_session_row_count_history",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.booking_session_row_count_history`\n(\n  snapshot_date DATE,\n  table_name STRING,\n  historical_date DATE,\n  week_day_abbr STRING,\n  row_count INT64\n);"
}, {
  "table_name": "report_giai_bai_tap_5c87d591-0987-4853-a63a-21fc74a6c2b2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_giai_bai_tap_5c87d591-0987-4853-a63a-21fc74a6c2b2`\n(\n  created_at DATE,\n  phone_number STRING,\n  order_code STRING,\n  subscription_name STRING,\n  subscription_price INT64,\n  package_name STRING,\n  student_code STRING,\n  student_id INT64,\n  student_name STRING,\n  sales_email STRING,\n  num_completed_study_club INT64,\n  type STRING,\n  expired_date DATE\n);"
}, {
  "table_name": "temp_hoc_vien_kbc_thang_7_phase_2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_hoc_vien_kbc_thang_7_phase_2`\n(\n  student_id INT64,\n  student_code STRING,\n  num_bookings_to_map INT64\n);"
}, {
  "table_name": "kyna_duo_math1_support",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.kyna_duo_math1_support`\n(\n  teacher_id INT64,\n  program STRING\n);"
}, {
  "table_name": "ceo_ghi_danh_lai_INDO_view_temp",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.ceo_ghi_danh_lai_INDO_view_temp`\nAS with general_table as (\r\nSELECT\r\n  -- CAST(FORMAT_TIMESTAMP(\"%d/%m/%Y\", (bl.created_at)) AS STRING) AS register_created\r\n    bl.id\r\n  , bl.status\r\n  , bl.utm_campaign as affiliate_campaign\r\n  , bl.reason_cancel_id\r\n  , bl.created_at\r\n  , bo.invoice_code\r\n  , bo.payment_content\r\n  , bo.total\r\n  , bo.payment_status\r\n  , bo.status as booking_order_status\r\n  , bo.discount_money\r\n  , bo.currency_exchange_rate\r\n  , date(bo.created_at) as order_date\r\n \r\n  , `kynaforkids-server-production.kynaforkids.func_get_booking_lead_status`(bl.status) as lead_status\r\n  , (select ac.name from `kynaforkids-server-production.kynaforkids.affiliate_category` ac,\r\n    `kynaforkids-server-production.kynaforkids.affiliate_user` au where au.affiliate_id \u003d bl.affiliate_id and au.affiliate_category_id \u003d ac.id) as affiliate_category\r\n  , (select u.email from `kynaforkids-server-production.kynaforkids.affiliate_user` au,\r\n    `kynaforkids-server-production.kynaforkids.user` u where au.affiliate_id \u003d bl.affiliate_id and u.id \u003d au.user_id ) as affiliate_email\r\n  , (SELECT max(p.name) FROM `kynaforkids-server-production.kynaforkids.profile` p WHERE p.user_id \u003d bl.sale_id) AS sale_follow\r\n    , (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d bl.sale_id) AS sale_follow_email\r\n  -- ngaltt start\r\n    ,(SELECT max(p.name) FROM `kynaforkids-server-production.kynaforkids.profile` p WHERE p.user_id \u003d tsm.telesales_supervisor_id) AS sale_follow_supervisor\r\n  , (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d tsm.telesales_supervisor_id) AS sale_follow_supervisor_email,\r\n\r\n    -- (select date(bsn.begin_at)\r\n    -- from `kynaforkids-server-production.kynaforkids.booking_session_new` bsn\r\n    -- where bsn.id \u003d bl.booking_test_id) as test_date,\r\n\r\n    bl.booking_test_id,\r\n    bl.sale_id,\r\n    -- (select bsn.status_id,\r\n    -- from `kynaforkids-server-production.kynaforkids.booking_session_new` bsn\r\n    -- where bsn.id \u003d bl.booking_test_id) as booking_test_status\r\n\r\n    -- ngaltt start\r\n `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(bo.payment_content) AS loai_don_hang\r\n, IF(bo.payment_content \u003d 1, 1, 0) as hoc_thu\r\n, IF(bo.payment_content \u003d 2, 1, 0) as ghi_danh_lan_dau\r\n, IF(bo.payment_content \u003d 3, 1, 0) as tra_gop_lan_sau\r\n, IF(bo.payment_content \u003d 4, 1, 0) as ghi_danh_lai\r\n, (CASE WHEN bl.upsell \u003d 1 THEN \u0027Upsell\u0027 ELSE \u0027Lead\u0027 END) AS loai_lead\r\n, (CASE WHEN bl.is_blocked \u003d 0 THEN \u0027Open\u0027  ELSE \u0027Blocked\u0027 END) AS trang_thai\r\n    -- ngaltt end\r\n, if((select max(u.id) from `kynaforkids-server-production.kynaforkids.user` u,\r\n  (select parent_id from `kynaforkids-server-production.kynaforkids.booking_student` bst, `kynaforkids-server-production.kynaforkids.user` u where u.id \u003d bst.user_id and bst.is_user_test !\u003d 1) t1\r\n  where u.id \u003d t1.parent_id and u.phone_number \u003d bl.intl_phone_number) is null, \u0027Chưa là HV\u0027, \u0027Đã là HV\u0027) as HV_Yes_No\r\n, case\r\n    when bl.subject_code \u003d \u0027EK\u0027 then \u0027Tiếng Anh trẻ em\u0027\r\n    when bl.subject_code \u003d \u0027EA\u0027 then \u0027Tiếng Anh người lớn\u0027\r\n    when bl.subject_code \u003d \u0027M\u0027 then \u0027Toán\u0027\r\n    when bl.subject_code \u003d \u0027C\u0027 then \u0027Group Class\u0027\r\n    when bl.subject_code \u003d \u0027AI\u0027 then \u0027AI Tutor\u0027\r\n    when bl.subject_code \u003d \u0027AI-PRE\u0027 then \u0027AI Tutor Premium\u0027\r\n  end as subject_code\r\nFROM `kynaforkids-server-production.kynaforkids.booking_lead_view` bl\r\n-- ngaltt start\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr` tsm on tsm.telesales_id \u003d bl.sale_id\r\n-- ngaltt end\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_order_view` bo ON bl.id \u003d bo.lead_id\r\n-- LEFT JOIN `kynaforkids-server-production.kynaforkids.auth_assignment` aa ON aa.user_id \u003d bl.sale_id\r\nWHERE bl.country_id \u003d 2\r\n-- AND aa.item_name IN(\u0027Telesales\u0027, \u0027Lead Telesales\u0027,\u0027SALE - Manager\u0027,\u0027SALE - Telesales - Staff\u0027,\u0027SALE - Telesales Supervisor\u0027)\r\nAND bl.Upsell \u003d 1\r\n),\r\n\r\nlead_table as\r\n(\r\nselect \r\n        date(created_at) as lead_date, \r\n        sale_id,\r\n        affiliate_campaign, affiliate_category, affiliate_email,\r\n        trang_thai,\r\n        count(distinct id) as num_leads,   \r\n\r\n      SUM(\r\n            if(status in (6,12),1,0)\r\n        ) as num_leads_status_lien_he,\r\n      \r\n      SUM(\r\n          if(reason_cancel_id in (\u002720\u0027) and status in (9),1,0)\r\n      ) as num_leads_status_tu_choi_vi_ly_do_trung,\r\n\r\n      SUM(\r\n            if(status in (3,4,5),1,0)\r\n        ) as num_leads_status_tu_van_tham_gia_onl_off,\r\n      SUM(\r\n            if(status in (21,22),1,0)\r\n        ) as num_leads_status_coc_hen_tt,\r\n      SUM(\r\n          if(reason_cancel_id not in (\u002720\u0027) and status in (9),1,0)\r\n      ) as num_leads_status_tu_choi_loai_ly_do_trung,\r\n      SUM(\r\n            if(status in (9),1,0)\r\n        ) as num_leads_status_tu_choi\r\nfrom general_table\r\nwhere date(created_at) \u003e\u003d \u00272024-01-01\u0027\r\n  -- and date(created_at) \u003e\u003d \u00272025-01-20\u0027\r\n  group by lead_date, sale_id, trang_thai, affiliate_campaign, affiliate_category, affiliate_email\r\n  order by lead_date desc\r\n),\r\n\r\norder_info as (\r\nselect \r\n        bo.invoice_code,\r\n        bo.created_by as sale_id,\r\n        bo.payment_content,\r\n        bo.total,\r\n        bo.total_video_course,\r\n        bo.payment_status,\r\n        bo.status,\r\n        bo.discount_money,\r\n        bo.currency_exchange_rate,\r\n        date(bo.created_at) as order_date,\r\n        bl.utm_campaign as affiliate_campaign,\r\n        (select ac.name from `kynaforkids-server-production.kynaforkids.affiliate_category` ac,\r\n          `kynaforkids-server-production.kynaforkids.affiliate_user` au where au.affiliate_id \u003d bl.affiliate_id and au.affiliate_category_id \u003d ac.id) as affiliate_category,\r\n         (select u.email from `kynaforkids-server-production.kynaforkids.affiliate_user` au,\r\n           `kynaforkids-server-production.kynaforkids.user` u where au.affiliate_id \u003d bl.affiliate_id and u.id \u003d au.user_id ) as affiliate_email,\r\n        case\r\n          when bl.subject_code \u003d \u0027EK\u0027 then \u0027Tiếng Anh trẻ em\u0027\r\n          when bl.subject_code \u003d \u0027EA\u0027 then \u0027Tiếng Anh người lớn\u0027\r\n          when bl.subject_code \u003d \u0027M\u0027 then \u0027Toán\u0027\r\n          when bl.subject_code \u003d \u0027C\u0027 then \u0027Group Class\u0027\r\n          when bl.subject_code \u003d \u0027AI\u0027 then \u0027AI Tutor\u0027\r\n          when bl.subject_code \u003d \u0027AI-PRE\u0027 then \u0027AI Tutor Premium\u0027\r\n        end as subject_code,\r\n        bo.lead_id,\r\n\r\nfrom `kynaforkids.booking_order_view` bo\r\nleft join `kynaforkids.booking_lead` bl on bl.id \u003d bo.lead_id\r\nwhere bo.status in (4) and bo.payment_status in (0,1,3,4)\r\n      and bo.international_country_id \u003d 2\r\n),\r\n\r\norder_table as\r\n(\r\nselect\r\n        order_date,\r\n        order_info.sale_id,\r\n        \u0027Open\u0027 as trang_thai,\r\n        affiliate_campaign, affiliate_category, affiliate_email,\r\n\r\n        string_agg(CAST(lead_id AS STRING)) as lead_ids,\r\n        string_agg(invoice_code) as invoices,      \r\n\r\n\r\n\r\n       SUM(\r\n            if(payment_content in (3,4), 1,0)\r\n        ) as num_order_ghi_danh_lai_tra_gop,\r\n\r\n\r\n        SUM(\r\n            if(payment_content in (3,4), round((coalesce(total,0) + coalesce(total_video_course,0) - coalesce(discount_money,0))*currency_exchange_rate),0)\r\n        ) as rev_ghi_danh_lai_tra_gop,\r\n\r\n\r\nfrom order_info\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr` tsm on tsm.telesales_id \u003d order_info.sale_id\r\n\r\nwhere order_date \u003e\u003d \u00272024-01-01\u0027\r\n  -- and order_date \u003e\u003d \u00272025-01-20\u0027\r\n  group by order_date,sale_id, trang_thai, affiliate_campaign, affiliate_category, affiliate_email\r\n  order by order_date desc\r\n),\r\n\r\n\r\nresult as (\r\nselect\r\n      coalesce(ot.order_date, lt.lead_date) as cal_date,\r\n      coalesce(ot.sale_id,lt.sale_id) as sale_id,\r\n      coalesce(ot.trang_thai, lt.trang_thai) as trang_thai,\r\n      coalesce(ot.affiliate_campaign, lt.affiliate_campaign) as affiliate_campaign,\r\n      coalesce(ot.affiliate_category,lt.affiliate_category) as affiliate_category,\r\n      coalesce(ot.affiliate_email, lt.affiliate_email) as affiliate_email,  \r\n\r\n      SUM(coalesce(lt.num_leads,0)) as num_leads,\r\n      SUM(coalesce(lt.num_leads_status_lien_he,0)) as num_leads_status_lien_he,\r\n      SUM(coalesce(lt.num_leads_status_tu_van_tham_gia_onl_off,0)) as num_leads_status_tu_van_tham_gia_onl_off,\r\n      SUM(coalesce(lt.num_leads_status_coc_hen_tt,0)) as num_leads_status_coc_hen_tt,\r\n      SUM(coalesce(lt.num_leads_status_tu_choi_vi_ly_do_trung,0)) as num_leads_status_tu_choi_vi_ly_do_trung,\r\n \r\n      SUM(coalesce(lt.num_leads_status_tu_choi_loai_ly_do_trung,0)) as num_leads_status_tu_choi_loai_ly_do_trung,\r\n      SUM(coalesce(lt.num_leads_status_tu_choi,0)) as num_leads_status_tu_choi,\r\n\r\n      -- SUM(coalesce(tt.num_test_booked,0)) as num_test_booked,\r\n      -- SUM(coalesce(tt.num_test_completed,0)) as num_test_completed,\r\n\r\n      -- SUM(coalesce(ot.num_order_hoc_thu,0)) as num_order_hoc_thu,\r\n      SUM(coalesce(ot.num_order_ghi_danh_lai_tra_gop,0)) as num_order_ghi_danh_lai_tra_gop,      \r\n      SUM(coalesce(ot.rev_ghi_danh_lai_tra_gop,0)) as rev_ghi_danh_lai_tra_gop,   \r\n      \r\n\r\n\r\n       \r\nfrom lead_table lt\r\nfull join order_table ot on (ot.order_date \u003d lt.lead_date and lt.sale_id \u003d ot.sale_id and lt.affiliate_campaign\u003dot.affiliate_campaign and lt.affiliate_category\u003dot.affiliate_category and lt.affiliate_email\u003dot.affiliate_email and lt.trang_thai\u003dot.trang_thai)\r\ngroup by cal_date, sale_id, trang_thai, affiliate_campaign, affiliate_category, affiliate_email \r\norder by cal_date desc, trang_thai, affiliate_campaign, affiliate_category, affiliate_email\r\n)\r\n\r\nselect r.*,\r\n      (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d r.sale_id) AS sale_follow_email,\r\n      (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d tsm.telesales_supervisor_id) AS sale_follow_supervisor_email,\r\nfrom result r\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr` tsm on tsm.telesales_id \u003d r.sale_id\r\n;"
}, {
  "table_name": "temp_hoc_vien_kbc_thang_8_phase_6_draft",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_hoc_vien_kbc_thang_8_phase_6_draft`\n(\n  student_id INT64,\n  student_code STRING,\n  num_bookings_to_map INT64,\n  num_august_remaining_draft_bookings INT64\n);"
}, {
  "table_name": "temp_hoc_vien_kbc_thang_8_phase_4",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_hoc_vien_kbc_thang_8_phase_4`\n(\n  student_id INT64,\n  student_code STRING,\n  num_bookings_to_map INT64\n);"
}, {
  "table_name": "report_so_luong_gv_tieng_anh_468ec3fd-a8cf-4796-9916-330e4359e503_s9nd2kt6sd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_so_luong_gv_tieng_anh_468ec3fd-a8cf-4796-9916-330e4359e503_s9nd2kt6sd`\n(\n  teacher_id INT64,\n  training_status INT64,\n  status INT64,\n  ops_teacher_id INT64,\n  contract_status INT64,\n  country_id INT64,\n  acceptance_date DATE,\n  teacher_source INT64,\n  deactivate_date DATE,\n  teacher_name STRING,\n  tc_termination_id INT64,\n  check_tc INT64,\n  tm_terminal_date DATE,\n  btcu_terminal_date DATE,\n  reason_of_termination STRING,\n  role_approve STRING,\n  check_deactivate_date INT64,\n  status_of_training STRING,\n  source_of_teacher STRING,\n  status_1 STRING,\n  tc_email STRING,\n  tc_as_of_termination_email STRING,\n  teacher_country STRING\n);"
}, {
  "table_name": "group_class_chenh_lech_khac_new",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.group_class_chenh_lech_khac_new`\n(\n  Ngay_hach_toan DATE,\n  ma_hv STRING,\n  email STRING,\n  phone_number STRING,\n  program_name STRING,\n  country STRING,\n  chenh_lech_khac_NT FLOAT64,\n  chenh_lech_khac FLOAT64\n);"
}, {
  "table_name": "murpher_instructor_1-1_5e46753b-94ad-431c-b1c1-c4ca786e753b_i5plb57ipd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.murpher_instructor_1-1_5e46753b-94ad-431c-b1c1-c4ca786e753b_i5plb57ipd`\n(\n  teacher_country STRING,\n  teacher_status STRING,\n  teacher_day DATE,\n  teacher_month STRING,\n  teacher_id INT64,\n  teacher_name STRING,\n  teacher_email STRING,\n  country_id INT64,\n  status INT64,\n  total_bookings INT64,\n  booking_booked INT64,\n  taught_test_1ca INT64,\n  taught_test_2ca INT64,\n  taught_25p INT64,\n  taught_45p INT64,\n  taught_60p INT64,\n  taught_60p_new INT64,\n  taught_90p INT64,\n  reject_bookings INT64,\n  bellow_standard_bookings INT64,\n  no_pay_bookings INT64,\n  approved_cancel_bookings INT64,\n  penalty_cancel_bookings INT64,\n  penalty_cancel_bookings_25m INT64,\n  penalty_cancel_bookings_45m INT64,\n  penalty_cancel_bookings_60m INT64,\n  penalty_cancel_bookings_90m INT64,\n  Cancellations_with_50_compensation INT64,\n  Cancellations_with_100_compensation INT64,\n  lop_50_compensation_25p INT64,\n  lop_50_compensation_45_50p INT64,\n  lop_100_compensation_25p INT64,\n  lop_100_compensation_45_50p INT64,\n  Nopay_25p INT64,\n  Nopay_45_50p INT64,\n  Nopay_60p INT64,\n  Nopay_60p_new INT64,\n  Nopay_90p INT64,\n  Nopay_test_25p INT64,\n  Nopay_test_45_50p INT64,\n  teacher_care_name STRING,\n  free_slots INT64,\n  booked_slots INT64,\n  total_open_slots INT64,\n  total_ajust NUMERIC\n);"
}, {
  "table_name": "potential_economy_package_students_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.potential_economy_package_students_view`\nAS with \r\ntarget_student_1 AS (\r\nSELECT bs.user_id, bs.student_code, \r\n      --  bsp.program_id,\r\n       count(distinct bsn.id) as num_completed_bookings, \r\nFROM `kynaforkids-server-production.kynaforkids.booking_student` bs\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_session_student` bssn\r\n        ON (bs.user_id \u003d bssn.student_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_student_program` bsp\r\n        ON (bsp.user_id \u003d bs.user_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_session_view` bsn\r\n        ON (bssn.booking_session_id \u003d bsn.id and bsp.program_id \u003d bsn.program_id)\r\n\r\nWHERE bs.is_user_test \u003d 0\r\n      and bs.country_id \u003d 3\r\n      and bsp.program_id not in (select bp.id from `kynaforkids.booking_program` bp where bp.type in (2,3,4) or bp.program_type in (2) or bp.program_model in (2) or bp.number_of_shift in (1,3,4))\r\n      and bsp.program_id not in (3,106,107,108,109,110,111,112)\r\n      AND bsn.status_id in (4,5)\r\n      And bsn.program_id not in (select bp.id from `kynaforkids.booking_program` bp where bp.type in (2,3,4) or bp.program_type in (2) or bp.program_model in (2) or bp.number_of_shift in (1,3,4))\r\n      and bsn.program_id not in (3,106,107,108,109,110,111,112)\r\n      AND cast(bsn.begin_at as datetime) \u003c current_datetime(\"UTC+7\")     \r\n      --AND (date(bsn.begin_at) \u003e\u003d \u00272024-10-01\u0027 AND date(bsn.begin_at) \u003c\u003d \u00272024-10-31\u0027) \r\nGROUP BY bs.user_id, bs.student_code--, bsp.program_id\r\n),\r\n\r\n-- Tính tổng số lesson còn lại của học sinh ở các chương trình mà học sinh đang học với các ràng buộc như trên \r\nremaining_bookings_program AS (\r\nSELECT bs.user_id, bs.student_code, bsp.program_id,\r\n       max(coalesce(bsp.remain_lesson,0)) as bookings_program_remain\r\nFROM `kynaforkids-server-production.kynaforkids.booking_student` bs\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_student_program` bsp ON (bsp.user_id \u003d bs.user_id)\r\nWHERE bs.is_user_test \u003d 0 \r\n      and bsp.program_id not in (select bp.id from `kynaforkids.booking_program` bp where bp.type in (2,3,4) or bp.program_type in (2) or bp.program_model in (2) or bp.number_of_shift in (1,3,4))\r\n      and bsp.program_id not in (3,106,107,108,109,110,111,112)\r\n\r\nGROUP BY bs.user_id, bs.student_code, bsp.program_id\r\n),\r\n\r\n-- Tính số booking đã được chạy ở các trạng thái draft, new, waiting approve, approved (lấy ở ngày hiện tại trở đi)\r\nremaining_bookings_booked AS (\r\nSELECT \r\n      bs.user_id, \r\n      bs.student_code, \r\n      bsp.program_id, \r\n      count(distinct bsn.id) as bookings_booked\r\nFROM `kynaforkids-server-production.kynaforkids.booking_student` bs\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_student_program` bsp ON (bsp.user_id \u003d bs.user_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_session_student` bssn\r\n        ON (bs.user_id \u003d bssn.student_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_session_view` bsn\r\n        ON (bssn.booking_session_id \u003d bsn.id and bsp.program_id \u003d bsn.program_id)\r\nWHERE bs.is_user_test \u003d 0 \r\n      AND bsn.status_id in (1,2,3,4)\r\n      and bsn.program_id not in (select bp.id from `kynaforkids.booking_program` bp where bp.type in (2,3,4) or bp.program_type in (2) or bp.program_model in (2) or bp.number_of_shift in (1,3,4))\r\n      and bsn.program_id not in (3,106,107,108,109,110,111,112)\r\n      AND cast(bsn.begin_at as datetime) \u003e current_datetime(\"UTC+7\")\r\nGROUP BY bs.user_id, bs.student_code, bsp.program_id\r\n),\r\n\r\n-- Tính tổng số booking còn lại của học viên (lấy 2 số trên cộng lại với nhau)\r\nremaining_bookings AS (\r\nSELECT rbp.user_id, rbp.student_code, --rbp.program_id,-- rbp.program_name, \r\n       max(rbp.bookings_program_remain) + max(coalesce(rbb.bookings_booked,0)) as total_remaining_lessons,\r\n       --`kynaforkids-server-production.kynaforkids.func_get_student_name_from_profile_by_student_id`(rbp.user_id) as student_name \r\nFROM remaining_bookings_program rbp\r\nLEFT JOIN remaining_bookings_booked rbb ON(rbp.user_id \u003d rbb.user_id AND rbp.program_id \u003d rbb.program_id)\r\nWHERE rbp.program_id not in (select bp.id from `kynaforkids.booking_program` bp where bp.type in (2,3,4) or bp.program_type in (2) or bp.program_model in (2) or bp.number_of_shift in (1,3,4))\r\n      and rbp.program_id not in (3,106,107,108,109,110,111,112)\r\n\r\nGROUP BY rbp.user_id, rbp.student_code--, rbp.program_id\r\n),\r\n\r\n-- Ghép các bảng trên để có bảng target_students\r\ntarget_students AS\r\n(\r\nSELECT \r\n      ts1.*, \r\n      --rb.program_name, rb.subject, \r\n      rb.total_remaining_lessons,  \r\nFROM target_student_1 ts1\r\nLEFT JOIN remaining_bookings rb ON(ts1.user_id \u003d rb.user_id) --AND ts1.program_id \u003d rb.program_id)\r\nwhere rb.total_remaining_lessons \u003e 0\r\n),\r\n\r\ntemp_result AS \r\n(\r\nSELECT ts.*,   -- student code, số buổi còn lại\r\n       `kynaforkids-server-production.kynaforkids.func_get_student_phone_number`(ts.user_id) as phone_number,\r\n       (select user_type_id from `kynaforkids.booking_student` bst where bst.student_code \u003d ts.student_code) as user_type_id, -- id của loại học viên\r\n  \r\n        \r\nFROM target_students ts\r\n\r\n),\r\n\r\npotential_economy_package_student_booking_info AS\r\n(\r\nSELECT tr.* except(user_id),\r\n       tr.user_id as student_id,\r\n       `kynaforkids-server-production.kynaforkids.func_get_student_name_from_profile_by_student_id`(tr.user_id) as student_name,\r\n       case when tr.user_type_id \u003d 1 then \u0027Trẻ em\u0027\r\n            when tr.user_type_id \u003d 2 then \u0027Người lớn\u0027\r\n            else \"Chưa rõ\"\r\n       end as loai_hoc_vien,\r\n \r\nFROM temp_result tr\r\n-- left join  `kynaforkids.ops_manager` omn on omn.ops_id \u003d tr.ops_id\r\n)\r\n\r\nselect t.*,\r\n      case \r\n            when t.student_code in (select student_code from `datateam_kynaforkids.hieu_qua_ghep_lop_economy_0f2ad318-1e72-496a-9a5b-d7ecf36b7c11_y5nn10f0ud_2`) then \u0027Còn tham gia\u0027\r\n            when t.student_code in (select student_code from `datateam_kynaforkids.hieu_qua_ghep_lop_economy_0f2ad318-1e72-496a-9a5b-d7ecf36b7c11_y5nn10f0ud`) then \u0027Đã hủy\u0027\r\n            else \u0027Chưa đăng ký\u0027\r\n      end as economy_status\r\n\r\n      -- case when t2.student_code is not null then \u0027Còn tham gia\u0027\r\n      --      when t1.student_code is not null then \u0027\u0027\r\nfrom potential_economy_package_student_booking_info t\r\n-- left join `datateam_kynaforkids.hieu_qua_ghep_lop_economy_0f2ad318-1e72-496a-9a5b-d7ecf36b7c11_y5nn10f0ud` t1 on t.student_code\u003dt1.student_code\r\n-- left join  `datateam_kynaforkids.hieu_qua_ghep_lop_economy_0f2ad318-1e72-496a-9a5b-d7ecf36b7c11_y5nn10f0ud_2` t2 on t2.student_code\u003dt.student_code\r\n\r\n;"
}, {
  "table_name": "fixed_schedule_bonus_ec36f78c-7afc-400d-8d70-e3efb41afba6_6cwrccvktd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.fixed_schedule_bonus_ec36f78c-7afc-400d-8d70-e3efb41afba6_6cwrccvktd`\n(\n  year INT64,\n  quarter INT64,\n  teacher_id INT64,\n  student_id INT64,\n  student_code STRING,\n  total_booking INT64,\n  teacher_name STRING,\n  tc_in_charge STRING\n);"
}, {
  "table_name": "mkt_dieu_chinh_organic_fblines_93931ef4-def7-4955-99c7-ffeda394-03f3-4419-a5ae-36461591f7f9_imnytw0ltd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.mkt_dieu_chinh_organic_fblines_93931ef4-def7-4955-99c7-ffeda394-03f3-4419-a5ae-36461591f7f9_imnytw0ltd`\n(\n  calc_date DATE,\n  line_mkt STRING,\n  country_id INT64,\n  channel_id INT64,\n  product_id INT64,\n  spend INT64,\n  spend_with_tax FLOAT64,\n  num_leads FLOAT64,\n  num_leads_test FLOAT64,\n  num_leads_test_approved FLOAT64,\n  leads_wait_for_order FLOAT64,\n  num_orders FLOAT64,\n  order_value FLOAT64,\n  country STRING,\n  product_name STRING,\n  channel_name STRING\n);"
}, {
  "table_name": "table_booking_cr_test_15h15_lao_thai_market_a42d42d1-9892-4fa3-8dcb-a414a4afda63",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.table_booking_cr_test_15h15_lao_thai_market_a42d42d1-9892-4fa3-8dcb-a414a4afda63`\n(\n  ngay_tao_lead DATE,\n  sale_email STRING,\n  sale_manager_email STRING,\n  mon_hoc STRING,\n  country STRING,\n  affiliate_email STRING,\n  sale_name STRING,\n  sup_name STRING,\n  num_test_by_sic INT64,\n  num_test_by_sic_t1 INT64,\n  num_lead_t1 INT64,\n  num_lead_t1_1 INT64,\n  num_lead_t1_2 INT64\n);"
}, {
  "table_name": "thong_tin_gv_profile_9fe02a00-00f1-4e0d-89ed-a3d945a336ec",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.thong_tin_gv_profile_9fe02a00-00f1-4e0d-89ed-a3d945a336ec`\n(\n  user_id INT64,\n  contract_no STRING,\n  Ten STRING,\n  Email STRING,\n  PhoneNumber STRING,\n  Quoc_tich STRING,\n  TC_phu_trach STRING,\n  Trang_thai STRING,\n  Thoi_han_ket_thuc_HD DATE,\n  Trang_thai_ki_HD STRING,\n  booking_teacher_payment_method_id INT64,\n  Cam_ket_02 INT64,\n  payment_method STRING,\n  id_card STRING,\n  pp_picture_back STRING,\n  pp_picture_front STRING,\n  card_type STRING,\n  address STRING,\n  esign STRING,\n  tags_name STRING,\n  teacher_source STRING,\n  payment_method_id INT64,\n  ChuTK STRING,\n  SoTK STRING,\n  TenNganHang STRING,\n  Chinhanh STRING,\n  Swift_code STRING,\n  bank_address STRING,\n  iban_number STRING,\n  aba_routing_number STRING\n);"
}, {
  "table_name": "Thao_order_completed_tutoring_991cab41-304f-4c74-a83d-e774279b4008",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.Thao_order_completed_tutoring_991cab41-304f-4c74-a83d-e774279b4008`\n(\n  ngay_tao_don DATE,\n  ngay_duyet_don DATE,\n  ngay_tao_lead DATE,\n  invoice_code STRING,\n  ten_phu_huynh STRING,\n  email STRING,\n  name STRING,\n  student_code STRING,\n  phone_number STRING,\n  count_1 STRING,\n  accounting_date TIMESTAMP,\n  total_video_course NUMERIC,\n  total NUMERIC,\n  noi_dung_thanh_toan STRING,\n  source STRING,\n  program STRING,\n  order_status STRING,\n  payment_status STRING,\n  price NUMERIC,\n  currency_code STRING,\n  contract_code STRING,\n  duration INT64,\n  note STRING,\n  affiliate_campaign STRING,\n  landingpage_name STRING,\n  affiliate_id INT64,\n  affiliate_email STRING,\n  affiliate_type STRING,\n  currency_exchange_rate FLOAT64,\n  price_vnd FLOAT64,\n  country STRING,\n  total_lesson INT64,\n  nguoi_duyet STRING,\n  video_course_name STRING,\n  affiliate_emaill STRING,\n  loai_affiliate STRING,\n  thoi_gian_ghi_danh STRING,\n  map_don STRING,\n  order_type STRING,\n  total_video_vnd FLOAT64,\n  total_vnd FLOAT64,\n  total_nguyen_te NUMERIC\n);"
}, {
  "table_name": "duo_program_management_76067fbe-e59d-4989-a4d9-638012afe5bb_j0haeu89wd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.duo_program_management_76067fbe-e59d-4989-a4d9-638012afe5bb_j0haeu89wd`\n(\n  room_1_booking_id INT64,\n  room_1_booking_status STRING,\n  teacher_room_1_country STRING,\n  student_id INT64,\n  student_code STRING,\n  student_country_id INT64,\n  room_1_teacher_id INT64,\n  teacher_room_1_country_id INT64,\n  teacher_cost_oc_room_1 NUMERIC,\n  teacher_cost_vnd_room_1 FLOAT64,\n  revenue_vnd FLOAT64,\n  room_1_program STRING,\n  booking_date DATE,\n  num_students_room_2 STRING,\n  teacher_room_2_country STRING,\n  room_2_program STRING,\n  room_2_teacher_id STRING,\n  room_2_booking_id STRING,\n  room_2_booking_status STRING,\n  room_2_booking_rating STRING,\n  teacher_cost_vnd_room_2 FLOAT64,\n  teacher_cost_vnd_room_2_revised FLOAT64,\n  teacher_cost_vnd_room_2_all_students FLOAT64,\n  teacher_cost_vnd_2_rooms FLOAT64,\n  teacher_cost_vnd_2_rooms_revised FLOAT64\n);"
}, {
  "table_name": "report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_oriccq0atd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_oriccq0atd`\n(\n  booking_id INT64,\n  teacher_id INT64,\n  begin_at TIMESTAMP,\n  ngay_hoc DATE,\n  gio_bat_dau STRING,\n  gio_ket_thuc STRING,\n  ngay_ket_thuc STRING,\n  teacher_status INT64,\n  teacher_email STRING,\n  ops_teacher_email STRING,\n  teacher_name STRING,\n  country_id INT64,\n  country_id_hv INT64,\n  teacher_source_id INT64,\n  program STRING,\n  mon_hoc STRING,\n  loai_hoc_vien STRING,\n  completed INT64,\n  dat INT64,\n  khong_dat INT64,\n  duoi_chuan INT64,\n  no_pay INT64,\n  no_pay_base_rate INT64,\n  teacher_open_webcam_time_less_70 INT64,\n  percent_time_teacher_full_face_less_70 INT64,\n  percent_time_teacher_taking_less_20 INT64,\n  access_time_gv INT64,\n  GV_vao_lop_tre INT64,\n  teacher_note_tre INT64,\n  teacher_khong_note INT64,\n  access_time_hv INT64,\n  warning INT64,\n  warning_details STRING,\n  country_gv STRING,\n  teacher_source STRING\n);"
}, {
  "table_name": "kyna_english_duo_primary_lesson_id_list",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.kyna_english_duo_primary_lesson_id_list`\n(\n  lesson_id INT64\n);"
}, {
  "table_name": "tutoring_new_students_month_M_minus_2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.tutoring_new_students_month_M_minus_2`\n(\n  year_month STRING,\n  num_all_students_tutoring INT64,\n  num_new_students_tutoring INT64\n);"
}, {
  "table_name": "teacher_cost_tracker_4a393d9b-a1e8-4574-8af2-848a48e46a9b_3c1hst9dtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.teacher_cost_tracker_4a393d9b-a1e8-4574-8af2-848a48e46a9b_3c1hst9dtd`\n(\n  sellingEX FLOAT64,\n  booking_id INT64,\n  booking_time TIMESTAMP,\n  teacher_name STRING,\n  teacher_email STRING,\n  teacher_country STRING,\n  teacher_country_id INT64,\n  country STRING,\n  student_name STRING,\n  student_email STRING,\n  student_code STRING,\n  booking_status STRING,\n  revenue NUMERIC,\n  teacher_source STRING,\n  program STRING,\n  program_id INT64,\n  num_shift INT64,\n  currency_exchange_rate FLOAT64,\n  student_country STRING,\n  total_income NUMERIC,\n  income NUMERIC,\n  teacher_id INT64,\n  revenue_vnd FLOAT64,\n  bonus STRING,\n  bonus_income NUMERIC,\n  teacher_income_vnd FLOAT64\n);"
}, {
  "table_name": "duo_students_pop_up_request_from_form_before_automation",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.duo_students_pop_up_request_from_form_before_automation`\n(\n  student_code STRING,\n  source STRING,\n  to_duo_type_id INT64\n);"
}, {
  "table_name": "table_booking_test_indo_malaysia_market_4c192a36-077e-45a3-a4c6-a892e8fd2627",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.table_booking_test_indo_malaysia_market_4c192a36-077e-45a3-a4c6-a892e8fd2627`\n(\n  booking_id INT64,\n  booking_name STRING,\n  booking_time TIMESTAMP,\n  is_virtual_booking INT64,\n  booking_status STRING,\n  student_code STRING,\n  student_country_id INT64,\n  student_country STRING,\n  sic_id INT64,\n  sic_email STRING,\n  sales_manager_id INT64,\n  sales_manager_email STRING,\n  is_student_join_meeeting INT64,\n  teacher_id INT64,\n  is_teacher_join_meeeting INT64,\n  teacher_note_at TIMESTAMP,\n  program STRING,\n  subject INT64,\n  num_shift INT64\n);"
}, {
  "table_name": "ty_le_hoan_thanh-hv_a9a9d5a1-7678-4d02-9b95-eacc10c3467a_O1SMF",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.ty_le_hoan_thanh-hv_a9a9d5a1-7678-4d02-9b95-eacc10c3467a_O1SMF`\n(\n  student_code STRING,\n  user_type STRING,\n  program STRING,\n  level_name STRING,\n  num_completed INT64,\n  num_bookings INT64,\n  completed_rate FLOAT64,\n  completed_rate_filter STRING\n);"
}, {
  "table_name": "to_duo_student_analysis_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.to_duo_student_analysis_view`\nAS with\r\nbookings_students_duo_from_july_2025 as\r\n(\r\nselect\r\n      bss.student_id,\r\n      bs.id as booking_id,\r\n      bs.lesson_id,\r\n      bs.program_id,\r\n      bp.name as program,\r\n      bs.begin_at,\r\n      date(bs.begin_at) as ngay_hoc,\r\n      FORMAT_TIMESTAMP(\"%H:%M\", bs.begin_at) AS time_hh_mm,\r\n      -- case when bs.lesson_id in (select distinct lesson_id from `datateam_kynaforkids.kyna_english_duo_junior_lesson_id_list`) then \"Duo Junior\"\r\n      --      when bs.lesson_id in (select distinct lesson_id from `datateam_kynaforkids.kyna_english_duo_primary_lesson_id_list`) then \"Duo Primary\"\r\n      --      else \"Unknown\"\r\n      -- end as to_duo_program\r\n\r\n-- from `datateam_kynaforkids.temp_students_transfer_to_duo` sduo \r\nfrom `datateam_kynaforkids.temp_students_accept_convert_to_duo` sduo \r\nleft join `kynaforkids.booking_session_student` bss on bss.student_id \u003d sduo.user_id \r\nleft join `kynaforkids.booking_session_view` bs on bss.booking_session_id \u003d bs.id\r\nleft join `kynaforkids.booking_program` bp on bp.id \u003d bs.program_id\r\nwhere date(bs.begin_at) \u003e\u003d \u00272025-07-01\u0027\r\n      and bs.status_id in (1,2,3,4,5)\r\n      and bp.id in (17,6,39,41,73,79)\r\n),\r\n\r\ngroup_hv_ngay_gio as\r\n(\r\nselect\r\n      -- to_duo_program,\r\n      ngay_hoc,\r\n      time_hh_mm,\r\n      count(distinct student_id) as num_students,\r\n\r\nfrom bookings_students_duo_from_july_2025\r\ngroup by ngay_hoc, time_hh_mm\r\norder by ngay_hoc, num_students desc\r\n),\r\n\r\nroom_allocation as\r\n(\r\nselect \r\n      gr.*,\r\n      case when gr.num_students \u003e 2 then\r\n                                          case when mod(gr.num_students,3) \u003d 0 then div(gr.num_students,3)\r\n                                               when mod(gr.num_students,3) \u003d 1 then div(gr.num_students - 4,3)\r\n                                               when mod(gr.num_students,3) \u003d 2 then div(gr.num_students - 2,3)\r\n                                          end\r\n           else 0\r\n      end as num_3_student_rooms,\r\n      \r\n      case when gr.num_students \u003e\u003d 2 then\r\n                                          case when mod(gr.num_students,3) \u003d 0 then 0\r\n                                               when mod(gr.num_students,3) \u003d 1 then 2\r\n                                               when mod(gr.num_students,3) \u003d 2 then 1\r\n                                          end\r\n           else 0\r\n      end as num_2_student_rooms,\r\n\r\n      case when gr.num_students \u003d 1 then 1\r\n           else 0\r\n      end as num_1_student_rooms,\r\n            \r\nfrom group_hv_ngay_gio gr\r\n),\r\n\r\nresult as \r\n(\r\nselect \r\n      ra.*,\r\n      3 * num_3_student_rooms * (44004 - round((22000*0.1+32000*0.9)/3,0) - 23178)as cost_saved_3std_rooms,\r\n      2 * num_2_student_rooms * (44004 - round((22000*0.1+27000*0.9)/2,0) - 23178) as cost_saved_2std_rooms,\r\n      -- num_1_student_rooms * (44004 - 22000 - 23718) as cost_saved_1std_rooms,\r\n      0 as cost_saved_1std_rooms,\r\nfrom room_allocation ra\r\n\r\n)\r\n\r\nselect \r\n      r.*,\r\n      cost_saved_3std_rooms + cost_saved_2std_rooms + cost_saved_1std_rooms as total_cost_saved\r\nfrom result r\r\n;"
}, {
  "table_name": "daily_sales_tracking_f0e49640-59a8-4ea5-b80e-f4301679fa1e_d9529fk1xd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.daily_sales_tracking_f0e49640-59a8-4ea5-b80e-f4301679fa1e_d9529fk1xd`\n(\n  t_date DATE,\n  t_hour INT64,\n  affiliate_category STRING,\n  affiliate_email STRING,\n  sale_follow STRING,\n  sale_follow_email STRING,\n  sale_follow_supervisor_email STRING,\n  subject STRING,\n  num_lead_new INT64,\n  num_lead_change_status INT64,\n  num_lead_not_change_status INT64,\n  num_minutes_change_status FLOAT64,\n  num_remind_all INT64,\n  num_remind_cleared INT64,\n  num_remind_not_cleared INT64,\n  num_minutes_clear_remind FLOAT64\n);"
}, {
  "table_name": "mkt_line_performance_a288a4f1-6045-4d6a-b5bf-b0856b204c95",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.mkt_line_performance_a288a4f1-6045-4d6a-b5bf-b0856b204c95`\n(\n  calc_date DATE,\n  line_mkt STRING,\n  country_id INT64,\n  channel_id INT64,\n  product_id INT64,\n  spend INT64,\n  spend_with_tax FLOAT64,\n  num_leads INT64,\n  num_leads_test INT64,\n  num_leads_test_approved INT64,\n  leads_wait_for_order INT64,\n  num_orders INT64,\n  order_value FLOAT64,\n  country STRING,\n  product_name STRING,\n  channel_name STRING\n);"
}, {
  "table_name": "booking_group_talk_summer_camp_giai_bai_tap_bb2f6733-fcc9-4708-9d0a-d55477e7d904_srjn7t1sud",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.booking_group_talk_summer_camp_giai_bai_tap_bb2f6733-fcc9-4708-9d0a-d55477e7d904_srjn7t1sud`\n(\n  student_name STRING,\n  student_id INT64,\n  student_code STRING,\n  package STRING,\n  valid_package STRING,\n  program_levels_past_bookings STRING,\n  package_exercise_convert_levels_past_bookings STRING,\n  program_levels_future_bookings STRING,\n  package_exercise_convert_levels_future_bookings STRING,\n  program_levels_latest_order STRING,\n  package_exercise_convert_levels_latest_order STRING,\n  program_levels_FINAL STRING,\n  package_exercise_convert_FINAL STRING\n);"
}, {
  "table_name": "ltv_report_cash_revenue_505d4446-6e70-418c-ad7e-844a6bec083e_gv3ma2divd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.ltv_report_cash_revenue_505d4446-6e70-418c-ad7e-844a6bec083e_gv3ma2divd`\n(\n  student_name STRING,\n  student_code STRING,\n  tong_thu FLOAT64,\n  cacCost INT64,\n  accounting_date DATE,\n  percentGPMargin FLOAT64\n);"
}, {
  "table_name": "thong_tin_gv_e4cbc45e-b903-49bf-b551-5843074ac0cb_aa2maijhtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.thong_tin_gv_e4cbc45e-b903-49bf-b551-5843074ac0cb_aa2maijhtd`\n(\n  teacher_id INT64,\n  created_date TIMESTAMP,\n  deactivate_date TIMESTAMP,\n  teacher_name STRING,\n  birthday DATE,\n  status INT64,\n  country STRING,\n  teacher_source STRING,\n  gender STRING,\n  teacher_status STRING,\n  real_status STRING,\n  nationality STRING,\n  age INT64\n);"
}, {
  "table_name": "teacher_income_1-1_8b7cebb7-2377-43de-b4c7-30f363857402_h1474uxctd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.teacher_income_1-1_8b7cebb7-2377-43de-b4c7-30f363857402_h1474uxctd`\n(\n  year_month STRING,\n  teacher_id INT64,\n  teacher_email STRING,\n  name STRING,\n  quoc_tich STRING,\n  TC_in_charge STRING,\n  rating INT64,\n  income_base_salary_current NUMERIC,\n  income_base_salary_last_1month NUMERIC,\n  income_base_salary_last_2month NUMERIC,\n  income_oc_current NUMERIC,\n  income_oc_last_1month NUMERIC,\n  income_oc_last_2month NUMERIC,\n  total_gross_income_current FLOAT64,\n  total_gross_income_last_1month FLOAT64,\n  total_gross_income_last_2month FLOAT64,\n  num_completed_booking_current INT64,\n  num_completed_booking_last_1month INT64,\n  num_completed_booking_last_2month INT64,\n  num_booking_have_cost_current INT64,\n  num_booking_have_cost_last_1month INT64,\n  num_booking_have_cost_last_2month INT64,\n  num_minutes_current INT64,\n  num_minutes_last_1month INT64,\n  num_minutes_last_2month INT64,\n  num_minutes_booking_have_cost_current INT64,\n  num_minutes_booking_have_cost_last_1month INT64,\n  num_minutes_booking_have_cost_last_2month INT64,\n  num_of_real_class_current INT64,\n  num_of_real_class_last_1month INT64,\n  num_of_real_class_last_2month INT64,\n  bonus_qualified_class_current NUMERIC,\n  bonus_qualified_class_last_1month NUMERIC,\n  bonus_qualified_class_last_2month NUMERIC,\n  bonus_replacement_current NUMERIC,\n  bonus_replacement_last_1month NUMERIC,\n  bonus_replacement_last_2month NUMERIC,\n  hot_bonus_current NUMERIC,\n  hot_bonus_last_1month NUMERIC,\n  hot_bonus_last_2month NUMERIC,\n  kyna_compensation_50_current NUMERIC,\n  kyna_compensation_50_last_1month NUMERIC,\n  kyna_compensation_50_last_2month NUMERIC,\n  kyna_compensation_100_current NUMERIC,\n  kyna_compensation_100_last_1month NUMERIC,\n  kyna_compensation_100_last_2month NUMERIC,\n  bonus_test_early_review_current NUMERIC,\n  bonus_test_early_review_last_1month NUMERIC,\n  bonus_test_early_review_last_2month NUMERIC,\n  bonus_test_golden_hour_current NUMERIC,\n  bonus_test_golden_hour_last_1month NUMERIC,\n  bonus_test_golden_hour_last_2month NUMERIC,\n  penalty_rating_below_standard_current NUMERIC,\n  penalty_rating_below_standard_last_1month NUMERIC,\n  penalty_rating_below_standard_last_2month NUMERIC,\n  penalty_wrong_cancel_current NUMERIC,\n  penalty_wrong_cancel_last_1month NUMERIC,\n  penalty_wrong_cancel_last_2month NUMERIC,\n  penalty_open_webcam_current NUMERIC,\n  penalty_open_webcam_last_1month NUMERIC,\n  penalty_open_webcam_last_2month NUMERIC,\n  penalty_code_of_conduct_current NUMERIC,\n  penalty_code_of_conduct_last_1month NUMERIC,\n  penalty_code_of_conduct_last_2month NUMERIC,\n  penalty_full_face_current FLOAT64,\n  penalty_full_face_last_1month FLOAT64,\n  penalty_full_face_last_2month FLOAT64,\n  penalty_over_cancel_current NUMERIC,\n  penalty_over_cancel_last_1month NUMERIC,\n  penalty_over_cancel_last_2month NUMERIC,\n  golden_hour_bonus_current NUMERIC,\n  golden_hour_bonus_last_1month NUMERIC,\n  golden_hour_bonus_last_2month NUMERIC,\n  Fsb_Level_1_Bonus_current NUMERIC,\n  Fsb_Level_1_Bonus_last_1month NUMERIC,\n  Fsb_Level_1_Bonus_last_2month NUMERIC,\n  Fsb_Level_2_Bonus_current NUMERIC,\n  Fsb_Level_2_Bonus_last_1month NUMERIC,\n  Fsb_Level_2_Bonus_last_2month NUMERIC,\n  fsb_quarter_bonus_current NUMERIC,\n  fsb_quarter_bonus_last_1month NUMERIC,\n  fsb_quarter_bonus_last_2month NUMERIC,\n  adjustment_income_current FLOAT64,\n  adjustment_income_last_1month FLOAT64,\n  adjustment_income_last_2month FLOAT64,\n  other_adjustment_current NUMERIC,\n  other_adjustment_last_1month NUMERIC,\n  other_adjustment_last_2month NUMERIC,\n  referral_income_current NUMERIC,\n  referral_income_last_1month NUMERIC,\n  referral_income_last_2month NUMERIC,\n  intro_income_current NUMERIC,\n  intro_income_last_1month NUMERIC,\n  intro_income_last_2month NUMERIC,\n  other_income_current NUMERIC,\n  other_income_last_1month NUMERIC,\n  other_income_last_2month NUMERIC,\n  last_month_adjustment_income_current NUMERIC,\n  last_month_adjustment_income_last_1month NUMERIC,\n  last_month_adjustment_income_last_2month NUMERIC,\n  avg_income_base_salary NUMERIC,\n  avg_income_oc NUMERIC,\n  avg_total_gross_income FLOAT64,\n  min_booking_income_current NUMERIC,\n  max_booking_income_current NUMERIC,\n  min_booking_income NUMERIC,\n  max_booking_income NUMERIC\n);"
}, {
  "table_name": "table_booking_cr_test_10h15_lao_thai_market_a42d42d1-9892-4fa3-8dcb-a414a4afda63",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.table_booking_cr_test_10h15_lao_thai_market_a42d42d1-9892-4fa3-8dcb-a414a4afda63`\n(\n  ngay_tao_lead DATE,\n  sale_email STRING,\n  sale_manager_email STRING,\n  mon_hoc STRING,\n  country STRING,\n  affiliate_email STRING,\n  sale_name STRING,\n  sup_name STRING,\n  num_test_by_sic INT64,\n  num_test_by_sic_t1 INT64,\n  num_lead_t1 INT64,\n  num_lead_t1_1 INT64,\n  num_lead_t1_2 INT64\n);"
}, {
  "table_name": "temp_left_economy",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_left_economy`\n(\n  student_id INT64\n);"
}, {
  "table_name": "mkt_dieu_chinh_organic_fblines_93931ef4-def7-4955-99c7-ffeda394-03f3-4419-a5ae-36461591f7f9_je4szv1ltd_2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.mkt_dieu_chinh_organic_fblines_93931ef4-def7-4955-99c7-ffeda394-03f3-4419-a5ae-36461591f7f9_je4szv1ltd_2`\n(\n  lead_date DATE,\n  utm_campaign STRING,\n  country_id INT64,\n  line_id INT64,\n  line_mkt STRING,\n  country STRING,\n  num_leads FLOAT64,\n  num_leads_test FLOAT64,\n  num_leads_test_approved FLOAT64,\n  leads_wait_for_order FLOAT64\n);"
}, {
  "table_name": "kyna_eng_teacher_management_9a9ea35c-3271-4af4-ac49-61472d1ad616_quxolsi6sd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.kyna_eng_teacher_management_9a9ea35c-3271-4af4-ac49-61472d1ad616_quxolsi6sd`\n(\n  booking_id INT64,\n  teacher_id INT64,\n  begin_at TIMESTAMP,\n  ngay_hoc DATE,\n  gio_bat_dau STRING,\n  gio_ket_thuc STRING,\n  ngay_ket_thuc STRING,\n  ops_teacher_email STRING,\n  teacher_name STRING,\n  country_id INT64,\n  country_id_hv INT64,\n  program STRING,\n  mon_hoc STRING,\n  loai_hoc_vien STRING,\n  completed INT64,\n  dat INT64,\n  khong_dat INT64,\n  duoi_chuan INT64,\n  no_pay INT64,\n  no_pay_base_rate INT64,\n  teacher_open_webcam_time_less_70 INT64,\n  percent_time_teacher_full_face_less_70 INT64,\n  percent_time_teacher_taking_less_20 INT64,\n  access_time_gv INT64,\n  GV_vao_lop_tre INT64,\n  teacher_note_tre INT64,\n  teacher_khong_note INT64,\n  access_time_hv INT64,\n  warning INT64,\n  warning_details STRING,\n  teacher_email STRING,\n  country_gv STRING,\n  teacher_source STRING\n);"
}, {
  "table_name": "report_math_SC_num_orders_by_students_e2ce689f-2387-460e-85ea-4ec88382f26d_s2t2h8sbtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_math_SC_num_orders_by_students_e2ce689f-2387-460e-85ea-4ec88382f26d_s2t2h8sbtd`\n(\n  booking_id INT64,\n  booking_name STRING,\n  booking_time TIMESTAMP,\n  student_name STRING,\n  student_code STRING,\n  booking_status STRING,\n  program STRING,\n  row_num INT64\n);"
}, {
  "table_name": "math_ambassador_candidate",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.datateam_kynaforkids.math_ambassador_candidate`\n(\n  datetime TIMESTAMP,\n  ambassador_name STRING,\n  ambassador_email STRING,\n  candidate_name STRING,\n  candidate_email STRING,\n  phone_number STRING,\n  is_kyna_teacher STRING,\n  program_teaching STRING,\n  link_cv STRING\n)\nOPTIONS(\n  sheet_range\u003d\"DS ứng viên được giới thiệu!A:I\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/1a7TmiVql6gvDYq1ZQZqjcGLxO8AefwSGTFT3Q8HAFo0/edit?gid\u003d940781723#gid\u003d940781723\"]\n);"
}, {
  "table_name": "performance_bonus_e3f0d061-6f11-4539-8b97-1b8dab74fab8_bqfvbsdhtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.performance_bonus_e3f0d061-6f11-4539-8b97-1b8dab74fab8_bqfvbsdhtd`\n(\n  tc_email STRING,\n  booking_id INT64,\n  booking_name STRING,\n  booking_time TIMESTAMP,\n  teacher_name STRING,\n  teacher_email STRING,\n  teacher_country STRING,\n  country STRING,\n  student_name STRING,\n  student_email STRING,\n  student_code STRING,\n  booking_status STRING,\n  teacher_source STRING,\n  program STRING,\n  level_name STRING,\n  num_shift INT64,\n  currency_exchange_rate FLOAT64,\n  student_country STRING,\n  teacher_id INT64,\n  total_income NUMERIC,\n  tc_incharge_id INT64\n);"
}, {
  "table_name": "students_kbc_teacher_june_part_1",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.students_kbc_teacher_june_part_1`\n(\n  student_code STRING,\n  student_id INT64\n);"
}, {
  "table_name": "temp_KT_theo_doi_xuat_hoa_don",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_KT_theo_doi_xuat_hoa_don`\n(\n  ngay_tao_don DATE,\n  invoice_code STRING,\n  phone_number STRING,\n  name STRING,\n  student_code STRING,\n  accounting_date DATE,\n  ngay_duyet_don DATE,\n  total_video_course NUMERIC,\n  total NUMERIC,\n  noi_dung_thanh_toan STRING,\n  program STRING,\n  order_status STRING,\n  payment_status STRING,\n  price NUMERIC,\n  price_raw NUMERIC,\n  note STRING,\n  note_not_processed STRING,\n  So_hoa_don STRING,\n  So_tien FLOAT64,\n  currency_exchange_rate FLOAT64,\n  price_vnd FLOAT64,\n  country STRING,\n  video_course_name STRING,\n  Currency STRING,\n  address STRING\n);"
}, {
  "table_name": "report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_k73ly1xatd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_k73ly1xatd`\n(\n  interview_date DATE,\n  acceptance_date DATE,\n  teacher_id INT64,\n  teacher_name STRING,\n  teacher_country STRING,\n  teacher_source INT64,\n  teaching_training_date DATE,\n  test_training_date DATE,\n  training_status_id INT64,\n  status_id INT64,\n  contract_status_id INT64,\n  contract_completion_date DATE,\n  deactivate_date DATE,\n  is_tester INT64,\n  tc_email STRING,\n  training_status STRING,\n  contract_status STRING,\n  source STRING,\n  status STRING,\n  least_training_date DATE,\n  greatest_training_date DATE,\n  first_month_completed_bookings INT64,\n  first_booking_date DATE,\n  reactivated_date DATE,\n  num_reactivate INT64,\n  ready_to_teach_date DATE,\n  reactivate_contract_completion_date DATE,\n  booked_training_date DATE,\n  num_contracts INT64,\n  max_contract_send_date INT64,\n  num_reactivated_contracts INT64,\n  max_reactivated_contract_send_date INT64,\n  acceptance_or_reactivated_date DATE,\n  contract_sign_status_id INT64,\n  reactivated_contract_sign_status_id INT64,\n  is_trained STRING,\n  is_contract_sign STRING,\n  is_reactivated_contract_sign STRING,\n  normal_or_reactivated STRING,\n  reactivated_qualified_to_teach_date DATE,\n  final_contract_completion_date DATE,\n  num_days_to_be_qualified_to_teach INT64,\n  status_contract_sign STRING,\n  status_reactivated_contract_sign STRING,\n  num_days_to_be_qualified_to_teach_reactivated INT64,\n  final_num_days_to_be_qualified_to_teach INT64,\n  final_is_contract_sign STRING,\n  final_qualified_to_teach_date DATE,\n  final_status_contract_sign STRING\n);"
}, {
  "table_name": "report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3`\n(\n  interview_date DATE,\n  acceptance_date DATE,\n  teacher_id INT64,\n  teacher_name STRING,\n  teacher_country STRING,\n  teacher_source INT64,\n  teaching_training_date DATE,\n  test_training_date DATE,\n  training_status_id INT64,\n  status_id INT64,\n  contract_status_id INT64,\n  contract_completion_date DATE,\n  deactivate_date DATE,\n  is_tester INT64,\n  is_math_teacher_or_tester INT64,\n  tc_email STRING,\n  total_completed_bookings_all_time INT64,\n  first_ever_booking_date DATE,\n  training_status STRING,\n  contract_status STRING,\n  source STRING,\n  status STRING,\n  least_training_date DATE,\n  greatest_training_date DATE,\n  reactivated_date DATE,\n  num_reactivate INT64,\n  ready_to_teach_date DATE,\n  reactivate_contract_completion_date DATE,\n  booked_training_date DATE,\n  num_contracts INT64,\n  max_contract_send_date INT64,\n  num_reactivated_contracts INT64,\n  max_reactivated_contract_send_date INT64,\n  acceptance_or_reactivated_date DATE,\n  contract_sign_status_id INT64,\n  reactivated_contract_sign_status_id INT64,\n  is_trained STRING,\n  is_contract_sign STRING,\n  is_reactivated_contract_sign STRING,\n  normal_or_reactivated STRING,\n  reactivated_qualified_to_teach_date DATE,\n  final_contract_completion_date DATE,\n  num_days_to_be_qualified_to_teach INT64,\n  status_contract_sign STRING,\n  status_reactivated_contract_sign STRING,\n  num_days_to_be_qualified_to_teach_reactivated INT64,\n  final_num_days_to_be_qualified_to_teach INT64,\n  final_is_contract_sign STRING,\n  final_qualified_to_teach_date DATE,\n  first_booking_date DATE,\n  final_status_contract_sign STRING,\n  num_days_to_first_booking_date INT64\n);"
}, {
  "table_name": "ceo_ghi_danh_lai_LAO_view_temp",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.ceo_ghi_danh_lai_LAO_view_temp`\nAS with general_table as (\r\nSELECT\r\n  -- CAST(FORMAT_TIMESTAMP(\"%d/%m/%Y\", (bl.created_at)) AS STRING) AS register_created\r\n    bl.id\r\n  , bl.status\r\n  , bl.utm_campaign as affiliate_campaign\r\n  , bl.reason_cancel_id\r\n  , bl.created_at\r\n  , bo.invoice_code\r\n  , bo.payment_content\r\n  , bo.total\r\n  , bo.payment_status\r\n  , bo.status as booking_order_status\r\n  , bo.discount_money\r\n  , bo.currency_exchange_rate\r\n  , date(bo.created_at) as order_date\r\n \r\n  , `kynaforkids-server-production.kynaforkids.func_get_booking_lead_status`(bl.status) as lead_status\r\n  , (select ac.name from `kynaforkids-server-production.kynaforkids.affiliate_category` ac,\r\n    `kynaforkids-server-production.kynaforkids.affiliate_user` au where au.affiliate_id \u003d bl.affiliate_id and au.affiliate_category_id \u003d ac.id) as affiliate_category\r\n  , (select u.email from `kynaforkids-server-production.kynaforkids.affiliate_user` au,\r\n    `kynaforkids-server-production.kynaforkids.user` u where au.affiliate_id \u003d bl.affiliate_id and u.id \u003d au.user_id ) as affiliate_email\r\n  , (SELECT max(p.name) FROM `kynaforkids-server-production.kynaforkids.profile` p WHERE p.user_id \u003d bl.sale_id) AS sale_follow\r\n    , (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d bl.sale_id) AS sale_follow_email\r\n  -- ngaltt start\r\n    ,(SELECT max(p.name) FROM `kynaforkids-server-production.kynaforkids.profile` p WHERE p.user_id \u003d tsm.telesales_supervisor_id) AS sale_follow_supervisor\r\n  , (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d tsm.telesales_supervisor_id) AS sale_follow_supervisor_email,\r\n\r\n    -- (select date(bsn.begin_at)\r\n    -- from `kynaforkids-server-production.kynaforkids.booking_session_new` bsn\r\n    -- where bsn.id \u003d bl.booking_test_id) as test_date,\r\n\r\n    bl.booking_test_id,\r\n    bl.sale_id,\r\n    -- (select bsn.status_id,\r\n    -- from `kynaforkids-server-production.kynaforkids.booking_session_new` bsn\r\n    -- where bsn.id \u003d bl.booking_test_id) as booking_test_status\r\n\r\n    -- ngaltt start\r\n `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(bo.payment_content) AS loai_don_hang\r\n, IF(bo.payment_content \u003d 1, 1, 0) as hoc_thu\r\n, IF(bo.payment_content \u003d 2, 1, 0) as ghi_danh_lan_dau\r\n, IF(bo.payment_content \u003d 3, 1, 0) as tra_gop_lan_sau\r\n, IF(bo.payment_content \u003d 4, 1, 0) as ghi_danh_lai\r\n, (CASE WHEN bl.upsell \u003d 1 THEN \u0027Upsell\u0027 ELSE \u0027Lead\u0027 END) AS loai_lead\r\n, (CASE WHEN bl.is_blocked \u003d 0 THEN \u0027Open\u0027  ELSE \u0027Blocked\u0027 END) AS trang_thai\r\n    -- ngaltt end\r\n, if((select max(u.id) from `kynaforkids-server-production.kynaforkids.user` u,\r\n  (select parent_id from `kynaforkids-server-production.kynaforkids.booking_student` bst, `kynaforkids-server-production.kynaforkids.user` u where u.id \u003d bst.user_id and bst.is_user_test !\u003d 1) t1\r\n  where u.id \u003d t1.parent_id and u.phone_number \u003d bl.intl_phone_number) is null, \u0027Chưa là HV\u0027, \u0027Đã là HV\u0027) as HV_Yes_No\r\n, case\r\n    when bl.subject_code \u003d \u0027EK\u0027 then \u0027Tiếng Anh trẻ em\u0027\r\n    when bl.subject_code \u003d \u0027EA\u0027 then \u0027Tiếng Anh người lớn\u0027\r\n    when bl.subject_code \u003d \u0027M\u0027 then \u0027Toán\u0027\r\n    when bl.subject_code \u003d \u0027C\u0027 then \u0027Group Class\u0027\r\n    when bl.subject_code \u003d \u0027AI\u0027 then \u0027AI Tutor\u0027\r\n    when bl.subject_code \u003d \u0027AI-PRE\u0027 then \u0027AI Tutor Premium\u0027\r\n  end as subject_code\r\nFROM `kynaforkids-server-production.kynaforkids.booking_lead_view` bl\r\n-- ngaltt start\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr` tsm on tsm.telesales_id \u003d bl.sale_id\r\n-- ngaltt end\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_order_view` bo ON bl.id \u003d bo.lead_id\r\n-- LEFT JOIN `kynaforkids-server-production.kynaforkids.auth_assignment` aa ON aa.user_id \u003d bl.sale_id\r\nWHERE bl.country_id \u003d 5\r\n-- AND aa.item_name IN(\u0027Telesales\u0027, \u0027Lead Telesales\u0027,\u0027SALE - Manager\u0027,\u0027SALE - Telesales - Staff\u0027,\u0027SALE - Telesales Supervisor\u0027)\r\nAND bl.Upsell \u003d 1\r\n),\r\n\r\nlead_table as\r\n(\r\nselect \r\n        date(created_at) as lead_date, \r\n        sale_id,\r\n        affiliate_campaign, affiliate_category, affiliate_email,\r\n        trang_thai,\r\n        count(distinct id) as num_leads,   \r\n\r\n      SUM(\r\n            if(status in (6,12),1,0)\r\n        ) as num_leads_status_lien_he,\r\n      \r\n      SUM(\r\n          if(reason_cancel_id in (\u002720\u0027) and status in (9),1,0)\r\n      ) as num_leads_status_tu_choi_vi_ly_do_trung,\r\n\r\n      SUM(\r\n            if(status in (3,4,5),1,0)\r\n        ) as num_leads_status_tu_van_tham_gia_onl_off,\r\n      SUM(\r\n            if(status in (21,22),1,0)\r\n        ) as num_leads_status_coc_hen_tt,\r\n      SUM(\r\n          if(reason_cancel_id not in (\u002720\u0027) and status in (9),1,0)\r\n      ) as num_leads_status_tu_choi_loai_ly_do_trung,\r\n      SUM(\r\n            if(status in (9),1,0)\r\n        ) as num_leads_status_tu_choi\r\nfrom general_table\r\nwhere date(created_at) \u003e\u003d \u00272024-01-01\u0027\r\n  -- and date(created_at) \u003e\u003d \u00272025-01-20\u0027\r\n  group by lead_date, sale_id, trang_thai, affiliate_campaign, affiliate_category, affiliate_email\r\n  order by lead_date desc\r\n),\r\n\r\norder_info as (\r\nselect \r\n        bo.invoice_code,\r\n        bo.created_by as sale_id,\r\n        bo.payment_content,\r\n        bo.total,\r\n        bo.total_video_course,\r\n        bo.payment_status,\r\n        bo.status,\r\n        bo.discount_money,\r\n        bo.currency_exchange_rate,\r\n        date(bo.created_at) as order_date,\r\n        bl.utm_campaign as affiliate_campaign,\r\n        (select ac.name from `kynaforkids-server-production.kynaforkids.affiliate_category` ac,\r\n          `kynaforkids-server-production.kynaforkids.affiliate_user` au where au.affiliate_id \u003d bl.affiliate_id and au.affiliate_category_id \u003d ac.id) as affiliate_category,\r\n         (select u.email from `kynaforkids-server-production.kynaforkids.affiliate_user` au,\r\n           `kynaforkids-server-production.kynaforkids.user` u where au.affiliate_id \u003d bl.affiliate_id and u.id \u003d au.user_id ) as affiliate_email,\r\n        case\r\n          when bl.subject_code \u003d \u0027EK\u0027 then \u0027Tiếng Anh trẻ em\u0027\r\n          when bl.subject_code \u003d \u0027EA\u0027 then \u0027Tiếng Anh người lớn\u0027\r\n          when bl.subject_code \u003d \u0027M\u0027 then \u0027Toán\u0027\r\n          when bl.subject_code \u003d \u0027C\u0027 then \u0027Group Class\u0027\r\n          when bl.subject_code \u003d \u0027AI\u0027 then \u0027AI Tutor\u0027\r\n          when bl.subject_code \u003d \u0027AI-PRE\u0027 then \u0027AI Tutor Premium\u0027\r\n        end as subject_code,\r\n        bo.lead_id,\r\n\r\nfrom `kynaforkids.booking_order_view` bo\r\nleft join `kynaforkids.booking_lead` bl on bl.id \u003d bo.lead_id\r\nwhere bo.status in (4) and bo.payment_status in (0,1,3,4)\r\n      and bo.international_country_id \u003d 5\r\n),\r\n\r\norder_table as\r\n(\r\nselect\r\n        order_date,\r\n        order_info.sale_id,\r\n        \u0027Open\u0027 as trang_thai,\r\n        affiliate_campaign, affiliate_category, affiliate_email,\r\n\r\n        string_agg(CAST(lead_id AS STRING)) as lead_ids,\r\n        string_agg(invoice_code) as invoices,      \r\n\r\n\r\n\r\n       SUM(\r\n            if(payment_content in (3,4), 1,0)\r\n        ) as num_order_ghi_danh_lai_tra_gop,\r\n\r\n\r\n        SUM(\r\n            if(payment_content in (3,4), round((coalesce(total,0) + coalesce(total_video_course,0) - coalesce(discount_money,0))*currency_exchange_rate),0)\r\n        ) as rev_ghi_danh_lai_tra_gop,\r\n\r\n\r\nfrom order_info\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr` tsm on tsm.telesales_id \u003d order_info.sale_id\r\n\r\nwhere order_date \u003e\u003d \u00272024-01-01\u0027\r\n  -- and order_date \u003e\u003d \u00272025-01-20\u0027\r\n  group by order_date,sale_id, trang_thai, affiliate_campaign, affiliate_category, affiliate_email\r\n  order by order_date desc\r\n),\r\n\r\n\r\nresult as (\r\nselect\r\n      coalesce(ot.order_date, lt.lead_date) as cal_date,\r\n      coalesce(ot.sale_id,lt.sale_id) as sale_id,\r\n      coalesce(ot.trang_thai, lt.trang_thai) as trang_thai,\r\n      coalesce(ot.affiliate_campaign, lt.affiliate_campaign) as affiliate_campaign,\r\n      coalesce(ot.affiliate_category,lt.affiliate_category) as affiliate_category,\r\n      coalesce(ot.affiliate_email, lt.affiliate_email) as affiliate_email,  \r\n\r\n      SUM(coalesce(lt.num_leads,0)) as num_leads,\r\n      SUM(coalesce(lt.num_leads_status_lien_he,0)) as num_leads_status_lien_he,\r\n      SUM(coalesce(lt.num_leads_status_tu_van_tham_gia_onl_off,0)) as num_leads_status_tu_van_tham_gia_onl_off,\r\n      SUM(coalesce(lt.num_leads_status_coc_hen_tt,0)) as num_leads_status_coc_hen_tt,\r\n      SUM(coalesce(lt.num_leads_status_tu_choi_vi_ly_do_trung,0)) as num_leads_status_tu_choi_vi_ly_do_trung,\r\n \r\n      SUM(coalesce(lt.num_leads_status_tu_choi_loai_ly_do_trung,0)) as num_leads_status_tu_choi_loai_ly_do_trung,\r\n      SUM(coalesce(lt.num_leads_status_tu_choi,0)) as num_leads_status_tu_choi,\r\n\r\n      -- SUM(coalesce(tt.num_test_booked,0)) as num_test_booked,\r\n      -- SUM(coalesce(tt.num_test_completed,0)) as num_test_completed,\r\n\r\n      -- SUM(coalesce(ot.num_order_hoc_thu,0)) as num_order_hoc_thu,\r\n      SUM(coalesce(ot.num_order_ghi_danh_lai_tra_gop,0)) as num_order_ghi_danh_lai_tra_gop,      \r\n      SUM(coalesce(ot.rev_ghi_danh_lai_tra_gop,0)) as rev_ghi_danh_lai_tra_gop,   \r\n      \r\n\r\n\r\n       \r\nfrom lead_table lt\r\nfull join order_table ot on (ot.order_date \u003d lt.lead_date and lt.sale_id \u003d ot.sale_id and lt.affiliate_campaign\u003dot.affiliate_campaign and lt.affiliate_category\u003dot.affiliate_category and lt.affiliate_email\u003dot.affiliate_email and lt.trang_thai\u003dot.trang_thai)\r\ngroup by cal_date, sale_id, trang_thai, affiliate_campaign, affiliate_category, affiliate_email \r\norder by cal_date desc, trang_thai, affiliate_campaign, affiliate_category, affiliate_email\r\n)\r\n\r\nselect r.*,\r\n      (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d r.sale_id) AS sale_follow_email,\r\n      (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d tsm.telesales_supervisor_id) AS sale_follow_supervisor_email,\r\nfrom result r\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr` tsm on tsm.telesales_id \u003d r.sale_id\r\n;"
}, {
  "table_name": "temp_teacher_rate_increase",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_teacher_rate_increase`\n(\n  teacher_id INT64,\n  teacher_name STRING\n);"
}, {
  "table_name": "tinh_trang_CV_GVVN",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.datateam_kynaforkids.tinh_trang_CV_GVVN`\n(\n  date DATE,\n  name STRING,\n  email STRING,\n  phone STRING,\n  source STRING,\n  link_cv STRING,\n  position STRING,\n  apply_times STRING,\n  team STRING,\n  screener STRING,\n  status STRING,\n  note STRING\n)\nOPTIONS(\n  sheet_range\u003d\"Big query data!A:L\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/1mORbRfUBACjdvUSKzLaTXn_gGU7-UvQglo10uccHaE0/edit?gid\u003d80128517#gid\u003d80128517\"]\n);"
}, {
  "table_name": "hv_vip_45_junior_402a2c3b-8dad-442c-95e8-b4cca4d7b64a_6z7j8qspvd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.hv_vip_45_junior_402a2c3b-8dad-442c-95e8-b4cca4d7b64a_6z7j8qspvd`\n(\n  ngay_hoc DATE,\n  time_hh_mm STRING,\n  student_id INT64,\n  rn INT64\n);"
}, {
  "table_name": "report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_3dfetspatd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_3dfetspatd`\n(\n  ngay_tao DATE,\n  bd_incharge_email STRING,\n  new_affiliate INT64,\n  active_affiliate INT64,\n  affiliate_type STRING,\n  country STRING,\n  nguon_affiliate INT64,\n  affiliate_email STRING,\n  lead_status STRING,\n  phone_number_lead STRING,\n  num_lead INT64,\n  num_order INT64,\n  order_price FLOAT64\n);"
}, {
  "table_name": "report_math_SC_num_orders_by_students_e2ce689f-2387-460e-85ea-4ec88382f26d_4glv1gubtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_math_SC_num_orders_by_students_e2ce689f-2387-460e-85ea-4ec88382f26d_4glv1gubtd`\n(\n  student_id INT64,\n  student_code STRING,\n  student_name STRING,\n  teacher_name STRING,\n  ops STRING,\n  center STRING,\n  booking_id INT64,\n  lesson_id INT64,\n  lecture_content INT64,\n  system INT64,\n  lecturers INT64,\n  customer_care INT64,\n  student_rating_comment STRING,\n  join_meeting STRING,\n  begin_at TIMESTAMP,\n  student_rate_time INT64,\n  teacher_country STRING,\n  student_country STRING,\n  program_name STRING,\n  program_id INT64,\n  level_name STRING,\n  lesson_name STRING,\n  subject_id INT64,\n  sc_in_charge STRING\n);"
}, {
  "table_name": "report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_rtu279yatd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_rtu279yatd`\n(\n  tc_email STRING,\n  booking_id INT64,\n  booking_name STRING,\n  is_virtual_booking INT64,\n  booking_time TIMESTAMP,\n  teacher_name STRING,\n  teacher_email STRING,\n  teacher_country STRING,\n  teacher_country_id INT64,\n  country STRING,\n  student_code STRING,\n  booking_status STRING,\n  teacher_source STRING,\n  program STRING,\n  program_group INT64,\n  num_shift INT64,\n  student_country STRING,\n  teacher_id INT64,\n  booking_rating STRING,\n  tc_incharge_id INT64,\n  lead_id INT64,\n  lead_status STRING,\n  created_at TIMESTAMP,\n  created_order_at TIMESTAMP,\n  Bloked_Open STRING,\n  mon_hoc STRING,\n  is_student STRING,\n  lead_in_range INT64\n);"
}, {
  "table_name": "thu_nhap_aff_2a64b5ec-73da-4dce-8f02-eeb1a343b30c",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.thu_nhap_aff_2a64b5ec-73da-4dce-8f02-eeb1a343b30c`\n(\n  id INT64,\n  affiliate_id INT64,\n  affiliate_email STRING,\n  loai_affiliate STRING,\n  ngay_thu_nhap TIMESTAMP,\n  ngay_hoan_thanh_1 TIMESTAMP,\n  ngay_hach_toan TIMESTAMP,\n  program_name STRING,\n  student_email STRING,\n  thuc_nhan_hoc_phi NUMERIC,\n  phan_tram_hoa_hong FLOAT64,\n  affiliate_commission_amount FLOAT64,\n  order_invoice_code STRING,\n  lead_id INT64,\n  note STRING,\n  order_status STRING,\n  payment_content STRING,\n  total_video NUMERIC,\n  test_online_bonus FLOAT64,\n  bd_incharge_id INT64,\n  bd_incharge_email STRING,\n  country_id INT64,\n  student_type STRING,\n  affiliate_commission_percent_bonus FLOAT64,\n  affiliate_commission_amount_bonus FLOAT64,\n  Nguon STRING,\n  Quoc_gia STRING,\n  total_new FLOAT64,\n  program_type STRING\n);"
}, {
  "table_name": "order_tutoring_ad1672df-11fe-42f2-a5f8-a2e75d904708_3n6lmwijtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.order_tutoring_ad1672df-11fe-42f2-a5f8-a2e75d904708_3n6lmwijtd`\n(\n  month_kt STRING,\n  market STRING,\n  Order_Code STRING,\n  Phone_Number STRING,\n  purchase_date INT64,\n  first_time_purchase_phone INT64,\n  Email STRING,\n  first_time_purchase_email INT64,\n  Source STRING,\n  Original_Price FLOAT64,\n  VND_Price FLOAT64,\n  type_order_phone STRING,\n  type_order_email STRING,\n  Payment_Content STRING\n);"
}, {
  "table_name": "hv_kho_Jan_2026",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.hv_kho_Jan_2026`\n(\n  string_field_0 STRING,\n  string_field_1 STRING\n);"
}, {
  "table_name": "teacher_income_1-1_8b7cebb7-2377-43de-b4c7-30f363857402_20r9apwctd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.teacher_income_1-1_8b7cebb7-2377-43de-b4c7-30f363857402_20r9apwctd`\n(\n  teacher_id INT64,\n  year_month STRING,\n  teacher_email STRING,\n  name STRING,\n  quoc_tich STRING,\n  referral_income FLOAT64,\n  intro_income FLOAT64,\n  other_income FLOAT64,\n  gross_income FLOAT64,\n  other_adjustment FLOAT64,\n  income_total FLOAT64,\n  source STRING,\n  num_booking_completed_cancel_ko_bu INT64,\n  num_booking_have_cost INT64\n);"
}, {
  "table_name": "students_left_economy_bf_20250727",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.students_left_economy_bf_20250727`\n(\n  student_id INT64,\n  student_code STRING,\n  action_date DATE,\n  action INT64\n);"
}, {
  "table_name": "hv_tang_kem_ai",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.hv_tang_kem_ai`\n(\n  student_code STRING,\n  student_type STRING,\n  total_remaining_lessons INT64,\n  num_months_ai_gifted INT64,\n  expired_day DATE,\n  is_joined_ai INT64\n);"
}, {
  "table_name": "teacher_cost_tracker_4a393d9b-a1e8-4574-8af2-848a48e46a9b_yi9s177dtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.teacher_cost_tracker_4a393d9b-a1e8-4574-8af2-848a48e46a9b_yi9s177dtd`\n(\n  ngay_tao_don DATE,\n  ngay_duyet_don DATE,\n  ngay_tao_lead DATE,\n  invoice_code STRING,\n  ten_phu_huynh STRING,\n  email STRING,\n  name STRING,\n  student_code STRING,\n  phone_number STRING,\n  count_1 STRING,\n  accounting_date DATE,\n  total_video_course NUMERIC,\n  total NUMERIC,\n  noi_dung_thanh_toan STRING,\n  source STRING,\n  program STRING,\n  order_status STRING,\n  payment_status STRING,\n  price NUMERIC,\n  currency_code STRING,\n  contract_code STRING,\n  duration INT64,\n  note STRING,\n  affiliate_campaign STRING,\n  landingpage_name STRING,\n  affiliate_id INT64,\n  affiliate_email STRING,\n  affiliate_emaill STRING,\n  affiliate_type STRING,\n  currency_exchange_rate FLOAT64,\n  price_vnd FLOAT64,\n  country STRING,\n  total_lesson INT64,\n  nguoi_duyet STRING,\n  ai_tutor_price_oc_in_video_app NUMERIC,\n  loai_affiliate STRING,\n  thoi_gian_ghi_danh STRING,\n  map_don STRING,\n  order_type STRING,\n  ops_incharge STRING,\n  SIC_name STRING,\n  student_type STRING,\n  voucher_code STRING,\n  order_type_2 STRING,\n  total_ai_tutor_vnd FLOAT64,\n  total_video_vnd FLOAT64,\n  total_vnd FLOAT64,\n  total_nguyen_te NUMERIC\n);"
}, {
  "table_name": "accounting_management_metrics_5fe2d545-1c6c-4402-aa06-b5f45cb5d912",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.accounting_management_metrics_5fe2d545-1c6c-4402-aa06-b5f45cb5d912`\n(\n  Student_Code STRING,\n  purchase_date STRING,\n  first_time_purchase TIMESTAMP,\n  trial_date TIMESTAMP,\n  Original_Price FLOAT64,\n  VND_Price FLOAT64,\n  total_lesson INT64,\n  type_order STRING,\n  loai_affiliate STRING,\n  affiliate_campagain STRING,\n  Source STRING,\n  order_code STRING,\n  Market_1 STRING,\n  phone_number STRING,\n  email STRING,\n  payment_content STRING,\n  accounting_date TIMESTAMP,\n  client_classify STRING,\n  company_name STRING\n);"
}, {
  "table_name": "telemarketing_52312e63-9f7a-4948-9fdf-8ccf1e9bbe11_vw11lhu9sd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.telemarketing_52312e63-9f7a-4948-9fdf-8ccf1e9bbe11_vw11lhu9sd`\n(\n  calc_date DATE,\n  utm_campaign STRING,\n  affiliate_email STRING,\n  email_ctv STRING,\n  num_data_lead INT64,\n  num_data_tao_moi INT64,\n  num_data_open INT64,\n  num_data_tu_choi INT64,\n  num_order INT64,\n  revenue FLOAT64,\n  bonus INT64\n);"
}, {
  "table_name": "Order_Tutoring",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.Order_Tutoring`\n(\n  Date DATE,\n  Order_Code STRING,\n  Payment_Content STRING,\n  Source STRING,\n  Original_Price FLOAT64,\n  Ex FLOAT64,\n  Market STRING,\n  Code_Contract STRING\n);"
}, {
  "table_name": "test_fixed_date_range_for_materialized_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.test_fixed_date_range_for_materialized_view`\nAS WITH aff_campaign_inf AS\r\n(\r\n  SELECT\r\n    aci.`campaign_id`,\r\n    ac.name as campaign_name,\r\n    date(TIMESTAMP_SECONDS(aci.`date`)+ INTERVAL 7 HOUR) as date_spend,\r\n    aci.`spend`,\r\n    ac.account_id,\r\n    ac.channel_id,\r\n    ac.effective_status,\r\n    ac.product_id,\r\n    ac.user_id,\r\n    ac.country_id,\r\n    ac.line_id,\r\n  \r\n    CASE\r\n          WHEN ac.channel_id \u003d 1 AND date(TIMESTAMP_SECONDS(aci.`date`)+ INTERVAL 7 HOUR) \u003e\u003d \u00272025-03-01\u0027 THEN ROUND(1.05 * aci.spend)\r\n          WHEN ac.channel_id \u003d 1 AND date(TIMESTAMP_SECONDS(aci.`date`)+ INTERVAL 7 HOUR) \u003c \u00272025-03-01\u0027 THEN ROUND(1.07 * aci.spend)\r\n          WHEN ac.channel_id \u003d 2 THEN ROUND(1.05 * aci.spend)\r\n          WHEN ac.channel_id \u003d 3 THEN ROUND(1.05 * aci.spend)\r\n    END AS spend_with_tax,\r\n  FROM\r\n    `kynaforkids-server-production.kynaforkids.adwords_meta_campaign_insight` aci\r\n\r\n  LEFT JOIN `kynaforkids-server-production.kynaforkids.adwords_meta_campaign` ac\r\n        ON ac.id \u003d aci.campaign_id\r\n  WHERE date(TIMESTAMP_SECONDS(aci.`date`)) \u003e\u003d \u00272022-01-01\u0027\r\n    AND date(TIMESTAMP_SECONDS(aci.`date`)) \u003c\u003d \u00272025-04-30\u0027  -- Added upper bound for date range\r\n\r\n),\r\n\r\nline_name_spend as(\r\n  SELECT  ci.date_spend, ci.channel_id, ci.product_id, ci.country_id, \r\n        SUM(ci.spend) as spend, SUM(ci.spend_with_tax) as spend_with_tax,\r\n        CASE WHEN ci.line_id is not null then line.name\r\n             ELSE \u0027Line_without_ID\u0027\r\n        END as line_mkt\r\n  FROM aff_campaign_inf ci\r\n  LEFT JOIN `kynaforkids-server-production.kynaforkids.adwords_meta_line` line ON(line.id \u003d ci.line_id)\r\n  GROUP BY ci.date_spend, line_mkt, ci.country_id, ci.channel_id, ci.product_id\r\n  ORDER BY date_spend \r\n),\r\n\r\nline_lead_date AS \r\n(\r\nSELECT \r\n        lead_date, line_id,\r\n        SUM(num_leads) as num_leads,\r\n        SUM(num_leads_test_approved) as num_leads_test_approved,\r\n        SUM(num_leads_test) as num_leads_test,\r\n        SUM(leads_wait_for_order) as leads_wait_for_order,\r\n        max(country_id) as country_id,\r\n\r\nFROM\r\n(\r\nSELECT\r\n       date(blv.created_at) as lead_date, \r\n        blv.affiliate_campaign as utm_campaign,\r\n        COUNTIF(blv.id is not null and blv.Bloked_Open \u003d \u0027Open\u0027) as num_leads,\r\n        COUNT(blv.test_approved_lead_id) as num_leads_test_approved,\r\n        COUNTIF(blv.nhan_xet_gv \u003d \u0027Đã có nhận xét\u0027) as num_leads_test,\r\n        COUNTIF(blv.lead_status \u003d \u0027Ghi danh - Chờ lên đơn\u0027 and blv.Bloked_Open \u003d \u0027Open\u0027) as leads_wait_for_order,\r\n\r\n        if((select max(auc.country_id) from `kynaforkids-server-production.kynaforkids.adwords_utm_campaign` auc where lower(name) \u003d lower(blv.affiliate_campaign)) is null,\r\n            max(blv.country_id), \r\n            (select max(auc.country_id) from `kynaforkids-server-production.kynaforkids.adwords_utm_campaign` auc where lower(name) \u003d lower(blv.affiliate_campaign))) as country_id,\r\n        \r\n        (SELECT max(line_id) FROM `kynaforkids-server-production.kynaforkids.adwords_utm_campaign` \r\n         WHERE lower(name) \u003d lower(blv.affiliate_campaign)) as line_id,\r\n  FROM `kynaforkids-server-production.kynaforkids.mkt_booking_lead_view` blv\r\n  WHERE date(blv.created_at) \u003e\u003d \u00272022-01-01\u0027\r\n    AND date(blv.created_at) \u003c\u003d \u00272025-04-30\u0027  -- Added upper bound for date range\r\n    AND blv.id NOT IN\r\n        (\r\n          SELECT blv.id \r\n          FROM  `kynaforkids-server-production.kynaforkids.mkt_booking_lead_view` blv\r\n          WHERE date(blv.created_at) \u003e\u003d \u00272022-01-01\u0027\r\n               AND date(blv.created_at) \u003c\u003d \u00272025-04-30\u0027  -- Added upper bound for date range\r\n               AND blv.reason_cancel_id IN (\u002720\u0027,\u002718\u0027,\u002717\u0027,\u00279\u0027,\u00278\u0027)\r\n        )\r\n  GROUP BY lead_date, blv.affiliate_campaign, line_id\r\n  ORDER By lead_date\r\n)\r\nGROUP BY lead_date, line_id\r\n)\r\n,\r\n\r\nline_order_date AS (\r\nSELECT\r\n        date(oc.ngay_tao_don) as order_date,\r\n        (SELECT MAX(line_id) FROM `kynaforkids-server-production.kynaforkids.adwords_utm_campaign` \r\n         WHERE lower(name) \u003d lower(oc.affiliate_campaign)) as line_id,\r\n        MAX(oc.country_id) as country_id,\r\n        SUM(oc.total_VND) as order_value,\r\n        COUNT(oc.order_id) as num_orders,\r\nFROM `kynaforkids-server-production.kynaforkids.mkt_booking_order_old_new_students_view` oc\r\nWHERE date(oc.ngay_tao_don) \u003e\u003d \u00272022-01-01\u0027 \r\n  AND date(oc.ngay_tao_don) \u003c\u003d \u00272025-04-30\u0027  -- Added upper bound for date range\r\nGROUP BY order_date, line_id\r\nORDER BY order_date \r\n),\r\n\r\nline_lead_order AS\r\n(\r\nSELECT \r\n        IF(lld.lead_date is null, lod.order_date, lld.lead_date) as calc_date, \r\n        lld.lead_date,\r\n        lod.order_date,\r\n        IF(lld.line_id is null, lod.line_id, lld.line_id) as line_id,\r\n        lld.line_id as line_id_lead, \r\n        lod.line_id as line_id_od, \r\n        lld.num_leads, \r\n        lld.num_leads_test, \r\n        lld.num_leads_test_approved, \r\n        lld.leads_wait_for_order, \r\n        lod.num_orders, \r\n        lod.order_value,\r\n        IF(lld.country_id is null, lod.country_id, lld.country_id) as country_id, \r\nFROM line_lead_date lld\r\nFULL JOIN line_order_date lod\r\nON (lld.lead_date \u003d lod.order_date AND lld.line_id \u003d lod.line_id)\r\n),\r\n\r\nline_name_lead_order AS (\r\nSELECT\r\n    llo.calc_date,\r\n    SUM(num_leads) as num_leads, \r\n    SUM(num_leads_test) as num_leads_test, \r\n    SUM(num_leads_test_approved) as num_leads_test_approved, \r\n    SUM(num_orders) as num_orders, \r\n    SUM(leads_wait_for_order) as leads_wait_for_order, \r\n    SUM(order_value) as order_value,\r\n    CASE WHEN llo.line_id is not null then line.name\r\n        ELSE \u0027Line_without_ID\u0027\r\n    END AS line_mkt,\r\n    IF(llo.country_id is null, (SELECT max(auc.country_id) FROM `kynaforkids-server-production.kynaforkids.adwords_utm_campaign` auc \r\n         WHERE llo.line_id \u003d auc.line_id), llo.country_id) as country_id,\r\n    \r\n    (SELECT max(auc.product_id) FROM `kynaforkids-server-production.kynaforkids.adwords_utm_campaign` auc \r\n         WHERE llo.line_id \u003d auc.line_id) as product_id,\r\n\r\n    (SELECT max(auc.channel_id) FROM `kynaforkids-server-production.kynaforkids.adwords_utm_campaign` auc \r\n         WHERE llo.line_id \u003d auc.line_id) as channel_id,         \r\nFROM line_lead_order llo\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.adwords_meta_line` line ON(line.id \u003d llo.line_id)\r\nGROUP BY llo.calc_date, line_mkt, country_id, channel_id, product_id\r\nORDER BY calc_date\r\n),\r\n\r\nperformance_table as \r\n(SELECT \r\n  IF(lot.calc_date is null, sp.date_spend, lot.calc_date) as calc_date,\r\n  IF(lot.line_mkt is null, sp.line_mkt, lot.line_mkt) as line_mkt,\r\n  IF(sp.country_id is null, lot.country_id, sp.country_id) as country_id,\r\n  IF(lot.channel_id is null, sp.channel_id, lot.channel_id) as channel_id,\r\n  IF(lot.product_id is null, sp.product_id, lot.product_id) as product_id,\r\n  SUM(sp.spend) as spend, \r\n  SUM(sp.spend_with_tax) as spend_with_tax,\r\n  SUM(lot.num_leads) as num_leads,\r\n  SUM(lot.num_leads_test) as num_leads_test,\r\n  SUM(lot.num_leads_test_approved) as num_leads_test_approved,\r\n  SUM(lot.leads_wait_for_order) as leads_wait_for_order,\r\n  SUM(lot.num_orders) as num_orders,\r\n  SUM(lot.order_value) as order_value,\r\n  \r\nFROM line_name_lead_order lot\r\nFULL JOIN line_name_spend sp\r\nON (lot.calc_date \u003d sp.date_spend AND lot.line_mkt \u003d sp.line_mkt AND lot.country_id \u003d sp.country_id AND lot.channel_id \u003d sp.channel_id AND lot.product_id\u003dsp.product_id) \r\n\r\nWHERE (lot.calc_date BETWEEN \u00272022-01-01\u0027 AND \u00272025-04-30\u0027) OR (sp.date_spend BETWEEN \u00272022-01-01\u0027 AND \u00272025-04-30\u0027)  -- Added date range filter\r\n\r\nGROUP BY calc_date, line_mkt, country_id, channel_id, product_id\r\nORDER BY calc_date \r\n)\r\n\r\nSELECT pt.*,\r\n      case \r\n          WHEN country_id \u003d 1 THEN \u0027Thailand\u0027\r\n          WHEN country_id \u003d 2 THEN \u0027Indo\u0027\r\n          WHEN country_id \u003d 3 THEN \u0027Việt Nam\u0027\r\n          WHEN country_id \u003d 4 THEN \u0027Khác\u0027\r\n          WHEN country_id \u003d 5 THEN \u0027Lào\u0027\r\n          WHEN country_id \u003d 6 THEN \u0027Malaysia\u0027\r\n          else \"Chưa biết\"\r\n      end as country,\r\n\r\n      case \r\n            when product_id \u003d 1 then \u0027Kids - 1 kèm 1\u0027\r\n            when product_id \u003d 2 then \u0027KEA - 1 kèm 1\u0027\r\n            when product_id \u003d 3 then \u0027Toán - 1 kèm 1\u0027\r\n            when product_id \u003d 4 then \u0027Kids - Class\u0027\r\n            when product_id \u003d 5 then \u0027Tuyển dụng GV\u0027\r\n            when product_id \u003d 6 then \u0027Khác\u0027\r\n            when product_id \u003d 7 then \u0027AI Tutor\u0027\r\n            else \"Chưa biết\"\r\n      end as product_name,\r\n\r\n      case \r\n          when channel_id \u003d 1 then \u0027Facebook\u0027\r\n          when channel_id \u003d 2 then \u0027Tiktok\u0027\r\n          when channel_id \u003d 3 then \u0027Google\u0027\r\n          else \"Chưa biết\"\r\n      end as channel_name\r\n\r\nFROM performance_table pt\r\nWHERE pt.calc_date BETWEEN \u00272022-01-01\u0027 AND \u00272025-04-30\u0027  -- Final date range filter;"
}, {
  "table_name": "ops_manager_fixed_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.ops_manager_fixed_view`\nAS with ops_manager as(\r\nselect ops_id,\r\n\r\n      case when ops_id in (1356139,915898,869872,928157,1054120,904136,295041) then 766719 \r\n           when ops_id in (724591,1490359) then 724591 \r\n           when ops_id in (287342) then null\r\n      else ops_manager_id\r\n      end as ops_manager_id,\r\nfrom `kynaforkids.ops_manager` om\r\ngroup by ops_id,ops_manager_id\r\n)\r\n\r\nselect ops_id,\r\n       ops_manager_id,\r\n      `kynaforkids-server-production.kynaforkids.func_get_email_from_kynaforkids_user`(ops_manager_id) as ops_manager_email,\r\n      (SELECT min(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u where u.id  \u003d ops_id) as email_ops,\r\nfrom ops_manager\r\n;"
}, {
  "table_name": "mkt_dieu_chinh_organic_fblines_93931ef4-def7-4955-99c7-ffeda394-03f3-4419-a5ae-36461591f7f9_t8xye40ltd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.mkt_dieu_chinh_organic_fblines_93931ef4-def7-4955-99c7-ffeda394-03f3-4419-a5ae-36461591f7f9_t8xye40ltd`\n(\n  calc_date DATE,\n  line_mkt STRING,\n  country_id INT64,\n  channel_id INT64,\n  product_id INT64,\n  spend INT64,\n  spend_with_tax FLOAT64,\n  line_id INT64,\n  num_leads FLOAT64,\n  num_leads_test FLOAT64,\n  num_leads_test_approved FLOAT64,\n  leads_wait_for_order FLOAT64,\n  num_orders FLOAT64,\n  order_value FLOAT64,\n  ai_single_order_vnd FLOAT64,\n  num_single_ai_orders FLOAT64,\n  country STRING,\n  product_name STRING,\n  channel_name STRING,\n  total_order_value FLOAT64\n);"
}, {
  "table_name": "temp_hoc_vien_kbc_thang_7_phase_3",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_hoc_vien_kbc_thang_7_phase_3`\n(\n  student_id INT64,\n  student_code STRING,\n  num_bookings_to_map INT64\n);"
}, {
  "table_name": "report_cac_kyna_aff_dmkt_trial_cashcollect_other_test_part_91ba7bf9-c30e-4ed3-98d9-a0dea42a833e",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_cac_kyna_aff_dmkt_trial_cashcollect_other_test_part_91ba7bf9-c30e-4ed3-98d9-a0dea42a833e`\n(\n  year_month STRING,\n  affiliate_cost FLOAT64,\n  dmkt_cost FLOAT64,\n  pt_tester_cost FLOAT64,\n  teacher_cost_hoc_thu FLOAT64,\n  total_tutoring_order_value FLOAT64,\n  total_ai_single_order_value FLOAT64,\n  total_order_value FLOAT64,\n  other_cost FLOAT64,\n  cash_collection_cost FLOAT64\n);"
}, {
  "table_name": "report_performance_bonus_test_e3f0d061-6f11-4539-8b97-1b8dab74fab8",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_performance_bonus_test_e3f0d061-6f11-4539-8b97-1b8dab74fab8`\n(\n  tc_email STRING,\n  booking_id INT64,\n  booking_name STRING,\n  booking_time TIMESTAMP,\n  teacher_name STRING,\n  teacher_email STRING,\n  teacher_country STRING,\n  country STRING,\n  student_name STRING,\n  student_email STRING,\n  student_code STRING,\n  booking_status STRING,\n  teacher_source STRING,\n  program STRING,\n  level_name STRING,\n  num_shift INT64,\n  currency_exchange_rate FLOAT64,\n  student_country STRING,\n  teacher_id INT64,\n  total_income NUMERIC,\n  tc_incharge_id INT64\n);"
}, {
  "table_name": "daily_sales_tracking_f0e49640-59a8-4ea5-b80e-f4301679fa1e_q726pnnnyd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.daily_sales_tracking_f0e49640-59a8-4ea5-b80e-f4301679fa1e_q726pnnnyd`\n(\n  t_date DATE,\n  sale_follow_email STRING,\n  sale_follow_name STRING,\n  sale_follow_supervisor_email STRING,\n  affiliate_category STRING,\n  affiliate_email STRING,\n  subject STRING,\n  num_lead_T INT64,\n  num_lead_T_1 INT64,\n  num_lead_T_2 INT64,\n  num_order_T INT64,\n  num_order_T_1 INT64,\n  num_order_T_2 INT64,\n  num_lead_rejected_T INT64,\n  num_lead_rejected_T1 INT64,\n  num_lead_rejected_T2 INT64,\n  num_lead_reject INT64\n);"
}, {
  "table_name": "writing_session_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.writing_session_view`\nAS SELECT \r\n        ws.* except(created_at, graded_at),\r\n        timestamp_seconds(created_at) as created_at,\r\n        timestamp_seconds(graded_at) as graded_at, \r\nFROM `kynaforkids-server-production.kynaforkids.writing_session` ws;"
}, {
  "table_name": "gv_Toan_first_booking_date_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.gv_Toan_first_booking_date_view`\nAS select\r\n      teacher_id,\r\n      teacher_name,\r\n      acceptance_or_reactivated_date as acceptance_date,\r\n      training_status,\r\n      teaching_training_date,\r\n      test_training_date,\r\n      final_contract_completion_date,\r\n      final_qualified_to_teach_date,\r\n      first_booking_date,\r\n      (\r\n       select \r\n             min(bs.id) as booking_id\r\n       from `kynaforkids.booking_session_view` bs \r\n       where date(bs.begin_at) \u003d first_booking_date \r\n             and bs.teacher_id \u003d t.teacher_id\r\n             and bs.status_id in (4,5)\r\n      ) as booking_id\r\n       \r\n\r\nfrom `datateam_kynaforkids.report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_1dxy898vpd` t\r\nwhere is_math_teacher_or_tester \u003d 1\r\n;"
}, {
  "table_name": "task_control_57ab7349-afa3-4308-b62a-afdcd3c61ca2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.task_control_57ab7349-afa3-4308-b62a-afdcd3c61ca2`\n(\n  task_id INT64,\n  subject STRING,\n  start_date DATE,\n  due_date DATE,\n  created_on TIMESTAMP,\n  closed_on DATETIME,\n  status STRING,\n  author_id INT64,\n  author_email STRING,\n  assigned_to_id INT64,\n  assigned_to_email STRING,\n  role_name STRING,\n  author_role_name STRING,\n  category STRING,\n  student_code STRING,\n  sub_category STRING,\n  lich_hen STRING,\n  tag STRING,\n  ly_do_close_task STRING,\n  estimated_hours FLOAT64,\n  first_change_status_at DATETIME,\n  student_country_id INT64,\n  program STRING,\n  student_country STRING,\n  task_booking_type STRING\n);"
}, {
  "table_name": "report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_vgyj9nxatd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_vgyj9nxatd`\n(\n  id INT64,\n  name STRING,\n  email STRING,\n  phone_number STRING,\n  birthday DATE,\n  sex STRING,\n  country STRING,\n  position STRING,\n  link_cv STRING,\n  interview_record STRING,\n  interview_by STRING,\n  interview_date DATE,\n  created_by STRING,\n  training_status_description STRING,\n  booked_training_date DATE,\n  candidate_status_description STRING,\n  point INT64,\n  comment STRING\n);"
}, {
  "table_name": "report_so_luong_gv_tieng_anh_468ec3fd-a8cf-4796-9916-330e4359e503_tn7mj0vatd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_so_luong_gv_tieng_anh_468ec3fd-a8cf-4796-9916-330e4359e503_tn7mj0vatd`\n(\n  id INT64,\n  name STRING,\n  email STRING,\n  phone_number STRING,\n  country STRING,\n  subject_name STRING,\n  recruit_source STRING,\n  source_name STRING,\n  type STRING,\n  candidate_status STRING,\n  candidate_pass_status INT64,\n  history STRING,\n  created_by STRING,\n  created_date DATE,\n  recall_date DATE,\n  tc_in_charge STRING\n);"
}, {
  "table_name": "append_table_booking_lead_15h_test",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.append_table_booking_lead_15h_test`\n(\n  id INT64,\n  created_at INT64,\n  updated_at INT64,\n  status INT64,\n  considerating_date DATE\n);"
}, {
  "table_name": "giai_bai_tap",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.giai_bai_tap`\n(\n  `booking_1-1` STRING,\n  `level_1-1` STRING,\n  level_giai_bai_tap STRING\n);"
}, {
  "table_name": "report_home_work_3347f178-f175-448f-a6f7-f1a66e370713",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_home_work_3347f178-f175-448f-a6f7-f1a66e370713`\n(\n  country_id INT64,\n  student_code STRING,\n  student_name STRING,\n  program_name STRING,\n  start_level_id INT64,\n  current_level_id INT64,\n  sc_incharge INT64,\n  code_homework STRING,\n  date_study DATE,\n  homework STRING,\n  score STRING,\n  booking_session_id INT64,\n  homework_id INT64,\n  is_completed_game INT64,\n  is_pass_speech INT64,\n  is_passed_quiz INT64,\n  certificate_commitment STRING,\n  remain_lesson INT64,\n  phone_number STRING,\n  status STRING,\n  expired_at DATETIME,\n  sc_email STRING,\n  student_country STRING,\n  start_level STRING,\n  current_level STRING\n);"
}, {
  "table_name": "reason_cancel_lead",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.reason_cancel_lead`\n(\n  reason_cancel_id STRING,\n  reason_cancel STRING\n);"
}, {
  "table_name": "quan_ly_btvn_a64182d8-036a-4c86-b475-fafa06d45fc8_jjgyfnkhtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.quan_ly_btvn_a64182d8-036a-4c86-b475-fafa06d45fc8_jjgyfnkhtd`\n(\n  Chuongtrinh STRING,\n  program_id INT64,\n  Cap_do_hoc STRING,\n  level_id INT64,\n  Ma_buoi_hoc STRING,\n  ten_buoi_hoc STRING,\n  Status_buoi_hoc STRING,\n  Ten_tai_lieu STRING,\n  Loai_tai_lieu STRING,\n  ID_tai_lieu INT64,\n  Show_learner STRING,\n  Show_teacher STRING,\n  Last_update_at DATE\n);"
}, {
  "table_name": "aca_cb_check_income_theo_booking_thanh_phan_chi_tiet_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.aca_cb_check_income_theo_booking_thanh_phan_chi_tiet_view`\nAS with booking_info as\r\n(\r\nSELECT \r\n  bs.id as booking_id,\r\n  (select bp.subject from `kynaforkids.booking_program` bp where bp.id \u003d bs.program_id) as subject,\r\n  (select bp.program_type from `kynaforkids.booking_program` bp where bp.id \u003d bs.program_id) as program_type,\r\n  bs.total_income,\r\n  bs.begin_at as booking_time,\r\n  bs.rating,\r\n  bs.status_id,\r\n  if(bs.status_id\u003d7 and bs.is_rating_approved\u003d1, bs.income,0) as kyna_compensation,\r\n\r\n  (select max(p.`name`) from `kynaforkids-server-production.kynaforkids.profile` p where p.user_id \u003d bs.teacher_id) as teacher_name,\r\n  case\r\n    when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 1 then \u0027Philippines\u0027\r\n    when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 2 then \u0027Native\u0027\r\n    when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 3 then \u0027Vietnamese\u0027\r\n    when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 4 then \u0027Thailand\u0027\r\n    when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 5 then \u0027Indonesia\u0027\r\n  when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 8 then \u0027Laos\u0027\r\n  when (select bt.country_id from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bt.user_id \u003d bs.teacher_id) \u003d 9 then \u0027Malaysia\u0027\r\n  end as teacher_country,\r\n  (select bp.number_of_shift from `kynaforkids-server-production.kynaforkids.booking_program` bp where bp.id \u003d bs.program_id ) as num_shift,\r\n  bs.teacher_id,\r\n  (select bt.teacher_source from `kynaforkids-server-production.kynaforkids.booking_teacher` bt where bs.teacher_id \u003d bt.user_id) as teacher_source,\r\n  \r\nFROM `kynaforkids-server-production.kynaforkids.booking_session_view` bs\r\ninner join `kynaforkids-server-production.kynaforkids.booking_session_student` bss on bs.id \u003d bss.booking_session_id \r\nwhere bs.program_id not in (select id from `kynaforkids-server-production.kynaforkids.booking_program` where type in (4)) \r\n      and  bs.program_id!\u003d3\r\n      and bs.status_id not in (1,2,3,4)\r\n      and format_datetime(\"%Y-%m\", bs.begin_at) \u003e\u003d \u00272025-05\u0027\r\n\r\n),\r\n\r\nsellingEx as\r\n(select ex.date, ex.sellingEx, ex.teacherCountry,\r\n        lead (ex.date) over (partition by ex.teacherCountry order by ex.date) as next_applied_date\r\n        from `kynaforkids-server-production.kynaforkids.Acc_teacher_income_ex` ex\r\n),\r\n\r\nincome_booking_teacher_details as\r\n(\r\nselect \r\n  format_datetime(\"%Y-%m\", t1.booking_time) as year_month,\r\n  t1.booking_id,\r\n  t1.num_shift,\r\n  t1.teacher_name,\r\n  t1.teacher_country,\r\n  t1.teacher_id,\r\n  t1.rating,\r\n  t1.status_id,\r\n  t1.subject,\r\n  t1.program_type,\r\n  `kynaforkids-server-production.kynaforkids.func_get_teacher_source`(t1.teacher_source) as teacher_source,\r\n  \r\n  \r\n  coalesce(max(bsi.income),0) as base_rate_income,                                                       --bs\r\n  coalesce(max(bsi.performance_bonus),0) as performance_bonus,                                           --bs\r\n  coalesce(max(bsi.replacement_bonus),0) as replacement_bonus,                                           --brb\r\n  coalesce(max(bsi.hot_bonus_income),0) as hot_bonus_income,                                             --bsi\r\n  coalesce(max(bsi.bonus_test_online_early_review),0) as bonus_test_online_early_review,                 --bsi\r\n  coalesce(max(bsi.bonus_test_online_golden_hour),0) as bonus_test_online_golden_hour,                   --bsi\r\n  coalesce(max(kyna_compensation),0) as kyna_compensation,\r\n  \r\n  coalesce(-max(bsi.rating_below_standard_penalty),0) as rating_below_standard_penalty,\r\n  coalesce(-max(bsi.open_webcam_below_standard_penalty),0) as open_webcam_below_standard_penalty,        -- i\r\n  coalesce(-max(bsi.full_face_below_standard_penalty),0) as full_face_below_standard_penalty,            ---\r\n  coalesce(-max(bsi.etiquette_violation_penalty),0) as etiquette_violation_penalty,                      --- -max-bsi\r\n  coalesce(-max(bsi.cancel_penalty_income),0) as cancel_penalty_income,                                  --bs\r\n  \r\n  \r\n  coalesce(max(bsi.income),0)                                             \r\n  + coalesce(max(bsi.performance_bonus),0)                                    \r\n  + coalesce(max(bsi.replacement_bonus),0)                                    \r\n  + coalesce(max(bsi.hot_bonus_income),0)                                     \r\n  + coalesce(max(bsi.bonus_test_online_early_review),0)                 \r\n  + coalesce(max(bsi.bonus_test_online_golden_hour),0)  \r\n  + coalesce(max(kyna_compensation),0)                \r\n  - coalesce(max(bsi.rating_below_standard_penalty),0)\r\n  - coalesce(max(bsi.open_webcam_below_standard_penalty),0)        \r\n  - coalesce(max(bsi.full_face_below_standard_penalty),0)             \r\n  - coalesce(max(bsi.etiquette_violation_penalty),0)                       \r\n  - coalesce(max(bsi.cancel_penalty_income),0) as total_income_calculated,                                \r\n\r\n  -- coalesce(max(t1.total_income),0) as total_income,                                                      \r\n  -- max(t2.sellingEx) as sellingEx,\r\n  -- coalesce(max(t1.total_income),0) * max(t2.sellingEx) as total_income_vnd\r\n  \r\n  \r\nfrom booking_info t1\r\ninner join `kynaforkids-server-production.kynaforkids.booking_session_student` bss on t1.booking_id \u003d bss.booking_session_id\r\nleft join `kynaforkids-server-production.kynaforkids.booking_session_income_view` bsi on t1.booking_id \u003d bsi.booking_session_id\r\njoin sellingEx t2 on date(t1.booking_time) \u003e\u003d t2.date and (date(t1.booking_time) \u003c t2.next_applied_date or t2.next_applied_date is null) and t1.teacher_country \u003d t2.teacherCountry\r\nwhere format_datetime(\"%Y-%m\", t1.booking_time) \u003e\u003d \u00272025-05\u0027\r\ngroup by year_month, t1.booking_id, t1.program_type, t1.num_shift, t1.rating, t1.status_id, t1.subject, t1.teacher_name, t1.teacher_country, t1.teacher_id, t1.teacher_source\r\norder by year_month desc \r\n)\r\n,\r\n\r\n\r\nresult_temp as\r\n(\r\nselect \r\n      ibt.year_month,\r\n      ibt.teacher_id,\r\n      ibt.teacher_name,\r\n      ibt.teacher_country,\r\n      ibt.teacher_source,\r\n\r\n      countif(ibt.program_type \u003d 1 and ibt.rating \u003d 2 and ibt.status_id \u003d 5 and ibt.subject \u003d 1) as num_teaching_booking_with_pf_bonus_english,\r\n  \r\n      countif(ibt.program_type \u003d 1 and ibt.rating \u003d 2 and ibt.status_id \u003d 5 and ibt.subject \u003d 2) as num_teaching_booking_with_pf_bonus_math,\r\n      \r\n      countif(ibt.program_type \u003d 1 and ibt.rating \u003d 2 and ibt.status_id \u003d 5) as num_teaching_booking_with_pf_bonus,\r\n      \r\n      SUM(CASE WHEN ibt.program_type \u003d 1 and ibt.subject \u003d 1 THEN performance_bonus ELSE 0 END) AS performance_bonus_teaching_english,\r\n      \r\n      SUM(CASE WHEN ibt.program_type \u003d 1 and ibt.subject \u003d 2 THEN performance_bonus ELSE 0 END) AS performance_bonus_teaching_math,\r\n\r\n      SUM(CASE WHEN ibt.program_type \u003d 2 THEN performance_bonus ELSE 0 END) AS performance_bonus_test,\r\n      \r\n            -- count(distinct b)\r\n      sum(base_rate_income) as base_rate_income,\r\n      -- sum(performance_bonus) as performance_bonus_temp,     \r\n      sum(performance_bonus) as performance_bonus,                                           --bs\r\n      sum(replacement_bonus) as replacement_bonus,                                           --brb\r\n      sum(hot_bonus_income) as hot_bonus_income,                                             --bsi\r\n      sum(bonus_test_online_early_review) as bonus_test_online_early_review,                 --bsi\r\n      sum(bonus_test_online_golden_hour) as bonus_test_online_golden_hour,                   --bsi\r\n\r\n      sum(rating_below_standard_penalty) as rating_below_standard_penalty,\r\n      sum(open_webcam_below_standard_penalty) as open_webcam_below_standard_penalty,        --bsi\r\n      sum(full_face_below_standard_penalty) as full_face_below_standard_penalty,            --bsi\r\n      sum(etiquette_violation_penalty) as etiquette_violation_penalty,                      --bsi\r\n      sum(cancel_penalty_income) as cancel_penalty_income,                                  --bs\r\n      sum(if(kyna_compensation\u003e0,kyna_compensation,0)) as income_kyna_compensation,\r\n\r\n      -- round(sum(total_income_calculated),2) as total_income_calculated_temp,\r\n      \r\n      round(sum(total_income_calculated),2) as total_income_calculated,\r\n\r\n      -- sum(total_income) as total_income,\r\n\r\n      -- max(sellingEx) as sellingEx,\r\n      \r\n      -- round(sum(total_income_vnd),2) as total_income_vnd\r\n\r\nfrom income_booking_teacher_details ibt\r\n-- where teacher_id \u003d 1505174\r\ngroup by year_month, teacher_id, teacher_name, teacher_country, teacher_source\r\n--having total_income_calculated !\u003d 0\r\norder by year_month desc --total_income_vnd desc\r\n)\r\n\r\nselect\r\n       *,\r\n\r\n\r\nfrom result_temp r\r\nwhere      \r\n      total_income_calculated !\u003d 0\r\norder by year_month desc\r\n;"
}, {
  "table_name": "thong_tin_gv_e4cbc45e-b903-49bf-b551-5843074ac0cb_cmv8lhj4wd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.thong_tin_gv_e4cbc45e-b903-49bf-b551-5843074ac0cb_cmv8lhj4wd`\n(\n  user_id INT64,\n  tc_email STRING,\n  teacher_country STRING,\n  teacher_name STRING,\n  teacher_source STRING,\n  trang_thai STRING,\n  enable_mapping INT64,\n  is_accepted_economy INT64,\n  is_show_profile INT64,\n  ignore_full_face_camera INT64,\n  is_not_map_new_student INT64,\n  last_action_enable_mapping DATE,\n  last_action_is_accepted_economy DATE,\n  last_action_is_show_profile DATE,\n  last_action_ignore_full_face_camera DATE,\n  last_action_is_not_map_new_student DATE\n);"
}, {
  "table_name": "report_hoc_vien_summer_camp_sales_9d119656-1e6d-454a-a617-93d42793c9fe",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hoc_vien_summer_camp_sales_9d119656-1e6d-454a-a617-93d42793c9fe`\n(\n  order_id INT64,\n  created_at DATE,\n  is_activated INT64,\n  phone_number STRING,\n  order_code STRING,\n  subscription_name STRING,\n  subscription_price INT64,\n  package_name STRING,\n  student_code STRING,\n  student_id INT64,\n  program_order STRING,\n  activation_status INT64,\n  activation_date DATE,\n  date_expired DATE,\n  student_name STRING,\n  sales_email STRING\n);"
}, {
  "table_name": "chat_luong_mkt_vn_cb09a9e7-3575-474f-b88e-6fb58512f931_gzo0ves9sd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.chat_luong_mkt_vn_cb09a9e7-3575-474f-b88e-6fb58512f931_gzo0ves9sd`\n(\n  cal_date DATE,\n  sale_id INT64,\n  trang_thai STRING,\n  affiliate_category STRING,\n  affiliate_email STRING,\n  affiliate_campaign STRING,\n  subject STRING,\n  num_leads INT64,\n  num_leads_status_lien_he INT64,\n  num_leads_status_tu_van_tham_gia_onl_off INT64,\n  num_leads_status_coc_hen_tt INT64,\n  num_leads_status_tu_choi_vi_ly_do_trung INT64,\n  num_leads_status_tu_choi_loai_ly_do_trung INT64,\n  num_leads_status_tu_choi INT64,\n  num_test_booked INT64,\n  num_test_completed INT64,\n  num_order_hoc_thu INT64,\n  num_order_ghi_danh_lan_dau INT64,\n  rev_ghi_danh_lan_dau NUMERIC,\n  sale_follow_email STRING,\n  sale_follow_supervisor_email STRING\n);"
}, {
  "table_name": "support_screening_teachers",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.datateam_kynaforkids.support_screening_teachers`\n(\n  date DATE,\n  name STRING,\n  email STRING,\n  phone STRING,\n  source STRING,\n  link_cv STRING,\n  position STRING,\n  apply_times STRING,\n  screener STRING,\n  team STRING,\n  status STRING,\n  note STRING\n)\nOPTIONS(\n  sheet_range\u003d\"A:L\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/1wTKBxf55CvRZXeI-ddy8nnOEOAjsNtimQfn2TgBq3aM/edit?gid\u003d894323640#gid\u003d894323640\"]\n);"
}, {
  "table_name": "telemarketing_52312e63-9f7a-4948-9fdf-8ccf1e9bbe11",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.telemarketing_52312e63-9f7a-4948-9fdf-8ccf1e9bbe11`\n(\n  calc_date DATE,\n  utm_campaign STRING,\n  email STRING,\n  affiliate_email STRING,\n  num_data_lead INT64,\n  num_data_tao_moi INT64,\n  num_data_open INT64,\n  num_data_tu_choi INT64,\n  is_blocked STRING,\n  num_transfered_to_lead INT64,\n  num_test INT64,\n  num_order INT64,\n  revenue FLOAT64,\n  num_order_from_event INT64\n);"
}, {
  "table_name": "mkt_dieu_chinh_organic_fblines_93931ef4-def7-4955-99c7-ffeda394-03f3-4419-a5ae-36461591f7f9_je4szv1ltd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.mkt_dieu_chinh_organic_fblines_93931ef4-def7-4955-99c7-ffeda394-03f3-4419-a5ae-36461591f7f9_je4szv1ltd`\n(\n  campaign_name STRING,\n  date_spend DATE,\n  channel_id INT64,\n  product_id INT64,\n  country_id INT64,\n  spend INT64,\n  spend_with_tax FLOAT64,\n  line_mkt STRING,\n  country STRING,\n  product_name STRING,\n  channel_name STRING\n);"
}, {
  "table_name": "kyna_eng_teacher_management_9a9ea35c-3271-4af4-ac49-61472d1ad616_tlvx0fj6sd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.kyna_eng_teacher_management_9a9ea35c-3271-4af4-ac49-61472d1ad616_tlvx0fj6sd`\n(\n  interview_date DATE,\n  acceptance_date DATE,\n  teacher_id INT64,\n  teacher_name STRING,\n  teacher_country STRING,\n  teacher_source INT64,\n  teaching_training_date DATE,\n  test_training_date DATE,\n  training_status_id INT64,\n  status_id INT64,\n  contract_status_id INT64,\n  contract_completion_date DATE,\n  contract_sign_status STRING,\n  deactivate_date DATE,\n  is_tester INT64,\n  tc_email STRING,\n  check_completed_booking_in_range INT64,\n  training_status STRING,\n  contract_status STRING,\n  source STRING,\n  status STRING,\n  least_training_date DATE,\n  ready_to_teach_date DATE\n);"
}, {
  "table_name": "order_detail_c40aefb4-2d28-40e2-a6d7-c5837d0dd66f",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.order_detail_c40aefb4-2d28-40e2-a6d7-c5837d0dd66f`\n(\n  ngay_tetesale_len_don TIMESTAMP,\n  invoice_code STRING,\n  id INT64,\n  package_id INT64,\n  subscription_name STRING,\n  status STRING,\n  Mon_hoc STRING,\n  student_name STRING,\n  student_email STRING,\n  student_phone STRING,\n  payment_method STRING,\n  payment_status STRING,\n  shipping_company STRING,\n  partner_code STRING,\n  sub_total NUMERIC,\n  unit_price NUMERIC,\n  discount_amount NUMERIC,\n  voucher_discount_amount NUMERIC,\n  shipping_fee NUMERIC,\n  created_at INT64,\n  updated_at INT64,\n  completed_at TIMESTAMP,\n  SIC STRING,\n  SIC_name STRING,\n  register_source STRING,\n  package_subscription_id INT64,\n  subscription STRING\n);"
}, {
  "table_name": "report_order_video_software_b3d19fe3-e9f2-4fb0-8d50-d1570ff3a5a6_5dyh0bq5td",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_order_video_software_b3d19fe3-e9f2-4fb0-8d50-d1570ff3a5a6_5dyh0bq5td`\n(\n  ngay_sale_len_don TIMESTAMP,\n  id INT64,\n  completed_at TIMESTAMP,\n  created_by INT64,\n  telesale_id INT64,\n  register_source STRING,\n  country_id INT64,\n  currency_code STRING,\n  country STRING,\n  currency_exchange_rate FLOAT64,\n  sub_total NUMERIC,\n  unit_price NUMERIC,\n  student_name STRING,\n  student_phone STRING,\n  student_email STRING,\n  invoice_code STRING,\n  status STRING,\n  payment_method_id INT64,\n  payment_status_id INT64,\n  lead_id INT64,\n  affiliate_id INT64,\n  package_id INT64,\n  package_subscription_id INT64,\n  Mon_hoc STRING,\n  payment_method STRING,\n  payment_status STRING,\n  discount_amount NUMERIC,\n  voucher_discount_amount NUMERIC,\n  shipping_fee NUMERIC,\n  SIC STRING,\n  SIC_name STRING,\n  package_subscription INT64,\n  affiliate_category_id INT64,\n  created_at TIMESTAMP,\n  first_time_purchase_phone TIMESTAMP,\n  first_time_purchase_email TIMESTAMP,\n  subscription_month INT64,\n  subscription_name STRING,\n  total_oc NUMERIC,\n  utm_campaign STRING,\n  landingpage_name STRING,\n  affiliate_email STRING,\n  affiliate_category_name STRING,\n  type_order_phone STRING,\n  type_order_email STRING,\n  action STRING,\n  order_action STRING,\n  actual_total_oc NUMERIC,\n  order_action_note STRING,\n  order_action_time DATETIME,\n  show_hide STRING\n);"
}, {
  "table_name": "chat_luong_mkt_thai_be16b558-b557-48b0-95c9-752b3d3a824f_yj8oqd8hsd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.chat_luong_mkt_thai_be16b558-b557-48b0-95c9-752b3d3a824f_yj8oqd8hsd`\n(\n  cal_date DATE,\n  sale_id INT64,\n  trang_thai STRING,\n  affiliate_category STRING,\n  affiliate_email STRING,\n  affiliate_campaign STRING,\n  subject STRING,\n  num_leads INT64,\n  num_leads_status_lien_he INT64,\n  num_leads_status_tu_van_tham_gia_onl_off INT64,\n  num_leads_status_coc_hen_tt INT64,\n  num_leads_status_tu_choi_vi_ly_do_trung INT64,\n  num_leads_status_tu_choi_loai_ly_do_trung INT64,\n  num_leads_status_tu_choi INT64,\n  num_test_booked INT64,\n  num_test_completed INT64,\n  num_order_hoc_thu INT64,\n  num_order_ghi_danh_lan_dau INT64,\n  rev_ghi_danh_lan_dau FLOAT64,\n  sale_follow_email STRING,\n  sale_follow_supervisor_email STRING\n);"
}, {
  "table_name": "temp_hoc_vien_kbc_thang_12_phase_1",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_hoc_vien_kbc_thang_12_phase_1`\n(\n  student_id INT64,\n  student_code STRING,\n  num_bookings_to_map INT64\n);"
}, {
  "table_name": "mkt_line_performance_a288a4f1-6045-4d6a-b5bf-b0856b204c95_fq8af5ahtd_2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.mkt_line_performance_a288a4f1-6045-4d6a-b5bf-b0856b204c95_fq8af5ahtd_2`\n(\n  lead_date DATE,\n  utm_campaign STRING,\n  country_id INT64,\n  line_id INT64,\n  line_mkt STRING,\n  country STRING,\n  num_leads FLOAT64,\n  num_leads_test FLOAT64,\n  num_leads_test_approved FLOAT64,\n  leads_wait_for_order FLOAT64\n);"
}, {
  "table_name": "du_lieu_gv_co_ca_day_on_dinh_d159d09f-723d-4e4f-b6c9-41e659e17ac3_6pqvjvnvyd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.du_lieu_gv_co_ca_day_on_dinh_d159d09f-723d-4e4f-b6c9-41e659e17ac3_6pqvjvnvyd`\n(\n  teacher_id INT64,\n  schedule_id INT64,\n  year_month STRING,\n  Thu_2 INT64,\n  Thu_3 INT64,\n  Thu_4 INT64,\n  Thu_5 INT64,\n  Thu_6 INT64,\n  Thu_7 INT64,\n  Chu_Nhat INT64,\n  Max_Thu_2 INT64,\n  Max_Thu_3 INT64,\n  Max_Thu_4 INT64,\n  Max_Thu_5 INT64,\n  Max_Thu_6 INT64,\n  Max_Thu_7 INT64,\n  Max_CN INT64\n);"
}, {
  "table_name": "report_team_ops_active_9ae866b8-a7f7-4eea-9c70-9ed002c536fb",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_team_ops_active_9ae866b8-a7f7-4eea-9c70-9ed002c536fb`\n(\n  start_date DATE,\n  task_id INT64,\n  assigned_to_email STRING,\n  student_country STRING,\n  status STRING,\n  is_overdue INT64,\n  student_code STRING\n);"
}, {
  "table_name": "booking_session_daily_native_since_2025_05",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.booking_session_daily_native_since_2025_05`\n(\n  id INT64,\n  teacher_id INT64,\n  teacher_priority_map_type INT64,\n  booking_class_id INT64,\n  schedule_id INT64,\n  lesson_id INT64,\n  name STRING,\n  status_id INT64,\n  error_id INT64,\n  cancel_status_id INT64,\n  income NUMERIC,\n  bonus_income NUMERIC,\n  rating_below_standard_penalty NUMERIC,\n  cancel_penalty_income NUMERIC,\n  total_income NUMERIC,\n  rating INT64,\n  is_rating_approved INT64,\n  cskh_note STRING,\n  academic_note STRING,\n  video_link STRING,\n  class_id STRING,\n  recording_url STRING,\n  co_presenter_url STRING,\n  presenter_url STRING,\n  visible INT64,\n  created_by INT64,\n  updated_by INT64,\n  is_compensatory_course INT64,\n  teacher_note STRING,\n  vocabulary INT64,\n  use_of_english INT64,\n  pronunciation INT64,\n  listening INT64,\n  speaking INT64,\n  reading_and_writing INT64,\n  cancel_config_id INT64,\n  program_id INT64,\n  lecture_content INT64,\n  system INT64,\n  lecturers INT64,\n  customer_care INT64,\n  student_rating_comment STRING,\n  student_rate_time INT64,\n  is_exception INT64,\n  wiziq_video_link STRING,\n  lms_type INT64,\n  number_of_shift INT64,\n  bbb_server_point INT64,\n  is_created_bbb_compensatory INT64,\n  ops_id INT64,\n  class_status INT64,\n  student_attitude INT64,\n  student_attitude_note STRING,\n  student_level INT64,\n  teaching_time INT64,\n  teaching_progress INT64,\n  total_slide_teacher_access INT64,\n  teacher_open_webcam_time_percent INT64,\n  rating_temp INT64,\n  teacher_type INT64,\n  teacher_country_id STRING,\n  bonus_income_temp NUMERIC,\n  teacher_base_salary NUMERIC,\n  teacher_base_bonus NUMERIC,\n  currency STRING,\n  is_student_join_meeeting INT64,\n  is_teacher_join_meeeting INT64,\n  record_number INT64,\n  disable_monitor INT64,\n  datastream_metadata STRUCT\u003cuuid STRING, source_timestamp INT64\u003e,\n  begin_at TIMESTAMP,\n  end_at TIMESTAMP,\n  created_at TIMESTAMP,\n  updated_at TIMESTAMP,\n  last_action_at TIMESTAMP,\n  teacher_note_at TIMESTAMP,\n  completed_or_ko_bu STRING,\n  income_type STRING\n);"
}, {
  "table_name": "report_cac_kyna_new_students_91ba7bf9-c30e-4ed3-98d9-a0dea42a833e",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_cac_kyna_new_students_91ba7bf9-c30e-4ed3-98d9-a0dea42a833e`\n(\n  year_month STRING,\n  num_new_students_tutoring INT64,\n  num_new_students_AI_single INT64,\n  total_new_students INT64,\n  num_all_students_tutoring INT64,\n  num_all_students_AI_single INT64,\n  num_all_students INT64,\n  rate_new FLOAT64\n);"
}, {
  "table_name": "temp_check_hv_chua_tung_bi_map_kbc",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_check_hv_chua_tung_bi_map_kbc`\n(\n  student_id INT64,\n  student_code STRING,\n  string_field_2 STRING,\n  string_field_3 STRING,\n  string_field_4 STRING,\n  string_field_5 STRING,\n  string_field_6 STRING,\n  string_field_7 STRING,\n  string_field_8 STRING,\n  string_field_9 STRING\n);"
}, {
  "table_name": "check_trang_thai_ung_vien_du_20_ca_day_32a84479-5410-418e-b1ac-2a067a2ab708",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.check_trang_thai_ung_vien_du_20_ca_day_32a84479-5410-418e-b1ac-2a067a2ab708`\n(\n  teacher_name STRING,\n  teacher_email STRING,\n  phone_number STRING,\n  candidate_status STRING,\n  so_ca_day_test STRING,\n  ngay_du_20_ca_day_test DATE,\n  teacher_id STRING,\n  ngay_tao_ung_vien DATE\n);"
}, {
  "table_name": "hoc_vien_va_gvcd_58c703ea-7b57-45be-84d2-1c214447e462_gZIKF",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.hoc_vien_va_gvcd_58c703ea-7b57-45be-84d2-1c214447e462_gZIKF`\n(\n  student_code STRING,\n  student_name STRING,\n  teacher_id INT64,\n  teacher_name STRING,\n  program_id INT64,\n  program STRING,\n  teacher_country STRING,\n  student_country STRING,\n  total_remaining_lessons INT64,\n  loai_hv STRING,\n  ops_email STRING\n);"
}, {
  "table_name": "telemarketing_52312e63-9f7a-4948-9fdf-8ccf1e9bbe11_f9tr2kt9sd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.telemarketing_52312e63-9f7a-4948-9fdf-8ccf1e9bbe11_f9tr2kt9sd`\n(\n  year_month STRING,\n  email STRING,\n  position STRING,\n  num_test INT64,\n  num_order INT64,\n  total_rev FLOAT64,\n  test_unit_bonus INT64,\n  order_unit_bonus INT64,\n  sup_sale_bonus FLOAT64,\n  CTV_hours FLOAT64,\n  CTV_month_salary FLOAT64,\n  Sales_intern_days FLOAT64,\n  num_days_of_month INT64,\n  num_work_days_of_month FLOAT64,\n  sales_intern_salary_per_work_day FLOAT64,\n  sales_intern_month_salary FLOAT64,\n  test_bonus INT64,\n  order_bonus INT64,\n  total_month_income FLOAT64,\n  sup_email STRING\n);"
}, {
  "table_name": "temp_hoc_vien_kbc_thang_8_phase_6_not_draft",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_hoc_vien_kbc_thang_8_phase_6_not_draft`\n(\n  student_id INT64,\n  student_code STRING,\n  num_bookings_to_map INT64,\n  num_august_remaining_bookings INT64,\n  num_august_remaining_new_waiting_approved_bookings INT64\n);"
}, {
  "table_name": "students_kbc_teacher_june_part_3",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.students_kbc_teacher_june_part_3`\n(\n  student_code STRING,\n  student_id INT64\n);"
}, {
  "table_name": "hoc_vien_va_gvcd_58c703ea-7b57-45be-84d2-1c214447e462_sv944rewvd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.hoc_vien_va_gvcd_58c703ea-7b57-45be-84d2-1c214447e462_sv944rewvd`\n(\n  student_id INT64,\n  student_code STRING,\n  student_country STRING,\n  student_type STRING,\n  program_name STRING,\n  teacher_gender_priority STRING,\n  priority_country_group_region_ids STRING,\n  program_id INT64,\n  only_map_fixed_teacher INT64,\n  num_shift INT64,\n  num_bspd_id INT64,\n  so_buoi_hoc FLOAT64,\n  so_buoi_can_gvcd FLOAT64,\n  so_buoi_ko_yeu_cau_gvcd FLOAT64,\n  total_remaining_lessons INT64,\n  year_month STRING\n);"
}, {
  "table_name": "thu_nhap_ops_5c194737-88de-48ca-93f4-552714c5f803_mvb3a6bhtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.thu_nhap_ops_5c194737-88de-48ca-93f4-552714c5f803_mvb3a6bhtd`\n(\n  year_month STRING,\n  ops_manager_email STRING,\n  email_ops STRING,\n  name_ops STRING,\n  completed_booking_number INT64,\n  booking_number_filter STRING,\n  student_number_1_to_6_booking INT64,\n  student_number_7_to_12_booking INT64,\n  student_number_13_to_18_booking INT64,\n  student_number_over_19 INT64\n);"
}, {
  "table_name": "temp_hoc_vien_kbc_thang_1_2026_phase_1",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_hoc_vien_kbc_thang_1_2026_phase_1`\n(\n  student_id INT64,\n  student_code STRING,\n  num_bookings_to_map STRING\n);"
}, {
  "table_name": "kyna_vn_location",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.kyna_vn_location`\n(\n  id INT64,\n  name STRING,\n  parent_id STRING,\n  position INT64,\n  status INT64,\n  is_deleted INT64,\n  created_time INT64,\n  updated_time INT64,\n  type STRING\n);"
}, {
  "table_name": "report_TC_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_rjbqqj0atd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_TC_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_rjbqqj0atd`\n(\n  teacher_income_vnd NUMERIC,\n  tc_email STRING,\n  booking_id INT64,\n  booking_name STRING,\n  booking_time TIMESTAMP,\n  teacher_name STRING,\n  teacher_email STRING,\n  teacher_country STRING,\n  teacher_country_id INT64,\n  country STRING,\n  student_name STRING,\n  student_email STRING,\n  student_code STRING,\n  booking_status STRING,\n  revenue NUMERIC,\n  teacher_source STRING,\n  program STRING,\n  program_group INT64,\n  num_shift INT64,\n  student_country STRING,\n  total_income NUMERIC,\n  teacher_id INT64,\n  revenue_vnd FLOAT64,\n  booking_rating STRING,\n  tc_incharge_id INT64\n);"
}, {
  "table_name": "order_tutoring_ad1672df-11fe-42f2-a5f8-a2e75d904708_j9fnaaijtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.order_tutoring_ad1672df-11fe-42f2-a5f8-a2e75d904708_j9fnaaijtd`\n(\n  Student_Code STRING,\n  Market STRING,\n  purchase_date STRING,\n  first_time_purchase STRING,\n  trial_date STRING,\n  Original_Price FLOAT64,\n  VND_Price FLOAT64,\n  type_order STRING\n);"
}, {
  "table_name": "temp_table_add_teacher_type_program_adhoc",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_table_add_teacher_type_program_adhoc`\n(\n  invoice_code STRING,\n  student_code STRING,\n  num_booking_gift INT64\n);"
}, {
  "table_name": "temp_hoc_vien_kbc_thang_8_phase_5",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_hoc_vien_kbc_thang_8_phase_5`\n(\n  student_id INT64,\n  student_code STRING,\n  num_bookings_to_map INT64\n);"
}, {
  "table_name": "thu_nhap_ops_5c194737-88de-48ca-93f4-552714c5f803_gz5y7fchtd_2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.thu_nhap_ops_5c194737-88de-48ca-93f4-552714c5f803_gz5y7fchtd_2`\n(\n  ngay_tao_don DATE,\n  invoice_code STRING,\n  revenue FLOAT64,\n  bonus_ops FLOAT64,\n  bonus_ops_lead FLOAT64,\n  ops_id INT64,\n  country_id INT64,\n  country STRING,\n  email_ops STRING,\n  name_ops STRING,\n  ops_manager_email STRING\n);"
}, {
  "table_name": "kyna_eng_teacher_management_9a9ea35c-3271-4af4-ac49-61472d1ad616_2wntb0i6sd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.kyna_eng_teacher_management_9a9ea35c-3271-4af4-ac49-61472d1ad616_2wntb0i6sd`\n(\n  user_id INT64,\n  certification_id INT64,\n  qualification_photos STRING,\n  ops_teacher_id INT64,\n  avatar STRING,\n  name STRING,\n  tc_email STRING,\n  certification STRING\n);"
}, {
  "table_name": "task_control_lien_quan_team_sales_fc233916-82e4-4d10-a7e5-3ee67b5513f5_5zohF",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.task_control_lien_quan_team_sales_fc233916-82e4-4d10-a7e5-3ee67b5513f5_5zohF`\n(\n  task_id INT64,\n  subject STRING,\n  start_date DATE,\n  due_date DATE,\n  created_on TIMESTAMP,\n  closed_on DATETIME,\n  status STRING,\n  author_id INT64,\n  author_email STRING,\n  assigned_to_id INT64,\n  assigned_to_email STRING,\n  role_name STRING,\n  author_role_name STRING,\n  category STRING,\n  student_code STRING,\n  sub_category STRING,\n  lich_hen STRING,\n  tag STRING,\n  ly_do_close_task STRING,\n  estimated_hours FLOAT64,\n  first_change_status_at DATETIME,\n  student_country_id INT64,\n  sale_name STRING,\n  sup_name STRING,\n  author_name STRING,\n  sup_author_name STRING,\n  student_country STRING\n);"
}, {
  "table_name": "temp_hoc_vien_kbc_thang_8_phase_3",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_hoc_vien_kbc_thang_8_phase_3`\n(\n  student_id INT64,\n  student_code STRING,\n  num_bookings_to_map INT64\n);"
}, {
  "table_name": "temp_hoc_vien_kbc_thang_1_2026_phase_2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_hoc_vien_kbc_thang_1_2026_phase_2`\n(\n  student_id INT64,\n  student_code STRING,\n  num_bookings_to_map INT64\n);"
}, {
  "table_name": "doanhthu_order_2022_10_01",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.doanhthu_order_2022_10_01`\nAS Select \r\n    date(bo.accounting_date) as accounting_date,\r\n    (select bsp.user_id from `kynaforkids-server-production.kynaforkids.booking_student` bst, `kynaforkids-server-production.kynaforkids.booking_student_program` bsp where bo.student_code \u003d bst.student_code and bst.user_id \u003d bsp.user_id and bsp.program_id \u003d bo.program_id) as user_id,\r\n\t\tbo.student_code as ma_hoc_vien,\r\n\t\t(select max(p.`name`) \r\n\t\t  from `kynaforkids-server-production.kynaforkids.profile`  p , `kynaforkids-server-production.kynaforkids.booking_student`  bst\r\n            where bst.student_code \u003d bo.student_code \r\n            and p.user_id \u003d bst.user_id) \r\n\t\tas student_name,\r\n\t\tmax(bo.email) as email,\r\n    max(bo.phone_number) as phone_number,\r\n    case\r\n      when max(bo.international_country_id) \u003d 1 then \u0027Thailand\u0027\r\n      when max(bo.international_country_id) \u003d 2 then \u0027Indo\u0027\r\n      when max(bo.international_country_id) \u003d 3 then \u0027Việt Nam\u0027\r\n      when max(bo.international_country_id) \u003d 4 then \u0027Khác\u0027\r\n    end as country,\r\n    -- ngaltt start\r\n    max(bo.currency_code) as currency_code,\r\n    max(bo.contract_code) as contract_code,\r\n    -- ngaltt end\r\n    max(bo.currency_exchange_rate) as currency_exchange_rate,\r\n    sum((bo.total * bo.currency_exchange_rate) + (bo.total_video_course * bo.currency_exchange_rate)) - sum(if(bo.discount_money is null, 0, (bo.discount_money * bo.currency_exchange_rate))) \r\n    as tong_thu_has_video_course,\r\n    sum(bo.total * bo.currency_exchange_rate) - sum(if(bo.discount_money is null, 0, (bo.discount_money * bo.currency_exchange_rate))) \r\n    as tong_thu,\r\n    sum(bo.total) - sum(if(bo.discount_money is null, 0, bo.discount_money)) as tong_thu_nguyen_te,\r\n    bo.program_id,\r\n  case\r\n\t\t\twhen bo.program_id \u003d 1 then \u0027Kyna English VIP\u0027\r\n\t\t\twhen bo.program_id \u003d 2 then \u0027Kyna English SPEAK\u0027\r\n\t\t\twhen bo.program_id \u003d 3 then \u0027Chương trình Demo\u0027\r\n\t\t\twhen bo.program_id \u003d 4 then \u0027Kyna English Tutorials\u0027\r\n\t\t\twhen bo.program_id \u003d 5 then \u0027Kyna English Class\u0027\r\n      when bo.program_id \u003d 6 then \u0027Kyna English Junior\u0027\r\n      when bo.program_id \u003d 7 then \u0027Kyna English Primary\u0027\r\n      when bo.program_id \u003d 8 then \u0027Chương trình Test Online\u0027\r\n      when bo.program_id \u003d 9 then \u0027Kyna English SPEAK JUNIOR\u0027\r\n      when bo.program_id \u003d 10 then \u0027Kyna English IELTS\u0027\r\n      when bo.program_id \u003d 11 then \u0027Kyna English Business\u0027\r\n      when bo.program_id \u003d 12 then \u0027Toán Tiểu Học\u0027\r\n      when bo.program_id \u003d 13 then \u0027Test Online (2 shifts)\u0027\r\n      when bo.program_id \u003d 14 then \u0027Kyna English Class Vip\u0027\r\n      when bo.program_id \u003d 15 then \u0027Kyna English Class Speak\u0027\r\n      when bo.program_id \u003d 16 then \u0027Kyna English Secondary\u0027\r\n      when bo.program_id \u003d 17 then \u0027Kyna English VIP 45MINS\u0027\r\n      when bo.program_id \u003d 18 then \u0027Kyna English SPEAK 45MINS\u0027\r\n      when bo.program_id \u003d 19 then \u0027Kyna English Tutorials 45MINS\u0027\r\n      when bo.program_id \u003d 20 then \u0027Toán Tiểu Học (Mẫu giáo - Lớp 1 - Lớp 2)\u0027\r\n      when bo.program_id \u003d 21 then \u0027KE Public Speaking I\u0027\r\n      when bo.program_id \u003d 22 then \u0027KE Public Speaking II\u0027\r\n\tend as program,\r\n  \u0027\u0027 as invoice_code\r\nfrom `kynaforkids-server-production.kynaforkids.booking_order_view`  bo\r\nwhere bo.payment_status \u003d 1 \r\n\tand bo.student_code is not null \r\ngroup by bo.student_code, bo.program_id, date(bo.accounting_date)\r\n\r\nunion all \r\n\r\nSelect \r\n  date(bo.accounting_date) as accounting_date,\r\n  0 as user_id,\r\n\t\u0027\u0027 as ma_hoc_vien,   \r\n  \u0027\u0027 as student_name,\r\n\tbo.email as email,\r\n  max(bo.phone_number) as phone_number,\r\n  case\r\n      when max(bo.international_country_id) \u003d 1 then \u0027Thailand\u0027\r\n      when max(bo.international_country_id) \u003d 2 then \u0027Indo\u0027\r\n      when max(bo.international_country_id) \u003d 3 then \u0027Việt Nam\u0027\r\n      when max(bo.international_country_id) \u003d 4 then \u0027Khác\u0027\r\n  end as country,\r\n  -- ngaltt start\r\n  max(bo.currency_code) as currency_code,\r\n  max(bo.contract_code) as contract_code,\r\n  -- ngaltt end\r\n  max(bo.currency_exchange_rate) as currency_exchange_rate,\r\n  sum((bo.total * bo.currency_exchange_rate) + (bo.total_video_course * bo.currency_exchange_rate)) - \r\n    sum(if(bo.discount_money is null, 0, (bo.discount_money * bo.currency_exchange_rate))) as tong_thu_has_video_course,\r\n  sum(bo.total * bo.currency_exchange_rate) - sum(if(bo.discount_money is null, 0, (bo.discount_money * bo.currency_exchange_rate))) \r\n  as tong_thu,\r\n  sum(bo.total) - sum(if(bo.discount_money is null, 0, bo.discount_money)) as tong_thu_nguyen_te,\r\n  bo.program_id,\r\n  case\r\n\t\t\twhen bo.program_id \u003d 1 then \u0027Kyna English VIP\u0027\r\n\t\t\twhen bo.program_id \u003d 2 then \u0027Kyna English SPEAK\u0027\r\n\t\t\twhen bo.program_id \u003d 3 then \u0027Chương trình Demo\u0027\r\n\t\t\twhen bo.program_id \u003d 4 then \u0027Kyna English Tutorials\u0027\r\n\t\t\twhen bo.program_id \u003d 5 then \u0027Kyna English Class\u0027\r\n      when bo.program_id \u003d 6 then \u0027Kyna English Junior\u0027\r\n      when bo.program_id \u003d 7 then \u0027Kyna English Primary\u0027\r\n      when bo.program_id \u003d 8 then \u0027Chương trình Test Online\u0027\r\n      when bo.program_id \u003d 9 then \u0027Kyna English SPEAK JUNIOR\u0027\r\n      when bo.program_id \u003d 10 then \u0027Kyna English IELTS\u0027\r\n      when bo.program_id \u003d 11 then \u0027Kyna English Business\u0027\r\n      when bo.program_id \u003d 12 then \u0027Toán Tiểu Học\u0027\r\n      when bo.program_id \u003d 13 then \u0027Test Online (2 shifts)\u0027\r\n      when bo.program_id \u003d 14 then \u0027Kyna English Class Vip\u0027\r\n      when bo.program_id \u003d 15 then \u0027Kyna English Class Speak\u0027\r\n      when bo.program_id \u003d 16 then \u0027Kyna English Secondary\u0027\r\n      when bo.program_id \u003d 17 then \u0027Kyna English VIP 45MINS\u0027\r\n      when bo.program_id \u003d 18 then \u0027Kyna English SPEAK 45MINS\u0027\r\n      when bo.program_id \u003d 19 then \u0027Kyna English Tutorials 45MINS\u0027\r\n      when bo.program_id \u003d 20 then \u0027Toán Tiểu Học (Mẫu giáo - Lớp 1 - Lớp 2)\u0027\r\n      when bo.program_id \u003d 21 then \u0027KE Public Speaking I\u0027\r\n      when bo.program_id \u003d 22 then \u0027KE Public Speaking II\u0027\r\n\tend as program,\r\n  string_agg(bo.invoice_code) as invoice_code\r\nfrom `kynaforkids-server-production.kynaforkids.booking_order_view`  bo\r\nwhere bo.payment_status \u003d 1 \r\n  and bo.student_code is null \r\ngroup by bo.email, bo.program_id, date(bo.accounting_date)  ;"
}, {
  "table_name": "report_hieu_qua_partnership_312a51c8-b964-4328-b959-d027909dd30f_p_645es6sbtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hieu_qua_partnership_312a51c8-b964-4328-b959-d027909dd30f_p_645es6sbtd`\n(\n  bd_email STRING,\n  created_at DATE,\n  affiliate_type STRING,\n  affiliate_email STRING,\n  affiliate_campaign STRING,\n  dang_bai_dai_su STRING,\n  Blocked_Open STRING,\n  num_lead INT64,\n  num_order INT64,\n  num_order_ghi_danh_lan_dau_hv_moi_hoan_thanh_ko_duyet_chua_duyet INT64,\n  num_order_ghi_danh_lai_hv_cu_hoan_thanh_ko_duyet_chua_duyet INT64,\n  doanh_thu_ghi_danh_lan_dau NUMERIC,\n  doanh_thu_ghi_danh_lai NUMERIC,\n  hoa_hong_vnd FLOAT64\n);"
}, {
  "table_name": "support_screening_teachers_new",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.datateam_kynaforkids.support_screening_teachers_new`\n(\n  date DATE,\n  name STRING,\n  email STRING,\n  phone STRING,\n  source STRING,\n  link_cv STRING,\n  position STRING,\n  apply_times STRING,\n  screener STRING,\n  team STRING,\n  status STRING,\n  note STRING\n)\nOPTIONS(\n  sheet_range\u003d\"Nhập liệu!A:L\",\n  skip_leading_rows\u003d3,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/1uQv-_2sz5Z-Funr1nleqd8JkG4R8WWPxOomqMADOmpY/edit?gid\u003d811099923#gid\u003d811099923\"]\n);"
}, {
  "table_name": "temp_hoc_vien_kbc_thang_8_phase_1",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_hoc_vien_kbc_thang_8_phase_1`\n(\n  student_id INT64,\n  student_code STRING,\n  num_bookings_to_map INT64\n);"
}, {
  "table_name": "kbc_map_thang9_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.kbc_map_thang9_view`\nAS -- Student ID\r\n-- Student Code\r\n-- Loại học viên (Trẻ em/Người lớn)\r\n-- Số buổi đã hoàn thành\r\n-- Số buổi còn lại\r\n-- Số bookings tháng 9/2025\r\n-- Số bookings đã map với KBC tháng 8/2025\r\n-- Số booking thật sự bị cancel bởi KBC tháng 8/2025\r\n-- Số bookings trước giờ từng map với KBC\r\n-- Số booking thật sự bị cancel bởi KBC trước giờ\r\n\r\nwith\r\n\r\ntarget_students AS (\r\nSELECT \r\n       bs.user_id as student_id, \r\n       bs.student_code, \r\n       bs.user_type_id,\r\n      --  bsp.program_id,\r\n       count(distinct bsn.id) as num_completed_bookings, \r\nFROM `kynaforkids-server-production.kynaforkids.booking_student` bs\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_session_student` bssn\r\n        ON (bs.user_id \u003d bssn.student_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_student_program` bsp\r\n        ON (bsp.user_id \u003d bs.user_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_session_view` bsn\r\n        ON (bssn.booking_session_id \u003d bsn.id and bsp.program_id \u003d bsn.program_id)\r\n\r\nWHERE bs.is_user_test \u003d 0\r\n      and bs.country_id \u003d 3\r\n      and bsp.program_id not in (select bp.id from `kynaforkids.booking_program` bp where bp.type in (2,3,4) or bp.program_type in (2))\r\n      and bsp.program_id not in (3,106,107,108,109,110,111,112)\r\n      AND bsn.status_id in (4,5)\r\n      And bsn.program_id not in (select bp.id from `kynaforkids.booking_program` bp where bp.type in (2,3,4) or bp.program_type in (2))\r\n      and bsn.program_id not in (3,106,107,108,109,110,111,112)\r\n      AND cast(bsn.begin_at as datetime) \u003c current_datetime(\"UTC+7\")     \r\n      --AND (date(bsn.begin_at) \u003e\u003d \u00272024-10-01\u0027 AND date(bsn.begin_at) \u003c\u003d \u00272024-10-31\u0027) \r\nGROUP BY bs.user_id, bs.student_code, bs.user_type_id --, bsp.program_id\r\n),\r\n\r\n-- Tính tổng số lesson còn lại của học sinh ở các chương trình mà học sinh đang học với các ràng buộc như trên \r\nremaining_bookings_program AS (\r\nSELECT bs.user_id, bs.student_code, bsp.program_id,\r\n       max(coalesce(bsp.remain_lesson,0)) as bookings_program_remain\r\nFROM `kynaforkids-server-production.kynaforkids.booking_student` bs\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_student_program` bsp ON (bsp.user_id \u003d bs.user_id)\r\nWHERE bs.is_user_test \u003d 0 \r\n      AND bsp.program_id not in (select bp.id from `kynaforkids-server-production.kynaforkids.booking_program` bp where bp.program_type \u003d 2 or bp.id in (3,88,106,107,108,109,110,111,112) or bp.type in (2,3,4))\r\nGROUP BY bs.user_id, bs.student_code, bsp.program_id\r\n),\r\n\r\n-- Tính số booking đã được chạy ở các trạng thái draft, new, waiting approve, approved (lấy ở ngày hiện tại trở đi)\r\nremaining_bookings_booked AS (\r\nSELECT \r\n      bs.user_id, \r\n      bs.student_code, \r\n      bsp.program_id, \r\n      count(distinct bsn.id) as bookings_booked\r\nFROM `kynaforkids-server-production.kynaforkids.booking_student` bs\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_student_program` bsp ON (bsp.user_id \u003d bs.user_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_session_student` bssn\r\n        ON (bs.user_id \u003d bssn.student_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_session_view` bsn\r\n        ON (bssn.booking_session_id \u003d bsn.id and bsp.program_id \u003d bsn.program_id)\r\nWHERE bs.is_user_test \u003d 0 \r\n      AND bsn.status_id in (1,2,3,4)\r\n      AND bsn.program_id not in (select bp.id from `kynaforkids-server-production.kynaforkids.booking_program` bp where bp.program_type \u003d 2 or bp.id in (3,88,106,107,108,109,110,111,112) or bp.type in (2,3,4))\r\n      AND cast(bsn.begin_at as datetime) \u003e current_datetime(\"UTC+7\")\r\nGROUP BY bs.user_id, bs.student_code, bsp.program_id\r\n),\r\n\r\n-- Tính tổng số booking còn lại của học viên (lấy 2 số trên cộng lại với nhau)\r\nremaining_bookings AS (\r\nSELECT rbp.user_id, --rbp.program_id,-- rbp.program_name, \r\n      --  max(rbp.bookings_program_remain) + max(coalesce(rbb.bookings_booked,0)) as total_remaining_lessons,\r\n       sum(rbp.bookings_program_remain) + sum(coalesce(rbb.bookings_booked,0)) as total_remaining_lessons,\r\n\r\n       --`kynaforkids-server-production.kynaforkids.func_get_student_name_from_profile_by_student_id`(rbp.user_id) as student_name \r\nFROM remaining_bookings_program rbp\r\nLEFT JOIN remaining_bookings_booked rbb ON(rbp.user_id \u003d rbb.user_id AND rbp.program_id \u003d rbb.program_id)\r\nWHERE rbp.program_id not in (select bp.id from `kynaforkids-server-production.kynaforkids.booking_program` bp where bp.program_type \u003d 2 or bp.id in (3,88,106,107,108,109,110,111,112) or bp.type in (2,3,4))\r\nGROUP BY rbp.user_id--, rbp.program_id\r\n),\r\n\r\n\r\nresult_booking_economy as(\r\nselect \r\n      r.first_booking_id,\r\n      r.secondary_booking_id\r\n\r\nfrom `datateam_kynaforkids.hieu_qua_ghep_lop_economy_0f2ad318-1e72-496a-9a5b-d7ecf36b7c11` r\r\nwhere date(ngay_hoc) \u003e\u003d current_date() \r\n      and r.economy_status \u003d \"Ghép được\"\r\n),\r\n\r\nbookings_matched_temp as\r\n(\r\n  select \r\n        distinct r.first_booking_id as booking_id\r\n  from result_booking_economy r\r\n\r\n  union all\r\n\r\n  select \r\n        distinct r.secondary_booking_id as booking_id\r\n  from result_booking_economy r\r\n),\r\n\r\nmatched_bookings as\r\n(\r\nselect distinct booking_id from bookings_matched_temp\r\nwhere booking_id is not null\r\n),\r\n\r\nstudent_sep_2025_bookings as \r\n(\r\nselect\r\n      bss.student_id,\r\n      -- bs.program_id,\r\n      count(distinct bs.id) as num_sep_bookings,\r\n      -- countif(bs.status_id \u003d 1) as num_draft_bookings,\r\n      -- countif(bs.status_id !\u003d 1) as num_new_waiting_approved_bookings,\r\n      -- string_agg(`kynaforkids-server-production.kynaforkids.func_get_booking_status`(bs.status_id, bs.cancel_config_id),\", \") as august_bookings_status,\r\n\r\n      (select bst.student_code from `kynaforkids.booking_student` bst where bst.user_id \u003dbss.student_id) as student_code,\r\n\r\nfrom `kynaforkids.booking_session_view` bs\r\nleft join `kynaforkids.booking_session_student` bss on bs.id \u003d bss.booking_session_id\r\nwhere format_datetime(\"%Y-%m\",bs.begin_at) \u003d \u00272025-09\u0027 and date(bs.begin_at) \u003e current_date()\r\n      and bs.status_id in (1,2,3,4)\r\n      and bs.program_id not in (select bp.id from `kynaforkids-server-production.kynaforkids.booking_program` bp where bp.program_type \u003d 2 or bp.id in (3,88,106,107,108,109,110,111,112) or bp.type in (2,3,4))\r\n      and bss.country_id \u003d 3\r\n      and (select bst.student_code from `kynaforkids.booking_student` bst where bst.user_id \u003dbss.student_id) like \"K%\"\r\n      and bs.id not in (select distinct booking_id from matched_bookings)\r\ngroup by bss.student_id--, program_id \r\norder by num_sep_bookings desc     \r\n),\r\n\r\nbookings_kbc_all as\r\n(\r\nselect \r\n      bs.id as booking_id,\r\n      bst.student_code,\r\n      bst.user_type_id,\r\n      bs.program_id,\r\n      bst.user_id as student_id,\r\n      bs.teacher_id as kbc_teacher_id,\r\n      bs.cancel_config_id,\r\n      format_datetime(\"%Y-%m\",bs.begin_at) as year_month,\r\nfrom `kynaforkids.booking_session_view` bs\r\nleft join `kynaforkids.booking_session_student` bss on bss.booking_session_id \u003d bs.id\r\nleft join `kynaforkids.booking_student` bst on bst.user_id \u003d bss.student_id\r\nwhere --bs.cancel_config_id \u003d 1 --or bs.cancel_config_id \u003d 3 or bs.cancel_config_id \u003d 10\r\n      bs.teacher_id \u003d 1946838\r\n),\r\n\r\nkbc_summary as\r\n(\r\nselect\r\n      bkbc.student_id,\r\n      count(distinct bkbc.booking_id) as num_map_kbc_bookings,\r\n      countif(bkbc.cancel_config_id \u003d 1) as num_cancel_by_kbc_teacher_bookings,\r\nfrom bookings_kbc_all bkbc\r\ngroup by student_id\r\n),\r\n\r\naugust_kbc_summary as\r\n(\r\nselect\r\n      bkbc.student_id,\r\n      count(distinct bkbc.booking_id) as num_map_kbc_bookings,\r\n      countif(bkbc.cancel_config_id \u003d 1) as num_cancel_by_kbc_teacher_bookings,\r\n      \r\nfrom bookings_kbc_all bkbc\r\nwhere year_month \u003d \u00272025-08\u0027\r\ngroup by student_id\r\n)\r\n\r\nselect \r\n      ts.* except(user_type_id),\r\n      case when ts.user_type_id \u003d 1 then \u0027Trẻ em\u0027\r\n           when ts.user_type_id \u003d 2 then \u0027Người lớn\u0027\r\n           else \"Chưa biết\"\r\n      end as student_type,\r\n      rb.total_remaining_lessons,\r\n      stsep.num_sep_bookings as num_sep_05_30_bookings, \r\n      coalesce(auks.num_map_kbc_bookings,0) as num_august_map_kbc_bookings,\r\n      coalesce(auks.num_cancel_by_kbc_teacher_bookings,0) as num_august_cancel_by_kbc_teacher_bookings,\r\n      coalesce(ks.num_map_kbc_bookings,0) as num_map_kbc_bookings,\r\n      coalesce(ks.num_cancel_by_kbc_teacher_bookings,0) as num_cancel_by_kbc_teacher_bookings,\r\nfrom student_sep_2025_bookings stsep \r\nleft join remaining_bookings rb on rb.user_id \u003d stsep.student_id\r\nleft join target_students ts on ts.student_id \u003d stsep.student_id\r\nleft join kbc_summary ks on ks.student_id \u003d stsep.student_id\r\nleft join august_kbc_summary auks on auks.student_id \u003d stsep.student_id\r\nwhere stsep.num_sep_bookings \u003e 0 \r\n      and ts.num_completed_bookings \u003e 0\r\n      and rb.total_remaining_lessons \u003e 0;"
}, {
  "table_name": "booking_group_talk_summer_camp_giai_bai_tap_bb2f6733-fcc9-4708-9d0a-d55477e7d904",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.booking_group_talk_summer_camp_giai_bai_tap_bb2f6733-fcc9-4708-9d0a-d55477e7d904`\n(\n  booking_id INT64,\n  status_id INT64,\n  cancel_config_id INT64,\n  level STRING,\n  lesson_name STRING,\n  ngay_hoc DATE,\n  begin_at TIMESTAMP,\n  khung_gio STRING,\n  teacher_id INT64,\n  teacher_name STRING,\n  teacher_email STRING,\n  tc_email STRING,\n  booking_status STRING,\n  bonus_status STRING,\n  teaching_time INT64,\n  thoi_gian_day STRING,\n  cancel_time_by_kyna STRING,\n  program STRING,\n  action INT64,\n  cancel_time STRING,\n  canceled_by STRING,\n  room_id INT64,\n  group_talk_id INT64,\n  num_student_registered INT64,\n  num_student_learned INT64,\n  learned_rate FLOAT64\n);"
}, {
  "table_name": "kyna_vn_location_refined",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.kyna_vn_location_refined`\nAS with \r\n\r\nshort_god_huyen as \r\n(\r\nselect \r\n      god.province_id,\r\n      god.province_name,\r\n      god.name,\r\n      case when god.name like \"Thành phố%\" then trim(right(god.name,length(god.name)-10))\r\n           when god.name like \"Quận%\" then trim(right(god.name,length(god.name)-5))\r\n           when god.name like \"Huyện%\" then trim(right(god.name,length(god.name)-6))\r\n           when god.name like \"Thị trấn%\" then trim(right(god.name,length(god.name)-9))\r\n           when god.name like \"Thị xã%\" then trim(right(god.name,length(god.name)-7))\r\n           else god.name\r\n      end as god_short_name\r\nfrom `kynaforkids.gso_district` god\r\n),\r\n\r\nhuyen_tinh as\r\n(\r\nSELECT \r\n      god.god_short_name as district_name, \r\n      max(gop.name) as province_name,\r\n      \r\nFROM short_god_huyen god\r\nLEFT JOIN `kynaforkids.gso_province` gop on gop.gso_id \u003d god.province_id\r\ngroup by district_name\r\n)\r\n\r\n-- select * from huyen_tinh\r\n\r\nselect \r\n      kl.* except (parent_id,position,status,is_deleted,created_time,updated_time,type),\r\n      -- ht.district_name,\r\n      -- ht.province_name,\r\n      case when ht.province_name like \"Thành phố%\" then trim(right(ht.province_name,length(ht.province_name)-10))\r\n           when ht.province_name like \"Tỉnh%\" then trim(right(ht.province_name,length(ht.province_name)-5))\r\n           else ht.province_name\r\n      end as province_refined\r\nfrom `datateam_kynaforkids.kyna_vn_location` kl\r\nleft join huyen_tinh ht on lower(ht.district_name) \u003d lower(kl.name)\r\n;"
}, {
  "table_name": "booking_1_1_6b9718cf-9c3f-4878-8955-eeb2f4bbe054",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.booking_1_1_6b9718cf-9c3f-4878-8955-eeb2f4bbe054`\n(\n  teacher_income_vnd FLOAT64,\n  booking_id INT64,\n  booking_name STRING,\n  booking_time TIMESTAMP,\n  booking_type STRING,\n  teacher_name STRING,\n  teacher_email STRING,\n  teacher_country STRING,\n  teacher_country_id INT64,\n  country STRING,\n  student_name STRING,\n  student_email STRING,\n  student_code STRING,\n  booking_status STRING,\n  revenue NUMERIC,\n  open_webcam_below_standard_penalty NUMERIC,\n  teacher_source STRING,\n  program STRING,\n  currency_exchange_rate FLOAT64,\n  student_country STRING,\n  total_income NUMERIC,\n  income NUMERIC,\n  teacher_id INT64,\n  payment_content STRING,\n  revenue_vnd FLOAT64,\n  bonus STRING,\n  revenue_teacher_income FLOAT64,\n  bonus_income NUMERIC,\n  center_name STRING,\n  name_ops STRING,\n  loai_buoi_hoc STRING\n);"
}, {
  "table_name": "telemarketing_52312e63-9f7a-4948-9fdf-8ccf1e9bbe11_hypau9t9sd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.telemarketing_52312e63-9f7a-4948-9fdf-8ccf1e9bbe11_hypau9t9sd`\n(\n  ngay DATE,\n  lead_id INT64,\n  email_ctv STRING,\n  phone_number STRING,\n  utm_campaign STRING,\n  affiliate_email STRING,\n  ngay_test DATE,\n  ngay_hach_toan DATE,\n  order_id INT64,\n  invoice_code STRING,\n  revenue FLOAT64,\n  is_from_event INT64\n);"
}, {
  "table_name": "chat_luong_mkt_cb09a9e7-3575-474f-b88e-6fb58512f931_evrbw4r9sd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.chat_luong_mkt_cb09a9e7-3575-474f-b88e-6fb58512f931_evrbw4r9sd`\n(\n  cal_date DATE,\n  sale_id INT64,\n  trang_thai STRING,\n  affiliate_category STRING,\n  affiliate_email STRING,\n  affiliate_campaign STRING,\n  subject STRING,\n  num_leads INT64,\n  num_leads_status_lien_he INT64,\n  num_leads_status_tu_van_tham_gia_onl_off INT64,\n  num_leads_status_coc_hen_tt INT64,\n  num_leads_status_tu_choi_vi_ly_do_trung INT64,\n  num_leads_status_tu_choi_loai_ly_do_trung INT64,\n  num_leads_status_tu_choi INT64,\n  num_test_booked INT64,\n  num_test_completed INT64,\n  num_order_hoc_thu INT64,\n  num_order_ghi_danh_lan_dau INT64,\n  rev_ghi_danh_lan_dau NUMERIC,\n  sale_follow_email STRING,\n  sale_follow_supervisor_email STRING\n);"
}, {
  "table_name": "quan_ly_kiem_tra_viet_6b72d316-da10-42bb-a24e-7e68538104ef",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.quan_ly_kiem_tra_viet_6b72d316-da10-42bb-a24e-7e68538104ef`\n(\n  children_name STRING,\n  email STRING,\n  student_code STRING,\n  writing_name STRING,\n  created_at TIMESTAMP,\n  total_score FLOAT64,\n  is_graded STRING,\n  is_passed STRING,\n  graded_by STRING,\n  graded_at TIMESTAMP,\n  writing_type STRING\n);"
}, {
  "table_name": "ds_HV_ops_da_call_economy",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.ds_HV_ops_da_call_economy`\n(\n  string_field_0 STRING\n);"
}, {
  "table_name": "teacher_income_1_1_8b7cebb7-2377-43de-b4c7-30f363857402",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.teacher_income_1_1_8b7cebb7-2377-43de-b4c7-30f363857402`\n(\n  id INT64,\n  teacher_id INT64,\n  teacher_email STRING,\n  name STRING,\n  quoc_tich STRING,\n  trang_thai_hop_dong STRING,\n  status STRING,\n  TC_in_charge STRING,\n  teacher_source STRING,\n  contract_end_at DATE,\n  terminate_date STRING,\n  ngay_thu_nhap DATE,\n  num_of_real_class INT64,\n  num_of_teacher_wrong_cancel INT64,\n  num_of_kyna_50_percent_cancel INT64,\n  num_of_kyna_100_percent_cancel INT64,\n  num_of_rating_below_standard INT64,\n  no_pay_class INT64,\n  num_of_open_webcam_below_standard INT64,\n  number_of_etiquette_violation INT64,\n  income_basic_salary NUMERIC,\n  income_of_qualified_class NUMERIC,\n  income_of_replacement_bonus NUMERIC,\n  penalty_kyna_50_percent_cancel NUMERIC,\n  penalty_kyna_100_percent_cancel NUMERIC,\n  total_bonus_test_online_early_review NUMERIC,\n  total_bonus_test_online_golden_hour NUMERIC,\n  income_base_salary NUMERIC,\n  bonus_qualified_class NUMERIC,\n  bonus_replacement NUMERIC,\n  hot_bonus FLOAT64,\n  kyna_compensation_50 NUMERIC,\n  kyna_compensation_100 NUMERIC,\n  bonus_test_early_review NUMERIC,\n  bonus_test_golden_hour NUMERIC,\n  total_money_rating_below_standard NUMERIC,\n  penalty_teacher_wrong_cancel NUMERIC,\n  open_webcam_below_standard_penalty NUMERIC,\n  etiquette_violation_penalty NUMERIC,\n  total_full_face_below_standard_penalty FLOAT64,\n  penalty_rating_below_standard NUMERIC,\n  penalty_wrong_cancel NUMERIC,\n  penalty_open_webcam NUMERIC,\n  penalty_code_of_conduct NUMERIC,\n  penalty_full_face FLOAT64,\n  penalty_over_cancel NUMERIC,\n  golden_hour_bonus NUMERIC,\n  golden_hour_bonus_plus NUMERIC,\n  Fsb_Level_1_Bonus NUMERIC,\n  Fsb_Level_2_Bonus NUMERIC,\n  fsb_quarter_bonus NUMERIC,\n  adjustment_income FLOAT64,\n  other_adjustment NUMERIC,\n  referral_income NUMERIC,\n  intro_income NUMERIC,\n  other_income NUMERIC,\n  last_month_adjustment_income NUMERIC,\n  gross_income NUMERIC,\n  income_oc FLOAT64,\n  no_pay_base_rate FLOAT64,\n  golden_hour_bonus_final NUMERIC,\n  total_gross_income FLOAT64,\n  sellingEX FLOAT64\n);"
}, {
  "table_name": "fixed_schedule_bonus_ec36f78c-7afc-400d-8d70-e3efb41afba6_drljrjbzrd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.fixed_schedule_bonus_ec36f78c-7afc-400d-8d70-e3efb41afba6_drljrjbzrd`\n(\n  teacher_id INT64,\n  year INT64,\n  quarter INT64,\n  teacher_name STRING,\n  tc_in_charge STRING,\n  total_hv_fsq INT64,\n  total_fsq INT64\n);"
}, {
  "table_name": "refund_order_2022_10_01",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.refund_order_2022_10_01`\nAS select \r\n  (select bst.student_code from `kynaforkids-server-production.kynaforkids.booking_student` bst where bst.user_id \u003d t1.student_id) as student_code,\r\n  (select max(p.name) from `kynaforkids-server-production.kynaforkids.profile` p where p.user_id \u003d t1.student_id) as student_name,\r\n  case\r\n      when if(t1.type \u003d 1,(select t2.international_country_id from `kynaforkids-server-production.kynaforkids.booking_order` t2 where t2.id \u003d t1.order_id)\r\n      ,(select bst.country_id from `kynaforkids-server-production.kynaforkids.booking_student` bst where bst.user_id \u003d t1.student_id)) \u003d 1 then \u0027Thailand\u0027\r\n      when if(t1.type \u003d 1,(select t2.international_country_id from `kynaforkids-server-production.kynaforkids.booking_order` t2 where t2.id \u003d t1.order_id)\r\n      ,(select bst.country_id from `kynaforkids-server-production.kynaforkids.booking_student` bst where bst.user_id \u003d t1.student_id)) \u003d 2 then \u0027Indo\u0027\r\n      when if(t1.type \u003d 1,(select t2.international_country_id from `kynaforkids-server-production.kynaforkids.booking_order` t2 where t2.id \u003d t1.order_id)\r\n      ,(select bst.country_id from `kynaforkids-server-production.kynaforkids.booking_student` bst where bst.user_id \u003d t1.student_id)) \u003d 3 then \u0027Việt Nam\u0027\r\n      when if(t1.type \u003d 1,(select t2.international_country_id from `kynaforkids-server-production.kynaforkids.booking_order` t2 where t2.id \u003d t1.order_id)\r\n      ,(select bst.country_id from `kynaforkids-server-production.kynaforkids.booking_student` bst where bst.user_id \u003d t1.student_id)) \u003d 4 then \u0027Khác\u0027\r\n  end as country\r\n  -- ngaltt start\r\n   , (select t2.contract_code from `kynaforkids-server-production.kynaforkids.booking_order` t2 where t2.id \u003d t1.order_id) as contract_code,\r\n  -- ngaltt end\r\n  if(t1.type \u003d 1,(select t2.email from `kynaforkids-server-production.kynaforkids.booking_order` t2 where t2.id \u003d t1.order_id),\r\n   (select max(u1.email) from `kynaforkids-server-production.kynaforkids.user` u1 where u1.id \u003d u.parent_id))\r\n  as email,\r\n  t1.program_id,\r\n  case\r\n\t\t\twhen t1.program_id \u003d 1 then \u0027Kyna English VIP\u0027\r\n\t\t\twhen t1.program_id \u003d 2 then \u0027Kyna English SPEAK\u0027\r\n\t\t\twhen t1.program_id \u003d 3 then \u0027Chương trình Demo\u0027\r\n\t\t\twhen t1.program_id \u003d 4 then \u0027Kyna English Tutorials\u0027\r\n\t\t\twhen t1.program_id \u003d 5 then \u0027Kyna English Class\u0027\r\n      when t1.program_id \u003d 6 then \u0027Kyna English Junior\u0027\r\n      when t1.program_id \u003d 7 then \u0027Kyna English Primary\u0027\r\n      when t1.program_id \u003d 8 then \u0027Chương trình Test Online\u0027\r\n      when t1.program_id \u003d 9 then \u0027Kyna English SPEAK JUNIOR\u0027\r\n      when t1.program_id \u003d 10 then \u0027Kyna English IELTS\u0027\r\n      when t1.program_id \u003d 11 then \u0027Kyna English Business\u0027\r\n      when t1.program_id \u003d 12 then \u0027Toán Tiểu Học\u0027\r\n      when t1.program_id \u003d 13 then \u0027Test Online (2 shifts)\u0027\r\n      when t1.program_id \u003d 14 then \u0027Kyna English Class Vip\u0027\r\n      when t1.program_id \u003d 15 then \u0027Kyna English Class Speak\u0027\r\n      when t1.program_id \u003d 16 then \u0027Kyna English Secondary\u0027\r\n      when t1.program_id \u003d 17 then \u0027Kyna English VIP 45MINS\u0027\r\n      when t1.program_id \u003d 18 then \u0027Kyna English SPEAK 45MINS\u0027\r\n      when t1.program_id \u003d 19 then \u0027Kyna English Tutorials 45MINS\u0027\r\n      when t1.program_id \u003d 20 then \u0027Toán Tiểu Học (Mẫu giáo - Lớp 1 - Lớp 2)\u0027\r\n      when t1.program_id \u003d 21 then \u0027KE Public Speaking I\u0027\r\n      when t1.program_id \u003d 22 then \u0027KE Public Speaking II\u0027\r\n\tend as program,\r\n  if(t1.type \u003d 1,t1.amount,0) * (select t2.Currency_Exchange_Rate from `kynaforkids-server-production.kynaforkids.booking_order` t2 where t2.id \u003d t1.order_id) as refund_order,\r\n  if(t1.type \u003d 1,t1.amount,0) as refund_order_NT,\r\n  if(t1.type \u003d 1,if(t1.difference_amount is null,0,t1.difference_amount), 0) * \r\n  (select t2.Currency_Exchange_Rate from `kynaforkids-server-production.kynaforkids.booking_order` t2 where t2.id \u003d t1.order_id) as difference_amount,\r\n  if(t1.type \u003d 1,if(t1.difference_amount is null,0,t1.difference_amount), 0)  as difference_amount_NT,\r\n  if(t1.type \u003d 2,if(t1.difference_amount is null,0,t1.difference_amount), 0) *\r\n  (select min(bo.Currency_Exchange_Rate) from `kynaforkids-server-production.kynaforkids.booking_order` bo, \r\n    `kynaforkids-server-production.kynaforkids.booking_student` bst where bst.user_id \u003d t1.student_id and bo.student_code \u003d bst.student_code and t1.program_id \u003d bo.program_id) as difference_amount_deactive,\r\n    if(t1.type \u003d 2,if(t1.difference_amount is null,0,t1.difference_amount), 0) as difference_amount_deactive_NT,\r\n  if(t1.type \u003d 1,(select date(t2.accounting_date)from `kynaforkids-server-production.kynaforkids.booking_order_view` t2 where t2.id \u003d t1.order_id),date(timestamp_seconds(t1.created_at))) as refund_date\r\nfrom `kynaforkids-server-production.kynaforkids.booking_order_refund_history` t1\r\nleft join `kynaforkids-server-production.kynaforkids.user` u on u.id \u003d t1.student_id\r\n;"
}, {
  "table_name": "report_order_completed_465a96cb-872b-4f7d-b52d-481a0cc853d3",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_order_completed_465a96cb-872b-4f7d-b52d-481a0cc853d3`\n(\n  order_id INT64,\n  lead_id INT64,\n  ngay_tao_don DATE,\n  ngay_duyet_don DATE,\n  ngay_tao_lead DATE,\n  invoice_code STRING,\n  ten_phu_huynh STRING,\n  email STRING,\n  name STRING,\n  student_code STRING,\n  final_student_code STRING,\n  order_type_1 STRING,\n  order_type_sub STRING,\n  phone_number STRING,\n  phone_number_uncensored STRING,\n  count_2 INT64,\n  count_1 STRING,\n  accounting_date TIMESTAMP,\n  total_video_course NUMERIC,\n  total NUMERIC,\n  noi_dung_thanh_toan STRING,\n  source STRING,\n  program STRING,\n  order_status STRING,\n  payment_status STRING,\n  price NUMERIC,\n  currency_code STRING,\n  contract_code STRING,\n  duration INT64,\n  note STRING,\n  affiliate_campaign STRING,\n  landingpage_name STRING,\n  affiliate_id INT64,\n  affiliate_email STRING,\n  affiliate_emaill STRING,\n  affiliate_type STRING,\n  currency_exchange_rate FLOAT64,\n  price_vnd FLOAT64,\n  country STRING,\n  total_lesson INT64,\n  nguoi_duyet STRING,\n  video_course_name STRING,\n  ai_tutor_price_oc_in_video_app NUMERIC,\n  video_course_name_1 STRING,\n  loai_affiliate STRING,\n  thoi_gian_ghi_danh STRING,\n  map_don STRING,\n  order_type STRING,\n  ops_incharge STRING,\n  SIC_name STRING,\n  student_type STRING,\n  voucher_code STRING,\n  order_type_2 STRING,\n  bd_email STRING,\n  user_type_id STRING,\n  total_ai_tutor_vnd FLOAT64,\n  total_video_vnd FLOAT64,\n  total_vnd FLOAT64,\n  total_nguyen_te NUMERIC,\n  old_new_student STRING\n);"
}, {
  "table_name": "murpher_instructor_1-1_5e46753b-94ad-431c-b1c1-c4ca786e753b_qlfjxfrktd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.murpher_instructor_1-1_5e46753b-94ad-431c-b1c1-c4ca786e753b_qlfjxfrktd`\n(\n  teacher_month STRING,\n  teacher_name STRING,\n  teacher_email STRING,\n  taught_test_1ca INT64,\n  taught_test_2ca INT64,\n  taught_25p INT64,\n  taught_45p INT64,\n  taught_60p INT64,\n  income_25 NUMERIC,\n  income_60 NUMERIC,\n  income_45_50_min_sesions NUMERIC,\n  adjustment_by_booking_claim NUMERIC,\n  other_ajust NUMERIC\n);"
}, {
  "table_name": "report_math_SC_num_orders_by_students_e2ce689f-2387-460e-85ea-4ec88382f26d_t27safzbtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_math_SC_num_orders_by_students_e2ce689f-2387-460e-85ea-4ec88382f26d_t27safzbtd`\n(\n  teacher_income_vnd FLOAT64,\n  tc_email STRING,\n  booking_id INT64,\n  booking_name STRING,\n  booking_time TIMESTAMP,\n  teacher_name STRING,\n  teacher_email STRING,\n  teacher_country STRING,\n  teacher_country_id INT64,\n  country STRING,\n  student_name STRING,\n  student_email STRING,\n  student_code STRING,\n  booking_status STRING,\n  revenue NUMERIC,\n  teacher_source STRING,\n  program STRING,\n  num_shift INT64,\n  student_country STRING,\n  total_income FLOAT64,\n  teacher_id INT64,\n  revenue_vnd FLOAT64,\n  booking_rating STRING,\n  tc_incharge_id INT64\n);"
}, {
  "table_name": "telemarketing_52312e63-9f7a-4948-9fdf-8ccf1e9bbe11_uty1zhcwud",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.telemarketing_52312e63-9f7a-4948-9fdf-8ccf1e9bbe11_uty1zhcwud`\n(\n  utm_campaign STRING,\n  phone_number STRING,\n  student_code STRING,\n  order_id INT64,\n  invoice_code STRING,\n  affiliate_email STRING,\n  ngay_tao_gan_nhat DATE,\n  revenue FLOAT64,\n  bonus FLOAT64\n);"
}, {
  "table_name": "booking_program_view2",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.booking_program_view2`\nAS SELECT * \r\n      \r\nFROM `kynaforkids-server-production.kynaforkids_material_view.staged_booking_program`;"
}, {
  "table_name": "booking_session_view2",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.booking_session_view2`\nAS SELECT * except(begin_at,end_at,created_at,updated_at,last_action_at,teacher_note_at),\r\n      timestamp_seconds(begin_at) as begin_at,\r\n      timestamp_seconds(end_at) as end_at,\r\n      timestamp_seconds(created_at) as created_at,\r\n      timestamp_seconds(updated_at) as updated_at,\r\n      timestamp_seconds(last_action_at) as last_action_at,\r\n      timestamp_seconds(teacher_note_at) as teacher_note_at,\r\n\r\n      case when bs.status_id \u003d 5 then \u0027Completed\u0027\r\n           when bs.status_id \u003d 7 and bs.cancel_config_id in (2,5,6,9,12) then \u0027Cancel không bù\u0027\r\n      end as completed_or_ko_bu,\r\n\r\n      case when (bs.total_income is null or bs.total_income \u003d 0) then \u0027income_null_0\u0027\r\n           else \u0027income_occured\u0027\r\n      end as income_type\r\n      \r\nFROM `kynaforkids-server-production.kynaforkids_material_view.staged_booking_session` bs\r\nwhere date(timestamp_seconds(begin_at)) \u003e\u003d \u00272025-01-01\u0027;"
}, {
  "table_name": "thong_tin_gv_e4cbc45e-b903-49bf-b551-5843074ac0cb_92vkw6ihtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.thong_tin_gv_e4cbc45e-b903-49bf-b551-5843074ac0cb_92vkw6ihtd`\n(\n  teacher_name STRING,\n  teacher_email STRING,\n  user_id INT64,\n  salary FLOAT64,\n  ops_teacher_id INT64,\n  program STRING,\n  program_group_id INT64,\n  teacher_country STRING,\n  tc_email STRING,\n  program_group STRING\n);"
}, {
  "table_name": "report_Math_SC_num_orders_by_students_e2ce689f-2387-460e-85ea-4ec88382f26d",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_Math_SC_num_orders_by_students_e2ce689f-2387-460e-85ea-4ec88382f26d`\n(\n  student_id INT64,\n  student_code STRING,\n  student_name STRING,\n  first_order_date DATE,\n  last_order_date DATE,\n  sc_email STRING,\n  programs STRING,\n  programs_orders STRING,\n  num_orders INT64,\n  total_value FLOAT64,\n  num_bookings INT64,\n  total_remaining_lessons INT64,\n  is_lesson_remain STRING,\n  sale_email STRING,\n  sup_sale_email STRING\n);"
}, {
  "table_name": "temp_hoc_vien_chong_trung_task_12232",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_hoc_vien_chong_trung_task_12232`\n(\n  student_code STRING,\n  total_remaining_lessons INT64,\n  phone_number INT64\n);"
}, {
  "table_name": "hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_jnwo5knatd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_jnwo5knatd`\n(\n  month STRING,\n  Email STRING,\n  affiliate_campaign STRING,\n  affiliate_email STRING,\n  affiliate_type STRING,\n  Blocked_Open STRING,\n  kpi FLOAT64,\n  num_lead INT64\n);"
}, {
  "table_name": "order_completed_detail_a372d468-96ee-40f3-a68d-c677fd44bea8",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.order_completed_detail_a372d468-96ee-40f3-a68d-c677fd44bea8`\n(\n  Ngay_hach_toan DATE,\n  Ngay_duyet_don DATE,\n  Ngay_hoan_thanh DATE,\n  Order_code STRING,\n  SDT STRING,\n  Ma_HV STRING,\n  Ten_HV STRING,\n  payment_status STRING,\n  Noi_dung_thanh_toan STRING,\n  Chuong_trinh STRING,\n  Don_hang_nguyen_te NUMERIC,\n  Don_hang_nguyen_te_sau_khuyen_mai NUMERIC,\n  Ty_gia FLOAT64,\n  Quoc_gia STRING,\n  Currency STRING,\n  nguoi_duyet_don STRING,\n  Ghi_chu STRING,\n  code STRING,\n  trang_thai_gui_ma STRING,\n  thang_gui_ma STRING\n);"
}, {
  "table_name": "ltv_report_cash_revenue_505d4446-6e70-418c-ad7e-844a6bec083e_1512j90trd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.ltv_report_cash_revenue_505d4446-6e70-418c-ad7e-844a6bec083e_1512j90trd`\n(\n  student_name STRING,\n  student_code STRING,\n  order_code STRING,\n  Date STRING,\n  tong_thu FLOAT64,\n  don_ghi_danh_lan_dau TIMESTAMP,\n  accounting_date TIMESTAMP,\n  retention_months INT64,\n  country STRING,\n  user_type STRING\n);"
}, {
  "table_name": "completed_booking_students_by_program_ee23864e-1fd9-48e7-a778-f43fcf2af1ec",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.completed_booking_students_by_program_ee23864e-1fd9-48e7-a778-f43fcf2af1ec`\n(\n  booking_id INT64,\n  booking_name STRING,\n  booking_time TIMESTAMP,\n  booking_end_time TIMESTAMP,\n  teacher_name STRING,\n  teacher_email STRING,\n  teacher_country STRING,\n  teacher_country_id INT64,\n  country STRING,\n  student_name STRING,\n  student_code STRING,\n  booking_status STRING,\n  teacher_source STRING,\n  program STRING,\n  level_name STRING,\n  lesson_name STRING,\n  lesson_id INT64,\n  lesson_code STRING,\n  section_name STRING,\n  num_shift INT64,\n  student_country STRING,\n  teacher_id INT64\n);"
}, {
  "table_name": "hieu_qua_ghep_lop_economy_0f2ad318-1e72-496a-9a5b-d7ecf36b7c11_y5nn10f0ud",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.hieu_qua_ghep_lop_economy_0f2ad318-1e72-496a-9a5b-d7ecf36b7c11_y5nn10f0ud`\n(\n  user_id INT64,\n  action_date DATE,\n  action INT64,\n  student_code STRING,\n  student_name STRING,\n  action_description STRING,\n  student_type STRING\n);"
}, {
  "table_name": "booking_group_class_4ccab167-64e7-4d70-888e-314e25a779a5",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.booking_group_class_4ccab167-64e7-4d70-888e-314e25a779a5`\n(\n  id INT64,\n  teacher_id INT64,\n  booking_name STRING,\n  program_name STRING,\n  class_name STRING,\n  class_status STRING,\n  booking_status STRING,\n  teacher_name STRING,\n  teacher_source INT64,\n  student_id INT64,\n  teacher_type STRING,\n  revenue FLOAT64,\n  total_income NUMERIC,\n  teacher_income NUMERIC,\n  revenue_teacher_income FLOAT64,\n  begin_at TIMESTAMP,\n  ops_id STRING,\n  teacher_country_booking STRING\n);"
}, {
  "table_name": "table_vip45_junior_economy_check",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.table_vip45_junior_economy_check`\n(\n  user_id INT64,\n  student_code STRING,\n  program_id INT64,\n  current_level_id INT64,\n  student_country STRING,\n  program STRING,\n  level STRING,\n  remaining_lessons INT64,\n  has_joined_economy INT64,\n  is_successful INT64,\n  has_cancel_economy_request INT64\n);"
}, {
  "table_name": "report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_8hlwjcnatd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_8hlwjcnatd`\n(\n  month STRING,\n  email STRING,\n  kpi INT64,\n  so_bai_dang INT64\n);"
}, {
  "table_name": "report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_83pq8poatd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_83pq8poatd`\n(\n  month STRING,\n  Email STRING,\n  affiliate_campaign STRING,\n  affiliate_email STRING,\n  affiliate_type STRING,\n  order_status STRING,\n  order_payment STRING,\n  kpi_gdm FLOAT64,\n  kpi_gdl FLOAT64,\n  revenue_ghi_danh_lan_dau NUMERIC,\n  revenue_ghi_danh_lai NUMERIC\n);"
}, {
  "table_name": "gigabyte_billed_big_query_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.gigabyte_billed_big_query_view`\nAS with billed_query as\r\n(\r\nSELECT\r\n  user_email,\r\n  job_id,\r\n  date(creation_time) AS date_billed,\r\n  -- total_bytes_processed / POW(1024, 3) AS gb_processed,\r\n  total_bytes_billed / POW(1024, 4) AS tb_billed,\r\n  -- total_slot_ms / 1000 / 60 AS slot_minutes,\r\n  -- query\r\nFROM\r\n  region-asia-east1.INFORMATION_SCHEMA.JOBS_BY_PROJECT\r\nWHERE\r\n  creation_time \u003e\u003d \u00272025-06-01\u0027 --TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 1 DAY)\r\n  AND job_type \u003d \u0027QUERY\u0027\r\n  AND state \u003d \u0027DONE\u0027\r\nORDER BY\r\n  tb_billed DESC\r\n)\r\n\r\nselect \r\n    -- user_email,\r\n    date_billed,\r\n    sum(tb_billed) as tb_billed\r\nfrom billed_query\r\n-- group by user_email, date_billed \r\ngroup by date_billed\r\norder by date_billed desc;"
}, {
  "table_name": "du_lieu_gv_co_ca_day_on_dinh_d159d09f-723d-4e4f-b6c9-41e659e17ac3",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.du_lieu_gv_co_ca_day_on_dinh_d159d09f-723d-4e4f-b6c9-41e659e17ac3`\n(\n  teacher_id INT64,\n  schedule_id INT64,\n  teach_date DATE,\n  status INT64\n);"
}, {
  "table_name": "kynaforkids_dataset_table_info_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.kynaforkids_dataset_table_info_view`\nAS with kyna_tables as\r\n(\r\n(\r\nSELECT\r\n  \u0027kynaforkids\u0027 as dataset,\r\n  table_name,\r\n  table_type\r\nFROM\r\n  kynaforkids-server-production.kynaforkids.INFORMATION_SCHEMA.TABLES\r\n)\r\n\r\nUNION ALL\r\n\r\n(SELECT\r\n  \u0027datateam_kynaforkids\u0027 as dataset,\r\n  table_name,\r\n  table_type\r\nFROM\r\n  kynaforkids-server-production.datateam_kynaforkids.INFORMATION_SCHEMA.TABLES\r\n)\r\n\r\nUNION ALL\r\n\r\n(SELECT\r\n  \u0027accounting_kynaforkids\u0027 as dataset,\r\n  table_name,\r\n  table_type\r\nFROM\r\n  kynaforkids-server-production.accounting_kynaforkids.INFORMATION_SCHEMA.TABLES\r\n)\r\n\r\nUNION ALL\r\n\r\n(SELECT\r\n  \u0027redmine_kyna_task_live\u0027 as dataset,\r\n  table_name,\r\n  table_type\r\nFROM\r\n  kynaforkids-server-production.redmine_kyna_task_live.INFORMATION_SCHEMA.TABLES\r\n)\r\n)\r\n\r\nselect * from kyna_tables\r\norder by dataset, table_type, table_name;"
}, {
  "table_name": "ceo_ghi_danh_lan_dau_THAI_view_temp",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.ceo_ghi_danh_lan_dau_THAI_view_temp`\nAS with general_table as (\r\nSELECT\r\n    bl.id\r\n  , bl.status\r\n  , bl.actual_utm_campaign as affiliate_campaign\r\n  , bl.reason_cancel_id\r\n  , bl.created_at\r\n  , bo.invoice_code\r\n  , bo.payment_content\r\n  , bo.total\r\n  , bo.payment_status\r\n  , bo.status as booking_order_status\r\n  , bo.discount_money\r\n  , bo.currency_exchange_rate\r\n  , date(bo.created_at) as order_date\r\n \r\n  , `kynaforkids-server-production.kynaforkids.func_get_booking_lead_status`(bl.status) as lead_status\r\n  , (select ac.name from `kynaforkids-server-production.kynaforkids.affiliate_category` ac,\r\n    `kynaforkids-server-production.kynaforkids.affiliate_user` au where au.affiliate_id \u003d bl.affiliate_id and au.affiliate_category_id \u003d ac.id) as affiliate_category\r\n  , (select u.email from `kynaforkids-server-production.kynaforkids.affiliate_user` au,\r\n    `kynaforkids-server-production.kynaforkids.user` u where au.affiliate_id \u003d bl.affiliate_id and u.id \u003d au.user_id ) as affiliate_email\r\n  , (SELECT max(p.name) FROM `kynaforkids-server-production.kynaforkids.profile` p WHERE p.user_id \u003d bl.sale_id) AS sale_follow\r\n    , (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d bl.sale_id) AS sale_follow_email\r\n    ,(SELECT max(p.name) FROM `kynaforkids-server-production.kynaforkids.profile` p WHERE p.user_id \u003d tsm.telesales_supervisor_id) AS sale_follow_supervisor\r\n  , (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d tsm.telesales_supervisor_id) AS sale_follow_supervisor_email,\r\n  \r\n    -- (select date(bsn.begin_at)\r\n    -- from `kynaforkids-server-production.kynaforkids.booking_session_new` bsn\r\n    -- where bsn.id \u003d bl.booking_test_id) as test_date,\r\n\r\n\r\n    bl.booking_test_id,\r\n    bl.sale_id,\r\n\r\n    -- (select bsn.status_id,\r\n    -- from `kynaforkids-server-production.kynaforkids.booking_session_new` bsn\r\n    -- where bsn.id \u003d bl.booking_test_id) as booking_test_status\r\n\r\n\r\n\r\n\r\n  `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(bo.payment_content) AS loai_don_hang\r\n, IF(bo.payment_content \u003d 1, 1, 0) as hoc_thu\r\n, IF(bo.payment_content \u003d 2, 1, 0) as ghi_danh_lan_dau\r\n, IF(bo.payment_content \u003d 3, 1, 0) as tra_gop_lan_sau\r\n, IF(bo.payment_content \u003d 4, 1, 0) as ghi_danh_lai\r\n, (CASE WHEN bl.upsell \u003d 1 THEN \u0027Upsell\u0027 ELSE \u0027Lead\u0027 END) AS loai_lead\r\n, (CASE WHEN bl.is_blocked \u003d 0 THEN \u0027Open\u0027  ELSE \u0027Blocked\u0027 END) AS trang_thai\r\n    -- ngaltt end\r\n, if((select max(u.id) from `kynaforkids-server-production.kynaforkids.user` u,\r\n  (select parent_id from `kynaforkids-server-production.kynaforkids.booking_student` bst, `kynaforkids-server-production.kynaforkids.user` u where u.id \u003d bst.user_id and bst.is_user_test !\u003d 1) t1\r\n  where u.id \u003d t1.parent_id and u.phone_number \u003d bl.intl_phone_number) is null, \u0027Chưa là HV\u0027, \u0027Đã là HV\u0027) as HV_Yes_No\r\n, case\r\n    when bl.subject_code \u003d \u0027EK\u0027 then \u0027Tiếng Anh trẻ em\u0027\r\n    when bl.subject_code \u003d \u0027EA\u0027 then \u0027Tiếng Anh người lớn\u0027\r\n    when bl.subject_code \u003d \u0027M\u0027 then \u0027Toán\u0027\r\n    when bl.subject_code \u003d \u0027C\u0027 then \u0027Group Class\u0027\r\n    when bl.subject_code \u003d \u0027AI\u0027 then \u0027AI Tutor\u0027\r\n    when bl.subject_code \u003d \u0027AI-PRE\u0027 then \u0027AI Tutor Premium\u0027\r\n  end as subject_code\r\nFROM `kynaforkids-server-production.kynaforkids.booking_lead_view` bl\r\n-- ngaltt start\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr` tsm on tsm.telesales_id \u003d bl.sale_id\r\n-- ngaltt end\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_order_view` bo ON bl.id \u003d bo.lead_id\r\n-- LEFT JOIN `kynaforkids-server-production.kynaforkids.auth_assignment` aa ON aa.user_id \u003d bl.sale_id\r\nWHERE bl.country_id \u003d 1\r\n-- AND aa.item_name IN(\u0027Telesales\u0027, \u0027Lead Telesales\u0027,\u0027SALE - Manager\u0027,\u0027SALE - Telesales - Staff\u0027,\u0027SALE - Telesales Supervisor\u0027)\r\nAND bl.Upsell !\u003d 1\r\n),\r\n\r\nlead_table as\r\n(\r\nselect \r\n        date(created_at) as lead_date, \r\n        sale_id,\r\n        -- sale_follow_email,\r\n        trang_thai,\r\n        affiliate_category,\r\n        affiliate_email,\r\n        affiliate_campaign,\r\n        subject_code,\r\n        count(distinct id) as num_leads,   \r\n\r\n      SUM(\r\n            if(status in (6,12),1,0)\r\n        ) as num_leads_status_lien_he,\r\n      \r\n      SUM(\r\n          if(reason_cancel_id in (\u00278\u0027) and status in (9),1,0)\r\n      ) as num_leads_status_tu_choi_vi_ly_do_trung,\r\n\r\n      SUM(\r\n            if(status in (3,4,5),1,0)\r\n        ) as num_leads_status_tu_van_tham_gia_onl_off,\r\n      SUM(\r\n            if(status in (21,22),1,0)\r\n        ) as num_leads_status_coc_hen_tt,\r\n      SUM(\r\n          if(reason_cancel_id not in (\u00278\u0027) and status in (9),1,0)\r\n      ) as num_leads_status_tu_choi_loai_ly_do_trung,\r\n      SUM(\r\n            if(status in (9),1,0)\r\n        ) as num_leads_status_tu_choi\r\nfrom general_table\r\nwhere \r\n      date(created_at) \u003e\u003d \u00272024-01-01\u0027\r\n      -- date(created_at) \u003e\u003d \u00272025-01-01\u0027\r\n  -- and date(created_at) \u003c\u003d \u00272025-01-31\u0027\r\n  group by lead_date, sale_id,trang_thai,affiliate_category,affiliate_email,affiliate_campaign,subject_code\r\n  order by lead_date desc\r\n),\r\n\r\nbooking_test_data as (\r\nselect\r\n\r\n      bsn.id as booking_test_id,\r\n      date(bsn.begin_at) as test_date,\r\n      min(bsn.status_id) as booking_test_status,\r\n      min(gt.affiliate_campaign) as affiliate_campaign,\r\n      min(gt.affiliate_email) as affiliate_email,\r\n      min(gt.affiliate_category) as affiliate_category,\r\n      min(bs.sale_in_charge_id) as sale_id,\r\n      -- `kynaforkids-server-production.kynaforkids.func_get_telesale_email`(min(bs.sale_in_charge_id)) as sale_follow_email,\r\n      -- min(tsm.telesales_id) as sale_sup_id,\r\n      -- min(gt.sale_follow_supervisor_email) as sale_follow_supervisor_email,\r\n      min(gt.trang_thai) as trang_thai,\r\n      min(gt.subject_code) as subject_code,\r\n      min(gt.status) as status,\r\n      \r\n\r\n      \r\n\r\nfrom `kynaforkids.booking_session_view` bsn\r\nleft join `kynaforkids.booking_session_student` bssn on bssn.booking_session_id \u003d bsn.id\r\nleft join `kynaforkids.booking_student` bs on bssn.student_id \u003d bs.user_id\r\n-- LEFT JOIN `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr` tsm on tsm.telesales_id \u003d bs.sale_in_charge_id\r\n\r\nleft join general_table gt on bsn.id \u003d gt.booking_test_id\r\nwhere \r\n      --date(bsn.begin_at) \u003c\u003d \u00272025-01-31\u0027 and date(bsn.begin_at) \u003e\u003d \u00272025-01-01\u0027\r\n      bsn.program_id IN (8,13,47,48,53,54,55,56,89,90)\r\n      and bssn.country_id \u003d 1\r\ngroup by bsn.id, test_date\r\n),\r\n\r\ntest_table as\r\n(\r\nselect \r\n        test_date, \r\n        sale_id,\r\n        -- sale_follow_email,\r\n        -- sale_follow_supervisor_email,\r\n        trang_thai,\r\n        affiliate_category, \r\n        affiliate_email,\r\n        affiliate_campaign,\r\n        subject_code,\r\n        SUM(\r\n            if(booking_test_status in (5), 1,0)\r\n        ) as num_test_completed,\r\n\r\n        SUM(\r\n            if(status in (7),1,0)\r\n        ) as num_test_completed_alt,\r\n\r\n        SUM(\r\n            if(booking_test_id is not null, 1,0)\r\n        ) as num_test_booked,\r\nfrom booking_test_data\r\nwhere \r\n      test_date \u003e\u003d \u00272024-01-01\u0027\r\n      -- test_date \u003e\u003d \u00272025-01-01\u0027\r\n  -- and test_date \u003c\u003d \u00272025-01-31\u0027\r\n  group by test_date, sale_id, trang_thai, affiliate_category, affiliate_email, affiliate_campaign, subject_code\r\n  order by test_date desc\r\n),\r\n\r\norder_info as (\r\nselect \r\n         bo.invoice_code,\r\n        --  (select bl.sale_id from `kynaforkids.booking_lead` bl where bl.id \u003d bo.lead_id) as sale_id,\r\n         bo.created_by as sale_id,\r\n         bo.payment_content,\r\n         bo.total,\r\n         bo.total_video_course,\r\n         bo.payment_status,\r\n         bo.status,\r\n         bo.discount_money,\r\n         bo.currency_exchange_rate,\r\n         date(bo.created_at) as order_date,\r\n         bl.actual_utm_campaign as affiliate_campaign,\r\n         (select ac.name from `kynaforkids-server-production.kynaforkids.affiliate_category` ac,\r\n          `kynaforkids-server-production.kynaforkids.affiliate_user` au where au.affiliate_id \u003d bl.affiliate_id and au.affiliate_category_id \u003d ac.id) as affiliate_category,\r\n         (select u.email from `kynaforkids-server-production.kynaforkids.affiliate_user` au,\r\n           `kynaforkids-server-production.kynaforkids.user` u where au.affiliate_id \u003d bl.affiliate_id and u.id \u003d au.user_id ) as affiliate_email,\r\n        case\r\n          when bl.subject_code \u003d \u0027EK\u0027 then \u0027Tiếng Anh trẻ em\u0027\r\n          when bl.subject_code \u003d \u0027EA\u0027 then \u0027Tiếng Anh người lớn\u0027\r\n          when bl.subject_code \u003d \u0027M\u0027 then \u0027Toán\u0027\r\n          when bl.subject_code \u003d \u0027C\u0027 then \u0027Group Class\u0027\r\n          when bl.subject_code \u003d \u0027AI\u0027 then \u0027AI Tutor\u0027\r\n          when bl.subject_code \u003d \u0027AI-PRE\u0027 then \u0027AI Tutor Premium\u0027\r\n        end as subject_code,\r\n        bo.lead_id,\r\n\r\nfrom `kynaforkids.booking_order_view` bo\r\nleft join `kynaforkids.booking_lead` bl on bl.id \u003d bo.lead_id\r\nwhere bo.status in (4) and bo.payment_status in (0,1,3,4)\r\n      and bo.international_country_id \u003d 1\r\n),\r\n\r\norder_table as\r\n(\r\nselect\r\n        order_date,\r\n        order_info.sale_id,\r\n        -- (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d order_info.sale_id) AS sale_follow_email,\r\n        -- (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d tsm.telesales_supervisor_id) AS sale_follow_supervisor_email,\r\n        \u0027Open\u0027 as trang_thai,\r\n        affiliate_category,\r\n        affiliate_email,\r\n        subject_code,\r\n        affiliate_campaign,\r\n        string_agg(CAST(lead_id AS STRING)) as lead_ids,\r\n        string_agg(invoice_code) as invoices,      \r\n\r\n        SUM(\r\n            if(payment_content in (1), 1,0)\r\n        ) as num_order_hoc_thu,\r\n\r\n\r\n       SUM(\r\n            if(payment_content in (2), 1,0)\r\n        ) as num_order_ghi_danh_lan_dau,\r\n\r\n\r\n          SUM(\r\n            if(payment_content in (2), round((coalesce(total,0) + coalesce(total_video_course,0) - coalesce(discount_money,0))*currency_exchange_rate),0)\r\n        ) as rev_ghi_danh_lan_dau,\r\n\r\n\r\nfrom order_info\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr` tsm on tsm.telesales_id \u003d order_info.sale_id\r\nwhere order_date \u003e\u003d \u00272024-01-01\u0027\r\n      -- order_date \u003e\u003d \u00272025-01-01\u0027\r\n  -- and order_date \u003c\u003d \u00272025-01-31\u0027\r\n  group by order_date, sale_id, affiliate_category,affiliate_email,affiliate_campaign,subject_code\r\n  order by order_date desc\r\n),\r\n\r\n\r\nresult as (\r\nselect\r\n      coalesce(ot.order_date,tt.test_date,lt.lead_date) as cal_date,\r\n      coalesce(ot.sale_id,tt.sale_id,lt.sale_id) as sale_id,\r\n      -- coalesce(ot.sale_follow_email,tt.sale_follow_email,lt.sale_follow_email) as sale_follow_email,\r\n      -- coalesce(ot.sale_follow_supervisor_email,tt.sale_follow_supervisor_email,lt.sale_follow_supervisor_email) as sale_follow_supervisor_email,\r\n      coalesce(ot.trang_thai,tt.trang_thai,lt.trang_thai) as trang_thai,\r\n      \r\n      coalesce(ot.affiliate_category,tt.affiliate_category,lt.affiliate_category) as affiliate_category,\r\n      coalesce(ot.affiliate_email,tt.affiliate_email,lt.affiliate_email) as affiliate_email,\r\n      coalesce(ot.affiliate_campaign,tt.affiliate_campaign,lt.affiliate_campaign) as affiliate_campaign,\r\n      coalesce(ot.subject_code,tt.subject_code,lt.subject_code) as subject,\r\n      SUM(coalesce(lt.num_leads,0)) as num_leads,\r\n      SUM(coalesce(lt.num_leads_status_lien_he,0)) as num_leads_status_lien_he,\r\n      SUM(coalesce(lt.num_leads_status_tu_van_tham_gia_onl_off,0)) as num_leads_status_tu_van_tham_gia_onl_off,\r\n      SUM(coalesce(lt.num_leads_status_coc_hen_tt,0)) as num_leads_status_coc_hen_tt,\r\n      SUM(coalesce(lt.num_leads_status_tu_choi_vi_ly_do_trung,0)) as num_leads_status_tu_choi_vi_ly_do_trung,\r\n \r\n      SUM(coalesce(lt.num_leads_status_tu_choi_loai_ly_do_trung,0)) as num_leads_status_tu_choi_loai_ly_do_trung,\r\n      SUM(coalesce(lt.num_leads_status_tu_choi,0)) as num_leads_status_tu_choi,\r\n\r\n      SUM(coalesce(tt.num_test_booked,0)) as num_test_booked,\r\n      SUM(coalesce(tt.num_test_completed,0)) as num_test_completed,\r\n\r\n      SUM(coalesce(ot.num_order_hoc_thu,0)) as num_order_hoc_thu,\r\n      SUM(coalesce(ot.num_order_ghi_danh_lan_dau,0)) as num_order_ghi_danh_lan_dau,      \r\n      SUM(coalesce(ot.rev_ghi_danh_lan_dau,0)) as rev_ghi_danh_lan_dau,   \r\n      \r\n\r\n\r\n       \r\nfrom lead_table lt\r\nfull join test_table tt on (lt.lead_date \u003d tt.test_date and lt.sale_id \u003d tt.sale_id and lt.trang_thai\u003dtt.trang_thai and lt.affiliate_campaign\u003dtt.affiliate_campaign and lt.affiliate_category\u003dtt.affiliate_category and lt.affiliate_email\u003dtt.affiliate_email and lt.subject_code\u003dtt.subject_code)  \r\nfull join order_table ot on (ot.order_date \u003d lt.lead_date and lt.sale_id \u003d ot.sale_id and lt.affiliate_campaign\u003dot.affiliate_campaign and lt.affiliate_category\u003dot.affiliate_category and lt.affiliate_email\u003dot.affiliate_email and lt.subject_code\u003dot.subject_code and lt.trang_thai\u003dot.trang_thai)\r\n-- where lt.lead_date \u003d \u00272025-02-02\u0027 or tt.test_date \u003d \u00272025-02-02\u0027 or ot.order_date \u003d \u00272025-02-02\u0027\r\ngroup by cal_date, sale_id, trang_thai ,affiliate_category,affiliate_email,affiliate_campaign,subject\r\norder by cal_date desc, trang_thai\r\n)\r\n\r\nselect r.*,\r\n      (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d r.sale_id) AS sale_follow_email,\r\n      (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d tsm.telesales_supervisor_id) AS sale_follow_supervisor_email,\r\nfrom result r\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr` tsm on tsm.telesales_id \u003d r.sale_id\r\n;"
}, {
  "table_name": "booking_commission_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.booking_commission_view`\nAS SELECT \r\n    * EXCEPT(created_at, updated_at),   \r\n    TIMESTAMP_SECONDS(created_at) as created_at,        \r\n    TIMESTAMP_SECONDS(updated_at) as updated_at,        \r\nFROM `kynaforkids.booking_commission`;"
}, {
  "table_name": "teacher_income_1-1_8b7cebb7-2377-43de-b4c7-30f363857402_6t6mn52btd_2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.teacher_income_1-1_8b7cebb7-2377-43de-b4c7-30f363857402_6t6mn52btd_2`\n(\n  teacher_id INT64,\n  begin_at DATE,\n  total_bonus_test_online_early_review NUMERIC,\n  total_bonus_test_online_golden_hour NUMERIC,\n  total_full_face_below_standard_penalty FLOAT64,\n  total_duo_bonus NUMERIC\n);"
}, {
  "table_name": "table_math_kyna_tutor_economy_check",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.table_math_kyna_tutor_economy_check`\n(\n  user_id INT64,\n  student_code STRING,\n  program_id INT64,\n  current_level_id INT64,\n  student_country STRING,\n  program STRING,\n  level STRING,\n  remaining_lessons INT64,\n  has_joined_economy INT64,\n  is_successful INT64,\n  has_cancel_economy_request INT64\n);"
}, {
  "table_name": "gv_thu_nhap_am_hoac_bi_tru_tien_42e9d248-d938-4427-a514-12a5efd2f67f",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.gv_thu_nhap_am_hoac_bi_tru_tien_42e9d248-d938-4427-a514-12a5efd2f67f`\n(\n  year_month STRING,\n  teacher_id INT64,\n  teacher_name STRING,\n  teacher_country STRING,\n  tc_email STRING,\n  num_cancel_by_teacher INT64,\n  num_no_show_by_teacher INT64,\n  num_completed_bookings INT64,\n  total_income_calculated FLOAT64,\n  positive_income_calculated NUMERIC,\n  negative_income_calculated FLOAT64,\n  total_income_calculated_vnd FLOAT64,\n  positive_income_calculated_vnd FLOAT64,\n  negative_income_calculated_vnd FLOAT64,\n  income_classification_vnd STRING,\n  num_no_show_classification STRING,\n  num_completed_booking_classificaion STRING,\n  penalty_threshold_classification STRING,\n  teaching_ability STRING\n);"
}, {
  "table_name": "report_booking_lead_b5f96d41-fab7-485d-b54e-8e8d3473a4f2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_booking_lead_b5f96d41-fab7-485d-b54e-8e8d3473a4f2`\n(\n  id INT64,\n  sale_email STRING,\n  sup_sale_email STRING,\n  parent_name STRING,\n  children_name STRING,\n  email STRING,\n  phone_number STRING,\n  address STRING,\n  tinh_thanh_pho STRING,\n  quiz_score FLOAT64,\n  affiliate_campaign STRING,\n  affiliate_email STRING,\n  bd_incharge_email STRING,\n  affiliate_type STRING,\n  landing_page_name STRING,\n  note STRING,\n  sourse STRING,\n  thai_lead_status STRING,\n  lead_status STRING,\n  country STRING,\n  created_at TIMESTAMP,\n  created_order_at TIMESTAMP,\n  fanpage_name STRING,\n  sup_email STRING,\n  student_code STRING,\n  is_blocked STRING,\n  booking_id INT64,\n  order_id INT64,\n  program_name STRING,\n  reason_cancel STRING,\n  subject_code STRING,\n  mon_hoc STRING,\n  quoc_tich_gv STRING,\n  ngay_co_don TIMESTAMP,\n  total_remaining_lessons INT64,\n  has_remaining_lessons STRING,\n  ngay_co_don_1 TIMESTAMP\n);"
}, {
  "table_name": "report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_ik5eijv9sd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_ik5eijv9sd`\n(\n  ngay_dang_bai DATE,\n  bd_incharge_id INT64,\n  country_id INT64,\n  student_id INT64,\n  parent_name STRING,\n  children_name STRING,\n  post_link STRING,\n  phone_number STRING,\n  affiliate_id INT64,\n  affiliate_email STRING,\n  aff_country STRING,\n  student_code STRING,\n  email_bd STRING,\n  hoa_hong INT64,\n  so_bai_dang INT64,\n  hoa_hong_ngay INT64\n);"
}, {
  "table_name": "report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_pkonmojwpd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_pkonmojwpd`\n(\n  id INT64,\n  name STRING,\n  email STRING,\n  phone_number STRING,\n  country STRING,\n  subject_name STRING,\n  recruit_source STRING,\n  source_name STRING,\n  type STRING,\n  candidate_status STRING,\n  candidate_pass_status INT64,\n  history STRING,\n  created_by STRING,\n  created_date DATE,\n  recall_date DATE,\n  tc_in_charge STRING\n);"
}, {
  "table_name": "ltv_report_cash_revenue_505d4446-6e70-418c-ad7e-844a6bec083e_4buj6uaivd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.ltv_report_cash_revenue_505d4446-6e70-418c-ad7e-844a6bec083e_4buj6uaivd`\n(\n  student_name STRING,\n  date DATE,\n  student_code STRING,\n  tong_thu FLOAT64,\n  cacCost FLOAT64,\n  don_ghi_danh_lan_dau DATETIME,\n  accounting_date DATETIME,\n  retention_months INT64,\n  country STRING,\n  percentGPMargin FLOAT64\n);"
}, {
  "table_name": "thu_nhap_ops_5c194737-88de-48ca-93f4-552714c5f803_ozbga89rtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.thu_nhap_ops_5c194737-88de-48ca-93f4-552714c5f803_ozbga89rtd`\n(\n  year_month STRING,\n  ops_manager_email STRING,\n  email_ops STRING,\n  country_id INT64,\n  completed_booking_number INT64,\n  total_bonus INT64,\n  total_sup_bonus INT64,\n  ops_id INT64,\n  num_order_ghi_danh_lai_tra_gop INT64,\n  rev_ghi_danh_lai_tra_gop FLOAT64,\n  bonus_ghi_danh_lai FLOAT64,\n  bonus_ghi_danh_lai_sup FLOAT64,\n  country STRING,\n  name_ops STRING,\n  ops_bonus_all FLOAT64,\n  sup_bonus_all FLOAT64\n);"
}, {
  "table_name": "teacher_cost_tracker_4a393d9b-a1e8-4574-8af2-848a48e46a9b_4m4s24aetd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.teacher_cost_tracker_4a393d9b-a1e8-4574-8af2-848a48e46a9b_4m4s24aetd`\n(\n  id INT64,\n  program_name STRING,\n  booking_status STRING,\n  teacher_id INT64,\n  teacher_name STRING,\n  teacher_source INT64,\n  revenue FLOAT64,\n  total_income NUMERIC,\n  begin_at TIMESTAMP,\n  teacher_country_bt STRING,\n  teacher_country_bs STRING,\n  sellingEx FLOAT64,\n  teacher_income FLOAT64\n);"
}, {
  "table_name": "booking_lead_15h_test",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.booking_lead_15h_test`\n(\n  id INT64,\n  created_at INT64,\n  updated_at INT64,\n  status INT64,\n  considerating_date DATE\n);"
}, {
  "table_name": "kyna_english_duo_junior_lesson_id_list",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.kyna_english_duo_junior_lesson_id_list`\n(\n  lesson_id INT64\n);"
}, {
  "table_name": "booking_student_program_action_economy_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.booking_student_program_action_economy_view`\nAS SELECT\r\n      *\r\nFROM `kynaforkids-server-production.kynaforkids.booking_student_program_action` \r\nWHERE created_at \u003e\u003d 1753574400\r\n      AND action IN  (9,10)\r\norder by created_at asc\r\n;"
}, {
  "table_name": "schedule_create_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_190bttw9sd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.schedule_create_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_190bttw9sd`\n(\n  created_at DATE,\n  student_code STRING,\n  student_id INT64,\n  noi_dung_thanh_toan STRING,\n  invoice_code STRING,\n  country_id INT64,\n  student_country STRING,\n  affiliate_id INT64,\n  affiliate_type STRING,\n  bd_email STRING,\n  dang_bai_dai_su STRING,\n  revenue FLOAT64\n);"
}, {
  "table_name": "upsell_temp",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.datateam_kynaforkids.upsell_temp`\n(\n  student_code STRING,\n  phone_number STRING,\n  sales_email STRING,\n  sup_sales_email STRING,\n  total_remaining_lessons FLOAT64\n)\nOPTIONS(\n  sheet_range\u003d\"A:E\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/1nGenTdRcRmMXZP43m8V6TKIjJVYzWtaWBogRYrrfSoE/edit?gid\u003d203016857#gid\u003d203016857\"]\n);"
}, {
  "table_name": "track_bonus_student_care_69a1c79a-03fa-4b55-a2db-b7ab7a80cf62",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.track_bonus_student_care_69a1c79a-03fa-4b55-a2db-b7ab7a80cf62`\n(\n  ngay_map_don_gdl DATE,\n  student_code STRING,\n  invoice_code STRING,\n  program_name STRING,\n  subject INT64,\n  price_vnd FLOAT64,\n  quoc_gia STRING,\n  phone_number STRING,\n  order_id INT64,\n  sc_in_charge STRING,\n  loai_don_hang STRING,\n  noi_dung_thanh_toan STRING,\n  mon_hoc STRING\n);"
}, {
  "table_name": "table_active_students_by_quarter_a2ac8bef5bed_p_hyp7s1t7wd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.table_active_students_by_quarter_a2ac8bef5bed_p_hyp7s1t7wd`\n(\n  user_id INT64,\n  Q1_2026_active INT64,\n  Q2_2026_active INT64,\n  Q3_2026_active INT64,\n  Q4_2026_active INT64,\n  Q1_2027_active INT64,\n  Q2_2027_active INT64,\n  Q3_2027_active INT64,\n  Q4_2027_active INT64,\n  Q1_2022_active INT64,\n  Q2_2022_active INT64,\n  Q3_2022_active INT64,\n  Q4_2022_active INT64,\n  Q1_2023_active INT64,\n  Q2_2023_active INT64,\n  Q3_2023_active INT64,\n  Q4_2023_active INT64,\n  Q1_2024_active INT64,\n  Q2_2024_active INT64,\n  Q3_2024_active INT64,\n  Q4_2024_active INT64,\n  Q1_2025_active INT64,\n  Q2_2025_active INT64,\n  Q3_2025_active INT64,\n  Q4_2025_active INT64\n);"
}, {
  "table_name": "duo_program_management_76067fbe-e59d-4989-a4d9-638012afe5bb_ap7gfvpfxd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.duo_program_management_76067fbe-e59d-4989-a4d9-638012afe5bb_ap7gfvpfxd`\n(\n  booking_session_id INT64,\n  teacher_id INT64,\n  program STRING,\n  booking_time TIMESTAMP,\n  booking_status_id INT64,\n  room_type STRING,\n  num_students INT64,\n  student_ids STRING,\n  booking_rating STRING,\n  teacher_country STRING,\n  duo_support_bonus FLOAT64,\n  duo_support_bonus_DB NUMERIC,\n  chenh_lech_bonus FLOAT64\n);"
}, {
  "table_name": "booking_session_student_view2",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.booking_session_student_view2`\nAS SELECT * \r\n      \r\nFROM `kynaforkids-server-production.kynaforkids_material_view.staged_booking_session_student` bss\r\nwhere date(timestamp_seconds(bss.created_at)) \u003e\u003d \u00272025-01-01\u0027;"
}, {
  "table_name": "doanh_thu_con_lai_1-1_83d3ede5-ebc0-4963-8bea-c8e7b806e066",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.doanh_thu_con_lai_1-1_83d3ede5-ebc0-4963-8bea-c8e7b806e066`\n(\n  ma_hoc_vien STRING,\n  tdate DATE,\n  program STRING,\n  student_name STRING,\n  email STRING,\n  phone_number STRING,\n  country STRING,\n  currency_code STRING,\n  contract_code STRING,\n  currency_exchange_rate FLOAT64,\n  tong_thu FLOAT64,\n  tong_thu_nguyen_te NUMERIC,\n  tong_thu_has_video_course FLOAT64,\n  revenue FLOAT64,\n  revenue_nguyen_te NUMERIC,\n  refund_order FLOAT64,\n  refund_order_NT NUMERIC,\n  difference_amount FLOAT64,\n  difference_amount_NT NUMERIC,\n  difference_amount_deactive FLOAT64,\n  difference_amount_deactive_NT NUMERIC,\n  chenh_lech_khac FLOAT64,\n  chenh_lech_khac_NT FLOAT64,\n  invoice_code STRING\n);"
}, {
  "table_name": "bien_dong_so_luong_gv_tieng_anh_tracker_468ec3fd-a8cf-4796-9916-330e4359e503_w95d10pxpd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.bien_dong_so_luong_gv_tieng_anh_tracker_468ec3fd-a8cf-4796-9916-330e4359e503_w95d10pxpd`\n(\n  interview_date DATE,\n  acceptance_date DATE,\n  teacher_id INT64,\n  teacher_name STRING,\n  teacher_country STRING,\n  teacher_source INT64,\n  teaching_training_date DATE,\n  test_training_date DATE,\n  training_status_id INT64,\n  status_id INT64,\n  contract_status_id INT64,\n  contract_completion_date DATE,\n  deactivate_date DATE,\n  is_tester INT64,\n  is_math_teacher_or_tester INT64,\n  tc_email STRING,\n  is_auto_repeat_calendar INT64,\n  training_status STRING,\n  contract_status STRING,\n  source STRING,\n  status STRING,\n  least_training_date DATE,\n  greatest_training_date DATE,\n  first_month_completed_bookings INT64,\n  reactivated_date DATE,\n  num_reactivate INT64,\n  ready_to_teach_date DATE,\n  reactivate_contract_completion_date DATE,\n  booked_training_date DATE,\n  num_contracts INT64,\n  max_contract_send_date INT64,\n  num_reactivated_contracts INT64,\n  max_reactivated_contract_send_date INT64,\n  acceptance_or_reactivated_date DATE,\n  contract_sign_status_id INT64,\n  reactivated_contract_sign_status_id INT64,\n  is_trained STRING,\n  is_contract_sign STRING,\n  is_reactivated_contract_sign STRING,\n  normal_or_reactivated STRING,\n  reactivated_qualified_to_teach_date DATE,\n  final_contract_completion_date DATE,\n  num_days_to_be_qualified_to_teach INT64,\n  status_contract_sign STRING,\n  status_reactivated_contract_sign STRING,\n  num_days_to_be_qualified_to_teach_reactivated INT64,\n  final_num_days_to_be_qualified_to_teach INT64,\n  final_is_contract_sign STRING,\n  final_qualified_to_teach_date DATE,\n  first_booking_date DATE\n);"
}, {
  "table_name": "report_performance_bonus_test_e3f0d061-6f11-4539-8b97-1b8dab74fab8_1odxtgratd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_performance_bonus_test_e3f0d061-6f11-4539-8b97-1b8dab74fab8_1odxtgratd`\n(\n  tc_email STRING,\n  booking_id INT64,\n  booking_name STRING,\n  booking_time TIMESTAMP,\n  teacher_name STRING,\n  teacher_email STRING,\n  teacher_country STRING,\n  country STRING,\n  student_name STRING,\n  student_email STRING,\n  student_code STRING,\n  booking_status STRING,\n  teacher_source STRING,\n  program STRING,\n  level_name STRING,\n  num_shift INT64,\n  currency_exchange_rate FLOAT64,\n  student_country STRING,\n  teacher_id INT64,\n  total_income NUMERIC,\n  tc_incharge_id INT64\n);"
}, {
  "table_name": "kyna_duo_math2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.kyna_duo_math2`\n(\n  teacher_id INT64,\n  program STRING,\n  name STRING\n);"
}, {
  "table_name": "view_booking_1_10",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.view_booking_1_10`\nAS select \r\nbs.id,\r\nbs.name as booking_name,\r\n(select bc.`name` from `kynaforkids-server-production.kynaforkids.booking_class` bc where bc.id \u003d bs.booking_class_id) as class_name,\r\ncase \r\nwhen (select bc.status from `kynaforkids-server-production.kynaforkids.booking_class` bc where bc.id \u003d bs.booking_class_id) \u003d 1 then \u0027Mới tạo\u0027\r\nwhen (select bc.status from `kynaforkids-server-production.kynaforkids.booking_class` bc where bc.id \u003d bs.booking_class_id) \u003d 2 then \u0027Đang học\u0027\r\nwhen (select bc.status from `kynaforkids-server-production.kynaforkids.booking_class` bc where bc.id \u003d bs.booking_class_id) \u003d 3 then \u0027Lớp chuẩn bị hoàn thành\u0027\r\nwhen (select bc.status from `kynaforkids-server-production.kynaforkids.booking_class` bc where bc.id \u003d bs.booking_class_id) \u003d 4 then \u0027Hoàn thành\u0027\r\nwhen (select bc.status from `kynaforkids-server-production.kynaforkids.booking_class` bc where bc.id \u003d bs.booking_class_id) \u003d 5 then \u0027Huỷ\u0027\r\nelse \u0027Không có lớp\u0027\r\nend as class_status,\r\ncase \r\nwhen status_id \u003d 1 then \u0027Draft\u0027\r\nwhen status_id \u003d 2 then \u0027New\u0027\r\nwhen status_id \u003d 3 then \u0027WaitingApprove\u0027\r\nwhen status_id \u003d 4 then \u0027Approved\u0027\r\nwhen status_id \u003d 5 then \u0027Completed\u0027\r\nwhen status_id \u003d 6 then \u0027Rejected\u0027\r\nwhen status_id \u003d 7 and bs.cancel_config_id \u003d 5 then \u0027Cancelled by kyna without compensate\u0027\r\nwhen status_id \u003d 7 and bs.cancel_config_id \u003d 6 then \u0027Cancelled by teacher without compensate\u0027\r\nwhen status_id \u003d 8 then \u0027Deleted\u0027\r\nend as booking_status,\r\n(select p.`name` from `kynaforkids-server-production.kynaforkids.profile` p where p.user_id \u003d bs.teacher_id) as teacher_name,\r\n(select count(bss.student_id) from `kynaforkids-server-production.kynaforkids.booking_session_student` bss where bss.booking_session_id \u003d bs.id) as total_student,\r\n(select sum(revenue) from `kynaforkids-server-production.kynaforkids.booking_session_student` bss where bss.booking_session_id \u003d bs.id) as revenue,\r\nif(bs.total_income is null, 0, ceiling(bs.total_income * 23500)) as teacher_income,\r\ncase\r\n  when (select sum(revenue) from `kynaforkids-server-production.kynaforkids.booking_session_student` bss where bss.booking_session_id \u003d bs.id) \u003d 0 and (bs.total_income !\u003d0 or bs.total_income is not null)\r\n  then 100\r\n  else ceiling((bs.total_income * 23500) / (select sum(revenue) from `kynaforkids-server-production.kynaforkids.booking_session_student` bss where bss.booking_session_id \u003d bs.id) * 100) \r\nend as revenue_teacher_income,\r\ncase\r\nwhen bs.total_income is null then null\r\nwhen ((select count(bss.student_id) from `kynaforkids-server-production.kynaforkids.booking_session_student` bss where bss.booking_session_id \u003d bs.id) \u003d 0 and bs.total_income is not null) then ceiling(bs.total_income * 23500)\r\nelse ceiling(bs.total_income * 23500)/(select count(bss.student_id) from `kynaforkids-server-production.kynaforkids.booking_session_student` bss where bss.booking_session_id \u003d bs.id)\r\nend as total_income_chia_total_students,\r\nbs.begin_at\r\nfrom `kynaforkids-server-production.kynaforkids.booking_session` bs \r\nwhere bs.program_id \u003d 5;"
}, {
  "table_name": "tc_math_hoc_vien_gvcd_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.tc_math_hoc_vien_gvcd_view`\nAS --Nhờ bên anh làm thêm 1 cái Datastudio chi tiết danh sách HVCĐ nhé ạ, bao gồm các thông tin:\r\n-- Teacher ID\r\n-- Teacher Name\r\n-- Mã KE HVCĐ\r\n-- Tên học viên\r\n-- Ops In Charge\r\n-- Loại học viên: Trẻ em/người lớn\r\n-- Tên chương trình\r\n-- Số buổi còn lại\r\n\r\nwith \r\n-- HV chương trình số buổi còn lại\r\ntarget_student_1 AS (\r\nSELECT bs.user_id, bs.student_code, \r\n       bsp.program_id,\r\n       count(distinct bsn.id) as num_bookings, \r\nFROM `kynaforkids-server-production.kynaforkids.booking_student` bs\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_session_student` bssn\r\n        ON (bs.user_id \u003d bssn.student_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_student_program` bsp\r\n        ON (bsp.user_id \u003d bs.user_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_session_view` bsn\r\n        ON (bssn.booking_session_id \u003d bsn.id and bsp.program_id \u003d bsn.program_id)\r\n\r\nWHERE bs.is_user_test \u003d 0\r\n      -- and bs.country_id \u003d 3\r\n      AND bsp.program_id not in (select bp.id from `kynaforkids-server-production.kynaforkids.booking_program` bp where bp.program_type \u003d 2 or bp.id \u003d 3 or bp.type in (2,3,4) or bp.subject \u003d 1) \r\n      AND bsn.status_id in (4,5)\r\n      AND bsn.program_id not in (select bp.id from `kynaforkids-server-production.kynaforkids.booking_program` bp where bp.program_type \u003d 2 or bp.id \u003d 3 or bp.type in (2,3,4) or bp.subject \u003d 1)\r\n  \t  AND cast(bsn.begin_at as datetime) \u003c current_datetime(\"UTC+7\")     \r\n      --AND (date(bsn.begin_at) \u003e\u003d \u00272024-10-01\u0027 AND date(bsn.begin_at) \u003c\u003d \u00272024-10-31\u0027) \r\nGROUP BY bs.user_id, bs.student_code, bsp.program_id\r\n),\r\n\r\n-- Tính tổng số lesson còn lại của học sinh ở các chương trình mà học sinh đang học với các ràng buộc như trên \r\nremaining_bookings_program AS (\r\nSELECT bs.user_id, bs.student_code, bsp.program_id,\r\n       max(coalesce(bsp.remain_lesson,0)) as bookings_program_remain\r\nFROM `kynaforkids-server-production.kynaforkids.booking_student` bs\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_student_program` bsp ON (bsp.user_id \u003d bs.user_id)\r\nWHERE bs.is_user_test \u003d 0 \r\n      AND bsp.program_id not in (select bp.id from `kynaforkids-server-production.kynaforkids.booking_program` bp where bp.program_type \u003d 2 or bp.id \u003d 3 or bp.type in (2,3,4) or bp.subject \u003d 1)\r\nGROUP BY bs.user_id, bs.student_code, bsp.program_id\r\n),\r\n\r\n-- Tính số booking đã được chạy ở các trạng thái draft, new, waiting approve, approved (lấy ở ngày hiện tại trở đi)\r\nremaining_bookings_booked AS (\r\nSELECT \r\n      bs.user_id, \r\n      bs.student_code, \r\n      bsp.program_id, \r\n      count(distinct bsn.id) as bookings_booked\r\nFROM `kynaforkids-server-production.kynaforkids.booking_student` bs\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_student_program` bsp ON (bsp.user_id \u003d bs.user_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_session_student` bssn\r\n        ON (bs.user_id \u003d bssn.student_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_session_view` bsn\r\n        ON (bssn.booking_session_id \u003d bsn.id and bsp.program_id \u003d bsn.program_id)\r\nWHERE bs.is_user_test \u003d 0 \r\n      AND bsn.status_id in (1,2,3,4)\r\n      AND bsn.program_id not in (select bp.id from `kynaforkids-server-production.kynaforkids.booking_program` bp where bp.program_type \u003d 2 or bp.id \u003d 3 or bp.type in (2,3,4) or bp.subject \u003d 1)\r\n      AND cast(bsn.begin_at as datetime) \u003e current_datetime(\"UTC+7\")\r\nGROUP BY bs.user_id, bs.student_code, bsp.program_id\r\n),\r\n\r\n-- Tính tổng số booking còn lại của học viên (lấy 2 số trên cộng lại với nhau)\r\nremaining_bookings AS (\r\nSELECT rbp.user_id, rbp.student_code, rbp.program_id,-- rbp.program_name, \r\n       max(coalesce(rbp.bookings_program_remain,0)) + max(coalesce(rbb.bookings_booked,0)) as total_remaining_lessons,\r\n       --`kynaforkids-server-production.kynaforkids.func_get_student_name_from_profile_by_student_id`(rbp.user_id) as student_name \r\nFROM remaining_bookings_program rbp\r\nLEFT JOIN remaining_bookings_booked rbb ON(rbp.user_id \u003d rbb.user_id AND rbp.program_id \u003d rbb.program_id)\r\nWHERE rbp.program_id not in (select bp.id from `kynaforkids-server-production.kynaforkids.booking_program` bp where bp.program_type \u003d 2 or bp.id \u003d 3 or bp.type in (2,3,4) or bp.subject \u003d 1)\r\nGROUP BY rbp.user_id, rbp.student_code, rbp.program_id\r\n),\r\n\r\n-- Ghép các bảng trên để có bảng target_students\r\nstudents_with_remain_bookings AS\r\n(\r\nSELECT \r\n      ts1.*,\r\n      -- rb.program_id, \r\n      --rb.program_name, rb.subject, \r\n      rb.total_remaining_lessons,  \r\nFROM target_student_1 ts1\r\nLEFT JOIN remaining_bookings rb ON(ts1.user_id \u003d rb.user_id AND ts1.program_id \u003d rb.program_id)\r\nwhere rb.total_remaining_lessons \u003e 0\r\n),\r\n\r\n-- students_with_remain_bookings as\r\n-- (\r\n-- select \r\n--        ts.student_code,\r\n--        ts.program_id\r\n--        sum(ts.total_remaining_lessons) as total_remaining_lessons,\r\n        \r\n-- from target_students ts\r\n-- group by student_code \r\n-- ),\r\n\r\n-- HV và GVCĐ\r\nhv_gvcd as\r\n(\r\nselect\r\n      bst.student_code,\r\n      (\r\n        SELECT\r\n              max(p.name)\r\n        FROM\r\n              `kynaforkids-server-production.kynaforkids.profile` p\r\n        where p.user_id \u003d bspd.student_id\r\n      ) as student_name,\r\n\r\n      bt.user_id as teacher_id,\r\n      (\r\n        SELECT\r\n              max(p.name)\r\n        FROM\r\n             `kynaforkids-server-production.kynaforkids.profile` p\r\n        WHERE\r\n              p.user_id\u003d bt.user_id) as teacher_name,\r\n      \r\n      bspd.program_id,\r\n      (select bp.name from `kynaforkids.booking_program` bp where bp.id \u003d bspd.program_id) as program,\r\n\r\n      string_agg(distinct cast(bspd.day as string), \", \") as week_days,\r\n\r\n      string_agg(distinct cast(schedule_id as string), \", \") as schedule_ids,\r\n\r\n\r\n\r\n\r\nfrom `kynaforkids-server-production.kynaforkids.booking_student_priority_date` bspd\r\ninner join `kynaforkids.booking_student` bst on bst.user_id \u003d bspd.student_id\r\ninner join `kynaforkids.booking_teacher` bt on bt.user_id \u003d bspd.fixed_teacher_id\r\nwhere bspd.fixed_teacher_id is not null and bspd.only_map_current_teacher \u003d 1\r\n      -- and student_id \u003d 102\r\n      and bst.student_code like \u0027K%\u0027\r\n      and bspd.program_id in (select bp.id from `kynaforkids.booking_program` bp where bp.program_type \u003d 1 and bp.type not in (2,3,4) and bp.id !\u003d 3 and bp.subject \u003d 2)\r\ngroup by student_code, student_id, teacher_id, program_id\r\n)\r\n\r\nselect \r\n        hv_gvcd.*,\r\n        `kynaforkids-server-production.kynaforkids.func_get_country_teacher`((select bt.country_id from `kynaforkids.booking_teacher` bt where bt.user_id \u003d hv_gvcd.teacher_id)) as teacher_country,\r\n        `kynaforkids-server-production.kynaforkids.func_get_booking_student_country`(bst.country_id) as student_country,\r\n        srb.total_remaining_lessons,\r\n        case when bst.user_type_id \u003d 1 then \u0027Trẻ em\u0027\r\n             when bst.user_type_id \u003d 2 then \u0027Người lớn\u0027\r\n             else \"Unknown\"\r\n        end as loai_hv,\r\n        (select `kynaforkids-server-production.kynaforkids.func_get_email_from_kynaforkids_user`(bst.ops_id)) as ops_email,   \r\n\r\n        \r\nfrom hv_gvcd \r\ninner join `kynaforkids.booking_student` bst on bst.student_code \u003d hv_gvcd.student_code\r\nleft join students_with_remain_bookings srb on hv_gvcd.student_code \u003d srb.student_code and hv_gvcd.program_id \u003d srb.program_id\r\nwhere srb.total_remaining_lessons is not null\r\n\r\n;"
}, {
  "table_name": "kbc_may_batch1_user_id_table",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.kbc_may_batch1_user_id_table`\n(\n  booking_id INT64,\n  user_id INT64\n);"
}, {
  "table_name": "schedule_create_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_5fg4lyw9sd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.schedule_create_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_5fg4lyw9sd`\n(\n  bd_email STRING,\n  created_at DATE,\n  affiliate_type STRING,\n  affiliate_email STRING,\n  affiliate_campaign STRING,\n  dang_bai_dai_su STRING,\n  Blocked_Open STRING,\n  num_lead INT64,\n  num_order INT64,\n  num_order_ghi_danh_lan_dau_hv_moi_hoan_thanh_ko_duyet_chua_duyet INT64,\n  num_order_ghi_danh_lai_hv_cu_hoan_thanh_ko_duyet_chua_duyet INT64,\n  doanh_thu_ghi_danh_lan_dau NUMERIC,\n  doanh_thu_ghi_danh_lai NUMERIC,\n  hoa_hong_vnd FLOAT64\n);"
}, {
  "table_name": "teacher_income_1-1_8b7cebb7-2377-43de-b4c7-30f363857402_ozag86vctd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.teacher_income_1-1_8b7cebb7-2377-43de-b4c7-30f363857402_ozag86vctd`\n(\n  teacher_id INT64,\n  teacher_name STRING,\n  teacher_source INT64,\n  teacher_country STRING,\n  month_year STRING,\n  sellingEx FLOAT64,\n  booking_1_1_income_oc NUMERIC,\n  booking_1_n_income_oc NUMERIC,\n  duo_bonus NUMERIC,\n  source STRING,\n  rate FLOAT64\n);"
}, {
  "table_name": "mkt_standalone_order_ai_new_students_view",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.mkt_standalone_order_ai_new_students_view`\nAS with \r\norder_ai_tutor_single AS\r\n(SELECT \r\n        (select min(timestamp_seconds(order_action.created_at)) from `kynaforkids-server-production.kynaforkids.order_action` order_action \r\n  where order_action.order_id \u003d ord.id and not order_action.order_status \u003d 1 ) as ngay_sale_len_don,\r\n        ord.id,\r\n        ord.completed_at,\r\n        ord.created_by,\r\n        ord.telesale_id,\r\n        ord.register_source,        \r\n        ord.country_id,\r\n        ord.currency_code,\r\n        `kynaforkids-server-production.kynaforkids.func_get_country`(ord.country_id) as country,\r\n\r\n        round(coalesce(ord.currency_exchange_rate,0),2) as currency_exchange_rate,\r\n      --   ord.total as total_oc,\r\n\r\n        -- ord.sub_total,\r\n        case when ord.currency_code in (\u0027VND\u0027,\u0027IDR\u0027,\u0027KIP\u0027) then round(ord.sub_total)\r\n             when ord.currency_code in (\u0027THB\u0027,\u0027USD\u0027,\u0027MYR\u0027) then round(ord.sub_total,2)\r\n        end as sub_total,\r\n\r\n        -- ordd.unit_price,\r\n        case when ord.currency_code in (\u0027VND\u0027,\u0027IDR\u0027,\u0027KIP\u0027) then round(ordd.unit_price)\r\n             when ord.currency_code in (\u0027THB\u0027,\u0027USD\u0027,\u0027MYR\u0027) then round(ordd.unit_price,2)\r\n        end as unit_price,\r\n\r\n        ori.name as student_name,\r\n        ori.phone_number as student_phone,\r\n        ori.email as student_email,\r\n        ord.invoice_code,\r\n        case\r\n            when ord.`status` \u003d 1 then \u0027Mới tạo\u0027\r\n            when ord.`status` \u003d 2 then \u0027Xác nhận\u0027\r\n            when ord.`status` \u003d 3 then \u0027Hoàn thành\u0027\r\n            when ord.`status` \u003d 4 then \u0027Hủy\u0027\r\n            else \u0027Khác\u0027\r\n\t      end as status,\r\n        ord.payment_method_id,\r\n        ord.payment_method_status as payment_status_id,\r\n        \r\n        case when ord.invoice_code like \u0027KYNA%\u0027 then ori.lead_id\r\n             when ord.invoice_code like \u0027GRAI%\u0027 then bo.lead_id \r\n            --  (select bo.affiliate_id from `kynaforkids.booking_order` bo where RIGHT(bo.invoice_code,8) \u003d RIGHT(ord.invoice_code,8))\r\n        end as lead_id,\r\n        \r\n        case when ord.invoice_code like \u0027KYNA%\u0027 then ord.affiliate_id\r\n             when ord.invoice_code like \u0027GRAI%\u0027 then bo.affiliate_id\r\n        end as affiliate_id,\r\n      --   ord.utm_campaign,\r\n        ordd.package_id,\r\n        ordd.package_subscription_id,\r\n        pk.name as Mon_hoc,\r\n        (select pm.`name` from `kynaforkids-server-production.kynaforkids.payment_method` pm where pm.id \u003d ord.payment_method_id) as payment_method,\r\n        case\r\n      when ord.payment_method_status \u003d 1 then \u0027Chờ thanh toán\u0027\r\n      when ord.payment_method_status \u003d 2 then \u0027Đã thanh toán\u0027\r\n      when ord.payment_method_status \u003d 3 then \u0027Thanh toán thất bại\u0027\r\n      when ord.payment_method_status \u003d 4 then \u0027Chờ giao hàng\u0027\r\n \twhen ord.payment_method_status \u003d 5 then \u0027Đang giao hàng\u0027\r\n      when ord.payment_method_status \u003d 6 then \u0027Đã giao hàng\u0027\r\n      when ord.payment_method_status \u003d 7 then \u0027Đang trả hàng\u0027\r\n      when ord.payment_method_status \u003d 8 then \u0027Đã trả hàng\u0027\r\n      else null\r\n\tend as payment_status,\r\n      -- (select pg.`name` from `kynaforkids-server-production.kynaforkids.payment_gateway` pg where pg.id \u003d ord.shipping_method_id) as shipping_company,\r\n--     (select max(pt.transaction_code) from `kynaforkids-server-production.kynaforkids.payment_transaction` pt where pt.order_id \u003d ord.id) as partner_code,\r\n\r\n    -- if(ord.discount_amount is null,0,ord.discount_amount) as discount_amount,\r\n    case when ord.currency_code in (\u0027VND\u0027,\u0027IDR\u0027,\u0027KIP\u0027) then round(if(ord.discount_amount is null,0,ord.discount_amount))\r\n             when ord.currency_code in (\u0027THB\u0027,\u0027USD\u0027,\u0027MYR\u0027) then round(if(ord.discount_amount is null,0,ord.discount_amount),2)\r\n    end as discount_amount,\r\n\r\n    -- if(ordd.voucher_discount_amount is null,0,ordd.voucher_discount_amount) as voucher_discount_amount,\r\n    case when ord.currency_code in (\u0027VND\u0027,\u0027IDR\u0027,\u0027KIP\u0027) then round(if(ordd.voucher_discount_amount is null,0,ordd.voucher_discount_amount))\r\n             when ord.currency_code in (\u0027THB\u0027,\u0027USD\u0027,\u0027MYR\u0027) then round(if(ordd.voucher_discount_amount is null,0,ordd.voucher_discount_amount),2)\r\n    end as voucher_discount_amount,\r\n\r\n    -- if(ord.shipping_fee is null,0,ord.shipping_fee) as shipping_fee,\r\n    case when ord.currency_code in (\u0027VND\u0027,\u0027IDR\u0027,\u0027KIP\u0027) then round(if(ord.shipping_fee is null,0,ord.shipping_fee))\r\n             when ord.currency_code in (\u0027THB\u0027,\u0027USD\u0027,\u0027MYR\u0027) then round(if(ord.shipping_fee is null,0,ord.shipping_fee),2)\r\n    end as shipping_fee,\r\n\r\n\r\n    (select u.email from `kynaforkids-server-production.kynaforkids.user` u where u.id \u003d ord.created_by) as SIC,\r\n    (select max(p.name) from `kynaforkids-server-production.kynaforkids.profile` p where p.user_id \u003d ord.created_by) as SIC_name,\r\n    case\r\n    when ordd.package_combo_id is not null then\r\n    (select pcsi.package_subscription_id from `kynaforkids-server-production.kynaforkids.package_combo_subscription_item` pcsi where pcsi.id \u003d ordd.package_subscription_id and pcsi.package_id \u003d ordd.package_id)\r\n    else ordd.package_subscription_id\r\n    end as package_subscription\r\n\r\n        \r\n       \r\nFROM `kynaforkids-server-production.kynaforkids.order_view` ord\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.order_detail` ordd ON (ord.id \u003d ordd.order_id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.order_register_info` ori ON (ord.id \u003d ori.order_id)\r\n-- LEFT JOIN `kynaforkids-server-production.kynaforkids.package_subscriptions` pks ON (ordd.package_subscription_id \u003d pks.id)\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.package` pk ON (pk.id \u003d ordd.package_id)\r\n-- LEFT JOIN `kynaforkids.booking_lead_view` bll on bll.id \u003d ori.lead_id\r\nLEFT JOIN `kynaforkids.booking_order_view` bo on RIGHT(bo.invoice_code,8) \u003d RIGHT(ord.invoice_code,8)\r\n\r\n\r\n\r\n\r\nWHERE \r\n      ord.invoice_code like \u0027KYNA%\u0027 or ord.invoice_code like \u0027GRAI%\u0027\r\n--       AND pk.name like \u0027%AI Tutor%\u0027\r\n--       AND ordd.package_combo_id is null\r\n),\r\n\r\ntemp_table as (\r\nSELECT oats.*,\r\n       (SELECT us.email FROM `kynaforkids-server-production.kynaforkids.user` us WHERE oats.affiliate_id \u003d us.id) as affiliate_email,\r\n       (SELECT au.affiliate_category_id FROM `kynaforkids-server-production.kynaforkids.affiliate_user` au WHERE au.user_id \u003d oats.affiliate_id) as affiliate_category_id,\r\n        \r\n       if(oats.completed_at is null, oats.ngay_sale_len_don, oats.completed_at) as created_at,\r\n       t2.first_time_purchase_phone,\r\n       t3.first_time_purchase_email,\r\n       ps.subscription_month,\r\n       ps.name as subscription_name,\r\n\r\n      case when currency_code in (\u0027VND\u0027,\u0027IDR\u0027,\u0027KIP\u0027) then round(\r\n          CASE WHEN(oats.sub_total !\u003d 0) then (oats.unit_price + (oats.unit_price/oats.sub_total) * (oats.shipping_fee - (oats.discount_amount + oats.voucher_discount_amount)))\r\n            WHEN (oats.sub_total\u003d0) then 0\r\n            END\r\n      )\r\n           when currency_code in (\u0027THB\u0027,\u0027USD\u0027,\u0027MYR\u0027) then round(\r\n               CASE WHEN(oats.sub_total !\u003d 0) then (oats.unit_price + (oats.unit_price/oats.sub_total) * (oats.shipping_fee - (oats.discount_amount + oats.voucher_discount_amount)))\r\n            WHEN (oats.sub_total\u003d0) then 0\r\n            END,2)\r\n      end as total_oc,\r\n       \r\nFROM order_ai_tutor_single oats\r\n      LEFT JOIN\r\n\r\n      (select ans1.phone_number,\r\n      min(timestamp_seconds(ans1.completed_at)) as first_time_purchase_phone\r\n      from `kynaforkids-server-production.kynaforkids.Acc_No_Students_Tutoring_AI` as ans1\r\n      group by ans1.phone_number order by ans1.phone_number) t2\r\n\r\n      on oats.student_phone \u003d t2.phone_number\r\n\r\n      LEFT JOIN\r\n      \r\n      (select ans2.email,\r\n      min(timestamp_seconds(ans2.completed_at)) as first_time_purchase_email\r\n      from `kynaforkids-server-production.kynaforkids.Acc_No_Students_Tutoring_AI` as ans2\r\n      group by ans2.email order by ans2.email) t3\r\n\r\n      on oats.student_email \u003d t3.email\r\n\r\n      LEFT JOIN `kynaforkids-server-production.kynaforkids.package_subscriptions` ps ON (oats.package_subscription \u003d ps.id)\r\n),\r\n\r\nresult as\r\n(\r\nselect tt.* EXCEPT(affiliate_email),\r\n      if(bll.actual_lead_id is null, bll.utm_campaign,\r\n        (select bl.utm_campaign from `kynaforkids-server-production.kynaforkids.booking_lead_view` bl where bl.id \u003d bll.actual_lead_id)) as utm_campaign,\r\n      if(bll.actual_lead_id is null, bll.landing_page_name,\r\n        (select bl.landing_page_name from `kynaforkids-server-production.kynaforkids.booking_lead_view` bl where bl.id \u003d bll.actual_lead_id)) as landingpage_name,\r\n      -- if(bll.actual_lead_id is null, bll.affiliate_id,\r\n      --   (select bl.affiliate_id from `kynaforkids-server-production.kynaforkids.booking_lead_view` bl where bl.id \u003d bll.actual_lead_id)) as affiliate_id,\r\n      case when tt.invoice_code like \"KYNA%\" then tt.affiliate_email\r\n           else --if(bll.actual_lead_id is null, (select max(u.email) from `kynaforkids-server-production.kynaforkids.kynaforkids_user` u where bll.affiliate_id \u003d u.id),\r\n      --     (select max(u.email) from `kynaforkids-server-production.kynaforkids.booking_lead_view` bl, `kynaforkids-server-production.kynaforkids.kynaforkids_user` u where bll.actual_lead_id \u003d bl.id and bl.affiliate_id \u003d u.id))               \r\n                  (select max(u.email) from `kynaforkids-server-production.kynaforkids.user` u, `kynaforkids-server-production.kynaforkids.affiliate_user` au where au.affiliate_id \u003d  tt.affiliate_id and au.user_id \u003d u.id)\r\n  \r\n      end as affiliate_email,\r\n     \r\n      -- case when tt.invoice_code like \"KYNA%\" then (SELECT ac.name FROM `kynaforkids.affiliate_category` ac WHERE ac.id \u003d tt.affiliate_category_id)\r\n      --      else if (bll.actual_lead_id is null, (select ac.name from `kynaforkids-server-production.kynaforkids.affiliate_user` au, `kynaforkids-server-production.kynaforkids.affiliate_category` ac where \r\n      --     bll.affiliate_id \u003d au.user_id and au.affiliate_category_id \u003d ac.id),(select ac.name from `kynaforkids-server-production.kynaforkids.booking_lead_view` bl, \r\n      --     `kynaforkids-server-production.kynaforkids.affiliate_user` au, `kynaforkids-server-production.kynaforkids.affiliate_category` ac \r\n      --     where bl.id \u003d bll.actual_lead_id and bl.affiliate_id \u003d au.user_id and au.affiliate_category_id \u003d ac.id)) \r\n      -- end as affiliate_category_name,\r\n\r\n      case when tt.invoice_code like \"KYNA%\" then (SELECT ac.name FROM `kynaforkids.affiliate_category` ac WHERE ac.id \u003d tt.affiliate_category_id)\r\n           else  (select ac.name from `kynaforkids-server-production.kynaforkids.affiliate_category` ac, `kynaforkids-server-production.kynaforkids.affiliate_user` au  where \r\n      tt.affiliate_id \u003d au.affiliate_id and au.affiliate_category_id \u003d ac.id)\r\n      end as affiliate_category_name,\r\n\r\n\r\nfrom temp_table tt\r\nleft join `kynaforkids.booking_lead_view` bll on tt.lead_id \u003d bll.id\r\nwhere tt.status \u003d \"Hoàn thành\"\r\n-- left join `kynaforkids.booking_order` bo on bo.lead_id \u003d tt.lead_id\r\n),\r\n\r\nall_ai_orders as\r\n(\r\nSELECT \r\n  *,\r\n  (SELECT max(auc.line_id) FROM `kynaforkids-server-production.kynaforkids.adwords_utm_campaign` auc\r\n         WHERE lower(auc.name) \u003d lower(aov.utm_campaign)) as line_id, \r\n  case\r\n  when aov.created_at \u003d aov.first_time_purchase_phone then \u0027New Customers\u0027\r\n  else \u0027Returning Customers\u0027\r\n  end as type_order_phone,\r\n  case\r\n  when aov.created_at \u003d aov.first_time_purchase_email then \u0027New Customers\u0027\r\n  else \u0027Returning Customers\u0027\r\n  end as type_order_email\r\nFROM result aov\r\nwhere aov.Mon_hoc like \"%AI%\"\r\n)\r\n\r\nselect \r\n      date(aio.created_at) as calc_date,\r\n      if(line.name is not null, line.name, \u0027Line_without_ID\u0027) as line_mkt,\r\n      if((select max(ac.country_id) from `kynaforkids-server-production.kynaforkids.adwords_meta_campaign` ac where line.id \u003d ac.line_id) is null,\r\n          aio.country_id,\r\n          (select max(ac.country_id) from `kynaforkids-server-production.kynaforkids.adwords_meta_campaign` ac where line.id \u003d ac.line_id)) \r\n        as country_id,\r\n          \r\n      (select max(ac.channel_id) from `kynaforkids-server-production.kynaforkids.adwords_meta_campaign` ac where line.id \u003d ac.line_id) as channel_id,\r\n      \r\n      7 as product_id,\r\n\r\n      sum(aio.total_oc * aio.currency_exchange_rate) as ai_single_order_vnd,\r\n      \r\n      count(distinct aio.invoice_code) as num_single_ai_orders\r\nfrom all_ai_orders aio\r\nleft join `kynaforkids-server-production.kynaforkids.adwords_meta_line` line ON (aio.line_id \u003d line.id)\r\nwhere aio.type_order_phone \u003d \u0027New Customers\u0027 and aio.type_order_email \u003d \u0027New Customers\u0027 \r\n      and aio.created_at \u003e\u003d \u00272024-08-01\u0027 \r\ngroup by calc_date, line_mkt, country_id, channel_id, product_id\r\norder by calc_date;"
}, {
  "table_name": "temp_monkey_junior_1_ngon_ngu",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_monkey_junior_1_ngon_ngu`\n(\n  string_field_0 STRING,\n  string_field_1 STRING,\n  string_field_2 STRING,\n  string_field_3 STRING,\n  string_field_4 STRING,\n  string_field_5 STRING,\n  string_field_6 STRING,\n  string_field_7 STRING,\n  string_field_8 STRING\n);"
}, {
  "table_name": "kynavn_order_shipping",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.kynavn_order_shipping`\n(\n  order_id INT64,\n  phone_number STRING,\n  location_id INT64\n);"
}, {
  "table_name": "theo_doi_hieu_qua_goi_cr2_a3419851-b955-4050-9066-5ce8e2b0d125_gppe4tfitd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.theo_doi_hieu_qua_goi_cr2_a3419851-b955-4050-9066-5ce8e2b0d125_gppe4tfitd`\n(\n  ngay_tao TIMESTAMP,\n  parent_name STRING,\n  children_name STRING,\n  phone_number STRING,\n  student_code STRING,\n  register_at TIMESTAMP,\n  country STRING,\n  affiliate_id INT64,\n  email_bd STRING,\n  status STRING,\n  so_lan_cap_nhap_lien_he STRING,\n  post_link STRING,\n  ngay_cap_nhap_gan_nhat TIMESTAMP,\n  id_get_note INT64,\n  id_ngay_nhac_nho_gan_nhat INT64,\n  id_hoan_thanh_nhac_nho_gan_nhat INT64,\n  note STRING,\n  ngay_nhac_nho_gan_nhat TIMESTAMP,\n  ngay_hoan_thanh_nhac_nho_gan_nhat TIMESTAMP\n);"
}, {
  "table_name": "mkt_line_performance_a288a4f1-6045-4d6a-b5bf-b0856b204c95_uef3zvbetd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.mkt_line_performance_a288a4f1-6045-4d6a-b5bf-b0856b204c95_uef3zvbetd`\n(\n  line_mkt STRING,\n  calc_date DATE,\n  spend INT64,\n  spend_with_tax FLOAT64,\n  num_leads INT64,\n  num_orders INT64,\n  order_value FLOAT64,\n  num_leads_test INT64,\n  num_leads_test_approved INT64,\n  leads_wait_for_order INT64,\n  ai_single_order_vnd FLOAT64,\n  num_single_ai_orders INT64,\n  country_id INT64,\n  channel_id INT64,\n  product_id INT64,\n  line_id INT64,\n  country STRING,\n  product_name STRING,\n  channel_name STRING,\n  total_order_value FLOAT64\n);"
}, {
  "table_name": "doanh_thu_hoa_hong_41bcfd42-7fd3-416c-b2b2-d8a059588093",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.doanh_thu_hoa_hong_41bcfd42-7fd3-416c-b2b2-d8a059588093`\n(\n  affiliate_id INT64,\n  affiliate_email STRING,\n  phone_number STRING,\n  name STRING,\n  loai_affiliate STRING,\n  Nguon STRING,\n  bd_incharge STRING,\n  trang_thai_hop_dong STRING,\n  ngan_hang STRING,\n  thang STRING,\n  total_order INT64,\n  tong_don_ghi_danh_lan_dau INT64,\n  phan_tram_lan_dau NUMERIC,\n  hoa_hong_lan_dau NUMERIC,\n  phan_tram_lan_dau_bonus NUMERIC,\n  hoa_hong_lan_dau_bonus NUMERIC,\n  tong_gon_ghi_danh_lai INT64,\n  hoa_hong_ghi_danh_lai NUMERIC,\n  tong_hoa_hong_cuoi FLOAT64,\n  total_amount FLOAT64,\n  co_phat_sinh_thu_nhap STRING,\n  thuong_thang NUMERIC,\n  du_no_ki_truoc NUMERIC,\n  dieu_chinh_khac NUMERIC,\n  dieu_chinh_thanh_toan NUMERIC,\n  tong_tien_lan_dau_tutoring FLOAT64,\n  tong_tien_ghi_danh_lai_tutoring FLOAT64,\n  tong_thu_nhap_tutoring FLOAT64,\n  tong_don_tutoring INT64,\n  tong_tien_lan_dau_grai FLOAT64,\n  tong_tien_ghi_danh_lai_grai FLOAT64,\n  tong_thu_nhap_grai FLOAT64,\n  tong_don_grai INT64,\n  tong_tien_lan_dau FLOAT64,\n  tong_tien_ghi_danh_lai FLOAT64,\n  tong_thu_nhap FLOAT64,\n  doanh_thu_video FLOAT64,\n  hoa_hong_video FLOAT64\n);"
}, {
  "table_name": "table_booking_cr_test_10h15_vn_market_618d3829-32d9-4f94-a171-9e0c92a7b1bd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.table_booking_cr_test_10h15_vn_market_618d3829-32d9-4f94-a171-9e0c92a7b1bd`\n(\n  ngay_tao_lead DATE,\n  sale_email STRING,\n  sale_manager_email STRING,\n  mon_hoc STRING,\n  affiliate_email STRING,\n  sale_name STRING,\n  sup_name STRING,\n  num_test_by_sic INT64,\n  num_test_by_sic_t1 INT64,\n  num_lead_t1 INT64,\n  num_lead_t1_1 INT64,\n  num_lead_t1_2 INT64\n);"
}, {
  "table_name": "report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_qy1yeoqatd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_qy1yeoqatd`\n(\n  affiliate_id INT64,\n  affiliate_email STRING,\n  loai_affiliate STRING,\n  bd_incharge STRING,\n  thang STRING,\n  tong_hoa_hong_cuoi FLOAT64,\n  total_amount FLOAT64\n);"
}, {
  "table_name": "chat_luong_mkt_indo_ddec9cf4-aaf9-4327-adca-fee17318ca5e",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.chat_luong_mkt_indo_ddec9cf4-aaf9-4327-adca-fee17318ca5e`\n(\n  cal_date DATE,\n  sale_id INT64,\n  trang_thai STRING,\n  affiliate_category STRING,\n  affiliate_email STRING,\n  affiliate_campaign STRING,\n  subject STRING,\n  num_leads INT64,\n  num_leads_status_lien_he INT64,\n  num_leads_status_tu_van_tham_gia_onl_off INT64,\n  num_leads_status_coc_hen_tt INT64,\n  num_leads_status_tu_choi_vi_ly_do_trung INT64,\n  num_leads_status_tu_choi_loai_ly_do_trung INT64,\n  num_leads_status_tu_choi INT64,\n  num_test_booked INT64,\n  num_test_completed INT64,\n  num_order_hoc_thu INT64,\n  num_order_ghi_danh_lan_dau INT64,\n  rev_ghi_danh_lan_dau FLOAT64,\n  sale_follow_email STRING,\n  sale_follow_supervisor_email STRING\n);"
}, {
  "table_name": "june_kbc_booking_to_map",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.june_kbc_booking_to_map`\n(\n  user_id INT64,\n  booking_id INT64,\n  booking_date DATE,\n  booking_time_hour_minute STRING,\n  status_id INT64,\n  program STRING,\n  priority INT64,\n  week_day INT64\n);"
}, {
  "table_name": "table_remain_lessons_scheduled_efcbdc7bfcf6",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.table_remain_lessons_scheduled_efcbdc7bfcf6`\n(\n  user_id INT64,\n  parent_id INT64,\n  email STRING,\n  program STRING,\n  program_id INT64,\n  student_code STRING,\n  student_status INT64,\n  total_lesson INT64,\n  used_lesson INT64,\n  remain_lesson INT64,\n  sale_in_charge_email STRING,\n  telesales_supervisor_email STRING,\n  country STRING,\n  max_order_id INT64,\n  booking_id INT64,\n  affiliate_email STRING,\n  affiliate_category STRING,\n  quoc_tich_gv STRING,\n  phone_hv STRING,\n  current_level_id INT64,\n  current_level STRING\n);"
}, {
  "table_name": "temp_hoc_vien_kbc_thang_8_phase_2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_hoc_vien_kbc_thang_8_phase_2`\n(\n  student_id INT64,\n  student_code STRING,\n  num_bookings_to_map INT64\n);"
}, {
  "table_name": "hieu_qua_ghep_lop_economy_0f2ad318-1e72-496a-9a5b-d7ecf36b7c11_y5nn10f0ud_2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.hieu_qua_ghep_lop_economy_0f2ad318-1e72-496a-9a5b-d7ecf36b7c11_y5nn10f0ud_2`\n(\n  user_id INT64,\n  student_code STRING,\n  action INT64,\n  action_date DATE,\n  action_description STRING,\n  rn INT64,\n  student_type STRING\n);"
}, {
  "table_name": "temp_hoc_vien_kbc_thang_7",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_hoc_vien_kbc_thang_7`\n(\n  student_id INT64,\n  student_code STRING,\n  num_bookings_to_map INT64\n);"
}, {
  "table_name": "report_order_completed_MKT_d118e756-3a26-4b8f-bd48-d2c273fbd655",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_order_completed_MKT_d118e756-3a26-4b8f-bd48-d2c273fbd655`\n(\n  ngay_tao_don DATE,\n  ngay_duyet_don DATE,\n  accounting_date TIMESTAMP,\n  ngay_tao_lead DATE,\n  invoice_code STRING,\n  ten_phu_huynh STRING,\n  email STRING,\n  name STRING,\n  student_code STRING,\n  student_id INT64,\n  phone_number STRING,\n  total_video_course NUMERIC,\n  total NUMERIC,\n  noi_dung_thanh_toan STRING,\n  source STRING,\n  program STRING,\n  order_status STRING,\n  payment_status STRING,\n  price NUMERIC,\n  total_VND FLOAT64,\n  total_nguyen_te NUMERIC,\n  duration INT64,\n  note STRING,\n  lead_id INT64,\n  sale_email STRING,\n  affiliate_campaign STRING,\n  landingpage_name STRING,\n  fanpage_name STRING,\n  gclid STRING,\n  affiliate_id INT64,\n  affiliate_email STRING,\n  affiliate_type STRING,\n  currency_exchange_rate FLOAT64,\n  price_vnd FLOAT64,\n  country STRING,\n  total_lesson INT64,\n  video_course_name STRING,\n  affiliate_emaill STRING,\n  loai_affiliate STRING,\n  num_completed_orders_same_student INT64,\n  num_completed_orders_same_phone INT64,\n  old_new_student STRING\n);"
}, {
  "table_name": "du_lieu_gv_co_ca_day_on_dinh_d159d09f-723d-4e4f-b6c9-41e659e17ac3_WtIiF",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.du_lieu_gv_co_ca_day_on_dinh_d159d09f-723d-4e4f-b6c9-41e659e17ac3_WtIiF`\n(\n  teacher_id INT64,\n  teacher_name STRING,\n  year_month STRING,\n  num_completed_booking INT64,\n  so_ca_on_dinh INT64,\n  so_ca_on_dinh_except_holiday INT64,\n  so_ca_on_dinh_cao_diem INT64,\n  so_ca_on_dinh_cao_diem_except_holiday INT64,\n  num_days_ghb INT64,\n  num_days_ghb_plus INT64\n);"
}, {
  "table_name": "teacher_cost_tracker_4a393d9b-a1e8-4574-8af2-848a48e46a9b",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.teacher_cost_tracker_4a393d9b-a1e8-4574-8af2-848a48e46a9b`\n(\n  booking_id INT64,\n  booking_time TIMESTAMP,\n  booking_type STRING,\n  num_shift INT64,\n  teacher_name STRING,\n  teacher_country STRING,\n  booking_status STRING,\n  program STRING,\n  teacher_id INT64,\n  payment_content STRING,\n  teacher_source INT64,\n  student_country STRING,\n  revenue_oc NUMERIC,\n  revenue_vnd FLOAT64,\n  sellingEx FLOAT64,\n  total_income NUMERIC\n);"
}, {
  "table_name": "quan_ly_btvn_a64182d8-036a-4c86-b475-fafa06d45fc8_cj87l7jhtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.quan_ly_btvn_a64182d8-036a-4c86-b475-fafa06d45fc8_cj87l7jhtd`\n(\n  Chuongtrinh STRING,\n  Cap_do_hoc STRING,\n  Ma_buoi_hoc STRING,\n  ten_buoi_hoc STRING,\n  Khoa_hoc STRING,\n  course_slug STRING,\n  Goi_khoa_hoc STRING,\n  package_slug STRING,\n  pk_cat_name STRING,\n  pk_cat_slug STRING,\n  Ten_bai_tap STRING,\n  ID_BTVN INT64,\n  Loai_noi_dung STRING,\n  Ngay_cap_nhat DATE,\n  Status_buoihoc STRING,\n  quiz_id INT64,\n  quiz_name STRING,\n  quiz_slug STRING,\n  speech_id INT64,\n  speech_name STRING,\n  speech_slug STRING,\n  minutes FLOAT64,\n  minutes_quiz_normal FLOAT64,\n  minutes_quiz_writing FLOAT64,\n  link_learning STRING\n);"
}, {
  "table_name": "report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_vs1i9fqatd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_vs1i9fqatd`\n(\n  ngay_tao_lead DATE,\n  bd_incharge_email STRING,\n  affiliate_type STRING,\n  country STRING,\n  num_active_affiliates INT64,\n  num_lead INT64,\n  num_order INT64\n);"
}, {
  "table_name": "chat_luong_mkt_vn_cb09a9e7-3575-474f-b88e-6fb58512f931_evrbw4r9sd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.chat_luong_mkt_vn_cb09a9e7-3575-474f-b88e-6fb58512f931_evrbw4r9sd`\n(\n  cal_date DATE,\n  sale_id INT64,\n  trang_thai STRING,\n  affiliate_category STRING,\n  affiliate_email STRING,\n  affiliate_campaign STRING,\n  subject STRING,\n  num_leads INT64,\n  num_leads_status_lien_he INT64,\n  num_leads_status_tu_van_tham_gia_onl_off INT64,\n  num_leads_status_coc_hen_tt INT64,\n  num_leads_status_tu_choi_vi_ly_do_trung INT64,\n  num_leads_status_tu_choi_loai_ly_do_trung INT64,\n  num_leads_status_tu_choi INT64,\n  num_test_booked INT64,\n  num_test_completed INT64,\n  num_order_hoc_thu INT64,\n  num_order_ghi_danh_lan_dau INT64,\n  rev_ghi_danh_lan_dau NUMERIC,\n  sale_follow_email STRING,\n  sale_follow_supervisor_email STRING\n);"
}, {
  "table_name": "report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_42tye3patd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_42tye3patd`\n(\n  ngay_tao DATE,\n  ngay_tao_lead DATE,\n  bd_incharge_email STRING,\n  affiliate_id INT64,\n  affiliate_type STRING,\n  affiliate_source STRING,\n  affiliate_email STRING,\n  num_lead INT64\n);"
}, {
  "table_name": "danh_sach_don_hang_co_qua_tang_c492366b-1459-4da6-8078-edf3cd07b374",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.danh_sach_don_hang_co_qua_tang_c492366b-1459-4da6-8078-edf3cd07b374`\n(\n  invoice_code STRING,\n  accounting_date DATE,\n  student_code STRING,\n  noi_dung_thanh_toan STRING,\n  price_vnd FLOAT64,\n  so_buoi_chinh_thuc INT64,\n  so_buoi_tang INT64,\n  teacher_type STRING,\n  gift_status STRING,\n  transport_status STRING,\n  notes STRING,\n  san_pham_tang STRING,\n  sale_email STRING,\n  sup_sale_email STRING,\n  phone_number STRING,\n  short_phone_number STRING\n);"
}, {
  "table_name": "alita_thu_duc_q9_q2",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.datateam_kynaforkids.alita_thu_duc_q9_q2`\n(\n  Name STRING,\n  Gender STRING,\n  Phone STRING,\n  Email STRING,\n  City STRING,\n  District STRING,\n  Dob STRING,\n  Relationship STRING,\n  Friend_Number STRING,\n  Follow_Number STRING,\n  Profile_URL STRING\n)\nOPTIONS(\n  sheet_range\u003d\"\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/1KuoKAv_1bFEE1U2D6KwSvEZlOMf4RcG5HqH8bU1kjpI/edit?gid\u003d0#gid\u003d0\"]\n);"
}, {
  "table_name": "fixed_schedule_bonus_ec36f78c-7afc-400d-8d70-e3efb41afba6_sz7sg7uktd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.fixed_schedule_bonus_ec36f78c-7afc-400d-8d70-e3efb41afba6_sz7sg7uktd`\n(\n  teacher_id INT64,\n  year_begin_at INT64,\n  month_begin_at INT64,\n  teacher_name STRING,\n  tc_in_charge STRING,\n  total_hv_fs2 INT64,\n  total_fs2 INT64\n);"
}, {
  "table_name": "report_order_event_offline_68c50866-e1f2-46a6-b111-ce8f51accad8",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_order_event_offline_68c50866-e1f2-46a6-b111-ce8f51accad8`\n(\n  invoice_code STRING,\n  event_name STRING,\n  phone_number STRING,\n  noi_dung_thanh_toan STRING,\n  aff_campaign STRING,\n  student_type STRING,\n  aff_email_nguon_dang_ky_order STRING,\n  affiliate_category_order STRING,\n  order_value FLOAT64\n);"
}, {
  "table_name": "report_heatmap_students_province_59a3d47e-4fc7-43b5-a613-a2ac8bef5bed",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_heatmap_students_province_59a3d47e-4fc7-43b5-a613-a2ac8bef5bed`\n(\n  province STRING,\n  district STRING,\n  ward STRING,\n  num_students INT64\n);"
}, {
  "table_name": "report_team_ops_9ae866b8-a7f7-4eea-9c70-9ed002c536fb",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_team_ops_9ae866b8-a7f7-4eea-9c70-9ed002c536fb`\n(\n  start_date DATE,\n  task_id INT64,\n  assigned_to_email STRING,\n  sub_category STRING,\n  student_country STRING,\n  ops_manager_email STRING,\n  so_task FLOAT64,\n  task_overdue FLOAT64,\n  student_code_from_db STRING\n);"
}, {
  "table_name": "doanh_thu_hoa_hong_41bcfd42-7fd3-416c-b2b2-d8a059588093_dosu8iihtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.doanh_thu_hoa_hong_41bcfd42-7fd3-416c-b2b2-d8a059588093_dosu8iihtd`\n(\n  affiliate_id INT64,\n  ten_aff_tren_HD STRING,\n  CCCD STRING,\n  MST STRING,\n  chu_tai_khoan STRING,\n  so_tai_khoan STRING,\n  ngan_hang_HD STRING,\n  chi_nhanh STRING,\n  thuoc_tinh STRING,\n  affiliate_email STRING,\n  phone_number STRING,\n  name STRING,\n  loai_affiliate STRING,\n  Nguon STRING,\n  bd_incharge STRING,\n  trang_thai_hop_dong STRING,\n  ngan_hang STRING,\n  thang STRING,\n  total_order INT64,\n  tong_don_ghi_danh_lan_dau INT64,\n  phan_tram_lan_dau NUMERIC,\n  hoa_hong_lan_dau NUMERIC,\n  phan_tram_lan_dau_bonus NUMERIC,\n  hoa_hong_lan_dau_bonus NUMERIC,\n  tong_gon_ghi_danh_lai INT64,\n  hoa_hong_ghi_danh_lai NUMERIC,\n  tong_hoa_hong_cuoi FLOAT64,\n  total_amount FLOAT64,\n  co_phat_sinh_thu_nhap STRING,\n  thuong_thang NUMERIC,\n  du_no_ki_truoc NUMERIC,\n  dieu_chinh_khac NUMERIC,\n  dieu_chinh_thanh_toan NUMERIC,\n  tong_tien_lan_dau_tutoring FLOAT64,\n  tong_tien_ghi_danh_lai_tutoring FLOAT64,\n  tong_thu_nhap_tutoring FLOAT64,\n  tong_don_tutoring INT64,\n  tong_tien_lan_dau_grai FLOAT64,\n  tong_tien_ghi_danh_lai_grai FLOAT64,\n  tong_thu_nhap_grai FLOAT64,\n  tong_don_grai INT64,\n  tong_tien_lan_dau FLOAT64,\n  tong_tien_ghi_danh_lai FLOAT64,\n  tong_thu_nhap FLOAT64,\n  doanh_thu_video FLOAT64,\n  hoa_hong_video FLOAT64\n);"
}, {
  "table_name": "order_video_software_b3d19fe3-e9f2-4fb0-8d50-d1570ff3a5a6",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.order_video_software_b3d19fe3-e9f2-4fb0-8d50-d1570ff3a5a6`\n(\n  ngay_sale_len_don TIMESTAMP,\n  id INT64,\n  completed_at TIMESTAMP,\n  created_by INT64,\n  telesale_id INT64,\n  register_source STRING,\n  country_id INT64,\n  currency_code STRING,\n  country STRING,\n  currency_exchange_rate FLOAT64,\n  sub_total NUMERIC,\n  unit_price NUMERIC,\n  student_name STRING,\n  student_phone STRING,\n  student_email STRING,\n  invoice_code STRING,\n  status STRING,\n  payment_method_id INT64,\n  payment_status_id INT64,\n  lead_id INT64,\n  affiliate_id INT64,\n  package_id INT64,\n  package_subscription_id INT64,\n  Mon_hoc STRING,\n  payment_method STRING,\n  payment_status STRING,\n  discount_amount NUMERIC,\n  voucher_discount_amount NUMERIC,\n  shipping_fee NUMERIC,\n  SIC STRING,\n  SIC_name STRING,\n  package_subscription INT64,\n  affiliate_category_id INT64,\n  created_at TIMESTAMP,\n  first_time_purchase_phone TIMESTAMP,\n  first_time_purchase_email TIMESTAMP,\n  subscription_month INT64,\n  subscription_name STRING,\n  total_oc NUMERIC,\n  utm_campaign STRING,\n  landingpage_name STRING,\n  affiliate_email STRING,\n  affiliate_category_name STRING,\n  type_order_phone STRING,\n  type_order_email STRING\n);"
}, {
  "table_name": "teacher_income_1-1_8b7cebb7-2377-43de-b4c7-30f363857402_dkhxblxctd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.teacher_income_1-1_8b7cebb7-2377-43de-b4c7-30f363857402_dkhxblxctd`\n(\n  year_month STRING,\n  teacher_id INT64,\n  teacher_email STRING,\n  name STRING,\n  quoc_tich STRING,\n  TC_in_charge STRING,\n  income_base_salary_current NUMERIC,\n  income_base_salary_last_1month NUMERIC,\n  income_base_salary_last_2month NUMERIC,\n  income_oc_current FLOAT64,\n  income_oc_last_1month FLOAT64,\n  income_oc_last_2month FLOAT64,\n  total_gross_income_current FLOAT64,\n  total_gross_income_last_1month FLOAT64,\n  total_gross_income_last_2month FLOAT64,\n  num_completed_booking_current INT64,\n  num_completed_booking_last_1month INT64,\n  num_completed_booking_last_2month INT64,\n  num_booking_have_cost_current INT64,\n  num_booking_have_cost_last_1month INT64,\n  num_booking_have_cost_last_2month INT64,\n  num_of_real_class_current INT64,\n  num_of_real_class_last_1month INT64,\n  num_of_real_class_last_2month INT64,\n  bonus_qualified_class_current NUMERIC,\n  bonus_qualified_class_last_1month NUMERIC,\n  bonus_qualified_class_last_2month NUMERIC,\n  bonus_replacement_current NUMERIC,\n  bonus_replacement_last_1month NUMERIC,\n  bonus_replacement_last_2month NUMERIC,\n  hot_bonus_current FLOAT64,\n  hot_bonus_last_1month FLOAT64,\n  hot_bonus_last_2month FLOAT64,\n  kyna_compensation_50_current NUMERIC,\n  kyna_compensation_50_last_1month NUMERIC,\n  kyna_compensation_50_last_2month NUMERIC,\n  kyna_compensation_100_current NUMERIC,\n  kyna_compensation_100_last_1month NUMERIC,\n  kyna_compensation_100_last_2month NUMERIC,\n  bonus_test_early_review_current NUMERIC,\n  bonus_test_early_review_last_1month NUMERIC,\n  bonus_test_early_review_last_2month NUMERIC,\n  bonus_test_golden_hour_current NUMERIC,\n  bonus_test_golden_hour_last_1month NUMERIC,\n  bonus_test_golden_hour_last_2month NUMERIC,\n  penalty_rating_below_standard_current NUMERIC,\n  penalty_rating_below_standard_last_1month NUMERIC,\n  penalty_rating_below_standard_last_2month NUMERIC,\n  penalty_wrong_cancel_current NUMERIC,\n  penalty_wrong_cancel_last_1month NUMERIC,\n  penalty_wrong_cancel_last_2month NUMERIC,\n  penalty_open_webcam_current NUMERIC,\n  penalty_open_webcam_last_1month NUMERIC,\n  penalty_open_webcam_last_2month NUMERIC,\n  penalty_code_of_conduct_current NUMERIC,\n  penalty_code_of_conduct_last_1month NUMERIC,\n  penalty_code_of_conduct_last_2month NUMERIC,\n  penalty_full_face_current FLOAT64,\n  penalty_full_face_last_1month FLOAT64,\n  penalty_full_face_last_2month FLOAT64,\n  penalty_over_cancel_current NUMERIC,\n  penalty_over_cancel_last_1month NUMERIC,\n  penalty_over_cancel_last_2month NUMERIC,\n  golden_hour_bonus_current NUMERIC,\n  golden_hour_bonus_last_1month NUMERIC,\n  golden_hour_bonus_last_2month NUMERIC,\n  Fsb_Level_1_Bonus_current NUMERIC,\n  Fsb_Level_1_Bonus_last_1month NUMERIC,\n  Fsb_Level_1_Bonus_last_2month NUMERIC,\n  Fsb_Level_2_Bonus_current NUMERIC,\n  Fsb_Level_2_Bonus_last_1month NUMERIC,\n  Fsb_Level_2_Bonus_last_2month NUMERIC,\n  fsb_quarter_bonus_current NUMERIC,\n  fsb_quarter_bonus_last_1month NUMERIC,\n  fsb_quarter_bonus_last_2month NUMERIC,\n  adjustment_income_current FLOAT64,\n  adjustment_income_last_1month FLOAT64,\n  adjustment_income_last_2month FLOAT64,\n  other_adjustment_current NUMERIC,\n  other_adjustment_last_1month NUMERIC,\n  other_adjustment_last_2month NUMERIC,\n  referral_income_current NUMERIC,\n  referral_income_last_1month NUMERIC,\n  referral_income_last_2month NUMERIC,\n  intro_income_current NUMERIC,\n  intro_income_last_1month NUMERIC,\n  intro_income_last_2month NUMERIC,\n  other_income_current NUMERIC,\n  other_income_last_1month NUMERIC,\n  other_income_last_2month NUMERIC,\n  last_month_adjustment_income_current NUMERIC,\n  last_month_adjustment_income_last_1month NUMERIC,\n  last_month_adjustment_income_last_2month NUMERIC,\n  avg_income_base_salary NUMERIC,\n  avg_income_oc FLOAT64,\n  avg_total_gross_income FLOAT64,\n  min_booking_income_current NUMERIC,\n  max_booking_income_current NUMERIC,\n  min_booking_income NUMERIC,\n  max_booking_income NUMERIC\n);"
}, {
  "table_name": "report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_jnwo5knatd_2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_jnwo5knatd_2`\n(\n  month_lead STRING,\n  email_lead STRING,\n  aff_camp_lead STRING,\n  aff_email_lead STRING,\n  aff_type_lead STRING,\n  block_op_lead STRING,\n  kpi INT64,\n  num_lead INT64\n);"
}, {
  "table_name": "mkt_line_performance_a288a4f1-6045-4d6a-b5bf-b0856b204c95_fq8af5ahtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.mkt_line_performance_a288a4f1-6045-4d6a-b5bf-b0856b204c95_fq8af5ahtd`\n(\n  campaign_name STRING,\n  date_spend DATE,\n  channel_id INT64,\n  product_id INT64,\n  country_id INT64,\n  spend INT64,\n  spend_with_tax FLOAT64,\n  line_mkt STRING,\n  country STRING,\n  product_name STRING,\n  channel_name STRING\n);"
}, {
  "table_name": "booking_no_documents_2190693d-7a39-4925-9a22-19b38c3ef83b",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.booking_no_documents_2190693d-7a39-4925-9a22-19b38c3ef83b`\n(\n  id INT64,\n  student_id INT64,\n  student_code STRING,\n  teacher_email STRING,\n  lesson_id INT64,\n  lesson_name STRING,\n  lesson_code STRING,\n  booking_name STRING,\n  program STRING,\n  level STRING,\n  booking_status STRING,\n  ngay_hoc TIMESTAMP,\n  document_id STRING\n);"
}, {
  "table_name": "teacher_cost_tracker_a393d9b-a1e8-4574-8af2-848a48e46a9b_qowgwe9dtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.teacher_cost_tracker_a393d9b-a1e8-4574-8af2-848a48e46a9b_qowgwe9dtd`\n(\n  year_month STRING,\n  booking_time DATE,\n  begin_at DATE,\n  accounting_date DATE,\n  teacher_cost_vnd FLOAT64,\n  rev_tutoring_vnd FLOAT64,\n  rev_video_app_vnd FLOAT64,\n  total_rev_vnd FLOAT64\n);"
}, {
  "table_name": "teacher_cost_tracker_4a393d9b-a1e8-4574-8af2-848a48e46a9b_3q1mjow9vd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.teacher_cost_tracker_4a393d9b-a1e8-4574-8af2-848a48e46a9b_3q1mjow9vd`\n(\n  booking_id INT64,\n  booking_time TIMESTAMP,\n  booking_type STRING,\n  num_shift INT64,\n  teacher_name STRING,\n  teacher_country STRING,\n  booking_status STRING,\n  program STRING,\n  teacher_id INT64,\n  payment_content STRING,\n  teacher_source INT64,\n  student_country STRING,\n  revenue_oc NUMERIC,\n  revenue_vnd FLOAT64,\n  sellingEx FLOAT64,\n  total_income NUMERIC\n);"
}, {
  "table_name": "report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_tg16x4xatd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_tg16x4xatd`\n(\n  user_id INT64,\n  qualification_photos STRING,\n  certification_id INT64,\n  ops_teacher_id INT64,\n  avatar STRING,\n  name STRING,\n  tc_email STRING,\n  certification STRING\n);"
}, {
  "table_name": "ceo_ghi_danh_lai_THAI_view_temp",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.ceo_ghi_danh_lai_THAI_view_temp`\nAS with general_table as (\r\nSELECT\r\n  -- CAST(FORMAT_TIMESTAMP(\"%d/%m/%Y\", (bl.created_at)) AS STRING) AS register_created\r\n    bl.id\r\n  , bl.status\r\n  , bl.utm_campaign as affiliate_campaign\r\n  , bl.reason_cancel_id\r\n  , bl.created_at\r\n  , bo.invoice_code\r\n  , bo.payment_content\r\n  , bo.total\r\n  , bo.payment_status\r\n  , bo.status as booking_order_status\r\n  , bo.discount_money\r\n  , bo.currency_exchange_rate\r\n  , date(bo.created_at) as order_date\r\n \r\n  , `kynaforkids-server-production.kynaforkids.func_get_booking_lead_status`(bl.status) as lead_status\r\n  , (select ac.name from `kynaforkids-server-production.kynaforkids.affiliate_category` ac,\r\n    `kynaforkids-server-production.kynaforkids.affiliate_user` au where au.affiliate_id \u003d bl.affiliate_id and au.affiliate_category_id \u003d ac.id) as affiliate_category\r\n  , (select u.email from `kynaforkids-server-production.kynaforkids.affiliate_user` au,\r\n    `kynaforkids-server-production.kynaforkids.user` u where au.affiliate_id \u003d bl.affiliate_id and u.id \u003d au.user_id ) as affiliate_email\r\n  , (SELECT max(p.name) FROM `kynaforkids-server-production.kynaforkids.profile` p WHERE p.user_id \u003d bl.sale_id) AS sale_follow\r\n    , (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d bl.sale_id) AS sale_follow_email\r\n  -- ngaltt start\r\n    ,(SELECT max(p.name) FROM `kynaforkids-server-production.kynaforkids.profile` p WHERE p.user_id \u003d tsm.telesales_supervisor_id) AS sale_follow_supervisor\r\n  , (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d tsm.telesales_supervisor_id) AS sale_follow_supervisor_email,\r\n\r\n    -- (select date(bsn.begin_at)\r\n    -- from `kynaforkids-server-production.kynaforkids.booking_session_new` bsn\r\n    -- where bsn.id \u003d bl.booking_test_id) as test_date,\r\n\r\n    bl.booking_test_id,\r\n    bl.sale_id,\r\n    -- (select bsn.status_id,\r\n    -- from `kynaforkids-server-production.kynaforkids.booking_session_new` bsn\r\n    -- where bsn.id \u003d bl.booking_test_id) as booking_test_status\r\n\r\n    -- ngaltt start\r\n `kynaforkids-server-production.kynaforkids.func_get_booking_payment_content`(bo.payment_content) AS loai_don_hang\r\n, IF(bo.payment_content \u003d 1, 1, 0) as hoc_thu\r\n, IF(bo.payment_content \u003d 2, 1, 0) as ghi_danh_lan_dau\r\n, IF(bo.payment_content \u003d 3, 1, 0) as tra_gop_lan_sau\r\n, IF(bo.payment_content \u003d 4, 1, 0) as ghi_danh_lai\r\n, (CASE WHEN bl.upsell \u003d 1 THEN \u0027Upsell\u0027 ELSE \u0027Lead\u0027 END) AS loai_lead\r\n, (CASE WHEN bl.is_blocked \u003d 0 THEN \u0027Open\u0027  ELSE \u0027Blocked\u0027 END) AS trang_thai\r\n    -- ngaltt end\r\n, if((select max(u.id) from `kynaforkids-server-production.kynaforkids.user` u,\r\n  (select parent_id from `kynaforkids-server-production.kynaforkids.booking_student` bst, `kynaforkids-server-production.kynaforkids.user` u where u.id \u003d bst.user_id and bst.is_user_test !\u003d 1) t1\r\n  where u.id \u003d t1.parent_id and u.phone_number \u003d bl.intl_phone_number) is null, \u0027Chưa là HV\u0027, \u0027Đã là HV\u0027) as HV_Yes_No\r\n, case\r\n    when bl.subject_code \u003d \u0027EK\u0027 then \u0027Tiếng Anh trẻ em\u0027\r\n    when bl.subject_code \u003d \u0027EA\u0027 then \u0027Tiếng Anh người lớn\u0027\r\n    when bl.subject_code \u003d \u0027M\u0027 then \u0027Toán\u0027\r\n    when bl.subject_code \u003d \u0027C\u0027 then \u0027Group Class\u0027\r\n    when bl.subject_code \u003d \u0027AI\u0027 then \u0027AI Tutor\u0027\r\n    when bl.subject_code \u003d \u0027AI-PRE\u0027 then \u0027AI Tutor Premium\u0027\r\n  end as subject_code\r\nFROM `kynaforkids-server-production.kynaforkids.booking_lead_view` bl\r\n-- ngaltt start\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr` tsm on tsm.telesales_id \u003d bl.sale_id\r\n-- ngaltt end\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.booking_order_view` bo ON bl.id \u003d bo.lead_id\r\n-- LEFT JOIN `kynaforkids-server-production.kynaforkids.auth_assignment` aa ON aa.user_id \u003d bl.sale_id\r\nWHERE bl.country_id \u003d 1\r\n-- AND aa.item_name IN(\u0027Telesales\u0027, \u0027Lead Telesales\u0027,\u0027SALE - Manager\u0027,\u0027SALE - Telesales - Staff\u0027,\u0027SALE - Telesales Supervisor\u0027)\r\nAND bl.Upsell \u003d 1\r\n),\r\n\r\nlead_table as\r\n(\r\nselect \r\n        date(created_at) as lead_date, \r\n        sale_id,\r\n        affiliate_campaign, affiliate_category, affiliate_email,\r\n        trang_thai,\r\n        count(distinct id) as num_leads,   \r\n\r\n      SUM(\r\n            if(status in (6,12),1,0)\r\n        ) as num_leads_status_lien_he,\r\n      \r\n      SUM(\r\n          if(reason_cancel_id in (\u002720\u0027) and status in (9),1,0)\r\n      ) as num_leads_status_tu_choi_vi_ly_do_trung,\r\n\r\n      SUM(\r\n            if(status in (3,4,5),1,0)\r\n        ) as num_leads_status_tu_van_tham_gia_onl_off,\r\n      SUM(\r\n            if(status in (21,22),1,0)\r\n        ) as num_leads_status_coc_hen_tt,\r\n      SUM(\r\n          if(reason_cancel_id not in (\u002720\u0027) and status in (9),1,0)\r\n      ) as num_leads_status_tu_choi_loai_ly_do_trung,\r\n      SUM(\r\n            if(status in (9),1,0)\r\n        ) as num_leads_status_tu_choi\r\nfrom general_table\r\nwhere date(created_at) \u003e\u003d \u00272024-01-01\u0027\r\n  -- and date(created_at) \u003e\u003d \u00272025-01-20\u0027\r\n  group by lead_date, sale_id, trang_thai, affiliate_campaign, affiliate_category, affiliate_email\r\n  order by lead_date desc\r\n),\r\n\r\norder_info as (\r\nselect \r\n        bo.invoice_code,\r\n        bo.created_by as sale_id,\r\n        bo.payment_content,\r\n        bo.total,\r\n        bo.total_video_course,\r\n        bo.payment_status,\r\n        bo.status,\r\n        bo.discount_money,\r\n        bo.currency_exchange_rate,\r\n        date(bo.created_at) as order_date,\r\n        bl.utm_campaign as affiliate_campaign,\r\n        (select ac.name from `kynaforkids-server-production.kynaforkids.affiliate_category` ac,\r\n          `kynaforkids-server-production.kynaforkids.affiliate_user` au where au.affiliate_id \u003d bl.affiliate_id and au.affiliate_category_id \u003d ac.id) as affiliate_category,\r\n         (select u.email from `kynaforkids-server-production.kynaforkids.affiliate_user` au,\r\n           `kynaforkids-server-production.kynaforkids.user` u where au.affiliate_id \u003d bl.affiliate_id and u.id \u003d au.user_id ) as affiliate_email,\r\n        case\r\n          when bl.subject_code \u003d \u0027EK\u0027 then \u0027Tiếng Anh trẻ em\u0027\r\n          when bl.subject_code \u003d \u0027EA\u0027 then \u0027Tiếng Anh người lớn\u0027\r\n          when bl.subject_code \u003d \u0027M\u0027 then \u0027Toán\u0027\r\n          when bl.subject_code \u003d \u0027C\u0027 then \u0027Group Class\u0027\r\n          when bl.subject_code \u003d \u0027AI\u0027 then \u0027AI Tutor\u0027\r\n          when bl.subject_code \u003d \u0027AI-PRE\u0027 then \u0027AI Tutor Premium\u0027\r\n        end as subject_code,\r\n        bo.lead_id,\r\n\r\nfrom `kynaforkids.booking_order_view` bo\r\nleft join `kynaforkids.booking_lead` bl on bl.id \u003d bo.lead_id\r\nwhere bo.status in (4) and bo.payment_status in (0,1,3,4)\r\n      and bo.international_country_id \u003d 1\r\n),\r\n\r\norder_table as\r\n(\r\nselect\r\n        order_date,\r\n        order_info.sale_id,\r\n        \u0027Open\u0027 as trang_thai,\r\n        affiliate_campaign, affiliate_category, affiliate_email,\r\n\r\n        string_agg(CAST(lead_id AS STRING)) as lead_ids,\r\n        string_agg(invoice_code) as invoices,      \r\n\r\n\r\n\r\n       SUM(\r\n            if(payment_content in (3,4), 1,0)\r\n        ) as num_order_ghi_danh_lai_tra_gop,\r\n\r\n\r\n        SUM(\r\n            if(payment_content in (3,4), round((coalesce(total,0) + coalesce(total_video_course,0) - coalesce(discount_money,0))*currency_exchange_rate),0)\r\n        ) as rev_ghi_danh_lai_tra_gop,\r\n\r\n\r\nfrom order_info\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr` tsm on tsm.telesales_id \u003d order_info.sale_id\r\n\r\nwhere order_date \u003e\u003d \u00272024-01-01\u0027\r\n  -- and order_date \u003e\u003d \u00272025-01-20\u0027\r\n  group by order_date,sale_id, trang_thai, affiliate_campaign, affiliate_category, affiliate_email\r\n  order by order_date desc\r\n),\r\n\r\n\r\nresult as (\r\nselect\r\n      coalesce(ot.order_date, lt.lead_date) as cal_date,\r\n      coalesce(ot.sale_id,lt.sale_id) as sale_id,\r\n      coalesce(ot.trang_thai, lt.trang_thai) as trang_thai,\r\n      coalesce(ot.affiliate_campaign, lt.affiliate_campaign) as affiliate_campaign,\r\n      coalesce(ot.affiliate_category,lt.affiliate_category) as affiliate_category,\r\n      coalesce(ot.affiliate_email, lt.affiliate_email) as affiliate_email,  \r\n\r\n      SUM(coalesce(lt.num_leads,0)) as num_leads,\r\n      SUM(coalesce(lt.num_leads_status_lien_he,0)) as num_leads_status_lien_he,\r\n      SUM(coalesce(lt.num_leads_status_tu_van_tham_gia_onl_off,0)) as num_leads_status_tu_van_tham_gia_onl_off,\r\n      SUM(coalesce(lt.num_leads_status_coc_hen_tt,0)) as num_leads_status_coc_hen_tt,\r\n      SUM(coalesce(lt.num_leads_status_tu_choi_vi_ly_do_trung,0)) as num_leads_status_tu_choi_vi_ly_do_trung,\r\n \r\n      SUM(coalesce(lt.num_leads_status_tu_choi_loai_ly_do_trung,0)) as num_leads_status_tu_choi_loai_ly_do_trung,\r\n      SUM(coalesce(lt.num_leads_status_tu_choi,0)) as num_leads_status_tu_choi,\r\n\r\n      -- SUM(coalesce(tt.num_test_booked,0)) as num_test_booked,\r\n      -- SUM(coalesce(tt.num_test_completed,0)) as num_test_completed,\r\n\r\n      -- SUM(coalesce(ot.num_order_hoc_thu,0)) as num_order_hoc_thu,\r\n      SUM(coalesce(ot.num_order_ghi_danh_lai_tra_gop,0)) as num_order_ghi_danh_lai_tra_gop,      \r\n      SUM(coalesce(ot.rev_ghi_danh_lai_tra_gop,0)) as rev_ghi_danh_lai_tra_gop,   \r\n      \r\n\r\n\r\n       \r\nfrom lead_table lt\r\nfull join order_table ot on (ot.order_date \u003d lt.lead_date and lt.sale_id \u003d ot.sale_id and lt.affiliate_campaign\u003dot.affiliate_campaign and lt.affiliate_category\u003dot.affiliate_category and lt.affiliate_email\u003dot.affiliate_email and lt.trang_thai\u003dot.trang_thai)\r\ngroup by cal_date, sale_id, trang_thai, affiliate_campaign, affiliate_category, affiliate_email \r\norder by cal_date desc, trang_thai, affiliate_campaign, affiliate_category, affiliate_email\r\n)\r\n\r\nselect r.*,\r\n      (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d r.sale_id) AS sale_follow_email,\r\n      (SELECT max(u.email) FROM `kynaforkids-server-production.kynaforkids.user` u WHERE u.id \u003d tsm.telesales_supervisor_id) AS sale_follow_supervisor_email,\r\nfrom result r\r\nLEFT JOIN `kynaforkids-server-production.kynaforkids.telesales_supervisor_mgr` tsm on tsm.telesales_id \u003d r.sale_id\r\n;"
}, {
  "table_name": "kyna_eng_teacher_management_9a9ea35c-3271-4af4-ac49-61472d1ad616_p_xmi9i8cwjd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.kyna_eng_teacher_management_9a9ea35c-3271-4af4-ac49-61472d1ad616_p_xmi9i8cwjd`\n(\n  booking_id INT64,\n  teacher_id INT64,\n  begin_at TIMESTAMP,\n  duyet_booking INT64,\n  ops_teacher_email STRING,\n  teacher_name STRING,\n  country_id INT64,\n  country_id_hv INT64,\n  t_source INT64,\n  program STRING,\n  mon_hoc STRING,\n  loai_hoc_vien STRING,\n  danh_gia STRING,\n  khong_dat INT64,\n  duoi_chuan INT64,\n  no_pay INT64,\n  no_pay_base_rate INT64,\n  no_show INT64,\n  teacher_open_webcam_time_less_70 STRING,\n  percent_open_camera_time INT64,\n  percent_time_teacher_full_face_less_70 STRING,\n  percent_full_face_time INT64,\n  teacher_taking_less_20 STRING,\n  percent_teacher_talking_time INT64,\n  access_time_gv INT64,\n  teacher_vao_lop_tre STRING,\n  teacher_note_tre STRING,\n  teacher_khong_note STRING,\n  access_time_hv INT64,\n  warning INT64,\n  warning_details STRING,\n  teacher_email STRING,\n  teacher_country STRING,\n  teacher_source STRING,\n  student_country STRING\n);"
}, {
  "table_name": "booking_session_check_history",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.booking_session_check_history`\n(\n  snapshot_date DATE,\n  table_name STRING,\n  historical_date DATE,\n  week_day_abbr STRING,\n  row_count INT64,\n  completed_count INT64,\n  canceled_count INT64,\n  deleted_count INT64,\n  other INT64,\n  completed_7days_before_count INT64,\n  difference INT64,\n  percentage_difference FLOAT64\n);"
}, {
  "table_name": "hieu_qua_ghep_lop_economy_0f2ad318-1e72-496a-9a5b-d7ecf36b7c11_8pvv4vq0ud",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.hieu_qua_ghep_lop_economy_0f2ad318-1e72-496a-9a5b-d7ecf36b7c11_8pvv4vq0ud`\n(\n  ngay_hoc DATE,\n  khung_gio STRING,\n  program STRING,\n  lesson STRING,\n  booking_name STRING,\n  extracted_program_level_lesson STRING,\n  teacher_id INT64,\n  teacher_name STRING,\n  booking_status STRING,\n  bonus_status STRING,\n  economy_status STRING,\n  money_saved_dk NUMERIC,\n  money_to_pay_dk NUMERIC,\n  first_booking_id INT64,\n  secondary_booking_id INT64,\n  first_student_code STRING,\n  secondary_student_code STRING,\n  first_student_access_time DATETIME,\n  second_student_access_time DATETIME,\n  is_successful INT64,\n  estimated_money_saved NUMERIC,\n  estimated_money_to_pay NUMERIC,\n  final_money_saved NUMERIC,\n  final_money_to_pay NUMERIC,\n  num_student_economy INT64,\n  teacher_country STRING,\n  estimated_money_saved_vnd FLOAT64,\n  estimated_money_to_pay_vnd FLOAT64,\n  final_money_saved_vnd FLOAT64,\n  final_money_to_pay_vnd FLOAT64,\n  num_booking_total INT64,\n  estimated_money_to_pay_vnd_total FLOAT64,\n  final_money_to_pay_vnd_total FLOAT64\n);"
}, {
  "table_name": "report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_1dxy898vpd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_1dxy898vpd`\n(\n  interview_date DATE,\n  acceptance_date DATE,\n  teacher_id INT64,\n  teacher_email STRING,\n  teacher_name STRING,\n  teacher_country STRING,\n  teacher_source INT64,\n  teaching_training_date DATE,\n  test_training_date DATE,\n  training_status_id INT64,\n  status_id INT64,\n  contract_status_id INT64,\n  contract_completion_date DATE,\n  deactivate_date DATE,\n  is_tester INT64,\n  is_math_teacher_or_tester INT64,\n  tc_email STRING,\n  training_status STRING,\n  contract_status STRING,\n  source STRING,\n  status STRING,\n  least_training_date DATE,\n  greatest_training_date DATE,\n  reactivated_date DATE,\n  num_reactivate INT64,\n  ready_to_teach_date DATE,\n  reactivate_contract_completion_date DATE,\n  booked_training_date DATE,\n  num_contracts INT64,\n  max_contract_send_date INT64,\n  num_reactivated_contracts INT64,\n  max_reactivated_contract_send_date INT64,\n  acceptance_or_reactivated_date DATE,\n  contract_sign_status_id INT64,\n  reactivated_contract_sign_status_id INT64,\n  is_trained STRING,\n  is_contract_sign STRING,\n  is_reactivated_contract_sign STRING,\n  normal_or_reactivated STRING,\n  reactivated_qualified_to_teach_date DATE,\n  final_contract_completion_date DATE,\n  num_days_to_be_qualified_to_teach INT64,\n  status_contract_sign STRING,\n  status_reactivated_contract_sign STRING,\n  num_days_to_be_qualified_to_teach_reactivated INT64,\n  final_num_days_to_be_qualified_to_teach INT64,\n  final_is_contract_sign STRING,\n  final_qualified_to_teach_date DATE,\n  first_booking_date DATE\n);"
}, {
  "table_name": "performance_bonus_e3f0d061-6f11-4539-8b97-1b8dab74fab8_k746n4a6sd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.performance_bonus_e3f0d061-6f11-4539-8b97-1b8dab74fab8_k746n4a6sd`\n(\n  tc_email STRING,\n  booking_id INT64,\n  booking_name STRING,\n  booking_time TIMESTAMP,\n  teacher_name STRING,\n  teacher_email STRING,\n  teacher_country STRING,\n  country STRING,\n  student_name STRING,\n  student_email STRING,\n  student_code STRING,\n  booking_status STRING,\n  teacher_source STRING,\n  program STRING,\n  level_name STRING,\n  num_shift INT64,\n  currency_exchange_rate FLOAT64,\n  student_country STRING,\n  teacher_id INT64,\n  total_income NUMERIC,\n  tc_incharge_id INT64\n);"
}, {
  "table_name": "chat_luong_mkt_lao_93931ef4-def7-4955-99c7-18ebc5a270c1_azww0e0ltd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.chat_luong_mkt_lao_93931ef4-def7-4955-99c7-18ebc5a270c1_azww0e0ltd`\n(\n  cal_date DATE,\n  sale_id INT64,\n  trang_thai STRING,\n  affiliate_category STRING,\n  affiliate_email STRING,\n  affiliate_campaign STRING,\n  subject STRING,\n  num_leads INT64,\n  num_leads_status_lien_he INT64,\n  num_leads_status_tu_van_tham_gia_onl_off INT64,\n  num_leads_status_coc_hen_tt INT64,\n  num_leads_status_tu_choi_vi_ly_do_trung INT64,\n  num_leads_status_tu_choi_loai_ly_do_trung INT64,\n  num_leads_status_tu_choi INT64,\n  num_test_booked INT64,\n  num_test_completed INT64,\n  num_order_hoc_thu INT64,\n  num_order_ghi_danh_lan_dau INT64,\n  rev_ghi_danh_lan_dau FLOAT64,\n  sale_follow_email STRING,\n  sale_follow_supervisor_email STRING\n);"
}, {
  "table_name": "table_active_students_by_quarter_province_a2ac8bef5bed_p_hyp7s1t7wd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.table_active_students_by_quarter_province_a2ac8bef5bed_p_hyp7s1t7wd`\n(\n  student_code STRING,\n  user_id INT64,\n  province STRING,\n  Q1_2026_active INT64,\n  Q2_2026_active INT64,\n  Q3_2026_active INT64,\n  Q4_2026_active INT64,\n  Q1_2027_active INT64,\n  Q2_2027_active INT64,\n  Q3_2027_active INT64,\n  Q4_2027_active INT64,\n  Q1_2022_active INT64,\n  Q2_2022_active INT64,\n  Q3_2022_active INT64,\n  Q4_2022_active INT64,\n  Q1_2023_active INT64,\n  Q2_2023_active INT64,\n  Q3_2023_active INT64,\n  Q4_2023_active INT64,\n  Q1_2024_active INT64,\n  Q2_2024_active INT64,\n  Q3_2024_active INT64,\n  Q4_2024_active INT64,\n  Q1_2025_active INT64,\n  Q2_2025_active INT64,\n  Q3_2025_active INT64,\n  Q4_2025_active INT64\n);"
}, {
  "table_name": "chat_luong_mkt_lao_93931ef4-def7-4955-99c7-18ebc5a270c1_0fonmh0ltd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.chat_luong_mkt_lao_93931ef4-def7-4955-99c7-18ebc5a270c1_0fonmh0ltd`\n(\n  cal_date DATE,\n  sale_id INT64,\n  trang_thai STRING,\n  affiliate_campaign STRING,\n  affiliate_category STRING,\n  affiliate_email STRING,\n  num_leads INT64,\n  num_leads_status_lien_he INT64,\n  num_leads_status_tu_van_tham_gia_onl_off INT64,\n  num_leads_status_coc_hen_tt INT64,\n  num_leads_status_tu_choi_vi_ly_do_trung INT64,\n  num_leads_status_tu_choi_loai_ly_do_trung INT64,\n  num_leads_status_tu_choi INT64,\n  num_order_ghi_danh_lai_tra_gop INT64,\n  rev_ghi_danh_lai_tra_gop FLOAT64,\n  sale_follow_email STRING,\n  sale_follow_supervisor_email STRING\n);"
}, {
  "table_name": "table_booking_cr_test_15h15_vn_market_618d3829-32d9-4f94-a171-9e0c92a7b1bd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.table_booking_cr_test_15h15_vn_market_618d3829-32d9-4f94-a171-9e0c92a7b1bd`\n(\n  ngay_tao_lead DATE,\n  sale_email STRING,\n  sale_manager_email STRING,\n  mon_hoc STRING,\n  affiliate_email STRING,\n  sale_name STRING,\n  sup_name STRING,\n  num_test_by_sic INT64,\n  num_test_by_sic_t1 INT64,\n  num_lead_t1 INT64,\n  num_lead_t1_1 INT64,\n  num_lead_t1_2 INT64\n);"
}, {
  "table_name": "tong_gia_tri_theo_sdt_eeb32fba-f0cb-4b1d-ad9f-d6083e68fe11_uomoc2qwtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.tong_gia_tri_theo_sdt_eeb32fba-f0cb-4b1d-ad9f-d6083e68fe11_uomoc2qwtd`\n(\n  phone_number STRING,\n  cohort STRING,\n  Market STRING,\n  student_codes STRING,\n  student_names STRING,\n  sale_emails STRING,\n  sup_emails STRING,\n  sale_tao_don STRING,\n  sup_sale_tao_don STRING,\n  last_order_info STRING,\n  order_values STRING,\n  total_order_values FLOAT64,\n  category_total_order_value STRING,\n  remaining_lesson_filter STRING\n);"
}, {
  "table_name": "ty_le_hoan_thanh-hv_a9a9d5a1-7678-4d02-9b95-eacc10c3467a_u3isazeitd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.ty_le_hoan_thanh-hv_a9a9d5a1-7678-4d02-9b95-eacc10c3467a_u3isazeitd`\n(\n  student_code STRING,\n  user_type STRING,\n  program STRING,\n  level_name STRING,\n  num_completed INT64,\n  num_bookings INT64,\n  completed_rate FLOAT64,\n  completed_rate_filter STRING\n);"
}, {
  "table_name": "report_so_luong_gv_tieng_anh_468ec3fd-a8cf-4796-9916-330e4359e503_a4xntqvatd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_so_luong_gv_tieng_anh_468ec3fd-a8cf-4796-9916-330e4359e503_a4xntqvatd`\n(\n  id INT64,\n  name STRING,\n  email STRING,\n  phone_number STRING,\n  role_interview STRING,\n  birthday DATE,\n  gender STRING,\n  country STRING,\n  position STRING,\n  link_cv STRING,\n  interview_record STRING,\n  interview_by STRING,\n  interview_date DATE,\n  created_by STRING,\n  training_status_description STRING,\n  booked_training_date DATE,\n  candidate_status_description STRING,\n  point INT64,\n  comment STRING\n);"
}, {
  "table_name": "students_kbc_teacher_june_part_2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.students_kbc_teacher_june_part_2`\n(\n  student_code STRING,\n  student_id INT64\n);"
}, {
  "table_name": "ds_142_tx_nhan_hb",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.ds_142_tx_nhan_hb`\n(\n  id STRING,\n  name STRING,\n  phone STRING,\n  depot STRING\n);"
}, {
  "table_name": "hieu_qua_ghep_lop_economy_0f2ad318-1e72-496a-9a5b-d7ecf36b7c11_vWmOF",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.hieu_qua_ghep_lop_economy_0f2ad318-1e72-496a-9a5b-d7ecf36b7c11_vWmOF`\n(\n  booking_id INT64,\n  ngay_hoc DATE,\n  is_successful INT64,\n  is_match INT64,\n  student_code STRING,\n  estimated_money_to_pay_vnd FLOAT64,\n  final_money_to_pay_vnd FLOAT64,\n  is_1st_student INT64,\n  is_2nd_student INT64\n);"
}, {
  "table_name": "bien_dong_so_luong_gv_tieng_anh_tracker_468ec3fd-a8cf-4796-9916-330e4359e503_1oknv0ebsd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.bien_dong_so_luong_gv_tieng_anh_tracker_468ec3fd-a8cf-4796-9916-330e4359e503_1oknv0ebsd`\n(\n  user_id INT64,\n  is_auto_repeat_calendar INT64,\n  name STRING,\n  email STRING,\n  country STRING,\n  teacher_care_name STRING,\n  teacher_care STRING,\n  max_salary_one_shifts FLOAT64,\n  max_apply_date_one_shifts TIMESTAMP,\n  max_salary_two_shifts FLOAT64,\n  max_apply_date_two_shifts TIMESTAMP,\n  student_priority STRING,\n  count_student_priority INT64,\n  phone_number STRING,\n  ngay_bat_dau_hop_dong INT64,\n  teacher_source STRING,\n  Khu_vuc STRING,\n  Trang_thai STRING,\n  Nhom_quoc_gia STRING,\n  ranking INT64,\n  num_warnings INT64,\n  num_tc_warnings INT64,\n  num_hvcd INT64\n);"
}, {
  "table_name": "hoc_vien_mua_aiv2_31d9758d-2bf1-428e-974d-fda937e427f5",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.hoc_vien_mua_aiv2_31d9758d-2bf1-428e-974d-fda937e427f5`\n(\n  order_id INT64,\n  created_at DATE,\n  is_activated INT64,\n  phone_number STRING,\n  order_code STRING,\n  subscription_month INT64,\n  subscription_name STRING,\n  subscription_price INT64,\n  package_name STRING,\n  student_id INT64,\n  student_code STRING,\n  ngay_hach_toan DATE,\n  ngay_het_han DATE,\n  loai_hoc_vien STRING,\n  num_order INT64,\n  tong_so_thang INT64,\n  num_grouptalk_bookings INT64,\n  level STRING,\n  sale_in_charge_id INT64,\n  total_booking_ai INT64,\n  booking_ai_completed INT64,\n  num_booking_join INT64,\n  num_booking_vang INT64,\n  total_booking_1_1 INT64,\n  booking_1_1_completed INT64,\n  kich_hoat_len_lich STRING,\n  sale_in_charge_email STRING,\n  created_by_email STRING\n);"
}, {
  "table_name": "thong_tin_gv_suggest_cho_sales_ops_b7e86dc3-4bf4-4970-b80a-e13d897808c9",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.thong_tin_gv_suggest_cho_sales_ops_b7e86dc3-4bf4-4970-b80a-e13d897808c9`\n(\n  teacher_id INT64,\n  teacher_name STRING,\n  tc_email STRING,\n  teacher_country STRING,\n  age INT64,\n  academic_score INT64,\n  Gioi_Tinh STRING,\n  difficulty_level STRING,\n  total_booking_completed INT64,\n  total_booking_completed_last_30days INT64,\n  total_booking_new_waiting_approved_in_future INT64,\n  major STRING,\n  certification STRING,\n  certificate_detail STRING,\n  level_of_education STRING,\n  education_background STRING,\n  teaching_experience STRING,\n  enable_mapping STRING,\n  Nhom_quoc_gia STRING,\n  Khu_vuc STRING,\n  Trang_thai STRING,\n  num_warnings INT64,\n  num_tc_warnings INT64,\n  source STRING,\n  final_qualified_to_teach_date DATE,\n  qualified_to_teach STRING,\n  day_or_test STRING,\n  tags_name STRING,\n  total_booking_completed_filter STRING,\n  total_booking_completed_last_30days_filter STRING,\n  total_booking_new_waiting_approved_in_future_filter STRING,\n  num_warnings_filter STRING,\n  num_tc_warnings_filter STRING,\n  program STRING,\n  salary_over STRING\n);"
}, {
  "table_name": "telemarketing_52312e63-9f7a-4948-9fdf-8ccf1e9bbe11_l8jtjecwud",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.telemarketing_52312e63-9f7a-4948-9fdf-8ccf1e9bbe11_l8jtjecwud`\n(\n  calc_date DATE,\n  utm_campaign STRING,\n  affiliate_email STRING,\n  email_ctv STRING,\n  num_data_lead INT64,\n  num_data_tao_moi INT64,\n  num_data_open INT64,\n  num_data_tu_choi INT64,\n  num_order INT64,\n  revenue FLOAT64,\n  bonus FLOAT64\n);"
}, {
  "table_name": "fixed_schedule_bonus_ec36f78c-7afc-400d-8d70-e3efb41afba6_zww5wmwktd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.fixed_schedule_bonus_ec36f78c-7afc-400d-8d70-e3efb41afba6_zww5wmwktd`\n(\n  teacher_id INT64,\n  year INT64,\n  quarter INT64,\n  teacher_name STRING,\n  tc_in_charge STRING,\n  total_hv_fsq INT64,\n  total_fsq INT64\n);"
}, {
  "table_name": "temp_list_gv_can_them_email",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_list_gv_can_them_email`\nOPTIONS(\n  sheet_range\u003d\"Sheet1!A:L\",\n  skip_leading_rows\u003d1,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/1zWiISE5-Ryf0bYQX8JFbZDAl4SNy5q7izMi3R57KIvU/edit?gid\u003d0#gid\u003d0\"]\n);"
}, {
  "table_name": "report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_6huxxzrbtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_bien_dong_GV_Toan_efbf2d67-49f4-40cb-b109-2c5c237aeef3_6huxxzrbtd`\n(\n  tc_email STRING,\n  booking_id INT64,\n  teacher_id INT64,\n  tc_incharge_id INT64,\n  teacher_name STRING,\n  teacher_country STRING,\n  booking_begin_time TIMESTAMP,\n  booking_end_time TIMESTAMP,\n  program STRING,\n  cancel_no_show_1 INT64,\n  cancel_no_show_2 INT64,\n  time_out INT64,\n  reject INT64,\n  cancel_less_24h INT64,\n  cancel_more_24h INT64,\n  hoat_dong STRING\n);"
}, {
  "table_name": "report_hieu_qua_partnership_312a51c8-b964-4328-b959-d027909dd30f",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hieu_qua_partnership_312a51c8-b964-4328-b959-d027909dd30f`\n(\n  id INT64,\n  sale_email STRING,\n  sup_sale_email STRING,\n  parent_name STRING,\n  children_name STRING,\n  email STRING,\n  phone_number_lead STRING,\n  address STRING,\n  tinh_thanh_pho STRING,\n  quiz_score FLOAT64,\n  affiliate_campaign STRING,\n  affiliate_email STRING,\n  bd_incharge_email STRING,\n  landing_page_name STRING,\n  note_id INT64,\n  actual_affiliate_id INT64,\n  source INT64,\n  thai_lead_status STRING,\n  lead_status STRING,\n  country STRING,\n  created_at TIMESTAMP,\n  updated_at TIMESTAMP,\n  created_order_at TIMESTAMP,\n  fanpage_name STRING,\n  reason_cancel STRING,\n  sup_email STRING,\n  Bloked_Open STRING,\n  gclid STRING,\n  nhan_xet_gv STRING,\n  affiliate_id INT64,\n  email_lien_he STRING,\n  quoc_gia STRING,\n  nguon_affiliate STRING,\n  dang_bai_dai_su STRING,\n  user_id INT64,\n  price_vnd FLOAT64,\n  sourse STRING,\n  note STRING,\n  email_he_thong STRING,\n  affiliate_type STRING,\n  country_affiliate STRING\n);"
}, {
  "table_name": "report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_6huxxzrbtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hieu_qua_bd_feb27bdc-ea38-46e5-9343-8692c02329a3_6huxxzrbtd`\n(\n  tc_email STRING,\n  booking_id INT64,\n  teacher_id INT64,\n  tc_incharge_id INT64,\n  teacher_name STRING,\n  teacher_country STRING,\n  booking_begin_time TIMESTAMP,\n  booking_end_time TIMESTAMP,\n  program STRING,\n  cancel_no_show_1 INT64,\n  cancel_no_show_2 INT64,\n  time_out INT64,\n  reject INT64,\n  cancel_less_24h INT64,\n  cancel_more_24h INT64,\n  hoat_dong STRING\n);"
}, {
  "table_name": "booking_lead_dae3c67b-8d8d-4961-9524-70d880082c68",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.booking_lead_dae3c67b-8d8d-4961-9524-70d880082c68`\n(\n  id INT64,\n  sale_email STRING,\n  sup_sale_email STRING,\n  parent_name STRING,\n  children_name STRING,\n  email STRING,\n  phone_number STRING,\n  address STRING,\n  tinh_thanh_pho STRING,\n  quiz_score FLOAT64,\n  affiliate_campaign STRING,\n  affiliate_email STRING,\n  bd_incharge_email STRING,\n  affiliate_type STRING,\n  landing_page_name STRING,\n  note_id INT64,\n  source_id INT64,\n  actual_affiliate_id INT64,\n  source INT64,\n  thai_lead_status STRING,\n  lead_status STRING,\n  country STRING,\n  created_at TIMESTAMP,\n  updated_at TIMESTAMP,\n  created_order_at TIMESTAMP,\n  fanpage_name STRING,\n  reason_cancel STRING,\n  sup_email STRING,\n  Bloked_Open STRING,\n  gclid STRING,\n  nhan_xet_gv STRING,\n  ip_address STRING,\n  mon_hoc STRING,\n  sourse STRING,\n  note STRING\n);"
}, {
  "table_name": "temp_hv_dang_ky_economy",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_hv_dang_ky_economy`\n(\n  student_id INT64,\n  profile_link STRING,\n  register_time TIMESTAMP,\n  register_date DATE\n);"
}, {
  "table_name": "vongquay500",
  "ddl": "CREATE EXTERNAL TABLE `kynaforkids-server-production.datateam_kynaforkids.vongquay500`\n(\n  campaign STRING,\n  phone STRING,\n  code STRING,\n  expired_date DATETIME,\n  status STRING,\n  gift STRING,\n  created_at DATETIME,\n  used_date DATETIME\n)\nOPTIONS(\n  sheet_range\u003d\"VONGQUAY500!A:H\",\n  skip_leading_rows\u003d3,\n  format\u003d\"GOOGLE_SHEETS\",\n  uris\u003d[\"https://docs.google.com/spreadsheets/d/1Hh__ebkjFv30y_woekcvpEEhLKGE8I-yEvLtrzpnEiE/edit?gid\u003d343272210#gid\u003d343272210\"]\n);"
}, {
  "table_name": "view_learnig_retention_month_location",
  "ddl": "CREATE VIEW `kynaforkids-server-production.datateam_kynaforkids.view_learnig_retention_month_location`\nAS SELECT \r\n  DISTINCT(t2.id),\r\n  t2.student_code,\r\n  t2.student_id,\r\n  t2.email,\r\n  t2.minDate,\r\n  t2.learning_date,\r\n  t2.learning_date_1,\r\n  FORMAT_TIMESTAMP(\"%m/%Y\",timestamp_seconds(t2.order_date)) as order_date,\r\n  t2.begin_at,\r\n  t2.revenue,\r\n  t2.center_name,\r\n  t2.user_type,\r\n  t2.birthday,\r\n  (select max(bl.location_id) from `kynaforkids-server-production.kynaforkids.booking_lead` bl \r\n    where bl.email \u003d t2.email) as location_id,\r\n  t2.Loai_CT,\r\n  t2.status_id,\r\n  t2.cancel_config_id,\r\n  t2.payment_content\r\nFROM\r\n(\r\nSELECT \r\n  *,\r\n  (select max(u.email) from `kynaforkids-server-production.kynaforkids.user` u \r\n    where t1.parent_id \u003d u.id) as email\r\nFROM (\r\n  SELECT \r\n      bs.id,\r\n      bss.student_id as student_id, \r\n      case \r\n        when (select btu.user_type_id from `kynaforkids-server-production.kynaforkids.booking_student` btu \r\n          where btu.user_id \u003d bss.student_id) \u003d 1 then \u0027Trẻ em\u0027\r\n        when (select btu.user_type_id from `kynaforkids-server-production.kynaforkids.booking_student` btu \r\n          where btu.user_id \u003d bss.student_id) \u003d 2 then \u0027Người lớn\u0027\r\n      end as user_type,\r\n      (select max(u.parent_id) from `kynaforkids-server-production.kynaforkids.user` u \r\n        where u.id \u003d bss.student_id)  as parent_id,\r\n      (select rft.minDate from `kynaforkids-server-production.accounting_kynaforkids.learning_retention_first_time` rft \r\n        where rft.student_id \u003d bss.student_id) as minDate,\r\n      FORMAT_TIMESTAMP(\"%m/%Y\", bs.begin_at) as learning_date,\r\n      FORMAT_TIMESTAMP(\"%Y\", bs.begin_at) as learning_date_1,\r\n      (select max(bo.accounting_date) from `kynaforkids-server-production.kynaforkids.booking_order` bo where \r\n        bo.student_payment_id \u003d bss.student_payment_id and bo.payment_status \u003d 1 and bo.payment_content in (1,2,3,4)) \r\n        as order_date,\r\n      bs.begin_at,\r\n      bss.revenue,\r\n      (select t1.name from `kynaforkids-server-production.kynaforkids.booking_center` t1, \r\n        `kynaforkids-server-production.kynaforkids.booking_student` t2 \r\n        where bss.student_id \u003d t2.user_id and t2.center_id \u003d t1.id ) as center_name,\r\n    (select max(p.birthday) from `kynaforkids-server-production.kynaforkids.profile` p \r\n      where p.user_id \u003d bss.student_id) as birthday,\r\n    case \r\n    when bs.program_id in (14,15,21,22) then \u0027Group class\u0027\r\n    else \u00271-1\u0027\r\n    end as Loai_CT,\r\n    case\r\n\t\t\twhen bs.program_id \u003d 1 then \u0027Kyna English VIP\u0027\r\n\t\t\twhen bs.program_id \u003d 2 then \u0027Kyna English SPEAK\u0027\r\n\t\t\twhen bs.program_id \u003d 3 then \u0027Chương trình Demo\u0027\r\n\t\t\twhen bs.program_id \u003d 4 then \u0027Kyna English Tutorials\u0027\r\n\t\t\twhen bs.program_id \u003d 5 then \u0027Kyna English Class\u0027\r\n      when bs.program_id \u003d 6 then \u0027Kyna English Junior\u0027\r\n      when bs.program_id \u003d 7 then \u0027Kyna English Primary\u0027\r\n      when bs.program_id \u003d 8 then \u0027Chương trình Test Online\u0027\r\n      when bs.program_id \u003d 9 then \u0027Kyna English SPEAK JUNIOR\u0027\r\n      when bs.program_id \u003d 10 then \u0027Kyna English IELTS\u0027\r\n      when bs.program_id \u003d 11 then \u0027Kyna English Business\u0027\r\n      when bs.program_id \u003d 12 then \u0027Toán Tiểu Học\u0027\r\n      when bs.program_id \u003d 13 then \u0027Test Online (2 shifts)\u0027\r\n      when bs.program_id \u003d 14 then \u0027Kyna English Class Vip\u0027\r\n      when bs.program_id \u003d 15 then \u0027Kyna English Class Speak\u0027 \r\n      when bs.program_id \u003d 16 then \u0027Kyna English Secondary\u0027    \r\n      when bs.program_id \u003d 17 then \u0027Kyna English VIP 45MINS\u0027   \r\n      when bs.program_id \u003d 18 then \u0027Kyna English SPEAK 45MINS\u0027 \r\n      when bs.program_id \u003d 19 then \u0027Kyna English Tutorials 45MINS\u0027 \r\n      when bs.program_id \u003d 20 then \u0027Toán Tiểu Học (Mẫu giáo - Lớp 1 - Lớp 2)\u0027 \r\n      when bs.program_id \u003d 21 then \u0027KE Public Speaking I\u0027 \r\n      when bs.program_id \u003d 20 then \u0027KE Public Speaking II\u0027 \r\n\tend as program,\r\n  (select bst.student_code from `kynaforkids-server-production.kynaforkids.booking_student` bst where bst.user_id \u003d bss.student_id) as student_code,\r\n  bs.status_id,\r\n  bs.cancel_config_id,\r\n  case\r\n    when (select min(cast(bo.payment_content as INT64)) from `kynaforkids-server-production.kynaforkids.booking_order` bo\r\n    where  bo.student_payment_id \u003d bss.student_payment_id) \u003d 1 then \u0027Buổi Học thử\u0027\r\n    when (select bph.payment_fee from `kynaforkids-server-production.kynaforkids.booking_payment_history` bph \r\n    where bph.id \u003d bss.student_payment_id) \u003d 0  then \u0027Buổi tặng\u0027\r\n    else \u0027Buổi Ghi danh\u0027\r\n  end as payment_content\r\n  FROM `kynaforkids-server-production.kynaforkids.booking_session_view` bs\r\n  left join `kynaforkids-server-production.kynaforkids.booking_session_student` bss on bs.id\u003dbss.booking_session_id \r\n  where bs.program_id not in (3,8,13,47,48,53,54,55,56) \r\n  -- and (bs.status_id in (1,2,3,4,5) or (bs.status_id \u003d 7 and bs.cancel_config_id in (1,2,4,8))) \r\n  and \r\n    (select min(cast(bo.payment_content as INt64)) from `kynaforkids-server-production.kynaforkids.booking_order` bo,\r\n    `kynaforkids-server-production.kynaforkids.booking_session_student` bst \r\n    where bst.booking_session_id \u003d bs.id   and bo.student_payment_id \u003d bst.student_payment_id) !\u003d 1\r\n    order by bss.student_id desc) t1 ) t2\r\norder by t2.email;"
}, {
  "table_name": "new_students_month_M_minus_2",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.new_students_month_M_minus_2`\n(\n  year_month STRING,\n  num_new_students_tutoring INT64,\n  num_new_students_AI_single INT64,\n  total_new_students INT64,\n  num_all_students_tutoring INT64,\n  num_all_students_AI_single INT64,\n  num_all_students INT64,\n  rate_new FLOAT64\n);"
}, {
  "table_name": "student_care_f830905a-5fc7-4471-87c2-d28f87f105be_369283zltd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.student_care_f830905a-5fc7-4471-87c2-d28f87f105be_369283zltd`\n(\n  student_code STRING,\n  user_id INT64,\n  student_name STRING,\n  program_name STRING,\n  program_subject INT64,\n  student_status STRING,\n  start_leve STRING,\n  current_level STRING,\n  student_type STRING,\n  country STRING,\n  manager_name STRING,\n  manager_math_name STRING,\n  parent_email STRING,\n  first_time_learning TIMESTAMP,\n  last_time_learning TIMESTAMP,\n  total_lesson INT64,\n  remain_lesson INT64,\n  teacher_type STRING\n);"
}, {
  "table_name": "report_cac_kyna_sale_cost_part_91ba7bf9-c30e-4ed3-98d9-a0dea42a833e",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_cac_kyna_sale_cost_part_91ba7bf9-c30e-4ed3-98d9-a0dea42a833e`\n(\n  year_month STRING,\n  sale_all_cost FLOAT64\n);"
}, {
  "table_name": "report_hieu_qua_partnership_312a51c8-b964-4328-b959-d027909dd30f_33ocsjtjtd",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.report_hieu_qua_partnership_312a51c8-b964-4328-b959-d027909dd30f_33ocsjtjtd`\n(\n  bd_email STRING,\n  created_at DATE,\n  affiliate_category STRING,\n  affiliate_email STRING,\n  affiliate_campaign STRING,\n  dang_bai_dai_su STRING,\n  Blocked_Open STRING,\n  num_lead INT64,\n  num_order INT64,\n  num_order_ghi_danh_lan_dau_hv_moi_hoan_thanh_ko_duyet_chua_duyet INT64,\n  num_order_ghi_danh_lai_hv_cu_hoan_thanh_ko_duyet_chua_duyet INT64,\n  doanh_thu_ghi_danh_lan_dau NUMERIC,\n  doanh_thu_ghi_danh_lai NUMERIC,\n  hoa_hong_vnd FLOAT64\n);"
}, {
  "table_name": "booking_lead_check_history",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.booking_lead_check_history`\n(\n  snapshot_date DATE,\n  table_name STRING,\n  historical_date DATE,\n  week_day_abbr STRING,\n  row_count INT64,\n  lead_new_count INT64,\n  lead_new_1days_before_count INT64,\n  difference_new INT64,\n  percentage_difference_new FLOAT64,\n  lead_upsell_count INT64,\n  lead_upsell_1days_before_count INT64,\n  difference_upsell INT64,\n  percentage_difference_upsell FLOAT64\n);"
}, {
  "table_name": "temp_hoc_vien_kbc_thang_1_2026_phase_3",
  "ddl": "CREATE TABLE `kynaforkids-server-production.datateam_kynaforkids.temp_hoc_vien_kbc_thang_1_2026_phase_3`\n(\n  student_id INT64,\n  num_bookings_to_map INT64\n);"
}]